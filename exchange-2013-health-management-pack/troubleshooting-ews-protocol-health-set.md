---
title: Устранение неполадок в наборе для контроля работоспособности EWS.Protocol
TOCTitle: Устранение неполадок в наборе для контроля работоспособности EWS.Protocol
ms:assetid: 826b2d5b-adbb-4bf5-94b6-0a8de2e3aac0
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/ms.exch.scom.ews.protocol(v=EXCHG.150)
ms:contentKeyID: 53275661
ms.date: 11/14/2015
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Устранение неполадок в наборе для контроля работоспособности EWS.Protocol

 

_**Применимо к:** Exchange Server 2013, Project Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Набор для контроля работоспособности EWS.Protocol отслеживает протокол связи веб-службы Exchange (EWS) на сервере почтовых ящиков. Набор для контроля работоспособности EWS.Protocol тесно связан со следующими наборами для проверки работоспособности.

[Устранение неполадок, связанных с настройками работоспособности веб-служб Exchange](troubleshooting-ews-health-set.md)

[Устранение неполадок, связанных с настройками работоспособности EWS.Proxy](troubleshooting-ews-proxy-health-set.md)

Отображение предупреждения, указывающего на неработоспособное состояние EWS.Protocol, свидетельствует о наличии проблемы, которая может не позволить пользователям получить доступ к Exchange.

## Пояснение

Набор для контроля работоспособности EWS.Protocol включает следующие зонды.

1.  EwsSelfTestProbe

2.  EwsDeepTestProbe

EwsSelfTestProbe не зависит от банка данных. Однако зонд EwsDeepTestProbe зависит от банка данных. Оба этих зонда выполняют операции EWS на сервере почтовых ящиков и используют один и тот же способ проверки подлинности как сервер клиентского доступа. EwsSeftTestProbe вызывает способ **ConvertId**, а EwsDeepTestProbe — **GetFolder**.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Зонд</th>
<th>Настройки работоспособности</th>
<th>Зависимости</th>
<th>Связанные мониторы</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>EwsSelfTestProbe</p></td>
<td><p>EWS.Protocol</p></td>
<td><p>Active Directory</p></td>
<td><p>EWSSelfTestMonitor</p></td>
</tr>
<tr class="even">
<td><p>EwsDeepTestProbe</p></td>
<td><p>EWS.Protocol</p></td>
<td><p>Банк данных</p></td>
<td><p>EWSDeepTestMonitor</p></td>
</tr>
</tbody>
</table>


Дополнительные сведения о зондах и мониторах см. в разделе [Работоспособность и производительность сервера](https://technet.microsoft.com/ru-ru/library/jj150551\(v=exchg.150\)).

Если вы получите оповещение, связанное с этими настройками работоспособности, сообщение электронной почты содержит приведенные ниже сведения.

1.  Имя сервера почтовых ящиков, от которого исходило предупреждение

2.  Полная трассировка исключения последней ошибки, включая диагностические данные и определенные сведения о заголовках HTTP

3.  Время возникновения инцидента.

## Распространенные проблемы

Этот зонд может не работать по любой из следующих распространенных причин:

  - Пул приложений EWS на отслеживаемом сервере почтовых ящиков работает неправильно.

  - Контроллеры домена не отвечают или у них нет связи с сервером почтовых ящиков.

  - База данных пользователя не подключена, или для конкретного почтового ящика недоступен банк данных.

## Действия пользователя

Служба может восстановить работу после отображения оповещения. Поэтому если вы получите оповещение о неработоспособном состоянии настроек работоспособности, сначала убедитесь в наличии данной проблемы. Если проблема не устранена, выполните соответствующие действия по восстановлению, указанные в приведенных ниже разделах.

## Проверка наличия проблемы

1.  Определите имена настроек работоспособности и сервера, указанные в оповещении.

2.  В сообщении приводятся подробные сведения о точной причине возникновения оповещения. В большинстве случаев в сообщении приводится достаточно сведений по устранению неполадок для определения основной причины проблемы. Если в сообщении приводятся непонятные сведения:
    
    1.  Откройте Командная консоль Exchange, а затем выполните следующую команду, чтобы извлечь подробные сведения о настройках работоспособности, с которыми связано оповещение.
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        Например, чтобы получить сведения о наборе для контроля работоспособности EWS.Protocol для сервера server1.contoso.com, выполните следующую команду:
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -eq "EWS.Protocol"}
    
    2.  Просмотрите выходные данные команды, чтобы определить монитор, сообщивший об ошибке. Параметр **AlertValue** монитора, вызвавшего оповещение, будет иметь значение `Unhealthy`.
    
    3.  Повторно запустите связанный зонд для монитора, находящегося в неработоспособном состоянии. Обратитесь к таблице в разделе Пояснение, чтобы найти связанный зонд. Для этого выполните следующую команду.
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        Например, предположим, что неисправен монитор **EWSSelfTestMonitor**. С этим монитором связан зонд **EWSSelfTestProbe**. Чтобы запустить этот зонд на сервере server1.contoso.com, выполните следующую команду.
        
            Invoke-MonitoringProbe EWS.Protocol\EWSSelfTestProbe -Server server1.contoso.com | Format-List
    
    4.  В выходных данных команды просмотрите значение параметра **Результат** зонда. Если этот параметр имеет значение **Succeeded**, ошибка была временной и в настоящее время устранена. В противном случае обратитесь к действиям по восстановлению, приведенным в следующих разделах.

## Действия по восстановлению EWSSelfTestMonitor и EWSDeepTestMonitor

Это оповещение обычно возникает для серверов почтовых ящиков.

1.  Запустите диспетчер IIS, а затем подключитесь к серверу, сообщающему о проблеме, чтобы определить, запущен ли MSExchangeServicesAppPool на сервере клиентского доступа и сервере почтовых ящиков.

2.  Найдите MailboxDatabase для зондов со сбоями и затем убедитесь, что MailboxDatabase активен для MailboxServer и банк сообщений находится в работоспособном состоянии.

3.  Щелкните **Пулы приложений**, а затем перезапустите пул приложений **MSExchangeServicesAppPool**, выполнив следующую команду из командной консоли:
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeServicesAppPool

4.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

5.  Если проблема все еще не устранена, повторно запустите службу IIS с помощью служебной программы IISReset.

6.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

7.  Если проблема все еще не устранена, просмотрите файлы журнала протокола на сервере почтовых ящиков. На сервере почтовых ящиков журналы находятся в *\<установочном каталоге сервера exchange\>*\\Logging\\Ews folder.

8.  Создайте тестовую учетную запись, а затем войдите в систему, используя тестовую учетную запись для данного сервера почтовых ящиков через порт 444 https://*\<имя\_сервера\>*:444/ews/exchange.asmx. Если тест выполнен успешно, проблема может повлиять на определенную базу данных почтовых ящиков или сервер почтовых ящиков, на котором расположен наблюдаемый почтовый ящик. Повторите этот шаг, используя тестовую учетную запись на этой базе данных.

9.  Проверьте наличие предупреждений в наборе для контроля работоспособности EWS.Protocol, которые могут указывать на проблему, влияющую на определенный сервер почтовых ящиков.

10. Если проблема не устранена, перезапустите сервер. Для этого сначала для отработки отказа баз данных, размещенных на сервере, выполните следующую команду.
    
        Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $true
    
    В этом и всех последующих примерах кодов замените*server1.contoso.com* на реальное имя сервера.

11. Убедитесь, что все базы данных перемещены с сервера, который сообщает о проблеме. Для этого выполните следующую команду.
    
        Get-MailboxDatabaseCopyStatus -Server server1.contoso.com | Group Status
    
    Если в выводе команды не показываются активные копии на сервере, его можно перезапустить. Перезагрузите сервер.

12. После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

13. Если с зондом все нормально, выполните отработку отказа баз данных с помощью следующей команды:
    
        Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $false

14. Если зонд все равно не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Дополнительные сведения

[Новые возможности в Exchange 2013](https://technet.microsoft.com/ru-ru/library/jj150540\(v=exchg.150\))

