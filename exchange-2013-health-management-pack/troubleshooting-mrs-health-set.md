---
title: Устранение неполадок в наборе для контроля работоспособности MRS
TOCTitle: Устранение неполадок в наборе для контроля работоспособности MRS
ms:assetid: 21947ed6-1584-4db9-9cd6-f6c1de22e352
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/ms.exch.scom.mrs(v=EXCHG.150)
ms:contentKeyID: 53275654
ms.date: 11/14/2015
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Устранение неполадок в наборе для контроля работоспособности MRS

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2015-03-09_

Настройки работоспособности службы репликации почтовых ящиков (MRS) отслеживают общее состояние службы MRS.

## Пояснение

Служба MRS отслеживается следующими зондами и мониторами.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Зонд</th>
<th>Настройки работоспособности</th>
<th>Зависимости</th>
<th>Связанные мониторы</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>MRSServiceCrashingProbe</p></td>
<td><p>MRS</p></td>
<td><p>Банк данных</p></td>
<td><p>MRSServiceCrashingMonitor</p></td>
</tr>
</tbody>
</table>


Дополнительные сведения о зондах и мониторах см. в разделе [Работоспособность и производительность сервера](https://technet.microsoft.com/ru-ru/library/jj150551\(v=exchg.150\)).

## Действия пользователя

Служба может восстановить работу после отображения оповещения. Поэтому если вы получите оповещение о неработоспособном состоянии настроек работоспособности, сначала убедитесь в наличии данной проблемы. Если проблема не устранена, выполните соответствующие действия по восстановлению, указанные в приведенных ниже разделах.

## Проверка наличия проблемы

1.  Определите имена настроек работоспособности и сервера, указанные в оповещении.

2.  В сообщении приводятся подробные сведения о точной причине возникновения оповещения. В большинстве случаев в сообщении приводится достаточно сведений по устранению неполадок для определения основной причины проблемы. Если в сообщении приводятся непонятные сведения:
    
    1.  Откройте Командная консоль Exchange, а затем выполните следующую команду, чтобы извлечь подробные сведения о настройках работоспособности, с которыми связано оповещение.
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        Например, чтобы получить сведения о наборе для контроля работоспособности MRS для сервера server1.contoso.com, выполните следующую команду:
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -eq "MRS"}
    
    2.  Просмотрите выходные данные команды, чтобы определить монитор, сообщивший об ошибке. Параметр **AlertValue** монитора, вызвавшего оповещение, будет иметь значение `Unhealthy`.
    
    3.  Повторно запустите связанный зонд для монитора, находящегося в неработоспособном состоянии. Обратитесь к таблице в разделе Пояснение, чтобы найти связанный зонд. Для этого выполните следующую команду.
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        Например, предположим, что неисправен монитор **MRSServiceCrashingMonitor**. С ним будет связан зонд **MRSServiceCrashingProbe**. Чтобы запустить этот зонд на сервере server1.contoso.com, выполните следующую команду.
        
            Invoke-MonitoringProbe MRS\MRSServiceCrashingProbe -Server server1.contoso.com | Format-List
    
    4.  В выходных данных команды просмотрите значение параметра **Результат** зонда. Если этот параметр имеет значение **Succeeded**, ошибка была временной и в настоящее время устранена. В противном случае обратитесь к действиям по восстановлению, приведенным в следующих разделах.

## Распространенные проблемы

Если вы получите оповещение, связанное с настройками работоспособности, сообщение электронной почты содержит приведенные ниже сведения.

  - Имя сервера, отправившего оповещение.

  - Время и дата возникновения оповещения.

  - Используемый механизм проверки подлинности и сведения об учетных данных.

  - Полная трассировка исключения, связанного с последней ошибкой, включая диагностические данные и конкретные сведения о заголовке HTTP.
    
    Сведения в полной трассировке исключения можно использовать для устранения проблемы. Исключение, создаваемое зондом, содержит поле "Причина сбоя" с описанием причины сбоя.

**Почтовый ящик заблокирован**

Если почтовый ящик заблокирован, вы можете получить следующее оповещение:

*MailboxIdentity: namprd03.prod.outlook.com/Microsoft Exchange Hosted Organizations/example.com/User6 MailboxGuid: Primary (00000000-abcd-01234-5678-1234567890ab) RequestFlags: IntraOrg, Pull, Protected База данных: exampledb-db089 Исключение: MapiExceptionADUnavailable: не удается предварительно заполнить кэш для пользователя…*

Это указывает на то, что почтовый ящик заблокирован. Чтобы разблокировать его, выполните следующую команду:

    New-MailboxRepairRequest -CorruptionType LockedMoveTarget -Identity <mailboxIdentity> [-Archive]

**Примечание**   В этой команде замените \<*mailboxIdentity*\> на имя почтового ящика, указанное в сообщении электронной почты как **MailboxIdentity**. Если почтовый ящик архивный, добавьте флаг **–Archive**. Вы можете определить, является ли почтовый ящик основным или архивным, изучив поле **MailboxGuid** в оповещении.

**Поврежденное задание миграции**

При повреждении задания миграции вы можете получить следующее оповещение:

*Уведомление, созданное MailboxMigration 07.09.2012 г. в 21:08:32. Сведения: Диагностические сведения: ProcessCacheEntry: Основная организация: /o=ExchangeLabs/ou=Административная группа Exchange (FYDIBOHF23SPDLT)/cn=Получатели/cn=e80fc128879e452ebc882f6bca7007fa-Migration.8*

Повреждение происходит, если в метаданных миграции возникли ошибки. После повреждения задания корпорация Майкрософт получит отчет программы "Доктор Ватсон", который будет проанализирован. Чтобы исправить эту проблему, удалите пакет миграции и затем воссоздайте его. Для этого выполните указанные ниже действия.

1.  Чтобы удалить поврежденный пакет, выполните следующую команду:
    
        Remove-MigrationBatch -Identity

2.  Чтобы воссоздать пакетное задание, выполните следующую команду:
    
        New-MigrationBatch -Local -Name

Дополнительные сведения см. в разделе [Командлеты Exchange 2013](https://technet.microsoft.com/ru-ru/library/bb124413\(v=exchg.150\))

**Предупреждение MailboxMigration: CriticalError**

При возникновении критической ошибки во время миграции вы можете получить следующее оповещение:

*Уведомление, созданное MailboxMigration 07.09.2012 г. в 21:08:32. Сведения: Диагностические сведения: ProcessCacheEntry: Основная организация: /o=ExchangeLabs/ou=Административная группа Exchange (FYDIBOHF23SPDLT)/cn=Получатели/cn=e80fc128879e452ebc882f6bca7007fa-Migration.8*

Чтобы устранить эту проблему, повторите миграцию. Для этого выполните следующую команду или нажмите кнопку **Пуск** в Центре администрирования Exchange (EAC).

    Call start-migrationbatch -Identity batchName

При возникновении этой проблемы корпорация Майкрософт получает отчет от программы "Доктор Ватсон" для анализа.

**Служба репликации Exchange не запущена.**

Если ошибка возникает по этой причине, вы можете проверить работоспособность службы с помощью следующей команды:

    Test-MRSHealth <servername> -MonitoringContext:$true

Можно также попробовать запустить службу, выполнив следующую команду:

    Start-Service msexchangemailboxreplication

**Ошибка проверки связи MSExchangeMailboxReplication RCP**

Если вы видите эту причину ошибки, вы можете получить следующее оповещение:

*Ошибка MRS обнаружена 26.06.2012 г. в 6:08:47. Сведения: Проверка связи MRS RPC для сервера \<имя\_сервера\> завершилась со следующей ошибкой: Конечная точка RPC для службы репликации почтовых ящиков Microsoft Exchange не отвечает:*

Если возникает эта ошибка, вы можете проверить работоспособность службы с помощью следующей команды:

    Test-MRSHealth <servername> -MonitoringContext:$true

Можно также попробовать перезапустить службу, выполнив следующую команду:

    Restart-Service msexchangemailboxreplication

**В службе MSExchangeMailboxReplication постоянно возникает сбой**

Если в службе MSExchangeMailboxReplication возникает сбой или она перестает отвечать, вы можете получить следующее оповещение:

*В процессе MRS произошел сбой по крайней мере 3 раза за последний 01:00:00. \<b\>Сообщение "Доктора Ватсон":\</b\> Отчет "Доктора Ватсон" будет отправлен для процесса с кодом: 41432 со следующими параметрами: E12, \<имя\_сервера\>, 15.00.0516.024, MSExchangeMailboxReplication, M.Exchange.MailboxReplicationService, M.E.M.BaseJob.BeginJob, System.ApplicationException, 7ec9, 15.00.0516.024. ErrorReportingEnabled: True.*

Если возникает эта ошибка, вы можете проверить работоспособность службы с помощью следующей команды:

    Test-MRSHealth <servername> -MonitoringContext:$true

Можно также попробовать перезапустить службу, выполнив следующую команду:

    Restart-Service msexchangemailboxreplication

**MSExchangeMailboxReplication не сканирует очереди MDB**

Если службе MSExchangeMailboxReplication не удается проверить очереди, вы можете получить следующее оповещение:

*Ошибка MRS обнаружена 12.06.2012 г. в 18:20:44. Сведения: Проверка сканирования очередей MRS для сервера \<имя\_сервера\> завершилась со следующей ошибкой: Служба репликации почтовых ящиков Microsoft Exchange не проверяет очереди базы данных почтовых ящиков на наличие заданий. Время последней проверки: 04:38:02.1959439..*

Если возникает эта ошибка, вы можете проверить работоспособность службы с помощью следующей команды:

    Test-MRSHealth <servername> -MonitoringContext:$true

Можно также попробовать перезапустить службу, выполнив следующую команду:

    Restart-Service msexchangemailboxreplication

**Дополнительные действия для устранения неполадок**

1.  Запустите диспетчер служб IIS и подключитесь к серверу, на котором возникла ошибка, чтобы проверить, запущен ли пул приложений **MSExchangeServicesAppPool**.

2.  В диспетчере служб IIS щелкните **Пулы приложений** и перезапустите пул **MSExchangeServicesAppPool**, выполнив в командной консоли следующую команду:
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeServicesAppPool

3.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

4.  Если проблема сохраняется, перезапустите службы IIS с помощью программы IISReset или выполнив следующую команду:
    
        Iisreset /noforce

5.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

6.  Если проблема не устранена, перезапустите сервер.

7.  После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

8.  Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Дополнительные сведения

[Новые возможности в Exchange 2013](https://technet.microsoft.com/ru-ru/library/jj150540\(v=exchg.150\))

[Командлеты Exchange 2013](https://technet.microsoft.com/ru-ru/library/bb124413\(v=exchg.150\))

