---
title: Устранение неполадок с настройками работоспособности автообнаружения
TOCTitle: Устранение неполадок с настройками работоспособности автообнаружения
ms:assetid: bc933621-df73-4d1d-bdef-825b98be8e09
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/ms.exch.scom.autodiscover(v=EXCHG.150)
ms:contentKeyID: 53275671
ms.date: 11/14/2015
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Устранение неполадок с настройками работоспособности автообнаружения

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Настройки работоспособности автообнаружения следят за общей работоспособностью службы автообнаружения для клиентов.

Если вы получили оповещение о неисправности автообнаружения, значит существует проблема, которая может предотвращать доступ пользователей к автообнаружению.

## Пояснение

Слежение за службой автообнаружения выполняется с помощью следующих зондов и средств мониторинга.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Зонд</th>
<th>Настройки работоспособности</th>
<th>Зависимости</th>
<th>Связанные мониторы</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>AutodiscoverCtpProbe</p></td>
<td><p>Автообнаружение</p></td>
<td><p>Active Directory</p></td>
<td><p>AutodiscoverCtpMonitor</p></td>
</tr>
</tbody>
</table>


Дополнительные сведения о зондах и мониторах см. в разделе [Работоспособность и производительность сервера](https://technet.microsoft.com/ru-ru/library/jj150551\(v=exchg.150\)).

## Распространенные проблемы

Этот зонд может не работать по любой из следующих распространенных причин:

  - Не отвечает пул приложений автообнаружения (MSExchangeAutodiscoverAppPool), размещенный на наблюдаемом сервере клиентского доступа (CAS), Или не отвечает пул приложений автообнаружения, размещенный на одном или нескольких серверах почтовых ящиков.

  - На сервере клиентского доступа произошли проблемы с сетью, поэтому он не может подключиться к серверу почтовых ящиков или контроллеру домена.

  - Введены неправильные данные учетной записи наблюдения.

  - Контроллеры доменов не отвечают.

## Действия пользователя

Служба может восстановиться после отправки оповещения. Поэтому если вы получите оповещение о неработоспособном состоянии настроек работоспособности, сначала убедитесь в наличии данной проблемы. Если проблема не устранена, выполните соответствующие действия по восстановлению, указанные в приведенных ниже разделах.

## Проверка наличия проблемы

1.  Определите имена настроек работоспособности и сервера, указанные в оповещении.

2.  В сообщении приводятся подробные сведения о точной причине возникновения оповещения. В большинстве случаев в сообщении приводится достаточно сведений по устранению неполадок для определения основной причины проблемы. Если в сообщении приводятся непонятные сведения:
    
    1.  откройте Командная консоль Exchange, а затем запустите следующую команду, чтобы получить сведения о настройках работоспособности, которые выдали предупреждение:
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        Например, чтобы получить сведения о настройках работоспособности автообнаружения для server1.contoso.com, выполните следующую команду:
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -eq "Autodiscover"}
    
    2.  Просмотрите выходные данные команды, чтобы определить монитор, сообщивший об ошибке. Параметр **AlertValue** монитора, вызвавшего оповещение, имеет значение `Unhealthy`.
    
    3.  Еще раз запустите зонд для средства мониторинга, которое находится в неисправном состоянии. Обратитесь к таблице в разделе Пояснение, чтобы найти связанный зонд. Для этого выполните следующую команду.
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        Допустим, что неисправно средство мониторинга **AutodiscoverCtpMonitor**. Связанный с этим средством мониторинга зонд — **AutodiscoverCtpProbe**. Чтобы запустить этот зонд на сервере server1.contoso.com, выполните следующую команду.
        
            Invoke-MonitoringProbe Autodiscover\AutodiscoverCtpProbe -Server server1.contoso.com | Format-List
    
    4.  В выходных данных команды просмотрите значение параметра **Результат** зонда. Если этот параметр имеет значение **Succeeded**, ошибка была временной и в настоящее время устранена. В противном случае обратитесь к действиям по восстановлению, приведенным в следующих разделах.

## Действия по восстановлению AutodiscoverCtpMonitor

Если вы получите оповещение, связанное с настройками работоспособности, сообщение электронной почты содержит приведенные ниже сведения.

  - Имя сервера, отправившего оповещение.

  - имя сервера почтовых ящиков, который отслеживался зондом;

  - Время и дата возникновения оповещения.

  - Используемый механизм проверки подлинности и сведения об учетных данных.

  - Полная трассировка исключения, связанного с последней ошибкой, включая диагностические данные и конкретные сведения о заголовке HTTP.

Сведения в полной трассировке исключения можно использовать для устранения проблемы. Исключение, создаваемое зондом, содержит поле "Причина сбоя" с описанием причины сбоя. Ниже приведены примеры возможных причин сбоя.

  - **X-FEServer**. Указывает сервер клиентского доступа, на котором запускался зонд.

  - **X-CalculatedBETarget**.   Указывает сервер почтовых ящиков, на который маршрутизирован запрос.

  - **X-DiagInfo**.   Указывает сервер почтовых ящиков, который получил запрос.

Для устранения данной проблемы выполните действия, указанные ниже.

1.  Проверьте журналы протокола на серверах клиентского доступа и почтовых ящиков. По умолчанию журналы протокола расположены в следующей папке сервера клиентского доступа: ***\<каталог установки сервера Exchange\>*\\Logging\\HttpProxy\\Autodiscover**. По умолчанию файлы журналов протокола на сервере почтовых ящиков расположены в папке ***\<каталог установки Exchange Server\>*\\Logging\\Autodiscover**.

2.  Создайте тестовую учетную запись пользователя, а затем войдите из нее на сервер клиентского доступа. Например, войдите в систему со следующего адреса: https://*\<имя\_сервера\>*/autodiscover/autodiscover.xml.
    
    Если имя учетной записи тестового пользователя будет пропущено, то проблема может повлиять на сервер почтовых ящиков, на котором размещен отслеживаемый почтовый ящик.
    
    Повторите предыдущие действия, используя тестовую учетную запись для входа на сервер почтовых ящиков. В случае неудачной попытки попробуйте выполнить тест на различных серверах клиентского доступа, чтобы подтвердить, что проблема происходит на определенном сервере клиентского доступа, а не сервере почтовых ящиков.

3.  Проверьте сетевое подключение между серверами клиентского доступа и почтовых ящиков. С помощью служебной программы ping.exe убедитесь, что отвечает каждый сервер.

4.  Проверьте наличие оповещений, которые связаны с настройками работоспособности Autodiscover.Proxy и могут указывать на проблему с определенным сервером почтовых ящиков. Подробнее см. в разделе [Устранение неполадок, связанных с наборами средств для проверки работоспособности Autodiscover.Proxy](troubleshooting-autodiscover-proxy-health-set.md).

5.  Проверьте, нет ли предупреждений настроек работоспособности Autodiscover.Protocol, которые могут указать на проблему с сервером почтовых ящиков. Подробнее см. в разделе [Устранение неполадок, связанных с настройками работоспособности Autodiscover.Protocol](troubleshooting-autodiscover-protocol-health-set.md).

6.  Запустите диспетчер IIS, а затем подключитесь к серверу, который сообщает о неполадке. Убедитесь, что пул приложений **MSExchangeAutodiscoverAppPool** работает на серверах клиентского доступа и почтовых ящиков.

7.  В диспетчере IIS щелкните **Пулы приложений**, а затем перезапустите пул приложений **MSExchangeAutodiscoverAppPool**, выполнив следующую команду из командной консоли:
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeAutodiscoverAppPool

8.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

9.  Если проблема не устранена, перезапустите службы IIS с помощью служебной программы IISReset или следующей команды.
    
        Iisreset /noforce

10. Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

11. Если проблема не устранена, перезапустите сервер.

12. После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

13. Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Дополнительные сведения

[Новые возможности в Exchange 2013](https://technet.microsoft.com/ru-ru/library/jj150540\(v=exchg.150\))

[Командлеты Exchange 2013](https://technet.microsoft.com/ru-ru/library/bb124413\(v=exchg.150\))

