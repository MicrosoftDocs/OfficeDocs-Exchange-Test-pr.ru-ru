---
title: Устранение неполадок, связанных с настройками работоспособности веб-служб Exchange
TOCTitle: Устранение неполадок, связанных с настройками работоспособности веб-служб Exchange
ms:assetid: f5aaacdd-7f4a-4d63-8440-1c564e644dfc
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/ms.exch.scom.ews(v=EXCHG.150)
ms:contentKeyID: 53275676
ms.date: 11/14/2015
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Устранение неполадок, связанных с настройками работоспособности веб-служб Exchange

 

_**Применимо к:** Exchange Server 2013, Project Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Группа работоспособности веб-служб Exchange (EWS) отвечает за мониторинг общей работоспособности веб-служб Exchange. Настройки работоспособности веб-служб Exchange тесно связаны со следующими настройками работоспособности.

[Устранение неполадок в наборе для контроля работоспособности EWS.Protocol](troubleshooting-ews-protocol-health-set.md)

[Устранение неполадок, связанных с настройками работоспособности EWS.Proxy](troubleshooting-ews-proxy-health-set.md)

Если вы получите оповещение о неработоспособном состоянии настроек работоспособности веб-служб Exchange, это указывает на проблему, вследствие которой пользователи не могут обмениваться данными с сервером Exchange.

## Пояснение

За мониторинг веб-служб Exchange отвечают приведенные ниже зонды и мониторы.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Зонд</th>
<th>Настройки работоспособности</th>
<th>Зависимости</th>
<th>Связанные мониторы</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>EwsCtpProbe</p></td>
<td><p>EWS</p></td>
<td><p>Банк данных</p>
<p>Доменные службы Active Directory (AD DS)</p></td>
<td><p>EwsCtpMonitor (настройки работоспособности веб-служб Exchange)</p></td>
</tr>
<tr class="even">
<td><p>EwsSelfTestProbe</p></td>
<td><p>EWS.Protocol</p></td>
<td><p>Доменные службы Active Directory (AD DS)</p></td>
<td><p>EWSSelfTestMonitor</p></td>
</tr>
<tr class="odd">
<td><p>EwsDeepTestProbe</p></td>
<td><p>EWS.Protocol</p></td>
<td><p>Банк данных</p></td>
<td><p>EWSDeepTestMonitor</p></td>
</tr>
</tbody>
</table>


Этот зонд выполняет полный вход в веб-службы Exchange с сервера клиентского доступа на сервер почтовых ящиков с учетной записи наблюдения. Данный зонд использует метод **GetFolder** в веб-службах Exchange. Дополнительные сведения о зондах и мониторах см. в разделе [Работоспособность и производительность сервера](https://technet.microsoft.com/ru-ru/library/jj150551\(v=exchg.150\)).

## Распространенные проблемы

Этот зонд может не работать по любой из следующих распространенных причин:

  - Существует несоответствие между механизмами проверки подлинности, которые используются зондом и виртуальным каталогом сервера клиентского доступа.

  - Не отвечает пул приложений веб-служб Exchange на сервере клиентского доступа, за которым ведется наблюдение.

  - На сервере клиентского доступа возникают проблемы с сетью при подключении к серверу почтовых ящиков.

  - На сервере клиентского доступа возникают проблемы с обменом данными при подключении к контроллерам доменов.

  - Контроллеры доменов не отвечают.

  - Не отвечает пул приложений веб-служб Exchange, расположенный на одном или нескольких серверах почтовых ящиков.

  - База данных пользователя не подключена, или для конкретного почтового ящика недоступен банк данных.

  - Возникли проблемы в работе службы банка данных на одном или нескольких серверах почтовых ящиков.

## Действия пользователя

Служба может восстановить работу после отображения оповещения. Поэтому если вы получите оповещение о неработоспособном состоянии настроек работоспособности, сначала убедитесь в наличии данной проблемы. Если проблема не устранена, выполните соответствующие действия по восстановлению, указанные в приведенных ниже разделах.

## Проверка наличия проблемы

1.  Определите имена настроек работоспособности и сервера, указанные в оповещении.
    
    Если вы получите оповещение, связанное с этими настройками работоспособности, сообщение электронной почты содержит приведенные ниже сведения.
    
    1.  Имя сервера клиентского доступа, на котором возникло оповещение.
    
    2.  Имя сервера почтовых ящиков, за которым в качестве целевого ресурса вел наблюдение сервер почтовых ящиков.
    
    3.  Полная трассировка исключения, связанного с последней ошибкой, включая диагностические данные и конкретные сведения о заголовке HTTP.
    
    4.  Время возникновения инцидента.
    
    5.  Используемый механизм проверки подлинности и сведения об учетных данных.
    
    Сведения о трассировке исключения предоставляют наиболее важные данные о причине сбоя зонда. Сообщение об эскалации также содержит приведенные ниже заголовки HTTP.
    
    1.  **X-FEServer**. Указывает сервер клиентского доступа, на котором запускался зонд.
    
    2.  **X-TargetBEServer**. Указывает сервер MBX, на который направлялся запрос.
    
    3.  **X-DiagInfo**. Указывает сервер MBX, который принял запрос.

2.  В сообщении приводятся подробные сведения о точной причине возникновения оповещения. В большинстве случаев в сообщении приводится достаточно сведений по устранению неполадок для определения основной причины проблемы. Если в сообщении приводятся непонятные сведения:
    
    1.  Откройте Командная консоль Exchange, а затем выполните следующую команду, чтобы извлечь подробные сведения о настройках работоспособности, с которыми связано оповещение.
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        Например, чтобы извлечь подробные сведения о настройках работоспособности веб-служб Exchange относительно сервера server1.contoso.com, выполните следующую команду.
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -eq "EWS"}
    
    2.  Просмотрите выходные данные команды, чтобы определить монитор, сообщивший об ошибке. Параметр **AlertValue** монитора, вызвавшего оповещение, будет иметь значение `Unhealthy`.
    
    3.  Повторно запустите связанный зонд для монитора, который находится в неработоспособном состоянии. Обратитесь к таблице в разделе Пояснение, чтобы найти связанный зонд. Для этого выполните следующую команду.
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        Предположим, что в отношении настроек работоспособности веб-служб Exchange не работает монитор **EWSCtpMonitor**. С этим монитором связан зонд **EWSCtpProbe**. Чтобы запустить этот зонд на сервере server1.contoso.com, выполните следующую команду.
        
            Invoke-MonitoringProbe EWS\EWSCtpProbe -Server server1.contoso.com | Format-List
    
    4.  В выходных данных команды просмотрите значение параметра **Результат** зонда. Если этот параметр имеет значение **Succeeded**, ошибка была временной и в настоящее время устранена. В противном случае обратитесь к действиям по восстановлению, приведенным в следующих разделах.

## Действия по восстановлению монитора EwsCtpMonitor

1.  Запустите диспетчер IIS и подключитесь к серверу, который сообщает о проблеме, чтобы определить, запущен ли на серверах клиентского доступа и почтовых ящиков пул приложений **MSExchangeServicesAppPool**.

2.  Найдите базу данных почтовых ящиков для неисправных зондов. Затем убедитесь, что база данных почтовых ящиков активна для сервера почтовых ящиков, а также что банк данных работоспособен.

3.  Щелкните **Пулы приложений**, а затем перезапустите пул приложений **MSExchangeServicesAppPool**, выполнив следующую команду из командной консоли:
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeServicesAppPool

4.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

5.  Если проблема не устранена, перезапустите все службы IIS с помощью служебной программы IISReset.

6.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

7.  Если проблема не устранена, просмотрите файлы журнала протокола на серверах клиентского доступа и почтовых ящиков. Журналы протокола для сервера клиентского доступа расположены в папке *\<каталог установки Exchange Server\>\\Logging\\HttpProxy\\Ews*. На сервере почтовых ящиков журналы находятся в папке *\<каталог установки Exchange Server\>\\Logging\\Ews*.

8.  Создайте тестовую учетную запись пользователя, а затем войдите из нее на данный сервер клиентского доступа. Например, войдите в систему со следующего адреса: https:// \<имя\_сервера\>/ews/exchange.asmx. Если проблема не устранена, попытайтесь войти на другой сервер клиентского доступа, чтобы определить, не связана ли проблема с этим сервером клиентского доступа, а не с сервером почтовых ящиков. Если имя пользователя тестовой учетной записи будет принято, возможно, проблема с конкретной базой данных почтовых ящиков или сервером почтовых ящиков, на котором расположен почтовый ящик наблюдения. Повторите эти действия, используя тестовую учетную запись, расположенную в базе данных почтовых ящиков.

9.  Проверьте сетевое подключение между серверами клиентского доступа и почтовых ящиков.

10. Проверьте наличие оповещений, которые связаны с настройками работоспособности EWS.Proxy и могут указывать на проблему с определенным сервером клиентского доступа.

11. Проверьте наличие оповещений, которые связаны с настройками работоспособности EWS.Protocol и могут указывать на проблему с определенным сервером почтовых ящиков.

12. Если проблема не устранена, перезапустите сервер. Для этого сначала выполните отработку отказа на базах данных, размещенных на сервере. Для этого выполните следующую команду.
    
        Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $true
    
    **Примечание**. В этом и всех последующих примерах кодов замените *server1.contoso.com* на действительное имя сервера.

13. Убедитесь, что все базы данных перемещены с сервера, который сообщает о проблеме. Для этого выполните следующую команду.
    
        Get-MailboxDatabaseCopyStatus -Server server1.contoso.com | Group Status
    
    Если в выходных данных команды не отображаются активные копии на сервере, перезапустите сервер.

14. После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

15. Если зонд успешно выполняет работу, выполните отработку отказа на базах данных обратно на сервер почтовых ящиков, выполнив следующую команду.
    
        Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $false

16. Если зонд все равно не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Дополнительные сведения

[Командлеты Exchange 2013](https://technet.microsoft.com/ru-ru/library/bb124413\(v=exchg.150\))

[Новые возможности в Exchange 2013](https://technet.microsoft.com/ru-ru/library/jj150540\(v=exchg.150\))

