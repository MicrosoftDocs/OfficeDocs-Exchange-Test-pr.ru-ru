---
title: Устранение неполадок в наборе для контроля работоспособности OWA.Protocol
TOCTitle: Устранение неполадок в наборе для контроля работоспособности OWA.Protocol
ms:assetid: fe172da8-65d3-43e0-ba62-d36a1b05fc11
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/ms.exch.scom.owa.protocol(v=EXCHG.150)
ms:contentKeyID: 53275678
ms.date: 11/14/2015
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Устранение неполадок в наборе для контроля работоспособности OWA.Protocol

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Набор для контроля работоспособности OWA.Protocol предназначен для отслеживания работоспособности протокола Outlook Web App на сервере почтовых ящиков.

Если вы видите предупреждение о том, что OWA.Protocol работает неправильно, это означает, что появилась проблема, которая может помешать пользователям получать доступ к почтовым ящикам с помощью Outlook Web App.

## Пояснение

Служба OWA отслеживается следующими зондами и мониторами.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Зонд</th>
<th>Настройки работоспособности</th>
<th>Зависимости</th>
<th>Связанные мониторы</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>OwaSelfTestProbe</p></td>
<td><p>OWA.Protocol</p></td>
<td><p>Нет</p></td>
<td><p>OwaSelfTestMonitor</p></td>
</tr>
<tr class="even">
<td><p>OwaDeepTestProbe</p></td>
<td><p>OWA.Protocol</p></td>
<td><p>Active Directory</p>
<p>Банк данных</p></td>
<td><p>OwaDeepTestMonitor</p></td>
</tr>
</tbody>
</table>


Зонд **OwaSelfTestProbe** отправляет один HTTP-запрос на следующий адрес: https://localhost:444/owa/exhealth.check. Зонд подтверждает, что пул приложений отвечает, возвращая код состояния **200 OK**. Этот зонд не зависит от других компонентов Exchange.

Зонд **OwaDeepTestProbe** применяется к каждой базе данных почтовых ящиков, используя копии на текущем сервере. Зонд определяет, можно ли выполнить полный вход на данный сервер. Для этого он симулирует тип трафика, формируемого сервером клиентского доступа, для заданного сервера. Зонду требуются доменные службы Active Directory для проверки подлинности и хранилище почтовых ящиков для доступа к почтовым ящикам. Дополнительные сведения о зондах и мониторах см. в разделе [Работоспособность и производительность сервера](https://technet.microsoft.com/ru-ru/library/jj150551\(v=exchg.150\)).

## Распространенные проблемы

Проблема с этим зондом может произойти по любой из следующих причин.

  - Пул приложений OWA, размещенный на отслеживаемом сервере клиентского доступа или на сервере почтовых ящиков, не отвечает.

  - На сервере клиентского доступа или сервере почтовых ящиков возникли проблемы, и он не может подключиться к другому серверу или контроллеру домена.

  - Введены неправильные данные учетной записи наблюдения.

  - База данных пользователя не подключена, или для данного почтового ящика недоступен банк данных.

  - Банк данных не отвечает.

  - Контроллеры доменов не отвечают.

## Действия пользователя

Служба может восстановить работу после отображения оповещения. Поэтому если вы получите оповещение о неработоспособном состоянии настроек работоспособности, сначала убедитесь в наличии данной проблемы. Если проблема не устранена, выполните соответствующие действия по восстановлению, указанные в приведенных ниже разделах.

## Проверка наличия проблемы

1.  Определите имена настроек работоспособности и сервера, указанные в оповещении.

2.  В сообщении приводятся подробные сведения о точной причине возникновения оповещения. В большинстве случаев в сообщении приводится достаточно сведений по устранению неполадок для определения основной причины проблемы. Если в сообщении приводятся непонятные сведения:
    
    1.  Откройте Командная консоль Exchange, а затем выполните следующую команду, чтобы извлечь подробные сведения о настройках работоспособности, с которыми связано оповещение.
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        Например, чтобы получить из набора для контроля работоспособности OWA.Protocol сведения о сервере server1.contoso.com, выполните следующую команду:
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -eq "OWA.Protocol"}
    
    2.  Просмотрите выходные данные команды, чтобы определить монитор, сообщивший об ошибке. Для монитора, создавшего предупреждение, значение параметра **AlertValue** будет равно `Unhealthy`.
    
    3.  Еще раз запустите зонд для средства мониторинга, которое находится в неисправном состоянии. Обратитесь к таблице в разделе Пояснение, чтобы найти связанный зонд. Для этого выполните следующую команду.
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        Допустим, что неисправен монитор **OwaSelfTestMonitor**. Связанный с этим монитором зонд — **OwaSelfTestProbe**. Чтобы запустить этот зонд на сервере server1.contoso.com, выполните следующую команду.
        
            Invoke-MonitoringProbe OWA.Protocol\OwaSelfTestProbe -Server server1.contoso.com | Format-List
    
    4.  В выходных данных команды просмотрите значение параметра **Результат** зонда. Если этот параметр имеет значение **Succeeded**, ошибка была временной и в настоящее время устранена. В противном случае обратитесь к действиям по восстановлению, приведенным в следующих разделах.

Если вы получите оповещение, связанное с настройками работоспособности, сообщение электронной почты содержит приведенные ниже сведения.

  - Имя сервера, отправившего оповещение.

  - тип неисправного зонда (SelfTest или DeepTest);

  - Время и дата возникновения оповещения.

  - путь к папке, в которой можно найти полные трассировки HTTP-запроса для зонда.
    
      
    По умолчанию файлы трассировки расположены в следующих папках:
    
      - SelfTestProbe: \<*ExchangeServer*\>\\Logging\\Monitoring\\OWA\\ProtocolProbe
    
      - DeepTestProbe: \<*ExchangeServer*\>\\Logging\\Monitoring\\OWA\\MailboxProbe

  - Полная трассировка исключения, связанного с последней ошибкой, включая диагностические данные и конкретные сведения о заголовке HTTP.  
    
    **Примечание**. Сведения в полной трассировке исключения можно использовать для устранения проблемы. Исключение, созданное зондом, содержит причину сбоя зонда. Причиной сбоя может быть:
    
      - **MissingKeyword**. В ответе сервера не найдено ожидаемое ключевое слово. В этом случае исключение содержит ожидаемые ключевые слова.
    
      - **NameResolution.**   Системе DNS не удается сопоставить заданное имя сервера.
    
      - **NetworkConnection.**   Зонд получает сообщение об ошибке сети при попытке подключиться к пулу приложений OWA в CAFE.
    
      - **UnexpectedHttpResponseCode.**   Ответ содержит непредвиденный код HTTP. Например, сервер вернул код HTTP **503**.
    
      - **RequestTimeout**. Сервер слишком долго отвечал на запрос клиента.
    
      - **UnexpectedHttpResponseCode.**   В ответе возвращен непредвиденный код HTTP. Например, сервер вернул код HTTP **503**.
    
      - **ScenarioTimeout.**   Зонд успешно завершил работу, но для этого потребовалось больше минуты. Обычно это указывает на высокую загрузку системы.
    
      - **OwaErrorPage.**   OWA возвращает страницу с ошибкой. Имя ошибки, вызвавшей сбой, обычно включено в сообщение исключения.
    
      - **OwaMailboxErrorPage.**   OWA возвращает страницу с ошибкой, связанной с хранилищем почтовых ящиков. Обычно это указывает на то, что хранилище почтовых ящиков недоступно или выполняется отключение почтовых ящиков.
    
    Трассировка исключения содержит важное поле **FailingComponent**, в котором зонд пытается определить и классифицировать ошибку. Например, зонд может вернуть одно из следующих значений:
    
      - **Mailbox.**   Зонду удалось связаться с OWA, но не удалось подключиться к хранилищу почтовых ящиков. В этом случае работоспособность зонда была нарушена или из-за задержки доступа к почтовому ящику зонд вызвал ошибку **ScenarioTimeout**. При возникновении таких сбоев проверьте исправность серверов почтовых ящиков.
    
      - **Active Directory.**   Зонду удалось связаться с OWA, но не удалось подключиться к доменным службам Active Directory. В этом случае работоспособность зонда была нарушена или из-за задержки вызовов доменных служб Active Directory могло быть превышено время ожидания зонда. При возникновении таких сбоев проверьте исправность контроллеров доменов, а также сетевые подключения между серверами клиентского доступа и почтовых ящиков и контроллерами доменов.
    
      - **OWA.**   Обычно это означает наличие ошибки на уровне OWA. При возникновении таких сбоев проверьте исправность процесса OWA на сервере клиентского доступа и сервере почтовых ящиков, а также сетевые подключения.
    
    Исключение также содержит сведения о последнем HTTP-запросе и ответе, полученным до сбоя зонда.  
      
    Сообщение эскалации содержит путь к журналам зонда, которые можно использовать для проверки полных веб-запросов и ответов HTTP, отправленных при сбое зонда. Этот файл содержит данные только для неисправных зондов, поскольку в журнал записываются исключительно неудачные попытки. Эти сведения можно использовать для получения более подробной информации о сбое при тестировании.

## Действия для восстановления монитора OwaSelfTestProbe

Поскольку у этого зонда немного зависимостей, ошибки обычно возникают, когда процесс пула приложений OWA не отвечает.

Для устранения данной проблемы выполните действия, указанные ниже.

1.  Щелкните URL-адрес журнала трассировки зонда в сообщении с предупреждением, чтобы проверить новые ошибки.

2.  Создайте тестовую учетную запись пользователя на сервере, на котором размещены почтовые ящики. Попробуйте войти в систему, чтобы определить, можно ли воспроизвести проблему.

3.  Проверьте наличие предупреждений в наборе контроля работоспособности OWA, которые могут указывать на проблему, влияющую на определенный сервер почтовых ящиков. Подробнее см. в разделе [Устранение неполадок, связанных с настройками работоспособности OWA](troubleshooting-owa-health-set.md).

4.  Запустите диспетчер IIS, а затем выполните подключение к серверу, сообщающему об ошибке, чтобы определить, работает ли пул приложений **MSExchangeOwaAppPool** на сервере клиентского доступа.

5.  В диспетчере IIS убедитесь, что запущен веб-сайт по умолчанию.

6.  В диспетчере IIS щелкните **Пулы приложений**, а затем перезапустите пул приложений **MSExchangeOWAAppPool**, выполнив следующую команду из Командная консоль Exchange.
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeOWAAppPool

7.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

8.  Если проблема не устранена, перезапустите службы IIS с помощью служебной программы IISReset или следующей команды.
    
        Iisreset /noforce

9.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

10. Если проблема не устранена, перезапустите сервер.

11. После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

12. Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Действия для восстановления монитора OwaDeepTestProbe

1.  Чтобы определить, существует ли проблема, создайте тестовую учетную запись пользователя на том же сервере, где размещен почтовый ящик, и попробуйте войти в OWA. Например, выполните вход, используя следующие данные: https:// *\<имя\_сервера\>*/owa.

2.  Проверьте наличие предупреждений в наборе контроля работоспособности OWA, которые могут указывать на проблему, влияющую на определенный сервер почтовых ящиков. Подробнее см. в разделе [Устранение неполадок, связанных с настройками работоспособности OWA](troubleshooting-owa-health-set.md).

3.  Запустите диспетчер IIS, а затем выполните подключение к серверу, сообщающему об ошибке, чтобы определить, работает ли пул приложений **MSExchangeOwaAppPool** на сервере клиентского доступа.

4.  В диспетчере IIS убедитесь, что запущен веб-сайт по умолчанию.

5.  Найдите базу данных почтовых ящиков для неисправных зондов и убедитесь, что она активна на сервере почтовых ящиков, а хранилище почтовых ящиков исправно. Чтобы получить сведения о GUID неисправной базы данных, откройте сведения о полной трассировке исключения. Каждая ошибка должна содержать запись, похожую на следующую:
    
    `Starting Owa probe with Target: https://localhost/owa/, Username:  HealthMailboxdf8b87828ab0427cb91e985bbdfcec62@yourdomain.com`

6.  Скопируйте GUID HealthMailbox, а затем выполните в командной консоли следующую команду.
    
        Get-Mailbox -Monitoring -Identity <username>
    
    Например, выполните следующую команду:
    
        Get-Mailbox -Monitoring -Identity HealthMailboxdf8b87828ab0427cb91e985bbdfcec62@yourdomain.com
    
    Возвращенный объект может содержать имя базы данных пользователя. Вы также можете определить расположение текущей активной базы данных.

7.  В диспетчере IIS щелкните **Пулы приложений** и перезапустите пул **MSExchangeOWAAppPool**, выполнив в командной консоли следующую команду:
    
        %SystemRoot%\System32\inetsrv\Appcmd recycle MSExchangeOWAAppPool

8.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

9.  Если проблема не устранена, перезапустите службы IIS с помощью служебной программы IISReset или следующей команды.
    
        Iisreset /noforce

10. Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

11. Если проблема не устранена, перезапустите сервер.

12. После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

13. Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Дополнительные сведения

[Новые возможности в Exchange 2013](https://technet.microsoft.com/ru-ru/library/jj150540\(v=exchg.150\))

[Командлеты Exchange 2013](https://technet.microsoft.com/ru-ru/library/bb124413\(v=exchg.150\))

