---
title: Устранение неполадок в наборе для контроля работоспособности IMAP
TOCTitle: Устранение неполадок в наборе для контроля работоспособности IMAP
ms:assetid: 2a06e671-4cc2-4ce5-bf53-6243ea140f20
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/ms.exch.scom.imap(v=EXCHG.150)
ms:contentKeyID: 53275653
ms.date: 11/14/2015
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Устранение неполадок в наборе для контроля работоспособности IMAP

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Набор для контроля работоспособности IMAP отслеживает доступность прокси-инфраструктуры IMAP4 на сервере клиентского доступа. Набор для контроля работоспособности IMAP тесно связан со следующими наборами для проверки работоспособности.

[Устранение неполадок в работе комплекта средств для проверки работоспособности IMAP.Protocol](troubleshooting-imap-protocol-health-set.md)

[Устранение неполадок с настройками работоспособности IMAP.Proxy](troubleshooting-imap-proxy-health-set.md)

Появление предупреждение о том, что IMAP работает неправильно, означает, что появилась проблема, которая может помешать пользователям получать доступ к их почтовым ящикам с помощью IMAP.

## Пояснение

Служба IMAP4 отслеживается с помощью следующих зондов и мониторов.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Зонд</th>
<th>Настройки работоспособности</th>
<th>Зависимости</th>
<th>Связанные мониторы</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>ImapCTPProbe</p></td>
<td><p>IMAP</p></td>
<td><p>Active Directory</p>
<p>Проверка подлинности</p>
<p>Проверка подлинности сервера почтовых ящиков</p>
<p>Высокая доступность</p>
<p>сеть</p></td>
<td><p>ImapCTPMonitor (набор для контроля работоспособности IMAP)</p></td>
</tr>
<tr class="even">
<td><p>ImapProxyTestProbe</p></td>
<td><p>IMAP.Proxy</p></td>
<td><p>Active Directory</p>
<p>Проверка подлинности</p></td>
<td><p>ImapProxyTestMonitor (набор для контроля работоспособности IMAP.Proxy)</p></td>
</tr>
<tr class="odd">
<td><p>ImapDeepTestProbe</p></td>
<td><p>IMAP.Protocol</p></td>
<td><p>Active Directory</p>
<p>Проверка подлинности</p>
<p>Банк данных</p>
<p>Высокая доступность</p></td>
<td><p>IMAP.Protocol (набор для контроля работоспособности IMAP.Protocol)</p></td>
</tr>
<tr class="even">
<td><p>ImapSelfTestProbe</p></td>
<td><p>IMAP.Protocol</p></td>
<td><p>Active Directory</p>
<p>Проверка подлинности</p></td>
<td><p>IMAP.Protocol (набор для контроля работоспособности IMAP.Protocol)</p>
<p>AverageCommandProcessingTimeGt60sMonitor (набор для контроля работоспособности IMAP)</p></td>
</tr>
</tbody>
</table>


Дополнительные сведения о зондах и мониторах см. в разделе [Работоспособность и производительность сервера](https://technet.microsoft.com/ru-ru/library/jj150551\(v=exchg.150\)).

## Действия пользователя

Служба может восстановить работу после отображения оповещения. Поэтому если вы получите оповещение о неработоспособном состоянии настроек работоспособности, сначала убедитесь в наличии данной проблемы. Если проблема не устранена, выполните соответствующие действия по восстановлению, указанные в приведенных ниже разделах.

## Проверка наличия проблемы

1.  Определите имена настроек работоспособности и сервера, указанные в оповещении.

2.  В сообщении приводятся подробные сведения о точной причине возникновения оповещения. В большинстве случаев в сообщении приводится достаточно сведений по устранению неполадок для определения основной причины проблемы. Если в сообщении приводятся непонятные сведения:
    
    1.  Откройте Командная консоль Exchange, а затем выполните следующую команду, чтобы извлечь подробные сведения о настройках работоспособности, с которыми связано оповещение.
        
            Get-ServerHealth <server name> | ?{$_.HealthSetName -eq "<health set name>"}
        
        Например, чтобы получить от набора для контроля работоспособности IMAP сведения о сервере server1.contoso.com, выполните следующую команду.
        
            Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -like "IMAP*"}
    
    2.  Просмотрите выходные данные команды, чтобы определить монитор, сообщивший об ошибке. Параметр **AlertValue** монитора, вызвавшего оповещение, будет иметь значение `Unhealthy`.
    
    3.  Повторно запустите связанный зонд для монитора, находящегося в неработоспособном состоянии. Обратитесь к таблице в разделе Пояснение, чтобы найти связанный зонд. Для этого выполните следующую команду.
        
            Invoke-MonitoringProbe <health set name>\<probe name> -Server <server name> | Format-List
        
        Предположим, что неисправен монитор **ImapCTPMonitor**. С этим монитором связан зонд **ImapCTPProbe**. Чтобы запустить этот зонд на сервере server1.contoso.com, выполните следующую команду.
        
            Invoke-MonitoringProbe IMAP\ImapCTPProbe -Server server1.contoso.com | Format-List
    
    4.  В выходных данных команды просмотрите значение параметра **Результат** зонда. Если этот параметр имеет значение **Succeeded**, ошибка была временной и в настоящее время устранена. В противном случае обратитесь к действиям по восстановлению, приведенным в следующих разделах.

## Действия восстановления для ImapTestDeepMonitor и ImapSelfTestMonitor

1.  Перезапустите службу IMAP4 Exchange на внутреннем сервере. Дополнительные сведения об остановке и запуске службы IMAP4 см. в разделе [Запуск и остановка служб IMAP4](https://technet.microsoft.com/ru-ru/library/bb124022\(v=exchg.150\)).

2.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

3.  Если проблема не исчезла, необходимо отработать отказ для баз данных, расположенных на сервере почтовых ящиков, выполнив следующую команду.
    
        Set-MailboxServer -Identity <ServerName> -DatabaseCopyActivationDisabledAndMoveNow $true

4.  Убедитесь, что все базы данных перемещены с сервера, сообщающего о проблеме. Для этого выполните следующую команду.
    
        Get-MailboxDatabaseCopyStatus -Server server1.contoso.com | Group Status
    
    Если в выходных данных команды не отображаются активные копии на сервере, перезапустите сервер.

5.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

6.  Если с зондом все нормально, выполните отработку отказа баз данных с помощью следующей команды:
    
        Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $false

7.  Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Действия восстановления ImapCTPMonitor

Предупреждение этого монитора обычно создается серверами клиентского доступа.

1.  Перезапустите службу IMAP4 Exchange на внутреннем сервере. Дополнительные сведения об остановке и запуске службы IMAP4 см. в разделе [Запуск и остановка служб IMAP4](https://technet.microsoft.com/ru-ru/library/bb124022\(v=exchg.150\)).

2.  Перезапустите связанный зонд, как показано в действии 2.c. в разделе Проверка наличия проблемы.

3.  Если проблема не исчезла, необходимо включить ведение журнала протокола IMAP, чтобы получить сведения, необходимые для решения этой проблемы. Для этого выполните указанные ниже действия.
    
    1.  Выполните в Windows PowerShell следующую команду.
        
            Set-ImapSettings -server <CAS server name> -ProtocolLoggingEnabled $true
    
    2.  Перезапустите службу IMAP4 Exchange на внутреннем сервере. Дополнительные сведения об остановке и запуске службы IMAP4 см. в разделе [Запуск и остановка служб IMAP4](https://technet.microsoft.com/ru-ru/library/bb124022\(v=exchg.150\)).
    
    3.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.
    
    4.  Выполните следующую команду, а затем задайте расположение для файла журнала. Для этого выполните следующую команду.
        
            Get-ImapSettings -server <CAS server name>
    
    5.  Задайте почтовый ящик, который будет обслуживать эту команду. Имя сервера почтовых ящиков отображается в качестве значения для `_Mbx:` в сообщении об ошибке.
    
    6.  Выполните следующую команду:
        
            Get-ServerHealth mailbox1.contoso.com | ?{$_.HealtSetName -like "IMAP*"}
        
        **Примечание.**   В этой команде необходимо заменить *mailbox1.contoso.com* на реальное имя сервера почтовых ящиков.
    
    7.  Если в данных, возвращаемых командой, есть сведения о том, что какие-либо из мониторов работают неправильно, необходимо прежде всего заняться этими мониторами. Для этого выполните действия по устранению неполадок, описанные в разделе Действия восстановления для ImapTestDeepMonitor и ImapSelfTestMonitor.

4.  Если сервер почтовых ящиков указан как неисправный, перезапустите сервер CAS.

5.  После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

6.  Выключите ведение журнала протокола. Для этого выполните следующую команду Windows PowerShell.
    
        Set-ImapSettings -server <CAS server name> -ProtocolLoggingEnabled $false

7.  Перезапустите службу IMAP4.

8.  Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Действия восстановления для ImapProxyTestMonitor

1.  Перезапустите службу IMAP4.

2.  Повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

3.  Если зонд по-прежнему работает неправильно, перезапустите сервер клиентского доступа.

4.  После перезапуска сервера повторно запустите связанный зонд, как показано в шаге 2c раздела Проверка наличия проблемы.

5.  Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Действия восстановления для AverageCommandProcessingTimeGt60sMonitor и RequestsQueuedGt500Monitor

Предупреждение этого монитора обычно создается серверами клиентского доступа и почтовых ящиков.

1.  Перезапустите службу IMAP4 Exchange на внутреннем сервере или сервере клиентского доступа. Дополнительные сведения об остановке и запуске службы IMAP4 см. в разделе [Запуск и остановка служб IMAP4](https://technet.microsoft.com/ru-ru/library/bb124022\(v=exchg.150\)).

2.  Подождите 10 минут, чтобы проверить, правильно ли работает монитор. По истечении 10 минут выполните следующую команду.
    
        Get-ServerHealth server1.contoso.com | ?{$_.HealthSetName -like "IMAP*"}
    
    **Примечание.**   В этой команде необходимо заменить *server1.contoso.com* на реальное имя сервера.

3.  Подождите 10 минут, а затем снова запустите команду, указанную в шаге 2, чтобы проверить, правильно ли работает монитор.

4.  Если проблема до сих пор не исчезла, перезапустите сервер. Если это сервер CAS, просто перезагрузите его. Если это сервер почтовых ящиков, выполните следующие действия.
    
    1.  Переключите на резервный ресурс базы данных, размещенные на сервере. Для этого выполните следующую команду.
        
            Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $true
        
        **Примечание.**   В этих и последующих примерах кода замените *server1.contoso.com* на реальное имя сервера.
    
    2.  Убедитесь, что все базы данных перемещены с сервера, сообщающего о проблеме. Для этого выполните следующую команду.
        
            Get-MailboxDatabaseCopyStatus -Server server1.contoso.com | Group Status
        
        Если в выходных данных команды не отображаются активные копии на сервере, перезапустите сервер.

5.  После перезапуска сервера подождите 10 минут, а затем снова запустите команду, указанную в шаге 2, чтобы проверить, правильно ли работает монитор.

6.  Если монитор работает правильно, и действия выполняются на сервере почтовых ящиков, отработайте отказ баз данных, выполнив следующую команду.
    
        Set-MailboxServer server1.contoso.com -DatabaseCopyActivationDisabledAndMoveNow $false

7.  Если зонд все еще не работает, вам понадобится помощь для устранения данной проблемы. Для решения этой проблемы обратитесь к специалисту службы технической поддержки Майкрософт. Сделать это можно в [Центре решений Exchange Server](http://go.microsoft.com/fwlink/p/?linkid=180809). В области навигации выберите элемент **Варианты поддержки и ресурсы** и выберите один из вариантов в разделе **Получите техническую поддержку**, чтобы обратиться к соответствующему специалисту. Так прямое обращение в службу технической поддержки Майкрософт в вашей организации может регламентироваться, сначала ознакомьтесь с инструкциями организации.

## Дополнительные сведения

[Протоколы POP3 и IMAP4](https://technet.microsoft.com/ru-ru/library/jj657728\(v=exchg.150\))

[Включение протокола IMAP4 в Exchange 2013](https://technet.microsoft.com/ru-ru/library/bb124489\(v=exchg.150\))

[Test-ImapConnectivity](https://technet.microsoft.com/ru-ru/library/bb738126\(v=exchg.150\))

