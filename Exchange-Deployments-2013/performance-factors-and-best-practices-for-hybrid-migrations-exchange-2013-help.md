---
title: 'Факторы производительности гибридной миграции и рекомендации по ее выполнению: Exchange 2013 Help'
TOCTitle: Факторы производительности гибридной миграции и рекомендации по ее выполнению
ms:assetid: 120a7832-d2d3-47d7-b305-918360c2ef66
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Mt483789(v=EXCHG.150)
ms:contentKeyID: 70118018
ms.date: 01/11/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Факторы производительности гибридной миграции и рекомендации по ее выполнению

 

_<strong>Применимо к:</strong>Exchange Server 2016_

_<strong>Последнее изменение раздела:</strong>2016-12-09_

Перенести данные из локальной организации электронной почты в Office 365 можно разными путями. При планировании миграции в Office 365 часто возникает вопрос: "Как повысить скорость переноса данных?". Информация, изложенная в этой статье, относится к гибридным развертываниям Exchange. Сведения о производительности при использовании других способов миграции см. в статье [Производительность миграции в Office 365 и рекомендации по ее повышению](http://go.microsoft.com/fwlink/p/?linkid=623651).

## Факторы производительности гибридной миграции и рекомендации по ее выполнению

Миграция при гибридном развертывании позволяет легко перенести данные с локальных серверов Exchange в Exchange Online в Office 365.

Миграция при гибридном развертывании — это самый быстрый метод переноса данных почтовых ящиков в Office 365. Мы наблюдали пропускную способность до 100 ГБ/ч в реальных развертываниях клиентов. В таблице ниже представлен список факторов, влияющих на сценарии собственной гибридной миграции Office 365.

Если локальная среда содержит несколько сайтов в отдаленных друг от друга местах, скорость миграции можно повысить, создав близкие конечные точки миграции. При этом для миграции используется сеть корпорации Майкрософт, а не локальная сеть.

## Фактор 1. Источник данных (Exchange Server)


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Контрольный список</th>
<th>Описание</th>
<th>Советы и рекомендации</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Производительность системы</p></td>
<td><p>Извлечение данных — это ресурсоемкая задача. Для оптимальной миграции исходной системе требуется достаточный объем ресурсов, таких как время ЦП и память. Во время миграции исходная система обычно находится на пределе производительности, чтобы обслужить стандартную нагрузку пользователей. Дополнительная нагрузка миграции иногда даже закрывает доступ пользователям из-за нехватки системных ресурсов.</p></td>
<td><p>Отслеживайте производительность системы во время пилотного теста миграции. Если система сильно загружена, не рекомендуется использовать агрессивное расписание миграции для нее, так как это может замедлить миграцию и привести к проблемам с доступностью службы. Если возможно, повысьте производительность исходной системы, добавив аппаратные ресурсы и сократив нагрузку на исходную систему, переместив задачи и пользователей на другие серверы, которые не участвуют в миграции.</p>
<p>Дополнительные сведения см. в указанных ниже статьях.</p>
<ul>
<li><p><a href="http://go.microsoft.com/fwlink/?linkid=723566">Спросите эксперта: масштабирование развертываний Exchange 2016</a></p></li>
<li><p><a href="https://technet.microsoft.com/ru-ru/library/jj150551(v=exchg.150)">Работоспособность и производительность сервера</a></p></li>
<li><p><a href="http://technet.microsoft.com/ru-ru/library/dd351192.aspx">Общие сведения о производительности Exchange</a></p></li>
</ul>
<p>При миграции из локальной организации Exchange с несколькими серверами почтовых ящиков и базами данных рекомендуется создать список переносимых пользователей так, чтобы равномерно распределить их на несколько серверов почтовых ящиков и баз данных. В зависимости от производительности отдельного сервера список можно скорректировать для увеличения пропускной способности.</p>
<p>Например, если на сервере A на 50 % больше доступных ресурсов, чем на сервере Б, будет логично включить на 50 % больше пользователей с сервера А в один пакет миграции. Аналогичный подход можно применять и к другим исходным системам.</p>
<p>Выполняйте перенос данных, когда объем доступных на серверах ресурсов максимален, например в нерабочее время, в выходные и праздничные дни.</p></td>
</tr>
<tr class="even">
<td><p>Внутренние задачи</p></td>
<td><p>Другие внутренние задачи, которые выполняются во время миграции. Так как рекомендуется выполнять миграцию в нерабочее время, зачастую миграция конфликтует с другими задачами обслуживания на локальных серверах, такими как резервное копирование данных.</p></td>
<td><p>Пересмотрите другие системные задачи, которые могут выполняться во время миграции. Рекомендуется переносить данные, когда другие ресурсозатратные задачи не выполняются.</p>
<p><strong>Примечание.</strong>   Для клиентов, использующих локальное решение Microsoft Exchange, основными внутренними задачами являются решения для резервного копирования и <a href="http://technet.microsoft.com/ru-ru/library/aa996226(exchg.65).aspx">обслуживание хранилища Exchange</a>.</p></td>
</tr>
</tbody>
</table>


## Фактор 2. Сервер миграции

Миграция при гибридном развертывании — это инициируемая облаком процедура миграции с извлечением и передачей данных, при которой гибридный сервер Exchange выступает в качестве сервера миграции. Об этом часто забывают, используя мелкомасштабную виртуальную машину в качестве гибридного сервера. Это приводит к плохой производительности миграции.

**Рекомендация**

В дополнение к выполнению рекомендаций, описанных выше, мы проверили приведенные ниже рекомендации, которые показали улучшение производительности миграции в реальных пользовательских миграциях.

  - Используйте мощные серверные компьютеры, а не виртуальные машины, в качестве гибридных серверов Exchange.

  - Используйте несколько гибридных серверов, обслуживаемых подсистемой балансировки сетевой нагрузки клиента.

Например, в реальных операциях миграции мы достигли постоянной пропускной способности 30 ГБ/ч, используя приведенную ниже конфигурацию.

  - **Сеть**.  Конвейер исходящих данных в Интернет в 500 МБ; внутренняя сеть со скоростью 1 ГБ и оптоволоконной магистралью с пропускной способностью 10 ГБ.

  - **Оборудование**.   Характеристики двух физических серверов клиентского доступа и концентраторов:
    
      - Процессор: E5520 Intel® Xeon® @ 2,27 ГГц и 2,26 ГГц (два процессора).
    
      - ОЗУ: 24 ГБ.
    
      - Диски: восемь, 146 ГБ на диске. Конфигурация RAID 5 = всего 960 ГБ.

  - **Прокси-сервер MRS**. Задан параллелизм 100.

## Фактор 3. Механизм миграции

Для миграции при гибридном развертывании используются встроенные средства Office 365. Они подвергаются регулированию службы миграции Office 365.

**Сравнение Exchange 2003 с более поздними версиями Exchange**

Во время миграции из Exchange 2003 следует учитывать ключевое отличие, влияющее на работу пользователя. В отличие от более поздних версий Exchange, в Exchange 2003 у пользователей нет доступа к своим почтовым ящикам во время переноса данных. Поэтому пользователей Exchange 2003 обычно больше беспокоит то, на какое время следует запланировать миграцию и сколько она будет длиться, особенно при низкой производительности, вызванной большими размерами почтовых ящиков или медленной работой сети.

Миграция Exchange 2003 также очень чувствительна к прерываниям. Например, у одного из наших клиентов при переносе почтового ящика размером 10 ГБ возник инцидент на отметке 50 %. Чтобы устранить проблему, пришлось перезагрузить сервер клиентского доступа Office 365, который обрабатывал перенос данных. В этом случае потребовалось перезапустить миграцию этого почтового ящика, то есть клиенту пришлось повторно переносить все 10 ГБ данных. Миграцию не удалось возобновить с момента остановки. Однако в Exchange 2010 и более поздних версиях Exchange можно возобновлять миграцию после прерываний.

**Рекомендация**

Некоторые клиенты выбирают миграцию из двух этапов для крупных и конфиденциальных почтовых ящиков Exchange 2003.

  - **Первый этап**. Миграция почтовых ящиков с сервера Exchange 2003 на сервер Exchange 2010 или более поздней версии, который обычно является гибридным сервером. На первом этапе выполняется автономное перемещение, но обычно это очень быстрая миграция по локальной сети.

  - **Второй этап**. Перенос почтовых ящиков из Exchange 2010 или более поздней версии в Office 365.

Второй этап — это сетевая операция, которая повышает удобство работы пользователя и отказоустойчивость. Чтобы применить такой двухэтапный подход, необходима лицензия на Exchange для временного почтового ящика локального пользователя.

**Прокси-сервер службы репликации почтовых ящиков (прокси-сервер MRS)**

Прокси-сервер MRS — это локальный компонент миграции, который работает со службой репликации почтовых ящиков, запущенной на стороне Office 365. Дополнительные сведения см. в статье [Общие сведения о запросах на перемещение](http://technet.microsoft.com/ru-ru/library/dd298174.aspx)

**Рекомендация**

Вы можете настроить максимальное число подключений к прокси-серверу MRS для локального сервера гибридной среды Exchange. Выполните приведенную ниже команду в Windows PowerShell.

    Set-WebServicesVirtualDirectory -Identity "EWS (Default Web Site)" -MRSMaxConnections <number between 0 and unlimited; default is 100>

> [!NOTE]
> Для большинства клиентских миграций не нужно менять значение MRSMaxConnections по умолчанию. Если вам требуется защитить исходный сервер от чрезмерной нагрузки вследствие миграции, можно сократить число подключений. Этот параметр применяется на уровне отдельных прокси-серверов MRS. Если у клиента два прокси-сервера MRS, для каждого из которых задано 10 подключений, общее количество подключений к прокси-серверам MRS будет равно 20 (2 x 10). Дополнительные сведения о настройке службы прокси-сервера MRS в локальной организации Exchange 2010 см. в статье <a href="http://technet.microsoft.com/ru-ru/library/ee732395.aspx">Запуск службы MRSProxy на удаленном сервере клиентского доступа</a>.


## Фактор 4. Сеть

**Тесты проверки**

Пользователям Exchange 2010 и более поздних версий для тестирования производительности сети при гибридной миграции достаточно выполнить несколько тестовых миграций почтовых ящиков. Вы также можете перенести реальные почтовые ящики пользователей с использованием параметра -SuspendWhenReadyToComplete, чтобы получить данные о производительности миграции. По завершении тестирования удалите запрос на перемещение, чтобы он не повлиял на пользователей.

Дополнительные сведения о запросах на перемещение см. в статье [New-MoveRequest](https://technet.microsoft.com/ru-ru/library/dd351123\(v=exchg.150\)).

## Фактор 5. Служба Office 365

Регулирование Office 365 на основе работоспособности ресурсов влияет на миграцию, выполняемую при гибридном развертывании Office 365. Дополнительные сведения см. в разделе "Регулирование Office 365 на основе работоспособности ресурсов".

