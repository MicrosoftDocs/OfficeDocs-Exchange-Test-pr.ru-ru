---
title: 'Настройка локальных общедоступных папок прежних версий для гибридного развертывания: Exchange 2013 Help'
TOCTitle: Настройка локальных общедоступных папок прежних версий для гибридного развертывания
ms:assetid: bcb0ac98-2949-486b-a8ab-8549c021651b
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dn249373(v=EXCHG.150)
ms:contentKeyID: 54913493
ms.date: 05/23/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Настройка локальных общедоступных папок прежних версий для гибридного развертывания

 

_**Применимо к:**Exchange Online, Exchange Server 2010, Exchange Server 2013, Exchange Server 2016_

_**Последнее изменение раздела:**2018-05-22_

**Сводка**. Следуйте инструкциям в этой статье, чтобы синхронизировать общедоступные папки между Office 365 и локальным развертыванием Exchange 2007 или Exchange 2010.

В гибридном развертывании пользователи могут находиться в Exchange Online, локальной организации или в обоих этих расположениях, а ваши общедоступные папки могут располагаться либо в Exchange Online, либо на локальном сервере. Общедоступные папки могут находиться только в одном расположении, поэтому нужно решить, где именно: в Exchange Online или на локальном сервере. Они не могут находиться в обоих расположениях. Почтовые ящики общедоступных папок синхронизируются с Exchange Online при помощи службы синхронизации каталогов. Однако общедоступные папки с поддержкой почты не синхронизируются между локальными и облачными организациями.

В этом разделе описывается, как синхронизировать общедоступные папки, поддерживающие почту, когда пользователи находятся в Office 365, а общедоступные папки Exchange 2010 с пакетом обновления 3 (SP3) или Exchange 2007 с пакетом обновления 3 (SP3) и накопительным пакетом обновления 10 (RU10) — на локальном сервере. У пользователя Office 365, который не представлен объектом MailUser в локальной среде (локальном расположении в целевой иерархии общедоступных папок), не будет доступа к локальным общедоступным папкам сервера Exchange 2013 или прежних версий.

<table>
<thead>
<tr class="header">
<th><img src="images/Dn986544.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>В этом разделе серверы Exchange 2010 с пакетом обновления 3 (SP3) и Exchange 2007 с пакетом обновления 3 (SP3) RU10 называются <em>сервер Exchange Server прежних версий</em>.</td>
</tr>
</tbody>
</table>


Для синхронизации общедоступных папок с поддержкой почты используются следующие сценарии, которые инициируются задачей Windows, которая выполняется в локальной среде:

1.  `Sync-MailPublicFolders.ps1`   Этот сценарий синхронизирует объекты общедоступных папок, поддерживающие почту, между локальным развертыванием Exchange и Office 365. Он использует локальное развертывание Exchange как основу для определения изменений, которые необходимо применить к Office 365. Этот сценарий создает, обновляет или удаляет объекты общедоступных папок, поддерживающие почту, в Active Directory Office 365 в зависимости от того, что находится в локальном развертывании Exchange.

2.  `SyncMailPublicFolders.strings.psd1`   Это файл поддержки, используемый предыдущим сценарием синхронизации. Его необходимо скопировать в то же расположение, что и предыдущий сценарий.

После завершения этой процедуры пользователи на локальном сервере и в Office 365 будут иметь доступ к одной и той же инфраструктуре локальных общедоступных папок.

## Какие гибридные версии Exchange будут работать с общедоступными папками?

В следующей таблице приведены поддерживаемые комбинации версий и расположений почтовых ящиков пользователей и общедоступных папок. Сценарий "Гибридная конфигурация не поддерживается" по-прежнему поддерживается, но не считается гибридным сценарием, так как общедоступные папки и пользователи находятся в одном и том же расположении.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>   </th>
<th>Почтовый ящик пользователей локального сервера Exchange 2007 или Exchange 2010</th>
<th>Почтовый ящик пользователей локального сервера Exchange 2013</th>
<th>Почтовый ящик пользователей Exchange Online</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Общедоступные папки локального сервера Exchange 2007 или Exchange 2010</p></td>
<td><p>Гибридная конфигурация не применяется</p></td>
<td><p>Гибридная конфигурация не применяется</p></td>
<td><p>Поддерживается</p></td>
</tr>
<tr class="even">
<td><p>Общедоступные папки локального сервера Exchange 2013</p></td>
<td><p>Гибридная конфигурация не применяется</p></td>
<td><p>Гибридная конфигурация не применяется</p></td>
<td><p>Поддерживается</p></td>
</tr>
<tr class="odd">
<td><p>Общедоступные папки Exchange Online</p></td>
<td><p>Не поддерживается</p></td>
<td><p>Поддерживается</p></td>
<td><p>Гибридная конфигурация не применяется</p></td>
</tr>
</tbody>
</table>


Гибридная конфигурация с общедоступными папками Exchange 2003 не поддерживается. Если в вашей организации используется Exchange 2003, необходимо переместить все базы данных общедоступных папок и реплики в Exchange 2007 с пакетом обновления 3 RU10 или более поздней версии. В Exchange 2003 не должно оставаться реплик общедоступных папок.

<table>
<thead>
<tr class="header">
<th><img src="images/Dn986544.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Outlook 2016 не поддерживает доступ к устаревшим общедоступным папкам Exchange 2007. Если в вашей организации используется Outlook 2016, вам нужно перенести общедоступные папки в более новую версию Exchange. Дополнительные сведения о совместимости Outlook 2016 и Office 2016 с Exchange 2007 и более ранних версий можно найти в <a href="https://go.microsoft.com/fwlink/p/?linkid=849053">этой статье</a>.</td>
</tr>
</tbody>
</table>


## Этап 1. Что нужно знать перед началом работы

1.  Эти указания предполагают, что использовался мастер гибридных конфигураций для настройки и синхронизации ваших локальных сред и сред Exchange Online и что записи DNS, которые использовались для ссылок AutoDiscover большинства пользователей, относятся к локальной конечной точке. Подробнее см. в разделе [Мастер гибридной конфигурации](hybrid-configuration-wizard-exchange-2013-help.md).

2.  Эти указания предполагают, что мобильный Outlook включен и работает на локальных серверах Exchange прежних версий. Сведения о включении мобильного Outlook см. в разделе [Мобильный Outlook](https://technet.microsoft.com/ru-ru/library/bb123741\(v=exchg.150\)).

3.  Чтобы настроить сосуществование общедоступных папок устаревших версий для гибридного развертывания Exchange с Office 365, возможно, понадобится устранить конфликты, которые произошли во время импорта. Конфликты могут происходить, поскольку не поддерживающий маршрутизацию адрес электронной почты, назначенный общедоступным папкам, поддерживающим почту, конфликтует с другими пользователями и группами в Office 365, а также другими атрибутами.

4.  Эти инструкции предполагают, что ваша организация Exchange Online была обновлена до версии, поддерживающей общедоступные папки.

5.  В Exchange Online вам необходимо быть членом группы ролей "Управление организацией". Эта группа ролей отличается от разрешений, которые назначаются при подписке на Exchange Online. Сведения о том, как включить группу ролей "Управление организацией", см. в разделе [Управление группами ролей](https://technet.microsoft.com/ru-ru/library/jj657480\(v=exchg.150\)).

6.  В Exchange 2010 вам необходимо быть членом группы ролей RBAC "Управление организацией" или "Управление сервером". Дополнительные сведения см. в статье [Добавление членов в группу ролей](https://go.microsoft.com/fwlink/?linkid=299212).

7.  В Exchange 2007 вам необходима роль администратора организации Exchange или администратора сервера Exchange Server. Кроме того, вам необходима роль администратора общедоступных папок, а также вы должны входить в локальную группу администраторов целевого сервера. Дополнительные сведения см. в статье [Инструкции по добавлению пользователя или группы в роль администратора](https://go.microsoft.com/fwlink/p/?linkid=81779).

8.  Если у вас Exchange Server 2007 работает на 64-разрядном сервере Windows Server 2008, необходимо выполнить обновление до [Windows PowerShell 2.0 и WinRM 2.0 для 64-разрядного выпуска Windows Server 2008](http://go.microsoft.com/fwlink/p/?linkid=3052%26kbid=968930). Если Exchange Server 2007 работает на 64-разрядном сервере Windows Server 2003, необходимо выполнить обновление до Windows PowerShell 2.0. Дополнительные сведения см. на странице с [обновлением для 64-разрядного выпуска Windows Server 2003](https://www.microsoft.com/ru-ru/download/details.aspx?id=10512).

9.  Чтобы получать доступ к общедоступным папкам на различных площадках, пользователям необходимо обновить свои клиенты Outlook с помощью общедоступного обновления Outlook за ноябрь 2012 г. или более поздней версии.
    
    1.  Чтобы скачать обновление за ноябрь 2012 г. для Outlook 2010, см. статью с [обновлением для 32-разрядного выпуска Microsoft Outlook 2010 (KB2687623)](https://www.microsoft.com/ru-ru/download/details.aspx?id=35702).
    
    2.  Чтобы скачать обновление Outlook за ноябрь 2012 г. для Outlook 2007, см. страницу [Обновление для Microsoft Office Outlook 2007 (KB2687404)](https://www.microsoft.com/ru-ru/download/details.aspx?id=35718).

10. Для доступа к устаревшим общедоступным папкам с помощью Outlook 2016 для Mac (и более ранних версий) и Outlook для Mac для Office 365 пользователи должны находиться там же, где и папки. Кроме того, пользователи с почтовыми ящиками в службе Exchange Online не смогут получить доступ к локальным общедоступным папкам с помощью Outlook Web App.

11. После настройки локальных общедоступных папок для гибридного развертывания согласно инструкциям в этой статье внешние пользователи не смогут отправлять сообщения в ваши локальные общедоступные папки, если вы не выполните дополнительные действия. Вы можете настроить обслуживаемый домен для общедоступных папок как домен внутренней ретрансляции (дополнительные сведения см. в статье [Управление обслуживаемыми доменами в Exchange Online](https://technet.microsoft.com/ru-ru/library/jj945194\(v=exchg.150\))) или отключить пограничную блокировку на основе каталогов (DBEB), как описано в [Использование пограничной блокировки на основе каталогов для отклонения сообщений, отправляемых недопустимым получателям](https://technet.microsoft.com/ru-ru/library/dn600322\(v=exchg.150\)).

## Этап 2. Сделайте удаленные общедоступные папки обнаруживаемыми

1.  Если ваши общедоступные папки размещены в Exchange 2010 или на серверах более поздних версий, необходимо установить роль сервера клиентского доступа на всех серверах почтовых ящиков, имеющих базу данных общедоступных папок. Это позволит работать службе Microsoft Exchange RpcClientAccess, благодаря чему все клиенты смогут получать доступ к общедоступным папкам. Для серверов общедоступных папок Exchange 2007 не требуется роль клиентского доступа, и этот шаг можно пропустить. Дополнительные сведения см. в статье [Установка сервера Exchange Server 2010](https://technet.microsoft.com/ru-ru/library/bb124778\(v=exchg.141\).aspx). Это действие не является обязательным для общедоступных папок Exchange 2007.
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Dn986544.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Этот сервер можно не учитывать при балансировке нагрузки клиентского доступа. Дополнительные сведения см. в статье <a href="https://technet.microsoft.com/ru-ru/library/ff625247(v=exchg.141).aspx">Общие сведения о балансировке нагрузки в Exchange 2010</a>.</td>
    </tr>
    </tbody>
    </table>


2.  Создайте пустую базу данных почтовых ящиков на каждом сервере общедоступных папок.
    
    Для Exchange 2010 выполните приведенную ниже команду. Эта команда исключает базу данных почтовых ящиков из подсистемы балансировки нагрузки подготовки почтовых ящиков. Это предотвратит автоматическое добавление новых почтовых ящиков в эту базу данных.
    
        New-MailboxDatabase -Server <PFServerName_with_CASRole> -Name <NewMDBforPFs> -IsExcludedFromProvisioning $true
    
    Для Exchange 2007 выполните приведенную ниже команду.
    
        New-MailboxDatabase -StorageGroup "<PFServerName>\StorageGroup>" -Name <NewMDBforPFs>
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Dn986544.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Мы рекомендуем добавлять в эту базу данных единственный почтовый ящик — промежуточный почтовый ящик, который будет создан в действии 3. В этой базе данных почтовых ящиков не нужно добавлять никакие другие почтовые ящики.</td>
    </tr>
    </tbody>
    </table>


3.  Создайте промежуточный почтовый ящик в новой базе данных почтовых ящиков и скройте его из адресной книги. Автообнаружение вернет SMTP этого почтового ящика как SMTP *DefaultPublicFolderMailbox*, чтобы путем разрешения этого SMTP клиент имел возможность получать доступ к серверу Exchange прежних версий для доступа к общедоступным папкам.
    
        New-Mailbox -Name <PFMailbox1> -Database <NewMDBforPFs>
    
        Set-Mailbox -Identity <PFMailbox1> -HiddenFromAddressListsEnabled $true

4.  Для Exchange 2010 включите функцию автообнаружения, чтобы вернуть промежуточные почтовые ящики общедоступных папок. Этот шаг можно пропустить в Exchange 2007.
    
        Set-MailboxDatabase <NewMDBforPFs> -RPCClientAccessServer <PFServerName_with_CASRole>

5.  Повторите предыдущие действия для каждого сервера общедоступных папок в своей организации.

## Шаг 3. Скачайте сценарии

1.  На странице [Общедоступные папки с поддержкой почты: скрипт для синхронизации каталога](https://www.microsoft.com/en-us/download/details.aspx?id=46381) скачайте следующие файлы:
    
      - `Sync-MailPublicFolders.ps1`
    
      - `SyncMailPublicFolders.strings.psd1`

2.  Сохраните файлы на локальном компьютере, с которого вы планируете запустить PowerShell. Например, в папку C:\\PFScripts.

## Этап 4. Настройте синхронизацию службы каталогов

Служба синхронизации службы каталогов не синхронизирует общедоступные папки, поддерживающие почту. Запустив следующий сценарий, можно синхронизировать общедоступные папки, поддерживающие почту, на различных площадках. Для общедоступных папок, поддерживающих почту, необходимо повторно создать специальные разрешения в облаке, так как в сценариях гибридного развертывания не поддерживаются разрешения для нескольких площадок. Дополнительные сведения см. в статье [Гибридное развертывание Exchange Server 2013](exchange-server-hybrid-deployments-exchange-2013-help.md).

<table>
<thead>
<tr class="header">
<th><img src="images/Dn986544.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Синхронизированные общедоступные папки, поддерживающие почту, отображаются как объекты почтовых контактов для потока обработки почты и не видны в Центре администрирования Exchange. См. сведения о команде Get-MailPublicFolder. Чтобы повторно создать разрешения SendAs в облаке, используйте команду Add-RecipientPermission.</td>
</tr>
</tbody>
</table>


1.  На сервере Exchange устаревшей версии выполните приведенную ниже команду, чтобы синхронизировать общедоступные папки, поддерживающие почту, из локального каталога Active Directory с Office 365.
    
        Sync-MailPublicFolders.ps1 -Credential (Get-Credential) -CsvSummaryFile:sync_summary.csv
    
    `Credential` — ваше имя пользователя и пароль для Office 365. `CsvSummaryFile` — путь к файлу журнала в формате CSV, в котором нужно регистрировать ошибки и операции синхронизации.

<table>
<thead>
<tr class="header">
<th><img src="images/Dn986544.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Перед запуском сценария рекомендуем сначала выполнить имитацию его действия в вашей среде, запустив его с параметром <code>-WhatIf</code>, как описано выше.<br />
Рекомендуем также запускать этот сценарий ежедневно, чтобы синхронизировать общедоступные папки, поддерживающие почту.</td>
</tr>
</tbody>
</table>


## Этап 5. Настройте для пользователей Exchange Online доступ к локальным общедоступным папкам

Конечный этап этой процедуры — настройка организации Exchange Online и разрешение доступа к локальным общедоступным папкам прежних версий.

Разрешите организации Exchange Online получать доступ к локальным общедоступным папкам. Укажите все промежуточные почтовые ящики общедоступных папок, которые вы создали на этапе 2. Сделайте удаленные общедоступные папки обнаруживаемыми.

Выполните в **Windows PowerShell** следующую команду:

    Set-OrganizationConfig -PublicFoldersEnabled Remote -RemotePublicFolderMailboxes PFMailbox1,PFMailbox2,PFMailbox3

Вы сможете увидеть изменения, когда завершится синхронизация ActiveDirectory. Это может занять до трех часов. Синхронизация повторяется каждые три часа, но вы можете в любое время выполнить принудительную синхронизацию каталогов. Подробные инструкции см. в разделе [Принудительное выполнение синхронизации каталогов](http://technet.microsoft.com/ru-ru/library/jj151771.aspx). Office 365 случайным образом выбирает один из почтовых ящиков общедоступных папок, которые возвращаются этой командой.

<table>
<thead>
<tr class="header">
<th><img src="images/Dn151301.important(EXCHG.150).gif" title="Важно" alt="Важно" />Важно!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>У пользователя Office 365, который не представлен локально объектом MailUser (локальным объектом по отношению к целевой иерархии общедоступных папок), не будет доступа к локальным общедоступным папкам Exchange 2013 или прежних версий. Решение см. в статье базы знаний <a href="https://go.microsoft.com/fwlink/p/?linkid=699451">Пользователям Exchange Online недоступны локальные общедоступные папки предыдущих версий</a>.</td>
</tr>
</tbody>
</table>


## Как проверить, что это работает

1.  Войдите в Outlook для пользователя, который находится в Exchange Online, и выполните следующие проверки общедоступных папок.
    
      - Просмотр иерархии.
    
      - Проверка разрешений.
    
      - Создание и удаление общедоступных папок.
    
      - Опубликуйте содержимое в общедоступной папке и удалите его.

## Никогда не работали с Office 365?


<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><img src="images/JJ200581.eac8a413-9498-4220-8544-1e37d1aaea13(EXCHG.150).png" title="Небольшой значок LinkedIn Learning" alt="Небольшой значок LinkedIn Learning" /> <strong>Никогда не работали с Office 365?</strong><br />
<a href="https://support.office.com/ru-ru/article/office-365-admin-and-it-pro-courses-68cc9b95-0bdc-491e-a81f-ee70b3ec63c5">Office 365 admins and IT pros</a> будут заинтересованы бесплатными видеокурсами, предоставленными платформой LinkedIn Learning.</p></td>
</tr>
</tbody>
</table>

