---
title: 'Режим координации активации центра данных: Exchange 2013 Help'
TOCTitle: Режим координации активации центра данных
ms:assetid: 57e4bf22-eeae-42a5-beb3-d68d06489592
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dd979790(v=EXCHG.150)
ms:contentKeyID: 50488270
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Режим координации активации центра данных

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2014-07-14_

Режим координации активации центра данных DAC (Datacenter Activation Coordination) — это свойство группы доступности базы данных DAG (Database Availability Group). Режим DAC отключен по умолчанию и должен включаться для всех групп обеспечения доступности базы данных (DAG), в которых используется непрерывная репликация. Необходимо отключить режим DAC для групп DAG, использующих режим сторонней репликации, если обратное не указано сторонним поставщиком.

Режим DAC используется для управления подключением баз данных при запуске групп DAG. Это средство предназначено для предотвращения синдрома разделенности на уровне баз данных при смене центра обработки данных. Деление кластера, или синдром разделенности — это состояние, которое приводит к тому, что копия базы данных подключается в качестве активной копии к двум участникам одной группы DAG, не связанным между собой. Этого можно избежать с помощью режима DAC, так как этот режим требует, чтобы участники групп DAG получали разрешение на подключение баз данных.

Например, рассмотрим сценарий, где основной центр данных содержит двух участников группы DAG и следящий сервер, а второй центр содержит двух других участников группы DAG. В этом случае группа DAG не находится в режиме DAC. Когда основной центр обработки данных теряет питание, вы активируете группу DAG во втором центре. Когда питание основного центра данных восстанавливается, участники группы DAG в основном центре данных, который обладал кворумом до перебоя питания, будут запущены и подключены к базам данных. Так как основной центр данных был восстановлен без сетевого подключения ко второму центру, а группа DAG не находилась в режиме DAC, в активных базах данных в группе DAG возник синдром разделенности.

## Как работает режим DAC

Режим DAC разработан для предотвращения синдрома разделенности путем включения протокола координации активации центра данных DACP (Datacenter Activation Coordination Protocol). В режиме DAC участники группы DAG не будут автоматически подключать базы данных, даже если им принадлежит кворум. Вместо этого с помощью протокола DACP определяется текущее состояние группы DAG и необходимость подключения баз данных с помощью диспетчера Active Manager.

Режим DAC можно представить как уровень приложения кворума для подключения баз данных. Чтобы понять назначение протокола DACP и принцип его работы, важно изучить основной сценарий, для работы с которым предназначен этот протокол. Рассмотрим сценарий для двух центров данных. Предположим, что в основном центре данных произошел полный отказ питания. В этом случае нарушается работа всех серверов и глобальной сети, поэтому организация принимает решение активировать резервный центр данных. Почти во всех таких сценариях устранения сбоев, когда восстанавливается питание основного центра, подключение к глобальной сети обычно восстанавливается не сразу. Это означает, что участники группы DAG в основном центре данных подключаются к питанию, но они не могут установить связь с участниками DAG в активированном резервном центре данных. Основной центр данных должен всегда содержать большинство голосующих в кворуме DAG, что означает: когда восстанавливается питание, даже при отсутствии подключения глобальной сети к участникам DAG в резервном центре данных, участники DAG в основном центре имеют большинство и, как результат, кворум. Это представляет проблему, так как при наличии кворума эти серверы могут подключаться к своим базам данных, что, в свою очередь, будет приводить к расхождению с текущими активными базами данных, которые теперь подключены в активированном резервном центре данных.

Протокол DACP был создан для решения этой проблемы. Диспетчер Active Manager хранит бит в памяти (0 либо 1), который указывает, разрешено ли группе DAG подключать локальные базы данных, которые назначены в качестве активных на сервере. Когда группа DAG работает в режиме DAC, при каждом запуске диспетчера Active Manager задается значение 0, которое означает, что ей не разрешено подключать базы данных. Так как сервер находится в режиме DAC, он должен установить связь со всеми известными ему другими участниками DAG, чтобы сообщить другому участнику DAG о том, можно ли подключать локальные базы данных, которые назначены в качестве активных. Ответ поступает в форме битового параметра для других диспетчеров Active Manager в группе DAG. Если другой сервер отвечает, что бит равен 1, то это означает, что серверам разрешено подключаться к базам данных, поэтому при запуске сервера для бита устанавливается значение 1 и подключаются его базы данных.

Но при восстановлении после сбоя питания основного центра данных, когда серверы восстанавливаются, но подключение к глобальной сети не восстановлено, все участники DAG в основном центре получают нулевое значение бита DACP; поэтому ни один из серверов, начинающих архивацию в восстановленном основном центре, не подключит базы данных, так как ни один из них не может установить связь с участником DAG, имеющим значение бита DAG, равное 1.

## Режим DAC для DAG с двумя участниками

Группы DAG с двумя членами наследуют ограничения, которые предотвращают обеспечение полной защиты от синдрома разделенности на уровне приложения только битом DACP. В группах DAG только с двумя членами режим DAC также использует время загрузки следящего сервера группы для определения возможности подключения баз данных при запуске. Время загрузки следящего сервера сравнивается со временем, когда бит DACP имел значение 1.

  - Если время установки бита DACP предшествует времени загрузки следящего сервера, система предполагает, что член группы DAG и следящий сервер были перезагружены одновременно (возможно, из-за отключения питания основного центра обработки данных), и члену группы DAG не разрешается подключать базы данных.

  - Если время установки бита DACP значительно предшествует времени загрузки следящего сервера, система предполагает, что член группы DAG был перезагружен по другой причине (возможно, из-за запланированного отключения для обслуживания или в результате сбоя системы или отключения питания на сервере группы DAG), и члену группы DAG разрешается подключить базы данных.

> [!IMPORTANT]  
> Так как время загрузки следящего сервера используется для определения возможности подключения участником группы DAG своих активных баз данных при запуске, следящий сервер и единственного участника группы DAG нельзя перезагружать одновременно. В противном случае участник группы обеспечения доступности баз данных может остаться в состоянии, в котором он не сможет подключать базы данных при запуске. В этом случае необходимо запустить командлет <a href="https://technet.microsoft.com/ru-ru/library/dd351169(v=exchg.150)">Restore-DatabaseAvailabilityGroup</a> в группе обеспечения доступности баз данных. При этом будет переустановлен бит DACP, что позволит члену группы DAG подключить базы данных.


## Другие преимущества режима DAC

Помимо защиты от синдрома разделенности на уровне приложения режим DAC позволяет использовать встроенные командлеты для устойчивости сайтов для переключения центра обработки данных. например:

  - [Stop-DatabaseAvailabilityGroup](https://technet.microsoft.com/ru-ru/library/dd335133\(v=exchg.150\))

  - [Restore-DatabaseAvailabilityGroup](https://technet.microsoft.com/ru-ru/library/dd351169\(v=exchg.150\))

  - [Start-DatabaseAvailabilityGroup](https://technet.microsoft.com/ru-ru/library/dd335076\(v=exchg.150\))

Для переключения центра данных для групп обеспечения доступности баз данных, не работающих в режиме DAC, необходимо использовать сочетание средств Exchange и средств управления кластером. Дополнительные сведения см. в разделе [Переключения центра обработки данных](datacenter-switchovers-exchange-2013-help.md).

## Включение режима DAC

Режим DAC можно включить только в командной консоли Exchange. В частности, для включения режима DAC можно использовать командлет [Set-DatabaseAvailabilityGroup](https://technet.microsoft.com/ru-ru/library/dd297934\(v=exchg.150\)), как это проиллюстрировано в следующем примере.

```powershell
Set-DatabaseAvailabilityGroup -Identity DAG2 -DatacenterActivationMode DagOnly
```

В предыдущем примере режим DAC включается для группы обеспечения доступности баз данных DAG2.

Дополнительные сведения о включении режима DAC см. в разделах [Настройка свойств группы обеспечения доступности баз данных](configure-database-availability-group-properties-exchange-2013-help.md) и [Set-DatabaseAvailabilityGroup](https://technet.microsoft.com/ru-ru/library/dd297934\(v=exchg.150\)).

