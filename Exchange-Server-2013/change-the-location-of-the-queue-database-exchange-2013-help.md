---
title: 'Изменение расположения базы данных очереди: Exchange 2013 Help'
TOCTitle: Изменение расположения базы данных очереди
ms:assetid: f170cb0c-04a9-4fa7-b594-206e3a787e14
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb125177(v=EXCHG.150)
ms:contentKeyID: 51408093
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Изменение расположения базы данных очереди

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

*Очередь* — это временное хранилище сообщений, ожидающих следующую стадию обработки. Каждая очередь представляет собой логический набор сообщений, которые обрабатываются сервером транспорта в определенном порядке.

Как и в предыдущих версиях Exchange, для хранения очередей сообщений в Microsoft Exchange Server 2013 используется расширенный обработчик хранилищ (ESE). Все очереди хранятся в одной базе данных ESE. Очереди размещаются только на серверах почтовых ящиков или на пограничных транспортных серверах.

Местоположение базы данных очереди и ее журналов транзакций контролируется ключами в XML-файле конфигурации приложения `%ExchangeInstallPath%Bin\EdgeTransport.exe.config`. Этот файл связан с транспортной службой Microsoft Exchange. В следующей таблице каждый ключ рассматривается более подробно.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Клавиша</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>QueueDatabasePath</em></p></td>
<td><p>Этот ключ определяет расположение файлов базы данных очереди. Это следующие файлы:</p>
<ul>
<li><p>Mail.que</p></li>
<li><p>Trn.chk</p></li>
</ul>
<p>Местоположение по умолчанию: <code>%ExchangeInstallPath%TransportRoles\data\Queue</code>.</p></td>
</tr>
<tr class="even">
<td><p><em>QueueDatabaseLoggingPath</em></p></td>
<td><p>Этот ключ определяет расположение файлов журналов транзакций базы данных очереди. Это следующие файлы:</p>
<ul>
<li><p>Trn.log</p></li>
<li><p>Trntmp.log</p></li>
<li><p>Trn<em>nnn</em>.log</p></li>
<li><p>Trnres00001.jrs</p></li>
<li><p>Trnres00002.jrs</p></li>
<li><p>Temp.edb</p></li>
</ul>
<p>Обратите внимание, что файл Temp.edb используется для проверки схемы базы данных очереди при запуске службы транспорта Microsoft Exchange. Хотя файл Temp.edb не является файлом журнала транзакций, он хранится там же, где и файлы журнала транзакций.</p>
<p>Местоположение по умолчанию: <code>%ExchangeInstallPath%TransportRoles\data\Queue</code>.</p></td>
</tr>
</tbody>
</table>


## Что нужно знать перед началом работы

  - Предполагаемое время для завершения: 15 минут.

  - Разрешения Exchange не применяются к процедурам, описанным в этом разделе. Эти процедуры выполняются в операционной системе сервера Exchange.

  - При остановке или перезапуске службы транспорта Microsoft Exchange поток обработки почты на сервере временно прерывается.

  - Если вы изменяете расположение базы данных очереди или журналов транзакций, существующие файлы базы данных и журналов не перемещаются. Новая база данных и новые журналы транзакций создаются в указанном расположении. Существующие файлы остаются там же, где и раньше. Тем не менее, эти файлы больше не используются. Если вы хотите повторно использовать существующую базу данных или файлы журналов транзакций в новом расположении, переместите существующие файлы в это расположение после остановки службы транспорта Microsoft Exchange, но до ее перезапуска.

  - Если целевая папка для базы данных очереди или журналов транзакций не существует, она будет создана автоматически, если к родительской папке применены перечисленные ниже разрешения.
    
      - Сетевая служба: полный доступ
    
      - Система: Полный доступ
    
      - Администраторы: Полный доступ

  - Все специальные настройки, выполненные для каждого сервера в XML-файлах конфигурации приложения Exchange, например в файлах web.config на серверах клиентского доступа или файлах EdgeTransport.exe.config на серверах почтовых ящиков, будут перезаписаны после установки накопительного пакета обновления Exchange. Обязательно сохраните нужные данные, чтобы упростить перенастройку сервера после установки. Эти параметры необходимо перенастроить после установки накопительного пакета обновления Exchange.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

## Что необходимо сделать?

## Использование командной строки для создания базы данных очереди и журналов транзакций в новом расположении

1.  Создайте папки, в которых вы хотите хранить базу данных очереди и журналы транзакций. Убедитесь, что к папкам применяются правильные разрешения.

2.  В окне командной строки откройте файл EdgeTransport.exe.config в Блокноте, выполнив следующую команду:
    
    ```powershell
    Notepad %ExchangeInstallPath%Bin\EdgeTransport.exe.config
    ```

3.  В разделе `<appSettings>` измените следующие ключи:
    ```powershell
        <add key="QueueDatabasePath" value="<LocalPath>" />
        <add key="QueueDatabaseLoggingPath" value="<LocalPath>" />
    ```
    Например, чтобы создать новую базу данных очереди в папке D:\\Queue\\QueueDB и новые журналы транзакций в папке D:\\Queue\\QueueLogs, используйте следующие значения:
    ```powershell
        <add key="QueueDatabasePath" value="D:\Queue\QueueDB" />
        <add key="QueueDatabaseLoggingPath" value="D:\Queue\QueueLogs" />
    ```
4.  Закончив, сохраните и закройте файл EdgeTransport.exe.config.

5.  Перезапустите службу транспорта Microsoft Exchange, выполнив следующую команду:
    ```powershell
        net stop MSExchangeTransport && net start MSExchangeTransport
    ```
## Как проверить, что все получилось?

Чтобы проверить, успешно ли созданы журналы транзакций и база данных очереди в новом расположении:

1.  Убедитесь, что новые файлы базы данных Mail.que и Trn.chk созданы в новом расположении.

2.  Убедитесь в том, что новые файлы журнала транзакций Trn.log, Trntmp.log, Trnres00001.jrs, Trnres00002.jrs и Temp.edb созданы в новом расположении.

3.  Если после запуска службы транспорта Microsoft Exchange вы можете удалить из старого расположения базу данных очереди и файлы журнала транзакций, эти файлы больше не используются.

Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: [Exchange Server](https://go.microsoft.com/fwlink/p/?linkid=60612), [Exchange Online](https://go.microsoft.com/fwlink/p/?linkid=267542) или [Exchange Online Protection](https://go.microsoft.com/fwlink/p/?linkid=285351).

Что необходимо сделать?

## Использование командной строки для перемещения существующей базы данных очереди и журналов транзакций в новое расположение

Восстановление и перемещение существующей базы данных очереди и журналов транзакций необходимо только в сценариях аварийного восстановления при неправильном завершении работы службы транспорта Microsoft Exchange или сбоях жесткого диска.

Как правило, нет необходимости повторно использовать существующие журналы транзакций. При нормальном завершении работы служба транспорта Microsoft Exchange сохраняет все несохраненные элементы журнала транзакций в базе данных очереди. А так как используется циклическое ведение журнала, журналы транзакций, которые содержат ранее сохраненные изменения базы данных, не сохраняются.

Чтобы переместить существующую базу данных очереди и журналы транзакций в новое расположение, выполните следующую процедуру:

1.  Создайте папки, в которых вы хотите хранить базу данных очереди и журналы транзакций. Убедитесь, что к папкам применяются правильные разрешения.

2.  В окне командной строки откройте файл EdgeTransport.exe.config в Блокноте, выполнив следующую команду:
    
    ```powershell
    Notepad %ExchangeInstallPath%Bin\EdgeTransport.exe.config
    ```

3.  В разделе `<appSettings>` измените следующие ключи:
    ```powershell
        <add key="QueueDatabasePath" value="<LocalPath>" />
        <add key="QueueDatabaseLoggingPath" value="<LocalPath>" />
    ```
    Например, чтобы изменить расположение базы данных очереди на папку D:\\Queue\\QueueDB, а расположение журналов транзакций — на папку D:\\Queue\\QueueLogs, используйте следующие значения:
    ```powershell
        <add key="QueueDatabasePath" value="D:\Queue\QueueDB" />
        <add key="QueueDatabaseLoggingPath" value="D:\Queue\QueueLogs" />
    ```
4.  Закончив, сохраните и закройте файл EdgeTransport.exe.config.

5.  Остановите службу транспорта Microsoft Exchange, выполнив следующую команду:
    
    ```powershell
    net stop MSExchangeTransport
    ```

6.  Переместите существующие файлы базы данных Mail.que и Trn.chk из исходного расположения в новое.

7.  Переместите существующие файлы журналов транзакций Trn.log, Trntmp.log, Trn*nnnn*.log, Trnres00001.jrs, Trnres00002.jrs и Temp.edb из старого расположения в новое.

8.  Запустите службу транспорта Microsoft Exchange, выполнив следующую команду:
    
    ```powershell
    net start MSExchangeTransport
    ```

## Как проверить, что все получилось?

Чтобы проверить, были ли журналы транзакций и база данных очереди успешно перемещены в новое расположение:

1.  Убедитесь, что файлы базы данных очереди Mail.que и Trn.chk созданы в новом расположении.

2.  Убедитесь, что файлы журнала транзакций Trn.log, Trntmp.log, Trnres00001.jrs, Trnres00002.jrs и Temp.edb созданы в новом расположении.

3.  Убедитесь, что в исходном расположении нет файлов базы данных очереди и журнала транзакций.

Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: [Exchange Server](https://go.microsoft.com/fwlink/p/?linkid=60612), [Exchange Online](https://go.microsoft.com/fwlink/p/?linkid=267542) или [Exchange Online Protection](https://go.microsoft.com/fwlink/p/?linkid=285351).

Что необходимо сделать?

