---
title: 'Трассировка преобразования контента: Exchange 2013 Help'
TOCTitle: Трассировка преобразования контента
ms:assetid: eb9c7df2-9093-49f9-aa4f-044909bd2225
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb397226(v=EXCHG.150)
ms:contentKeyID: 50489410
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Трассировка преобразования контента

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2012-09-25_

Ошибки при трассировке преобразования содержимого в процессе преобразования содержимого MAPI, выполняемого службой транспорта почтовых ящиков для входящих и исходящих сообщений на сервере почтовых ящиков Microsoft Exchange Server 2013.

Служба транспорта почтовых ящиков на сервере почтовых ящиков отвечает за преобразование содержимого сообщений, отправляемых из и на почтовый ящик получателя. В частности, служба Mailbox Transport Submission преобразует исходящие сообщения из почтового ящика пользователя из MAPI в MIME. Служба Mailbox Transport Delivery преобразует входящие сообщения для пользователей почтовых ящиков из MIME в MAPI. Ошибки при преобразовании MAPI регистрируются с помощью трассировки преобразования содержимого.

Классификатор в службе транспорта на сервере почтовых ящиков отвечает за преобразования содержимого всех сообщений, отправленных внешним получателям. Ошибки преобразования содержимого, обнаруженные классификатором в транспортной службе в ходе преобразования сообщений, отправляемых внешним получателям, при трассировке преобразования содержимого не регистрируются.

**Содержание**

Настройка трассировки преобразования содержимого

Принцип работы трассировки преобразования содержимого

Соображения по поводу трассировки преобразования содержимого

## Настройка трассировки преобразования содержимого

Для контроля над трассировкой преобразования содержимого используются указанные ниже параметры командлетов **Set-TransportService** и **Set-MailboxTransportService** в командной консоли.

  - *ContentConversionTracingEnabled*   Этот параметр включает или выключает трассировку преобразования содержимого в службе транспорта на сервере почтовых ящиков, или в службе транспорта почтовых ящиков на сервере почтовых ящиков. Допустимые значения этого параметра — `$true` и `$false`. Значение по умолчанию: `$false`. Если организация Exchange содержит несколько серверов почтовых ящиков, необходимо включить отслеживание преобразования содержимого на каждом сервере почтовых ящиков.

  - *PipelineTracingPath*   Хотя этот параметр связан с конвейерной трассировкой, он также определяет корневое расположение для файлов трассировки преобразования контента. Местоположение по умолчанию в службе транспорта `%ExchangeInstallPath%TransportRoles\Logs\Hub\PipelineTracing`. Местоположение по умолчанию в службе транспорта почтовых ящиков `%ExchangeInstallPath%TransportRoles\Logs\Mailbox\PipelineTracing`. Путь должен быть локальным для компьютера под управлением Exchange.

Функция преобразования содержимого создает папку с именем `ContentConversionTracing` по адресу, указанному в параметре *PipelineTracingPath*. В папке `ContentConversionTracing` создаются две папки: `InboundFailures` и `OutboundFailures`. В папке `InboundFailures` сохраняются сведения об ошибках преобразования содержимого входящих сообщений. В папке `OutboundFailures` сохраняются сведения об ошибках преобразования содержимого исходящих сообщений.

Максимальный размер всех файлов в папке `InboundFailures` или папке `OutboundFailures` составляет 128 мегабайт (MБ). Для удаления старых файлов в каталогах трассировки преобразования содержимого функция циклического ведения журнала не используется. Когда размер файлов в папке достигает предела, функция трассировки преобразования содержимого прекращает запись данных в эту папку. Если необходимо исключить увеличение размера папки до предельного значения, можно создать задачу, запускаемую по расписанию и перемещающую файлы трассировки преобразования содержимого в другое место.

Далее приведены разрешения, необходимые для доступа к папкам, используемым при трассировке преобразования контента.

  - Администраторы: полный доступ

  - Сетевая служба: полный доступ

  - Система: полный доступ

<table>
<thead>
<tr class="header">
<th><img src="images/Dd876857.Caution(EXCHG.150).gif" title="Внимание!" alt="Внимание!" />Внимание!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>При трассировке преобразования содержимого копируется все содержимое сообщений электронной почты. Во избежание раскрытия конфиденциальных сведений необходимо задать для места хранения файлов трассировки преобразования содержимого соответствующие разрешения системы безопасности.</td>
</tr>
</tbody>
</table>


В начало

## Принцип работы трассировки преобразования содержимого

Если преобразование содержимого входящего сообщения завершается неудачей, отправителю сообщения отправляется уведомление о доставке с кодом состояния 5.6.0. Если включена трассировка преобразования содержимого, сведения об ошибке записываются в момент создания уведомления о доставке 5.6.0. При каждой ошибке преобразования содержимого создаются два файла.

При возникновении ошибки в ходе преобразования содержимого входящего сообщения из формата MIME в MAPI в папке «InboundFailures» создаются два файла, указанных ниже.

  - **\<GUID\>.eml**   Этот файл содержит сообщение, которое не удалось преобразовать, в текстовом формате.

  - **\<GUID\>.txt**   Этот файл содержит описание исключения, результаты преобразования, параметры преобразования и ограничения, налагаемые на размер всех сообщений службой транспорта почтовых ящиков.

При возникновении ошибки в ходе преобразования содержимого исходящего сообщения из формата MAPI в MIME в папке «OutboundFailures» создаются два файла, указанных ниже.

  - **\<GUID\>.msg**   Этот файл содержит сообщение, которое не удалось преобразовать в формат Microsoft Outlook.

  - **\<GUID\>.txt**   Этот файл содержит описание исключения, результаты преобразования, параметры преобразования и ограничения, налагаемые на размер всех сообщений драйвером хранилища.

Значение \<*GUID*\> в именах обоих файлов одинаково. При каждой ошибке преобразования контента создается новый идентификатор GUID, используемый в именах соответствующих файлов сообщений и текстовых файлов. Примером значения GUID в именах этих файлов может служить значение `038b930e-61fd-4bfd-b9b4-0374c18b73f7`.

В начало

## Соображения по поводу трассировки преобразования содержимого

Трассировку преобразования содержимого можно оставить включенной для упреждающего наблюдения или. включать ее по мере необходимости для устранения конкретных ошибок. В большинстве случаев ошибки преобразования содержимого входящих сообщений можно воспроизвести, попросив получателя уведомления о доставке 5.6.0 отправить исходное сообщение еще раз.

Наиболее часто ошибки возникают при преобразовании содержимого входящих сообщений. Ниже описаны некоторые возможные причины возникновения этих ошибок.

  - **Нарушения ограничений размера сообщений   ** Ограничения размера сообщений налагаются службой транспорта почтовых ящиков для предотвращения атак типа «отказ в обслуживании» (DoS). Эти ограничения указаны в файле \<*GUID*\>.txt. Они описаны ниже.
    
      - **MaxMimeTextHeaderLength**   Это ограничение определяет максимально возможное число текстовых знаков в заголовке MIME. Данный параметр имеет значение 2000.
    
      - **MaxMimeSubjectLength**   Это ограничение определяет максимально возможное число текстовых знаков в теме сообщения. Данный параметр имеет значение 255.
    
      - **MSize**   Это ограничение определяет максимальный размер сообщения. Данный параметр имеет значение 2 147 483 647 байт.
    
      - **MaxMimeRecipients**.   Это ограничение определяет общее количество получателей, которых можно указать в полях «Кому», «Копия» и «Скрытая копия» Данный параметр имеет значение 12 288.
    
      - **MaxRecipientPropertyLength**   Это ограничение определяет максимально возможное число текстовых знаков в описании получателя. Данный параметр имеет значение 1000.
    
      - **MaxBodyPartsTotal**   Это ограничение определяет максимально возможное число частей в составном сообщении MIME. Данный параметр имеет значение 250.
    
      - **MaxEmbeddedMessageDepth**   Это ограничение определяет максимально возможное число перенаправленных сообщений в сообщении. Данный параметр имеет значение 30.
    
    Дополнительные сведения о настраиваемых ограничениях на размер сообщений, используемых в службе транспорта на серверах почтовых ящиков или на серверах пограничного транспорта см. в разделе [Ограничения на размер сообщений](message-size-limits-exchange-2013-help.md).

  - **Ошибка при преобразовании входящего сообщения iCalendar в приглашение на собрание**   В документе RFC 2445 спецификация iCalendar определена как стандартный способ обмена данными календаря. Ниже описаны возможные причины ошибок при преобразовании сообщений iCalendar.
    
      - Неправильное использование iCalendar отправляющим агентом.
    
      - Использование элементов iCalendar, не поддерживаемых схемой календаря Exchange или Outlook.
    
    При возникновении ошибок в ходе преобразования сообщений iCalendar отправитель не получает уведомления о доставке с кодом 5.6.0. Вместо этого сообщение доставляется адресату с вложенным файлом ICS, который содержит тело сообщения iCalendar.

  - **Ошибки, вызванные неправильным форматированием сообщения MIME**   Нежелательные сообщения электронной почты могут содержать в заголовках ошибки форматирования, например непарные кавычки в описаниях получателей. Ошибки, вызванные неправильным форматированием сообщения MIME, встречаются гораздо реже.

При преобразовании содержимого исходящих сообщений ошибки возникают гораздо реже, чем в случае с входящими сообщениями. Их причинами обычно являются ошибки в коде Exchange или поврежденное содержимое сообщения.

В начало

