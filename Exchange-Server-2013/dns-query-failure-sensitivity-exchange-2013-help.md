---
title: 'Чувствительность к сбою запросов DNS: Exchange 2013 Help'
TOCTitle: Чувствительность к сбою запросов DNS
ms:assetid: a3c3980c-20ca-4b54-a2e6-76d49af620b4
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb676467(v=EXCHG.150)
ms:contentKeyID: 52061249
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Чувствительность к сбою запросов DNS

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2014-12-02_

В Microsoft Exchange Server 2013 можно настраивать чувствительность запроса DNS на чуть более быструю доставку сообщения, когда в домене назначения встречаются ошибки DNS. Однако, в зависимости от ошибок DNS, эта настройка может при некоторых обстоятельствах вызвать сбой доставки.

## Запросы DNS и удаленная доставка сообщений

Сервер Exchange, который отвечает за доставку сообщений внешним получателям, должен найти конечный сервер обмена сообщениями, который принимает почту для внешних получателей. В зависимости от назначения сообщения отправляются в одну или более удаленных очередей доставки, где они ждут доставки удаленным получателям. Дополнительные сведения об очередях доставки см. в разделе [Очереди](queues-exchange-2013-help.md).

Сервер Exchange запрашивает настроенные серверы DNS, чтобы найти записи DNS, необходимые для доставки сообщения. Серверы DNS запрашиваются в том порядке, в котором они находятся в списке. Если один из DNS-серверов недоступен, запрос переходит на следующий DNS-сервер в списке. DNS-серверы получают запрос на следующую информацию.

  - **Записи обмена электронной почтой (MX) для доменной части внешнего получателя**   Запись MX содержит полное доменное имя сервера обмена сообщениями, отвечающего за прием сообщений для домена, а также значения приоритетов для этого сервера обмена сообщениями. Меньшее значение приоритета означает более предпочтительный сервер обмена сообщениями. Значение приоритета важно, если у домена более одной записи MX. Для оптимизации отказоустойчивости многие организации используют несколько серверов обмена сообщениями и несколько записей обмена почтой с разными значениями приоритетов.

  - **Записи адреса (A) для конечных серверов обмена сообщениями**   Каждый сервер обмена сообщениями, использующийся в записи MX, должен иметь соответствующую запись А. Запись А используется для поиска IP-адреса конечного сервера обмена сообщениями. Подписанный пограничный транспортный сервер использует IP-адрес для открытия SMTP-соединения с конечным сервером обмена сообщениями. Хотя для записи канонического имени (CNAME) в записи MX технически возможно использовать полное доменное имя, эта практика нарушает RFC 974, RFC 1034, RFC 1912 и RFC 2181, и поэтому не поддерживается большинством серверов обмена сообщениями.
    
    Требуемая комбинация итеративных запросов DNS и рекурсивных запросов DNS, начинающихся с корневого сервера DNS, используется для разрешения полного доменного имени сервера обмена сообщениями, найденного в записи MX в IP-адресе.

В Exchange 2013 существует ненастраиваемый лимит DNS-запроса, равный 5 секундам для каждого DNS-сервера, и лимит в одну минуту для всего DNS-запроса.

## Возможные проблемы с DNS

Даже если настройки DNS на сервере Exchange выполнены правильно, могут возникнуть проблемы с записями DNS для отдельных доменов или проблемы с любым из серверов DNS, которые используются для поиска доверенного сервера DNS. Обычно вы не можете контролировать возникновение этих проблем, поэтому их должны устранять стороны, владеющие данными серверами DNS. Ошибки, относящиеся к DNS, могут быть вызваны одним или несколькими следующими условиями:

  - недопустимые DNS-записи для конечного домена;

  - проблемы с загруженностью DNS-сервера;

  - проблемы с репликацией DNS-сервера.

Когда в Exchange 2013 в результате DNS-запроса возникает ошибка, запрос передается на следующий DNS-сервер только в случае, если этот DNS-сервер еще не вернул ошибку по текущему запросу.

Чувствительность к сбою запросов DNS можно контролировать, изменяя XML-файл конфигурации приложения `%ExchangeInstallPath%bin\EdgeTransport.exe.config`. Этот файл связан с транспортной службой Microsoft Exchange. Изменения в этом файле применяются после перезапуска службы транспорта Microsoft Exchange. При перезапуске этой службы поток почты на сервере временно прерывается. Чувствительность к сбою запросов DNS контролируется ключом *DnsFaultTolerance* в файле EdgeTransport.exe.config. Этот ключ использует следующие значения.

  - **Опережающий**   Когда DNS-запрос встречает комбинацию допустимых и недопустимых записей обмена почтой, DNS-запрос продолжается до тех пор, пока не достигнут предел времени ожидания DNS-запроса, равный одной минуте. Недопустимые записи МХ удаляются, а допустимая запись МХ с наименьшим значением приоритета используется для доставки сообщения на конечный сервер обмена сообщениями. Это значение по умолчанию.

  - **Обычный**   Когда запрос DNS встречает недопустимую запись МХ в первый раз, любые разрешенные записи МХ со значением приоритета, равным значению приоритета недопустимой записи МХ или превышающем его, немедленно удаляются. Оставшаяся запись обмена почтой с наименьшим значением приоритета используется для доставки сообщения на конечный сервера обмена сообщениями без ожидания истечения времени всего DNS-запроса. Хотя это поведение приводит к более быстрой доставке сообщений, его потенциальным недостатком является то, что DNS-запрос может не располагать допустимыми записями обмена почтой, если верны следующие условия.
    
      - Недопустимая запись обмена почтой является первой записью обмена почтой для домена назначения.
    
      - Допустимые записи МХ имеют те же значения приоритета, что и недопустимые записи.

В обоих режимах — `Normal` и `Lenient` — результаты DNS-запроса для недопустимой записи обмена почтой не кэшируются. При следующем выполнении DNS-запроса он попробует разрешить записи обмена почтой для домена назначения.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Все специальные настройки, выполненные для каждого сервера в XML-файлах конфигурации приложения Exchange, например в файлах web.config на серверах клиентского доступа или файлах EdgeTransport.exe.config на серверах почтовых ящиков, будут перезаписаны после установки накопительного пакета обновления Exchange. Обязательно сохраните нужные данные, чтобы упростить перенастройку сервера после установки. Эти параметры необходимо перенастроить после установки накопительного пакета обновления Exchange.</td>
</tr>
</tbody>
</table>

