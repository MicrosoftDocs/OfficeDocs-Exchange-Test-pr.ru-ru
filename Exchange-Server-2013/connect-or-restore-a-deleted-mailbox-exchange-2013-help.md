---
title: 'Подключение или восстановление удаленного почтового ящика: Exchange 2013 Help'
TOCTitle: Подключение или восстановление удаленного почтового ящика
ms:assetid: a5e6ac44-5901-4eab-9017-c6fae80a0f83
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ863438(v=EXCHG.150)
ms:contentKeyID: 50556466
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Подключение или восстановление удаленного почтового ящика

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2015-05-04_

Можно использовать командную консоль или Центр администрирования Exchange для подключения удаленного почтового ящика к учетной записи пользователя Active Directory. При удалении почтового ящика Exchange сохраняет ящик в базе данных почтовых ящиков и переводит его в отключенное состояние. Удаляется также связанная учетная запись пользователя Active Directory. Почтовый ящик сохраняется до истечения периода сохранения удаленных почтовых ящиков, который по умолчанию равен 30 дней, после чего они будут окончательно удалены (*очищены*) из базы данных почтовых ящиков.

Пока удаленный почтовый ящик окончательно не удаляется из базы данных почтовых ящиков Exchange. Можно использовать командную консоль или Центр администрирования Exchange для повторного его подключения к учетной записи пользователя в Active Directory. К тому же, можно использовать командную консоль для восстановления содержимого удаленного почтового ящика в существующем почтовом ящике.

Дополнительные сведения об отключенных почтовых ящиках и других задачах управления приведены в следующих разделах:

  - [Отключенные почтовые ящики](disconnected-mailboxes-exchange-2013-help.md)

  - [Отключение или удаление почтового ящика](disable-or-delete-a-mailbox-exchange-2013-help.md)

  - [Подключение отключенного почтового ящика](connect-a-disabled-mailbox-exchange-2013-help.md)

  - [Окончательное удаление почтового ящика](permanently-delete-a-mailbox-exchange-2013-help.md)

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения: 2 минуты.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Тема «Разрешения подготовки получателей» в разделе [Разрешения получателей](recipients-permissions-exchange-2013-help.md).

  - Создайте новую учетную запись пользователя в Active Directory для подключения удаленного почтового ящика. Или запустите командлет **Get-User** в командной консоли Exchange, чтобы убедиться, что учетная запись пользователя в Active Directory, к которой вы хотите подключить удаленный почтовый ящик, существует и не сопоставлена с другим почтовым ящиком. Для подключения удаленного почтового ящика к учетной записи пользователя учетная запись должна существовать, а значение свойства *RecipientType* должно равняться `User` — это указывает, что учетная запись еще не связана с почтовым ящиком.
    
    Для локальных организаций Exchange можно также проверить эти данные в оснастке "Active Directory — пользователи и компьютеры".
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Dd876857.important(EXCHG.150).gif" title="Важно" alt="Важно" />Важно!</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>При подключении удаленных связанных почтовых ящиков, почтовых ящиков ресурсов или общих почтовых ящиков учетная запись пользователя Active Directory, к которой подключается почтовый ящик, должна быть отключена.</td>
    </tr>
    </tbody>
    </table>


  - Выполните следующую команду, чтобы проверить, что удаленный ящик, который требуется подключить к учетной записи пользователя, существует в базе данных почтовых ящиков и не удален с возможностью восстановления.
    
        Get-MailboxDatabase | Get-MailboxStatistics | Where { $_.DisplayName -eq "<display name>" } | fl DisplayName,Database,DisconnectReason
    
    Удаленный почтовый ящик должен существовать в базе данных почтовых ящиков, а значение свойства *DisconnectReason* должно быть равно `Disabled`. Если почтовый ящик был удален из базы данных, команда не даст никаких результатов.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

  - Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: [Exchange Server](https://go.microsoft.com/fwlink/p/?linkid=60612), [Exchange Online](https://go.microsoft.com/fwlink/p/?linkid=267542) или [Exchange Online Protection](https://go.microsoft.com/fwlink/p/?linkid=285351)..

## Что необходимо сделать?

## Подключить удаленный почтовый ящик

При подключении удаленного почтового ящика выполняется связывание почтового ящика с учетной записью, для которой не включена поддержка почты, то есть у нее нет существующего ящика. Для подключения удаленного почтового ящика к учетной записи пользователя, имеющего почтовый ящик, следует восстановить удаленный почтовый ящик. Дополнительные сведения см. в подразделе Восстановление удаленного почтового ящика далее в этом разделе.

## Использовать Центр администрирования Exchange для подключения удаленного почтового ящика

В приведенной ниже процедуре описано, как подключить удаленный почтовый ящик к учетной записи пользователя. Эту процедуру также можно использовать для подключения связанных почтовых ящиков, почтовых ящиков ресурсов и общих почтовых ящиков, которые были удалены из учетной записи пользователя.

1.  В Центре администрирования Exchange перейдите к разделу **Получатели** \> **Почтовые ящики**.

2.  Щелкните **Дополнительно** ![Значок дополнительных параметров](images/JJ150550.5381819e-3b21-4873-8714-e9b956290b28(EXCHG.150).gif "Значок дополнительных параметров"), а затем — **Подключить почтовый ящик**.
    
    Появится список почтовых ящиков, которые были отключены на выбранном сервере Exchange Server в вашей организации Exchange.
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Это список отключенных почтовых ящиков содержит выключенные почтовые ящики, удаленные почтовые ящики (в том числе с возможностью восстановления).</td>
    </tr>
    </tbody>
    </table>


3.  Щелкните удаленный почтовый ящик, который требуется подключить, а затем щелкните **Подключить**.

4.  Нажмите кнопку **Да** в окне предупреждения, запрашивающего подтверждение подключения ящика.
    
    Отображается список учетных записей пользователей, для которых не включена поддержка почты.

5.  Щелкните пользователя, для которого требуется подключить ящик, а затем щелкните **ОК**.
    
    Exchange подключит удаленный почтовый ящик к выбранной учетной записи пользователя.

## Использовать командную консоль для подключения удаленного почтового ящика

Используйте командлет **Connect-Mailbox** в командной консоли Exchange для подключения удаленного почтового ящика к учетной записи пользователя, для которой не включена поддержка почты. Необходимо указать тип почтового ящика, который вы подключаете. В следующих примерах представлен синтаксис для повторного подключения пользовательских, связанных и общих почтовых ящиков, а также почтовых ящиков ресурсов и оборудования. Во всех примерах необязательный параметр *Alias* используется для указания псевдонима электронной почты, который является частью адреса электронной почты слева от символа @. Если не включать параметр *Alias*, значение, установленное для параметров *User* и *LinkedMasterAccount*, используется для создания псевдонима адреса электронной почты для подключаемого почтового ящика.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Как было сказано выше, при подключении связанного почтового ящика, почтового ящика ресурса или общего почтового ящика учетная запись пользователя Active Directory, с которой связывается почтовый ящик, должна быть отключена.</td>
</tr>
</tbody>
</table>


В данном примере подключается почтовый ящик пользователя. Параметр *Identity* задает отображаемое имя удаленного почтового ящика в базе данных почтовых ящиков с именем MBXDB01. В параметре *User* указывается учетная запись пользователя в Active Directory, к которой подключается почтовый ящик.

    Connect-Mailbox -Identity "Paul Cannon" -Database MBXDB01 -User "Robin Wood" -Alias robinw

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>К тому же, можно использовать значения свойств <code>LegacyDN</code> или <code>MailboxGuid</code> для идентификации удаленного почтового ящика.</td>
</tr>
</tbody>
</table>


В данном примере подключается связанный почтовый ящик. В параметре *Identity* указывается удаленный почтовый ящик в базе данных почтовых ящиков с именем MBXDB02. В параметре *LinkedMasterAccount* указывается учетная запись пользователя Active Directory в лесу учетных записей, к которой необходимо подключить почтовый ящик. Параметр *LinkedDomainController* указывает контроллер домена в лесу учетных записей.

    Connect-Mailbox -Identity "Temp User" -Database MBXDB02 -LinkedDomainController FabrikamDC01 -LinkedMasterAccount danpark@fabrikam.com -Alias dpark

В данном примере подключается почтовый ящик помещения.

    Connect-Mailbox -Identity "rm2121" -Database "MBXResourceDB" -User "Conference Room 2121" -Alias ConfRm2121 -Room

В данном примере подключается почтовый ящик оборудования.

    Connect-Mailbox -Identity "MotorPool01" -Database "MBXResourceDB" -User "Van01 (12 passengers)" -Alias van01 -Equipment

В данном примере подключается общий почтовый ящик.

    Connect-Mailbox -Identity "Printer Support" -Database MBXDB01 -User "Corp Printer Support" -Alias corpprint -Shared

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>К тому же, можно использовать значения <code>LegacyDN</code> или <code>MailboxGuid</code> для идентификации удаленного почтового ящика.</td>
</tr>
</tbody>
</table>


Дополнительные сведения о синтаксисе и параметрах см. в разделе [Connect-Mailbox](https://technet.microsoft.com/ru-ru/library/aa997878\(v=exchg.150\)).

## Как проверить, все ли получилось?

Чтобы убедиться, что вы успешно подключили удаленный почтовый ящик к учетной записи пользователя, выполните одно из следующих действий.

  - В Центре администрирования Exchange щелкните пункт **Получатели**, перейдите на соответствующую страницу для выбора типа почтового ящика, нажмите кнопку **Обновить** ![Значок обновления](images/Dd353189.85f271ca-32a4-426c-842a-d2172567099d(EXCHG.150).gif "Значок обновления") и убедитесь, что почтовый ящик указан в списке.

  - В оснастке "Active Directory — пользователи и компьютеры" щелкните правой кнопкой мыши учетную запись пользователя, чей почтовый ящик был подключен, и затем щелкните **Свойства**. На вкладке **Общие** обратите внимание, что поле **Адрес электронной почты** заполняется заново связанным адресом электронной почты для подключенного почтового ящика.

  - В консоли Shell выполните следующую команду:
    
        Get-User <identity>
    
    Значение **UserMailbox** свойства *RecipientType* указывает, что учетная запись и почтовый ящик пользователя связаны. Для проверки того, что почтовый ящик подключен, можно запустить командлет **Get-Mailbox \<identity\>**.

## Восстановление удаленного почтового ящика

Командную консоль можно использовать для восстановления удаленного почтового ящика в существующем почтовом ящике с использованием командлета **New-MailboxRestoreRequest**. При восстановлении удаленных почтовых ящиков их содержимое копируется в существующий почтовый ящик, который называется *целевым*. После восстановления удаленного почтового ящика он хранится в базе данных почтовых ящиков до окончательного удаления администратором или очистки после истечения периода сохранения удаленных почтовых ящиков.

После успешного завершения запроса на восстановление почтового ящика он хранится в течение 30 дней до удаления. Вы можете удалить его раньше с помощью командлета **Remove-StoreMailbox**.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Невозможно использовать Центр администрирования Exchange для восстановления удаленного почтового ящика.</td>
</tr>
</tbody>
</table>


## Использование командной консоли для восстановления удаленного почтового ящика

Для создания запроса на восстановление почтового ящика нужно использовать отображаемое имя, различающееся имя прежней версии (DN) или идентификатор GUID из удаленного почтового ящика. Используйте командлет **Get-MailboxStatistics**, чтобы вывести значения свойств `DisplayName`, `MailboxGuid` и `LegacyDN` удаленного почтового ящика, который необходимо восстановить. Например, выполните следующую команду, чтобы вернуть эти сведения для всех отключенных и удаленных почтовых ящиков в организации.

    Get-MailboxDatabase | Get-MailboxStatistics | Where {$_.DisconnectReason -eq "Disabled"} | fl DisplayName,MailboxGuid,LegacyDN,Database

В этом примере выполняется восстановление удаленного почтового ящика, который обозначен параметром *SourceStoreMailbox* и расположен в базе данных почтовых ящиков MBXDB01, в целевом почтовом ящике Debra Garcia. Используется параметр *AllowLegacyDNMismatch*, чтобы исходный почтовый ящик мог быть восстановлен в другом почтовом ящике с другим устаревшим различающимся именем.

    New-MailboxRestoreRequest -SourceStoreMailbox e4890ee7-79a2-4f94-9569-91e61eac372b -SourceDatabase MBXDB01 -TargetMailbox "Debra Garcia" -AllowLegacyDNMismatch

В этом примере выполняется восстановление удаленного архивного почтового ящика Pilar Pinilla в текущем архивном почтовом ящике. Параметр *AllowLegacyDNMismatch* не обязателен, так как основной почтовый ящик и его соответствующий архивный почтовый ящик имеют одинаковое устаревшее различающееся имя.

    New-MailboxRestoreRequest -SourceStoreMailbox "Personal Archive - Pilar Pinilla" -SourceDatabase "MDB01" -TargetMailbox pilarp@contoso.com -TargetIsArchive

Дополнительные сведения о синтаксисе и параметрах см. в разделе [New-MailboxRestoreRequest](https://technet.microsoft.com/ru-ru/library/ff829875\(v=exchg.150\)).

## Использование командной консоли для восстановления удаленного почтового ящика общей папки

Если вы необратимо удалили почтовый ящик общих папок, который вы хотите восстановить, и почтовый ящик находится в пределах срока хранения удаленных элементов (см. раздел [Настройка хранения удаленных элементов и квот элементов для восстановления](configure-deleted-item-retention-and-recoverable-items-quotas-exchange-2013-help.md)), вы можете использовать командлет `Connect-Mailbox`, и затем — командлет `Update-StoreMailboxState`. Дополнительные сведения о синтаксисе и параметрах см. в разделах [Connect-Mailbox](https://technet.microsoft.com/ru-ru/library/aa997878\(v=exchg.150\)) и [Update-StoreMailboxState](https://technet.microsoft.com/ru-ru/library/jj860462\(v=exchg.150\)).

Вам потребуется идентификатор GUID удаленного почтового ящика общих папок, а также идентификатор GUID или имя базы данных почтовых ящиков, в которой содержится почтовый ящик общих папок. Если у вас нет этих сведений, вы можете выполнить следующие действия.

1.  Получите лес Active Directory и полное доменное имя контроллера домена Active Directory, выполнив следующий командлет:
    
        Get-OrganizationConfig | fl OriginatingServer

2.  Используя данные, полученные на шаге 1, выполните в контейнере удаленных объектов в Active Directory поиск идентификатора GUID почтового ящика общих папок и идентификатора GUID или имени базы данных почтовых ящиков, в которой хранился почтовый ящик.
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Bb124558.tip(EXCHG.150).gif" title="Совет" alt="Совет" />Совет.</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Можно выполнить поиск удаленных объектов с помощью пользовательского скрипта или служебной программы Ldp, которую можно открыть, введя <strong>ldp.exe</strong> в командной строке Powershell.</td>
    </tr>
    </tbody>
    </table>


Когда вы получили GUID удаленного почтового ящика общих папок, а также имя или GUID почтового ящика базы данных, в которой хранился почтовый ящик, выполните следующие команды, чтобы восстановить его.

1.  Создайте объект Active Directory, выполнив следующие команды (возможно, появится ввести соответствующие учетные данные):
    
        New-MailUser <mailUserName> -ExternalEmailAddress <emailAddress> 
        
        Get-MailUser <mailUserName> | Disable-MailUser
    
    Где `<mailUserName>`, `<emailAddress>` и `<mailUserName>` — это выбранные вами значения. На следующем шаге необходимо использовать то же значение `<mailUserName>`.

2.  Подключите удаленный почтовый ящик общих папок к объекту Active Directory, который вы только что создали, выполнив следующую команду:
    
        Connect-Mailbox -Identity <public folder mailbox GUID> -Database <database name or GUID> -User <mailUserName>
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Параметр <code>Identity</code> указывает объект почтового ящика в базе данных Exchange, который следует подключить к объекту пользователя Active Directory. В примере выше указан идентификатор GUID почтового ящика общих папок, но можно также использовать отображаемое имя или значение LegacyExchangeDN.</td>
    </tr>
    </tbody>
    </table>


3.  Выполните команду `Update-StoreMailboxState` в почтовом ящике общих папок на основе примера ниже:
    
        Update-StoreMailboxState -Identity <public folder mailbox GUID> -Database <database name or GUID>
    
    Как показано в шаге 2, параметр `Identity` принимает значения GUID, отображаемое имя или LegacyExchangeDN почтового ящика общих папок.

## Как проверить, все ли получилось?

Чтобы убедиться, что вы успешно восстановили удаленный почтовый ящик общих папок, выполните командлет **Get-PublicFolder -GetChildren -\<GUID почтового ящика общих папок\>**. Если восстановление прошло успешно, командлет будет работать.

Дополнительные сведения см. в следующих разделах:

  - [Connect-Mailbox](https://technet.microsoft.com/ru-ru/library/aa997878\(v=exchg.150\))

  - [Update-StoreMailboxState](https://technet.microsoft.com/ru-ru/library/jj860462\(v=exchg.150\))

