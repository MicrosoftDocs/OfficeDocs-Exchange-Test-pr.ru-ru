---
title: 'Ведение журнала аудита администратора: Exchange 2013 Help'
TOCTitle: Ведение журнала аудита администратора
ms:assetid: 22b17eb8-d8ee-4599-b202-d6a7928c20d9
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dd335144(v=EXCHG.150)
ms:contentKeyID: 50556357
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Ведение журнала аудита администратора

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2018-03-05_

В Microsoft Exchange Server 2013 поддерживается функция ведения журнала аудита администратора, позволяющая регистрировать изменения, вносимые в организацию пользователем или администратором. Ведение журнала изменений позволяет соотносить изменения с внесшим их пользователем, дополнять собственные журналы изменений подробными записями о применении изменения, обеспечивать соответствие нормативным требованиям и запросам на обнаружение, а также многое другое.

Во вновь установленных экземплярах Exchange 2013 ведение журнала аудита включено по умолчанию.

**Содержание**

What gets audited

Audit logging configuration

Audit logs

Manual audit log entries

Active Directory replication

Агент журнала аудита действий администратора

## Что подлежит аудиту

Командлеты, которые выполняются непосредственно в командной консоли Exchange подлежат аудиту. Кроме того, операции, выполняемые с помощью Центра администрирования Exchange, также регистрируются в журнале, поскольку при их выполнении происходит запуск командлетов в фоновом режиме.

Командлеты, независимо от того, где они при запуске, были проверены, если командлет в командлете аудит списка и один или несколько параметров для этого командлета в списке параметров аудита. Ведение журнала аудита, предназначенного для отображения действия, которые были взяты для изменения объектов в организации Exchange вместо какие объекты был доступен для просмотра.

> [!IMPORTANT]  
> Командлет может быть не записан в журнал, если перед вызовом командлетом агента расширения командлета журнала аудита администратора произошла ошибка. Если ошибка произошла после вызова агента ведения журнала аудита администратора, командлет заносится в журнал вместе с соответствующей ошибкой. Дополнительные сведения см. далее в разделе Admin Audit Log Agent.<br />
Изменения, внесенные с помощью средств управления Microsoft Exchange Server 2010, также заносятся в журнал; однако изменения, которые вносятся с использованием средств управления Microsoft Exchange Server 2007, не регистрируются в журнале.<br />
На компьютерах, на которых во время изменения конфигурации открыта командная консоль, изменения конфигурации журнала аудита обновляются каждые 60 минут. Если изменения необходимо применить немедленно, на каждом компьютере закройте и снова откройте командную консоль.<br />
После запуска команды может пройти до 15 минут, прежде чем она появится в результатах поиска журнала аудита. Это связано с тем, что перед поиском необходимо выполнить индексацию записей журнала аудита. Если команда не появляется в журнале аудита администратора, подождите несколько минут и снова выполните поиск.


## Настройка ведения журнала аудита

По умолчанию если включено ведение журнала аудита, запись в журнал будет создан каждый раз, когда выполняется командлет. Если вы не хотите аудита каждого выполненного командлета, можно настроить ведение журнала аудита для аудита командлеты и параметры, которые вы хотите. Настройка ведения журнала аудита с помощью командлета **Set-AdminAuditLogConfig** . С помощью этого командлета используются параметры по ссылке в следующих разделах.

> [!IMPORTANT]  
> Изменения в конфигурации журнала аудита администратора всегда фиксируются в журнале независимо от того, находится ли командлет <strong>Set-AdministratorAuditLog</strong> в списке аудита командлетов и включено или отключено ведение журнала аудита.


При выполнении команды Exchange проверяет командлет, который был использован. Если выполненный командлет совпадает с каким-либо командлетом, указанным в параметре *AdminAuditLogConfigCmdlets*, система Exchange проверяет параметры указанные в параметре *AdminAuditLogConfigParameters*. При совпадении одного или нескольких параметров в списке параметров система Exchange заносит в журнал командлет, выполненный в почтовом ящике, указанном с помощью параметра *AdminAuditLogMailbox*. В следующих разделах содержатся сведения о каждом аспекте настройки ведения журнала аудита.

Дополнительные сведения о настройке ведения журнала аудита см. в разделе [Управление ведением журнала аудита администраторов](manage-administrator-audit-logging-exchange-2013-help.md).

В начало

## Командлеты

Можно указать командлеты для которых необходимо осуществлять аудит, задав список командлетов и их параметров, записи о которых необходимо вносить в журнал. При настройке ведения журнала аудита можно задать аудит каждого командлета или указать командлеты для аудита с помощью параметра *AdminAuditLogConfigCmdlets*. Имена командлетов можно указать полностью, например **New-Mailbox** или указать часть имени, поместив его между подстановочными символами, например символами звездочки (`*`). Например, чтобы записывать в журнал все выполнения командлетов, содержащих строковое значение `Transport`, укажите значение `*Transport*`. Можно использовать полные и частичные имена командлетов одновременно, чтобы настроить ведение журнала аудита необходимым образом.

## Параметры

Кроме указания командлетов, записи о выполнении которых следует заносить в журнал, можно также указать, чтобы в журнал записывались командлеты, в которых используются определенные параметры. Чтобы указать, какие параметры необходимо заносить в журнал, используйте параметр *AdminAuditLogConfigParameters*. Так же как в случае с командлетами, можно указать полное имя параметра, например `Database`, часть имени с подстановочным символом (`*`), например `*Address*`, или комбинацию этих вариантов.

## Время хранения журнала аудита

По умолчанию записи журнала аудита хранятся в течение 90 дней. По истечении 90 дней запись журнала аудита удаляется. С помощью параметра *AdminAuditLogAgeLimit* можно изменить время хранения журнала аудита. Можно указать число дней, часов, минут и секунд, в течение которых необходимо хранить записи журнала аудита. Чтобы задать значение, используйте формат `dd.hh:mm:ss`, где:

  - **dd** — количество дней хранения записи журнала аудита;

  - **hh** — количество часов хранения записи журнала аудита.

  - **mm** — количество минут хранения записи журнала аудита;

  - **ss** — количество секунд хранения записи журнала аудита.

Чтобы указать несколько лет, необходимо использовать поле `dd`. Например, 365 дней соответствуют одному году; 730 дней — двум годам; 913 дней — двум годам и шести месяцам. Чтобы установить для журнала аудита время хранения, равное двум годам и шести месяцам, используйте следующую синтаксическую конструкцию: `913.00:00:00`.

> [!CAUTION]  
> Для времени хранения журнала аудита можно установить меньшее значение по сравнению с текущим временем хранения. При этом все записи журнала аудита, чей возраст превысит новое время хранения, будут удалены.<br />
Если для времени хранения установлено значение 0, все записи в журнале аудита будут удалены системой Exchange.<br />
Разрешения на настройку времени хранения журнала аудита рекомендуется предоставлять только пользователям с высоким уровнем доверия.


## Ведение подробного журнала

По умолчанию в журнал аудита администратора записываются только имя и параметры командлета (а также указанные значения), сведения об измененном объекте, данные пользователя, который выполнил командлет, время его выполнения и сведения о сервере, на котором выполнен командлет. В журнале аудита администратора не регистрируются сведения об измененных свойствах объекта. Чтобы журнал аудита также включал измененные свойства объекта, можно включить ведение подробного журнала, установив для параметра *LogLevel* значение `Verbose`. Если включить ведение подробного журнала, в журнале аудита, кроме сведений, которые вносятся в журнал по умолчанию, регистрируются измененные свойства объекта, включая их старые и новые значения.

## Командлеты проверки

По умолчанию командлеты, начинающиеся с команды **Test**, не заносятся в журнал. Чтобы командлеты **Test** заносились в журнал, для параметра *TestCmdletLoggingEnabled* необходимо установить значение `$true`. Хотя регистрацию командлетов проверки в журнале можно включить, это рекомендуется делать только на короткие периоды времени, поскольку данные командлеты могут возвращать большой объем информации.

## Журналы аудита

При каждой регистрации командлета в журнале создается запись журнала аудита. Журналы аудита хранятся в скрытом выделенном арбитражном почтовом ящике, доступ к которому можно получить только с помощью Центра администрирования Exchange либо командлета **Search-AdminAuditLog** или **New-AdminAuditLogSearch**. Его невозможно открыть с помощью приложения Microsoft Outlook Web App или Microsoft Outlook. Следующие разделы содержат сведения на темы:

  - Сведения, содержащиеся в журналах

  - Отчеты, доступные на странице **аудита** Центра администрирования Exchange

  - Командлеты поиска в журнале аудита

## Содержимое журнала аудита

Каждая запись журнала аудита содержит сведения, описанные в следующей таблице. Журнал аудита содержит одну или несколько записей журнала аудита. Количество записей журнала аудита регулируется временем хранения журнала аудита, указанным с помощью командлета **Set-AdminAuditLogConfig**. Все записи журнала аудита, превышающие время хранения, удаляются.

### Поля записей журнала аудита

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Поле</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><code>RunspaceId</code></p></td>
<td><p>Это поле предназначено для внутреннего использования системой Exchange.</p></td>
</tr>
<tr class="even">
<td><p><code>ObjectModified</code></p></td>
<td><p>В этом поле содержится объект, измененный с помощью командлета, указанного в поле <code>CmdletName</code>.</p></td>
</tr>
<tr class="odd">
<td><p><code>CmdletName</code></p></td>
<td><p>Это поле содержит имя командлета, запущенного пользователем, указанным в поле <code>Caller</code>.</p></td>
</tr>
<tr class="even">
<td><p><code>CmdletParameters</code></p></td>
<td><p>В этом поле содержатся параметры, заданные при запуске командлета, указанного в поле <code>CmdletName</code>. В этом поле, при наличии, также хранится, но не отображается в выходных данных по умолчанию, значение, указанное с помощью параметра. Дополнительные сведения о доступе к другим данным в этом поле см. в разделе <a href="search-the-role-group-changes-or-administrator-audit-logs-exchange-2013-help.md">Поиск изменений группы ролей или журналов аудита администраторов</a>.</p></td>
</tr>
<tr class="odd">
<td><p><code>ModifiedProperties</code></p></td>
<td><p>В этом поле содержатся свойства, которые были изменены в объекте, указанном в поле <code>ObjectModified</code>. В этом поле также хранятся, но не отображаются в выходных данных по умолчанию, старое значение свойства и новое сохраненное значение. Дополнительные сведения о доступе к другим данным в этом поле см. в разделе <a href="search-the-role-group-changes-or-administrator-audit-logs-exchange-2013-help.md">Поиск изменений группы ролей или журналов аудита администраторов</a>.</p>

> [!IMPORTANT]  
> Это поле заполняется, только если для параметра <em>LogLevel</em> командлета <strong>Set-AdminAuditLogConfig</strong> установлено значение <code>Verbose</code>.

</td>
</tr>
<tr class="even">
<td><p><code>Caller</code></p></td>
<td><p>Это поле содержит учетную запись пользователя, запустившего командлет, указанный в поле <code>CmdletName</code>.</p></td>
</tr>
<tr class="odd">
<td><p><code>Succeeded</code></p></td>
<td><p>В этом поле указывается, успешно ли был выполнен командлет, указанный в поле <code>CmdletName</code>. Значение может быть равно <code>True</code> или <code>False</code>.</p></td>
</tr>
<tr class="even">
<td><p><code>Error</code></p></td>
<td><p>Это поле содержит сообщение об ошибке, которое создается при сбое выполнения командлета, указанного в поле <code>CmdletName</code>.</p></td>
</tr>
<tr class="odd">
<td><p><code>RunDate</code></p></td>
<td><p>В этом поле содержатся дата и время выполнения командлета, указанного в поле <code>CmdletName</code>. Дата и время хранятся в формате времени UTC.</p></td>
</tr>
<tr class="even">
<td><p><code>OriginatingServer</code></p></td>
<td><p>В этом поле указывается сервер, на котором был выполнен командлет, указанный в поле <code>CmdletName</code>.</p></td>
</tr>
<tr class="odd">
<td><p><code>Identity</code></p></td>
<td><p>Это поле предназначено для внутреннего использования системой Exchange.</p></td>
</tr>
<tr class="even">
<td><p><code>IsValid</code></p></td>
<td><p>Это поле предназначено для внутреннего использования системой Exchange.</p></td>
</tr>
<tr class="odd">
<td><p><code>ObjectState</code></p></td>
<td><p>Это поле предназначено для внутреннего использования системой Exchange.</p></td>
</tr>
</tbody>
</table>


В начало

## Отчеты аудита Центра администрирования Exchange

На странице **аудита** Центра администрирования Exchange представлено несколько отчетов, содержащих сведения о различных типах соответствия требованиям и изменениях конфигурации администрирования. Следующие отчеты содержат сведения об изменениях конфигурации вашей организации.

  - **Отчет о группе ролей администраторов**: этот отчет позволяет выполнять поиск изменений в указанных группах ролей управления в пределах заданных временных рамок. Полученные результаты содержат данные об измененных группах ролей, внесенных изменениях, а также о том, кто и когда внес эти изменения. Может быть возвращено не более 3000 записей. Если в результатах поиска выведено более 3000 записей, используйте отчет **Журнал аудита администратора** или командлет **Search-AdminAuditLog**.

  - **Журнал аудита администратора:**  этот отчет позволяет экспортировать записи журнала аудита, записанные в пределах заданных временных рамок, в XML-файл, а затем отправлять этот файл по электронной почте указанному получателю. Дополнительные сведения о содержимом файла XML см. в разделе [Структура журнала аудита администратора](administrator-audit-log-structure-exchange-2013-help.md).

Дополнительные сведения об использовании этих отчетов см. в разделе [Поиск изменений группы ролей или журналов аудита администраторов](search-the-role-group-changes-or-administrator-audit-logs-exchange-2013-help.md).

Сведения о других отчетах, доступных на странице **аудита**, см. в разделе [Отчеты аудита Exchange](exchange-auditing-reports-exchange-2013-help.md).

## Командлет Search-AdminAuditLog

При запуске командлета **Search-AdminAuditLog** возвращаются все записи журнала аудита, соответствующие указанным критериям поиска. Можно указать следующие критерии поиска.

  - **Командлеты**   Указывает командлеты, которые необходимо найти в журнале аудита администратора.

  - **Параметры**   Указывает параметры, разделенные запятыми, которые необходимо найти в журнале аудита администратора. Поиск параметров можно осуществлять, только если указан командлет для поиска.

  - **Дата окончания**   Задает область поиска записей журнала аудита администратора, внесенных в указанную дату или до нее.

  - **Дата начала**   Задает область поиска записей журнала аудита администратора, внесенных в указанную дату или после нее.

  - **Идентификаторы объекта**   Указывает, что возвращаться должны только записи журнала аудита администратора, содержащие указанные измененные объекты.

  - **Идентификаторы пользователей**   Указывает, что возвращаться должны только записи журнала аудита администратора, содержащие указанный идентификатор пользователя, запустившего командлет.

  - **Успешное выполнение**   Указывает, что возвращаться должны только записи журнала аудита администратора, указывающие на успешное выполнение или сбой.

Каждая возвращенная запись журнала аудита содержит сведения, описанные в таблице в разделе Audit Log Contents. По умолчанию возвращается только первая 1000 записей журнала, соответствующих заданным критериям. Однако значение по умолчанию можно изменить с помощью параметра *ResultSize* для вывода большего или меньшего количества записей. Если для параметра *ResultSize* установить значение `Unlimited`, возвращены будут все записи журнала, соответствующие указанным критериям.

Дополнительные сведения об использовании командлета **Search-AdminAuditLog** см. в разделе [Поиск изменений группы ролей или журналов аудита администраторов](search-the-role-group-changes-or-administrator-audit-logs-exchange-2013-help.md).

## Командлет New-AdminAuditLogSearch

Командлет **New-AdminAuditLogSearch** выполняет поиск в журнале аудита подобно командлету **Search-AdminAuditLog**. Однако вместо вывода результатов поиска в журнале аудита в командную консоль командлет **New-AdminAuditLogSearch** выполняет поиск и отправляет его результаты по электронной почте указанному получателю. Результаты включаются в сообщение электронной почты в виде XML-вложения.

С командлетом **New-AdminAuditLogSearch** можно использовать такие же критерии поиска, как и с командлетом **Search-AdminAuditLog**. Список критериев поиска см. в разделе Search-AdminAuditLog Cmdlet.

После запуска командлета **New-AdminAuditLogSearch** системе Exchange может потребоваться до 15 минут, чтобы доставить отчет указанному получателю. Максимальный размер отчета в формате XML составляет 10 мегабайт (МБ). В файле XML содержатся такие же сведения, как в таблице в разделе Audit Log Contents. Дополнительные сведения о структуре файла XML см. в разделе [Структура журнала аудита администратора](administrator-audit-log-structure-exchange-2013-help.md).

> [!NOTE]  
> Outlook Web App не позволяет открывать вложения XML по умолчанию. В системе Exchange можно разрешить просмотр вложений XML с помощью приложения Outlook Web App или же использовать другой почтовый клиент, например Microsoft Outlook. Сведения о том, как включить в Outlook Web App просмотр вложений XML, см. в разделе <a href="view-or-configure-outlook-web-app-virtual-directories-exchange-2013-help.md">Просмотр и настройка виртуальных каталогов Outlook Web App</a>.


Дополнительные сведения об использовании командлета **New-AdminAuditLogSearch** см. в разделе [Поиск изменений группы ролей или журналов аудита администраторов](search-the-role-group-changes-or-administrator-audit-logs-exchange-2013-help.md).

В начало

## Записи журнала аудита, внесенные вручную

Помимо внесения в журнал запущенных командлетов Exchange, Exchange 2013 позволяет вручную вносить записи в журнал аудита. Exchange 2013 поддерживает эту функцию благодаря командлету **Write-AdminAuditLog**. Записи журнала можно вносить вручную в следующих случаях.

  - Пользовательский сценарий входа и выхода

  - Сведения об изменении элемента управления

  - Время начала и окончания обслуживания

С помощью параметра *Comment* командлета **Write-AdminAuditLog** в журнал аудита можно внести текстовую строку. Параметр *Comment* принимает буквенно-цифровую строку длиной до 500 символов. Вместе со строкой комментария в запись журнала аудита вручную вводится информация, записываемая при внесении в журнал командлета Exchange. Описание полей, включенных в журнал аудита, см. в таблице раздела Audit Log Contents.

Просматривать записи журнала аудита, внесенные вручную, можно таким же образом, как и любые другие записи журнала — с помощью страницы **аудита** Центра администрирования Exchange или командлетов **Search-AdminAuditLog** и **New-AdminAuditLogSearch**.

Сведения о просмотре содержимого параметра *Comment* командлета **Write-AdminAuditLog** в записи журнала аудита, внесенной вручную, см. в разделе [Поиск изменений группы ролей или журналов аудита администраторов](search-the-role-group-changes-or-administrator-audit-logs-exchange-2013-help.md).

## Репликация Active Directory

При ведении журнала аудита администратора используется репликация Active Directory для выполнения репликации параметров конфигурации, указанных для контроллеров домена в организации. В зависимости от параметров репликации внесенные изменения могут не сразу примениться ко всем серверам с Exchange 2013 или Exchange 2010 в организации.

## Агент журнала аудита действий администратора

Встроенный агент расширения командлета журнала аудита администратора выполняет ведение журнала аудита администратора операций командлета в Exchange 2013. Этот агент считывает конфигурацию журнала аудита и выполняет оценку каждого командлета, запущенного в организации. Если критерий, указанный в конфигурации журнала аудита, соответствует выполняемому командлету, агент создает журнал аудита.

Агент журнала аудита администратора включен по умолчанию, что необходимо для функции ведения журнала аудита. Его невозможно отключить, и его приоритет невозможно изменить. Дополнительные сведения об агентах расширения командлета см. в разделе [Агенты расширения командлета](cmdlet-extension-agents-exchange-2013-help.md).

