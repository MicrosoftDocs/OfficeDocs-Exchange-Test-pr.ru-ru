---
title: 'Общие сведения об обнулении страниц в системе Exchange 2013: Exchange 2013 Help'
TOCTitle: Общие сведения об обнулении страниц в системе Exchange 2013
ms:assetid: 0ca7b188-efbc-4c0d-bcfe-5138cffc803c
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Gg549096(v=EXCHG.150)
ms:contentKeyID: 61639924
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Общие сведения об обнулении страниц в системе Exchange 2013

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2016-12-09_

## Обнуление страниц в системе Exchange 2013

*Обнуление* — это механизм безопасности, записывающий нули или двоичный шаблон поверх удаленных данных, чтобы усложнить их восстановление. В Exchange Server 2013 база данных ESE использует *страницы* как единицу хранения и в результате реализует *обнуление страниц*. По умолчанию обнуление страниц включено, а отключить его нельзя. Операции обнуления страниц записываются в файлы журнала транзакций, чтобы обнуление страниц для всех копий базы данных выполнялось аналогичным образом. Обнуление страницы в активной базе данных приводит к обнулению страницы в пассивной копии базы данных.

> [!NOTE]  
> Расширенный обработчик хранилищ (ESE) не позволяет определять приоритет повторного использования обнуленных страниц над выделением нового пространства. Таблицы, для которых назначено последовательное выделение места на диске, будут преднамеренно пропускать фрагментированные или обнуленные страницы в пользу новых или свободных последовательных страниц. Этот подход снижает число операций ввода-вывода в секунду для базы данных.


В Exchange 2013 обнуление страниц снижает негативное влияние на производительность серверов, выполняющих обнуление. Это достигается за счет следующего:

  - **Оптимизированная емкость хранилища и сети**. Расширенный обработчик хранилищ (ESE) добавляет в файл журнала транзакций запись об обнулении страницы вместо сохранения в журнале образа всей страницы. Этот подход сокращает количество операций ввода-вывода для записи в журнал и снижает требования к пропускной способности для доставки журналов.

  - **Оптимизированные операции ввода-вывода для диска базы данных**. В Exchange 2010 RTM и предыдущих версиях обнуление страниц выполнялось только в процессе резервного копирования или планового обслуживания (при его настройке) и требовало значительного числа операций ввода-вывода для диска базы данных. В Exchange 2010 с пакетом обновления 1 (SP1) и более поздних версиях (включая Exchange 2013) обнуление страниц включено по умолчанию и выполняется во время транзакции. В большинстве случаев обнуление происходит непосредственно после необратимого удаления. Такой механизм позволяет базе данных использовать функцию глубины контрольной точки ядра, обеспечивающую сохранение "грязных страниц" в кэше в течение определенного времени, в результате чего при дополнительном обновлении страниц, выполняемом с небольшим интервалом времени, число операций ввода-вывода для записи в базу данных не увеличивается. Благодаря этому механизму обнуление страниц не оказывает значительного влияния на операции ввода-вывода в базе данных и поэтому включено по умолчанию.

## Реализация обнуления страниц в базе данных ESE

При обнулении страниц поверх необратимо удаленной записи записывается один двоичный шаблон. Шаблон обнуления страниц характерен для работы обработчика ESE и различается для операций среды выполнения и операций обслуживания. В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям среды выполнения.

### Шаблон заполнения функции обнуления во время выполнения ESE

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Операция среды выполнения ESE</th>
<th>Шаблон заполнения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Заменить</p></td>
<td><p>R</p></td>
</tr>
<tr class="even">
<td><p>Удалить запись или длинное значение</p></td>
<td><p>D</p></td>
</tr>
<tr class="odd">
<td><p>Освобожденное место страницы</p></td>
<td><p>H</p></td>
</tr>
</tbody>
</table>


В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям, выполняемым во время фонового обслуживания базы данных ESE.

### Шаблон заполнения функции обнуления страниц во время фонового обслуживания базы данных ESE

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Операция фонового обслуживания базы данных ESE</th>
<th>Шаблон заполнения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Удалить запись</p></td>
<td><p>D</p></td>
</tr>
<tr class="even">
<td><p>Удалить длинное значение</p></td>
<td><p>L</p></td>
</tr>
<tr class="odd">
<td><p>Освобожденное место частично используемой страницы</p></td>
<td><p>Z</p></td>
</tr>
<tr class="even">
<td><p>Освобожденное место неиспользуемой страницы</p></td>
<td><p>U</p></td>
</tr>
</tbody>
</table>


## Фоновое обслуживание базы данных

Фоновое обслуживание базы данных — это процесс, непрерывно проверяющий контрольные суммы и сканирующий каждую базу данных. Главной задачей этого процесса является проверка контрольных сумм страниц базы данных, но он также выполняет очистку и обнуление записей и страниц, которые не были обновлены после сбоев хранилища. При фоновом обслуживании одной базы данных скорость обработки данных составляет приблизительно 1 МБ в секунду. Если приоритет отдается периодическому обнулению страниц, можно сократить размеры баз данных, чтобы обнуление страниц выполнялось в случае восстановления после сбоя в течение более короткого времени (например, 24 часов).

Фоновое обслуживание базы данных — это непрерывный процесс, поэтому событий, связанных с его началом и завершением, не существует. Можно отслеживать ход выполнения фонового обслуживания базы данных с помощью следующего счетчика производительности:

  - База данных MSExchange -\>Экземпляры -\> Время после обслуживания базы данных.

Этот счетчик указывает количество секунд, прошедших с момента завершения последнего обслуживания для заданной базы данных.

## Процесс обнуления страниц базы данных ESE

В следующей таблице описаны сценарии удаления базы данных и случаи выполнения функций обнуления страниц.

### Фоновое обслуживание базы данных расширенного обработчика хранилищ

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Сценарий удаления базы данных</th>
<th>Процесс ESE и временные рамки обнуления данных в базе данных</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li><p>Сценарий 1. Восстановление одного элемента отключено, и пользователь удаляет элемент из папки «Элементы для восстановления».</p></li>
<li><p>Сценарий 2. Восстановление одного элемента отключено, и для срока хранения элементов в папке «Элементы для восстановления»установлено значение, равное нулю.</p></li>
<li><p>Сценарий 3. Восстановление одного элемента включено, и срок действия элемента истекает в соответствии со сроком хранения удаленных элементов.</p></li>
</ul></td>
<td><p>В асинхронном потоке двоичный шаблон записывается поверх удаленных данных. Это действие выполняется за те миллисекунды, в течение которых происходит удаление записи. Если процесс хранилища завершается сбоем во время ожидания выполнения асинхронного обнуления (или очистка хранилища версий отменяется из-за его роста), обнуление завершается при обработке этого раздела базы данных во время фонового обслуживания базы данных.</p></td>
</tr>
<tr class="even">
<td><p>Сценарий представления. Истечение строка действия элементов в представлении папки Outlook или Outlook Web App (например, в представлении &quot;Беседа&quot;).</p></td>
<td><p>Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных.</p></td>
</tr>
<tr class="odd">
<td><p>Сценарий перемещения или удаления почтового ящика. Исходный почтовый ящик удален (истечение срока хранения удаленного в корзину почтового ящика)</p></td>
<td><p>Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных.</p></td>
</tr>
</tbody>
</table>


## Отслеживание реакции на событие обнуления страниц

Функции обнуления страниц можно измерять и отслеживать с помощью следующих счетчиков производительности ESE:

  - База данных MSExchange-\>Обнулено страниц при обслуживании базы данных: указывает число страниц, обнуленных ядром СУБД с момента вызова счетчика производительности.

  - База данных MSExchange-\>Обнулено страниц при обслуживании базы данных/с: указывает скорость обнуления страниц.

> [!NOTE]  
> Сведения о включении этих счетчиков см. в статье <a href="https://go.microsoft.com/fwlink/p/?linkid=101194">Включение расширенных счетчиков производительности ESE</a>.


Обнуление страниц является функцией обслуживания базы данных, поэтому указанные выше счетчики содержат сведения о производительности, связанные с обнулением страниц для транзакций среды выполнения и обнулением страниц во время фонового обслуживания базы данных.

## Типы данных почтового ящика без обнуления страниц

Следующие типы данных почтового ящика не предусматривают обнуления страниц:

  - Журналы транзакций базы данных почтовых ящиков (LOG)
    
    После удаления журналов транзакций (в результате усечения через резервное копирование или циклическое ведение журнала) невозможно обнулить блоки в файловой системе NTFS, содержащие удаленный файлы журнала. Система NTFS может в будущем повторно использовать это свободное пространство для создаваемых журналов, но это не гарантируется.

  - Файлы каталога индексов содержимого
    
    В Exchange 2013 для функций индексации при поиске используется платформа поиска. Каталог индекса поиска включает в себя несколько десятков файлов, хранящихся в одном томе с файлом базы данных почтовых ящиков. При необратимом удалении сообщения из базы данных почтовых ящиков связанное с ним содержимое в каталоге поиска не удаляется в тот же момент. Это содержимое удаляется, когда платформа поиска выполняет теневое или основное объединение большого числа небольших файлов каталога в один файл большего размера. После завершения основного объединения файлы каталога меньшего размера удаляются. Невозможно обнулить блоки, которые хранили удаленные файлы журнала.

