---
title: 'Настройка автоматического заполнения для группы обеспечения доступности баз данных: Exchange 2013 Help'
TOCTitle: Настройка автоматического заполнения для группы обеспечения доступности баз данных
ms:assetid: 4a8bd779-b52a-40ed-8040-4d76eabeb41e
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ619303(v=EXCHG.150)
ms:contentKeyID: 50487999
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Настройка автоматического заполнения для группы обеспечения доступности баз данных

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2013-04-15_

Автоматическое повторное заполнение — это функция для быстрого восстановления избыточности базы данных после сбоя диска. В случае сбоя диска для копий базы данных, хранящихся на нем, автоматически выполняется повторное заполнение на предварительно настроенном свободном диске на сервере почтовых ящиков. Чтобы настроить автоматическое повторное заполнение для группы обеспечения доступности баз данных, воспользуйтесь инструкциями в этом разделе.

> [!CAUTION]  
> Функция AutoReseed не обеспечивает автоматическое выполнение всех необходимых задач настройки. Администратор должен вручную устанавливать диски, добавлять в систему свободные диски, заменять неисправные и форматировать новые диски.


Сведения о дополнительных задачах по управлению группами обеспечения доступности баз данных см. в разделе [Управление группами доступности базы данных](managing-database-availability-groups-exchange-2013-help.md).

## Что нужно знать перед началом работы

  - Предполагаемое время выполнения задачи: 10 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Запись "Группы обеспечения доступности баз данных" в разделе [Разрешения высокого уровня доступности и устойчивости сайта](high-availability-and-site-resilience-permissions-exchange-2013-help.md).

  - Необходимо использовать один логический диск или его раздел на физический диск.

  - Следует использовать определенную базу данных и структуру папок журнала, описанные в приведенных ниже шагах.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>..


## Как это сделать

## Действие 1. Настройка корневых путей для баз данных и томов

На первом этапе необходимо настроить корневые каталоги для баз данных (*AutoDagDatabasesRootFolderPath*) и томов (*AutoDagVolumesRootFolderPath*), используемых группой обеспечения доступности баз данных. Пути по умолчанию — C:\\ExchangeDatabases и C:\\ExchangeVolumes соответственно. Если используются пути по умолчанию, этот шаг можно пропустить.

В этом примере показано, как настроить корневой путь для баз данных.

    Set-DatabaseAvailabilityGroup DAG1 -AutoDagDatabasesRootFolderPath "C:\ExchDbs"

В этом примере показано, как настроить корневой путь для томов хранения.

    Set-DatabaseAvailabilityGroup DAG1 -AutoDagVolumesRootFolderPath "C:\ExchVols"

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли настроены корневые пути для баз данных и томов, выполните следующую команду.

    Get-DatabaseAvailabilityGroup DAG1 | Format-List *auto*

Значения параметров *AutoDagDatabasesRootFolderPath* и *AutoDagVolumesRootFolderPath* должны соответствовать настроенным путям.

## Действие 2. Настройка количества баз данных на том

Далее нужно настроить количество баз данных на том (*AutoDagDatabaseCopiesPerVolume*) для группы обеспечения доступности баз данных.

В этом примере показано, как настроить этот параметр автоматического повторного заполнения (AutoReseed) для группы обеспечения доступности баз данных, задав 4 базы данных на один том.

    Set-DatabaseAvailabilityGroup DAG1 -AutoDagDatabaseCopiesPerVolume 4

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли настроено количество баз данных на том, выполните следующую команду.

    Get-DatabaseAvailabilityGroup DAG1 | Format-List *auto*

Значение параметра *AutoDagDatabaseCopiesPerVolume* должно соответствовать заданному числу баз данных.

## Действие 3. Создание корневых каталогов для баз данных и томов

Далее создайте каталоги, которые соответствуют корневым каталогам, настроенным в действии 1. В этом примере показано, как создать каталоги по умолчанию с помощью командной строки.

```
    md C:\ExchangeDatabases
```
```
    md C:\ExchangeVolumes
```

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли настроены корневые каталоги для баз данных и томов, выполните следующую команду.

    Dir C:\

Созданные папки должны появиться в списке вывода.

## Действие 4. Подключение томов к папкам

С помощью приложения управления дисками Windows (diskmgmt.msc) подключите каждый том, который будет использоваться для размещения баз данных (включая резервные тома), к папке подключения, расположенной по пути C:\\ExchangeVolumes\\. Например, если имеются 2 тома для размещения баз данных и 1 резервный том, подключите их к следующим папкам.

  - C:\\ExchangeVolumes\\Volume1

  - C:\\ExchangeVolumes\\Volume2

  - C:\\ExchangeVolumes\\Volume3

Папкам, подключенным по пути корневого тома, можно присваивать любые имена.

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли подключены тома к папкам, выполните следующую команду.

    Dir C:\

Должен быть выведен список подключенных томов.

## Действие 5. Создание папок баз данных

Далее создайте каталоги баз данных в корневом пути C:\\ExchangeDatabases. В этом примере показано, как создать каталоги для конфигурации хранилища с 4-мя базами данных в каждом томе.

```
    md c:\ExchangeDatabases\db001
```
```
    md c:\ExchangeDatabases\db002
```
```
    md c:\ExchangeDatabases\db003
```
```
    md c:\ExchangeDatabases\db004
```

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли подключены папки баз данных, выполните следующую команду.

    Dir C:\ExchangeDatabases

Созданные папки должны появиться в списке вывода.

## Действие 6. Создание точек подключения для баз данных

Создайте точки подключения для каждой базы данных и свяжите их с соответствующими томами. Например, подключенная папка для db001 должна находиться по пути C:\\ExchangeDatabases\\db001. Для этого можно воспользоваться программой diskmgmt.msc или mountvol.exe. В этом примере показано, как подключить базу данных db001 к C:\\ExchangeDatabases\\db001 с помощью программы mountvol.exe.

    Mountvol.exe c:\ExchangeDatabases\db001 \\?\Volume (GUID)

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли созданы точки подключения для базы данных, выполните следующую команду.

    Mountvol.exe C:\ExchangeDatabases\db001 /L

Подключенный том должен появиться в списке точек подключения.

## Действие 7. Создание структуры каталогов баз данных

Далее создайте по два каталога в папках, созданных в действии 5, по одному для каждой базы данных и по одному для потока журнала каждой базы данных, который будет храниться на том же томе. Для вашей структуры каталогов необходимо использовать следующий формат.

C:\\\< *DatabaseFolderName*\>\\*DatabaseName*\\\<*DatabaseName*\>.db

C:\\\< *DatabaseFolderName*\>\\*DatabaseName*\\\<*DatabaseName*\>.log

В этом примере показано, как создать каталоги для 4 баз данных, которые будут храниться в томе 1.

```
    md c:\ExchangeDatabases\db001\db001.db
```
```
    md c:\ExchangeDatabases\db001\db001.log
```
```
    md c:\ExchangeDatabases\db002\db002.db
```
```
    md c:\ExchangeDatabases\db002\db002.log
```
```
    md c:\ExchangeDatabases\db003\db003.db
```
```
    md c:\ExchangeDatabases\db003\db003.log
```
```
    md c:\ExchangeDatabases\db004\db004.db
```
```
    md c:\ExchangeDatabases\db004\db004.log
```

Повторите указанные выше команды для баз данных в каждом томе.

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли создана структура каталогов баз данных, выполните следующую команду.

    Dir C:\ExchangeDatabases /s

Созданные папки должны появиться в списке вывода.

## Действие 8. Создание баз данных

Создайте базы данных с путями журналов и баз данных, для которых настроены соответствующие папки. В этом примере показано, как создать базу данных, которая будет храниться в новом каталоге и структуре точек подключения.

    New-MailboxDatabase -Name db001 -Server MBX1 -LogFolderPath C:\ExchangeDatabases\db001\db001.log -EdbFilePath C:\ExchangeDatabases\db001\db001.db\db001.edb

## Как проверить, что шаг выполнен?

Чтобы проверить, успешно ли созданы базы данных в соответствующей папке, выполните следующую команду.

    Get-MailboxDatabase db001 | Format List *path*

В свойствах базы данных необходимо указать, что файл базы данных и ее файлы журнала хранятся в указанных выше папках.

## Как проверить, что это работает?

Чтобы убедиться, правильно ли настроено автоматическое повторное заполнение для группы обеспечения доступности баз данных, выполните следующие действия.

1.  Чтобы проверить, правильно ли настроена группа обеспечения доступности баз данных, выполните следующую команду.
    
        Get-DatabaseAvailabilityGroup DAG1 | Format-List *auto*

2.  Чтобы проверить, правильно ли настроена структура каталогов, выполните следующую команду (ниже указаны пути по умолчанию; при необходимости замените их на другие).
    
```
        Dir c:\ExchangeDatabases /s
```
```
        Dir c:\ExchangeVolumes /s
```
