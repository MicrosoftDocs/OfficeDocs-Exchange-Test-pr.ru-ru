---
title: 'Настройка конвейерной трассировки: Exchange 2013 Help'
TOCTitle: Настройка конвейерной трассировки
ms:assetid: 10293c83-2157-474e-840d-942e064a4672
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ916678(v=EXCHG.150)
ms:contentKeyID: 52061203
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Настройка конвейерной трассировки

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-04-08_

Конвейерная трассировка записывает копии почтовых сообщений при их перемещении по транспортному конвейеру в транспортной службе или транспортной службе почтовых ящиков на сервере почтовых ящиков и на пограничных транспортных серверах.

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения каждой процедуры: 15 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Записи "Служба транспорта" и "Транспортная служба почтовых ящиков" в разделе [Разрешения потока обработки почты](mail-flow-permissions-exchange-2013-help.md).

  - Для выполнения этой процедуры можно использовать только командную консоль.

  - Функция конвейерной трассировки копирует все содержимое сообщений электронной почты, которые отправляются с адреса электронной почты отправителя. Чтобы избежать раскрытия конфиденциальной информации, необходимо установить для папки конвейерной трассировки соответствующие разрешения системы безопасности.

  - Не следует включать конвейерную трассировку на длительный период времени. Во время конвейерной трассировки создается несколько файлов мгновенных снимков, которые быстро накапливаются. Если включена конвейерная трассировка, всегда следите за объемом свободного дискового пространства.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.


## Что необходимо сделать?

## Включение и настройка конвейерной трассировки

## Действие 1. Использование командной консоли для настройки адреса отправителя конвейерной трассировки

Чтобы настроить адрес отправителя конвейерной трассировки, введите команду в следующем формате.

```powershell
    <Set-TransportService | Set-MailboxTransportService> <ServerIdentity> -PipelineTracingSenderAddress <SMTPAddress | "<>">
```

Этот пример настраивает конвейерную трассировку для получения мгновенных снимков всех сообщений, отправленных с адреса chris@contoso.com в службе транспорта на сервере почтовых ящиков Mailbox01.

```powershell
Set-TransportService Mailbox01 -PipelineTracingSenderAddress chris@contoso.com
```

В этом примере конвейерная трассировка настраивается для получения мгновенных снимков всех созданных системой сообщений, полученных службой транспорта на сервере почтовых ящиков Mailbox02.

```powershell
Set-TransportService Mailbox02 -PipelineTracingSenderAddress "<>"
```

> [!CAUTION]  
> Если настроить конвейерную трассировку для записи всех созданных серверами сообщений в службе транспорта, нагрузка на сервер может сильно возрасти, а свободное место на диске может быстро закончиться. Если включена конвейерная трассировка, всегда следите за объемом свободного дискового пространства.


## Действие 2. (Необязательно) Использование командной консоли для указания папки конвейерной трассировки

Папка конвейерной трассировки по умолчанию не существует, пока вы не включите конвейерную трассировку, а сообщения, соответствующие заданным вами критериям с помощью параметра *PipelineTracingSenderAddress*, не будут проходить через службу транспорта на сервере. В транспортной службе на сервере почтовых ящиков папка по умолчанию размещается по пути `%ExchangeInstallPath%TransportRoles\Logs\Hub\PipelineTracing`. В транспортной службе почтовых ящиков на сервере почтовых ящиков папка по умолчанию размещается по пути `%ExchangeInstallPath%TransportRoles\Logs\Mailbox\PipelineTracing`. Если вы задаете другой путь, он должен указывать на каталог на локальном сервере Exchange.

Чтобы настроить папку конвейерной трассировки, введите команду в следующем формате.
```powershell
    <Set-TransportService | Set-MailboxTransportService> <ServerIdentity> -PipelineTracingPath <LocalFilePath>
```
В этом примере настраивается папка конвейерной трассировки для службы транспорта на сервере почтовых ящиков Mailbox01, имя папки — D:\\Hub\\Pipeline Tracing.

```powershell
Set-TransportService Mailbox01 -PipelineTracingPath "D:\Hub\Pipeline Tracing"
```

## Действие 3. Использование командной консоли для включения конвейерной трассировки

По умолчанию конвейерная трассировка отключена на всех серверах Exchange. Включая конвейерную трассировку, вы активируете ее в указанной транспортной службе только на заданном сервере Exchange. Перед включением конвейерной трассировки укажите адрес отправителя, как описано в шаге 1.

Для включения конвейерной трассировки введите команду в следующем формате.
```powershell
    <Set-TransportService | Set-MailboxTransportService> <ServerIdentity> -PipelineTracingEnabled $true
```
В этом примере активируется конвейерная трассировка в службе транспорта на сервере почтовых ящиков с именем Mailbox01.

```powershell
Set-TransportService Mailbox01 -PipelineTracingEnabled $true
```

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно настроили конвейерную трассировку, выполните следующие действия:

1.  Выполните следующую команду:
    ```powershell
        <Get-TransportService | Get-MailboxTransportService> <ServerIdentity> | Format-List PipelineTracing*
	```
2.  Убедитесь, что отображаются значения, которые вы настроили.

3.  Проверьте папку конвейерной трассировки для службы транспорта или транспортной службы почтовых ящиков и убедитесь, что файлы снимков сообщений создаются в папке.

## Отключение конвейерной трассировки

Из-за вопросов о месте на диске и безопасности, связанных с конвейерной трассировкой, подобная операция — это временное действие для диагностики или устранения неполадок. Включая конвейерную трассировку, не забывайте отключить ее, завершив ее применение.

Для отключения конвейерной трассировки введите команду в следующем формате.
```powershell
    <Set-TransportService | Set-MailboxTransportService> <ServerIdentity> -PipelineTracingEnabled $false
```
В этом примере отключается конвейерная трассировка в службе транспорта на сервере почтовых ящиков с именем Mailbox01.

```powershell
Set-TransportService Mailbox01 -PipelineTracingEnabled $false
```

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно отключили конвейерную трассировку, выполните следующие действия:

1.  Выполните следующую команду:
    ```powershell
        <Get-TransportService | Get-MailboxTransportService> <ServerIdentity> | Format-List PipelineTracingEnabled
	```
2.  По умолчанию параметр *PipelineTracingEnabled* имеет значение $false.

3.  Проверьте папку конвейерной трассировки и убедитесь, что файлы снимков сообщений больше не создаются в папке.

