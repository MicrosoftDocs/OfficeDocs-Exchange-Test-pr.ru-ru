---
title: 'Ведение журнала подключений: Exchange 2013 Help'
TOCTitle: Ведение журнала подключений
ms:assetid: c31fd710-4ae4-4d9a-8936-d056e7ca2748
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb124500(v=EXCHG.150)
ms:contentKeyID: 50489106
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Ведение журнала подключений

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Ведение журнала подключения предназначено для записывания активности исходящих подключений, используемых для передачи сообщений с транспортной службы на сервер Exchange. Назначением журнала подключения не является отслеживание передачи отдельных сообщений электронной почты. Наоборот, журнал подключения отслеживает активность подключений от исходного расположения к месту назначения, независимо от того, сколько сообщений передано. Журнал подключений включается в службе транспорта переднего плана на серверах клиентского доступа, службе транспорта на серверах почтовых ящиков и службе транспорта почтовых ящиков на серверах почтовых ящиков. Типы данных, которые регистрируются в журнале подключения:

  - Источник

  - Destination

  - Информация о разрешениях DNS

  - подробная информация о неудачных попытках подключения;

  - количество сообщений и количество переданных байтов

Командлеты **Set-TransportService**, **Set-FrontEndTransportService** и **Set-MailboxTransportService** позволяют выполнять в командной консоли Exchange все задачи, связанные с настройкой журнала подключения. Для журналов подключения доступны следующие параметры:

  - Включить/выключить функцию протоколирования данных о подключении. По умолчанию регистрация включена.

  - Указать местоположение файлов журналов подключения.

  - Указать максимальный размер для отдельного файла журнала подключений. Значение по умолчанию — 10 мегабайт (МБ).

  - Указать максимальный размер для каталога, в котором хранятся файлы журнала подключения. Размер по умолчанию — 1000 МБ.

  - Указать максимальный срок хранения отдельного файла журнала подключений. Значение по умолчанию – 30 дней.

По умолчанию для облегчения контроля над использованием пространства на диске, где хранятся файлы журналов подключения, сервер Exchange использует циклическое ведение журнала, чтобы ограничивать размер журналов подключения, исходя из размера файлов и срока их хранения.

**Содержание**

Структура файлов журнала подключения

Сведения, записываемые в журнал подключения

## Структура файлов журнала подключения

По умолчанию файлы журнала подключения размещаются в следующих папках:

  - **Transport service**   %ExchangeInstallPath%TransportRoles\\Logs\\Hub\\Connectivity

  - **Front End Transport service**   %ExchangeInstallPath%TransportRoles\\Logs\\FrontEnd\\Connectivity

  - **Mailbox Transport service**   %ExchangeInstallPath%TransportRoles\\Logs\\Mailbox\\Connectivity

Имена файлов журнала подключения имеют следующий вид: CONNECTLOG*yyyymmdd-nnnn*.log. Заполнители обозначают следующее:

  - Заполнитель *yyyymmdd* представляет собой время создания файла журнала в формате UTC. Где *yyyy* = год, *mm* = месяц и *dd* = день.

  - Заменитель *nnnn* представляет собой порядковый номер, который каждый день начинается со значения 1.

Данные записываются в файл журнала до тех пор, пока размер файла не достигнет максимально допустимого значения и не откроется новый файл журнала, имеющий следующий порядковый номер. Эта процедура выполняется круглосуточно. При циклическом ведении журнала, когда каталог журналов подключений достигает максимально допустимого размера или когда файл журнала достигает максимально допустимого срока хранения, удаляются самые старые файлы журнала.

Файлы журнала подключения представляют собой текстовые файлы с разделителями-запятыми в формате CSV. Каждый файл журнала подключения снабжен заголовком, содержащим следующие сведения:

  - **\#Software**.   Название программы, создавшей файл журнала подключения. Как правило, значением является: Microsoft Exchange Server.

  - **\#Version**.   Номер версии программы, создавшей файл журнала подключения. Текущее значение — 15.0.0.0.

  - **\#Log-Type**.   Значение типа журнала. Значение — Transport Connectivity Log.

  - **\#Date**.   Дата и время создания файла журнала в формате UTC. Дата и время в формате UTC переводятся в формат по стандарту ISO 8601: *yyyy-mm-dd*T*hh:mm:ss.fff*Z, где *yyyy* — год, *mm* — месяц, *dd* — день, *hh* — час, *mm* — минута, *ss* — секунда, *fff* — доли секунды. "T" указывает на начало кода времени. "Z" значит "время зулу" (еще одно обозначение формата UTC).

  - **\#Fields**.   Разделенные запятыми имена полей, используемые в файлах журнала подключения.

В начало

## Сведения, записываемые в журнал подключения

В журнале подключения каждое событие, связанное с подключением к исходящей транспортной службе, хранится отдельной строкой. Сведения, хранящиеся в каждой строке, сгруппированы по полям. Поля разделяются запятыми. В следующей таблице описаны поля, используемые для классификации каждого события исходящего подключения.

### Поля, используемые для классификации каждого события, связанного с подключением

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Имя поля</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>date-time</strong></p></td>
<td><p>Дата и время события подключения в формате UTC. Дата и время в формате UTC переводятся в формат по стандарту ISO 8601: <em>yyyy-mm-dd</em>T<em>hh:mm:ss.fff</em>Z, где <em>yyyy</em> — год, <em>mm</em> — месяц, <em>dd</em> — день, <em>hh</em> — час, <em>mm</em> — минута, <em>ss</em> — секунда, <em>fff</em> — доли секунды. &quot;T&quot; указывает на начало кода времени. &quot;Z&quot; значит &quot;время зулу&quot; (еще одно обозначение формата UTC).</p></td>
</tr>
<tr class="even">
<td><p><strong>session</strong></p></td>
<td><p>Идентификатор GUID уникален для каждого сеанса SMTP, но идентичен для каждого события, связанного с сеансом SMTP. Для сеансов MAPI в транспортной службе почтовых ящиков поле сеанса пустое.</p></td>
</tr>
<tr class="odd">
<td><p><strong>source</strong></p></td>
<td><p><strong>SMTP</strong> для SMTP-соединений, <strong>MAPI</strong> для подключений транспортной службы почтовых ящиков к локальной базе данных почтовых ящиков.</p></td>
</tr>
<tr class="even">
<td><p><strong>destination</strong></p></td>
<td><p>Имя назначения.</p></td>
</tr>
<tr class="odd">
<td><p><strong>direction</strong></p></td>
<td><p>Одиночный символ, указывающий начало, середину или завершение подключения. В этом поле возможны следующие значения:</p>
<ul>
<li><p><strong>+</strong>   Подключение</p></li>
<li><p><strong>-</strong>   Отключение</p></li>
<li><p><strong>&gt;</strong>   Отправка</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p><strong>description</strong></p></td>
<td><p>Содержит текстовую информацию, относящуюся к подключению. Ниже приводятся значения, которые могут быть указаны в данном поле:</p>
<ul>
<li><p>количество и размер отправленных сообщений;</p></li>
<li><p>информация о разрешении DNS почтового обменника для целевых доменов;</p></li>
<li><p>информация о разрешении DNS для целевых серверов почтовых ящиков;</p></li>
<li><p>сообщения об установлении подключения;</p></li>
<li><p>сообщения об ошибке подключения</p></li>
</ul></td>
</tr>
</tbody>
</table>


При установке соединения транспортной службой с назначением, возможно, транспортная служба сможет отправить одно или несколько сообщений. В ходе выполнения процедур подключения и передачи сообщений генерируются многочисленные события, информация о которых заносится в строки журнала подключения. В случае одновременных подключений к различным целевым объектам в журнал подключения заносятся записи, относящиеся к целевым объектам, которые связаны между собой. При этом для каждого подключения можно упорядочить поля «date-time», «session», «source» и «direction» таким образом, чтобы можно было просмотреть события в той последовательности, в которой они происходили на протяжении всего сеанса подключения.

В начало

