---
title: 'Использование пакетной миграции для переноса общедоступных папок Exchange 2010 в группы Office 365: Exchange 2013 Help'
TOCTitle: Использование пакетной миграции для переноса общедоступных папок Exchange 2010 в группы Office 365
ms:assetid: d018558d-3075-4dd3-9ff7-91ce66b8d5fb
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Mt843875(v=EXCHG.150)
ms:contentKeyID: 74468734
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Использование пакетной миграции для переноса общедоступных папок Exchange 2010 в группы Office 365

 

_**Применимо к:** Exchange Server 2010, Exchange Server 2013_

_**Последнее изменение раздела:** 2018-04-30_

**Сводка.** Узнайте, как переместить общедоступные папки Exchange 2010 в группы Office 365.

С помощью так называемой *пакетной миграции* вы можете перенести некоторые или все общедоступные папки Exchange 2010 в Группы Office 365. Группы — это новый инструмент для совместной работы от Майкрософт, обладающий определенными преимуществами по сравнению с общедоступными папками. Обзор различий между общедоступными папками и группами, а также описание преимуществ перехода на группы см. в статье [Перенос общедоступных папок в группы Office 365](migrate-your-public-folders-to-office-365-groups-exchange-2013-help.md).

Эта статья содержит пошаговые инструкции по выполнению пакетной миграции общедоступных папок Exchange 2010.

## Что нужно знать перед началом работы?

Перед началом подготовки к миграции убедитесь, что выполнены все указанные ниже условия.

  - Сервер Exchange 2010 должен работать под управлением **Exchange 2010 с пакетом обновления 3 (SP3) и накопительным пакетом обновления 8 (RU8)** или более поздней версии.

  - В Exchange Online вам необходимо быть членом группы ролей Organization Management. Эта группа ролей отличается от разрешений, которые назначаются при подписке на Office 365 или Exchange Online. Сведения о том, как включить группу ролей Organization Management, см. в статье [Управление группами ролей](manage-role-groups-exchange-2013-help.md).

  - В Exchange 2010 вы должны быть участником группы ролей RBAC "Управление организацией" или "Управление сервером". Дополнительные сведения см. в статье [Добавление участников в группу ролей](https://go.microsoft.com/fwlink/?linkid=299212).

  - Прежде чем переносить общедоступные папки в группы Office 365, рекомендуем переместить в Office 365 почтовые ящики пользователей, которым нужен доступ к группам Office 365 после миграции.

  - Мобильный Outlook должен быть включен на сервере Exchange 2010, на котором размещена база данных общедоступных папок. Дополнительные сведения о включении мобильного Outlook на серверах Exchange 2010 см. в [этой статье](https://go.microsoft.com/fwlink/p/?linkid=187249).

  - Эту процедуру невозможно выполнить с помощью Центра администрирования Exchange (EAC) или консоли управления Exchange (EMC). На серверах Exchange 2010 необходимо использовать командную консоль Exchange. В Exchange Online необходимо использовать Exchange Online PowerShell. Дополнительные сведения см. в статье [Подключение к Exchange Online PowerShell](https://technet.microsoft.com/library/jj984289\(v=exchg.150\).aspx).

  - В настоящее время в группы Office 365 можно перенести только общедоступные папки календаря и почты. Кроме того, целевые группы в Office 365 должны быть созданы до миграции.

  - При пакетной миграции в группы Office 365 из общедоступных папок копируются только сообщения и элементы календаря. Другие объекты, например политики, правила и разрешения, не копируются.

  - Служба "Группы Office 365" предоставляется с почтовым ящиком объемом 50 ГБ. Убедитесь, что суммарный размер данных в переносимых общедоступных папках не превышает 50 ГБ. Кроме того, оставьте место для дополнительного содержимого, которое пользователи будут добавлять после миграции. Рекомендуем переносить общедоступные папки общим размером не более 25 ГБ.

  - Не обязательно переносить все сразу. Вы можете выбрать общедоступные папки, которые нужно перенести. Если переносимая общедоступная папка содержит вложенные папки, они не будут автоматически включены в миграцию. Если их нужно перенести, включите их явным образом.

  - Эта миграция никак не повлияет на общедоступные папки. Однако после того как вы сделаете перенесенные общедоступные папки доступными только для чтения, пользователям придется использовать группы Office 365.

  - Прежде чем начинать, рекомендуем полностью прочитать эту статью, так как на некоторых этапах требуется простой в работе.

## Шаг 1. Скачайте скрипты

Для пакетной миграции в группы Office 365 необходимо запустить несколько скриптов на разных этапах переноса, как описано ниже в этой статье. Скачайте скрипты и их вспомогательные файлы [здесь](https://www.microsoft.com/en-us/download/details.aspx?id=55985). После скачивания всех скриптов и файлов сохраните их в одном месте, например `c:\PFtoGroups\Scripts`.

Прежде чем продолжить, убедитесь, что вы скачали и сохранили все следующие скрипты и файлы:

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Обязательно сохраните все скрипты и файлы в одном месте.</td>
</tr>
</tbody>
</table>


  - **AddMembersToGroups.ps1**. Этот скрипт добавляет участников и владельцев в группы Office 365 в соответствии с разрешениями в исходных общедоступных папках.

  - **AddMembersToGroups.strings.psd1**. Этот вспомогательный файл используется скриптом `AddMembersToGroups.ps1`.

  - **LockAndSavePublicFolderProperties.ps1**. Этот скрипт делает общедоступные папки доступными только для чтения, чтобы предотвратить какие-либо изменения, и переносит связанные с почтой свойства общедоступных папок (при условии, что они поддерживают почту) в целевые группы, чтобы письма из общедоступных папок перенаправлялись в целевые группы. Этот скрипт также создает резервные копии разрешений и почтовых свойств перед их изменением.

  - **LockAndSavePublicFolderProperties.strings.psd1**. Этот вспомогательный файл используется скриптом `LockAndSavePublicFolderProperties.ps1`.

  - **UnlockAndRestorePublicFolderProperties.ps1**. Этот скрипт восстанавливает права доступа и почтовые свойства общедоступных папок, используя файлы резервных копий, созданные скриптом `LockandSavePublicFolderProperties.ps1`.

  - **UnlockAndRestorePublicFolderProperties.strings.psd1**. Этот вспомогательный файл используется скриптом `UnlockAndRestorePublicFolderProperties.ps1`.

  - **WriteLog.ps1**. Этот скрипт позволяет трем предыдущим скриптам вести журналы.

  - **RetryScriptBlock.ps1**. Этот скрипт позволяет скриптам `AddMembersToGroups`, `LockAndSavePublicFolderProperties` и `UnlockAndRestorePublicFolderProperties` повторять определенные действия в случае временных ошибок.

Дополнительные сведения о скриптах `AddMembersToGroups.ps1`, `LockAndSavePublicFolderProperties.ps1` и `UnlockAndRestorePublicFolderProperties.ps1` и задачах, которые они выполняют, см. в разделе Скрипты миграции далее в этой статье.

## Шаг 2. Подготовьте организацию к миграции

Чтобы подготовить организацию к миграции, необходимо выполнить следующие действия:

1.  Составьте список общедоступных папок (почты и календаря), которые вы хотите перенести в группы Office 365.

2.  Составьте список соответствующих целевых групп для каждой переносимой общедоступной папки. Вы можете создать новую группу в Office 365 или использовать существующую. Если вы создаете новую группу, сведения о необходимых настройках вы найдете в статье [Узнайте о группах в Office 365](https://go.microsoft.com/fwlink/p/?linkid=858521). Если для переносимой общедоступной папки по умолчанию задано разрешение **Author** или выше, необходимо создать в Office 365 соответствующую группу с параметром конфиденциальности **Общедоступная**. Однако, чтобы увидеть общедоступную группу в узле **Группы** в Outlook, пользователям все равно придется присоединиться к группе.

3.  Переименуйте все общедоступные папки, в имени которых есть обратная косая черта (**\\**). В противном случае эти общедоступные папки могут перенестись неправильно.

4.  Для клиента Office 365 должна быть включена функция миграции **PAW**. Чтобы проверить, включена ли она, выполните следующую команду в Exchange Online PowerShell:
    
        Get-MigrationConfig
    
    Если в разделе **Features** указано **PAW**, функция включена, и можно переходить к *шагу 3*.
    
    Если функция PAW еще не включена для вашего клиента, это может быть связано с тем, что у вас уже есть пакеты миграции (для общедоступных папок или пользователей). Эти пакеты могут быть в любом состоянии, в том числе в состоянии "Завершено". В таком случае завершите обработку и удалите существующие пакеты миграции, чтобы при выполнении команды `Get-MigrationBatch` не возвращалось ни одной записи. После этого функция PAW должна включиться автоматически. Обратите внимание, что изменение может отразиться в `Get-MigrationConfig` не сразу, но это нормально. После этого вы можете продолжить создавать пакеты миграции пользователей.

## Шаг 3. Создайте CSV-файл

Создайте CSV-файл с выходными данными для одного из скриптов миграции.

CSV-файл должен содержать следующие столбцы:

  - **FolderPath**. Путь к переносимой общедоступной папке.

  - **TargetGroupMailbox**. SMTP-адрес целевой группы в Office 365. Выполните указанную ниже команду, чтобы просмотреть основной SMTP-адрес.
    
        Get-UnifiedGroup <alias of the group> | Format-Table PrimarySmtpAddress

Пример CSV-файла:

    "FolderPath","TargetGroupMailbox"
    "\Sales","sales@contoso.onmicrosoft.com"
    "\Sales\EMEA","emeasales@contoso.onmicrosoft.com"

Обратите внимание, что папку почты и папку календаря можно объединить в одну группу в Office 365. Однако другие скрипты объединения нескольких общедоступных папок в одну группу не поддерживаются в одном пакете миграции. Чтобы сопоставить несколько общедоступных папок с одной группой Office 365, последовательно, один за другим, запустите разные пакеты миграции. Каждый пакет миграции может содержать до 500 записей.

Одна общедоступная папка должна переноситься только в одну группу в одном пакете миграции.

## Шаг 4. Отправьте запрос на миграцию

На этом шаге вы собираете сведения из среды Exchange, а затем используете их в Exchange Online PowerShell для создания пакета миграции. После этого вы начнете миграцию.

1.  На сервере Exchange 2010 выполните следующие команды для сбора сведений, необходимых для создания пакета миграции:
    
    1.  Найдите **LegacyExchangeDN** для учетной записи администратора общедоступной папки, введя указанную ниже команду. Обратите внимание, что это тот же пользователь, чьи учетные данные вам понадобятся позже, на шаге 3 этой процедуры.
        
            Get-Mailbox <PublicFolder_Administrator_Account> | Select-Object LegacyExchangeDN
    
    2.  Найдите LegacyExchangeDN любого сервера почтовых ящиков с базой данных общедоступных папок, введя следующую команду:
        
            Get-ExchangeServer <public folder server> | Select-Object -Expand ExchangeLegacyDN
    
    3.  Найдите полное доменное имя узла мобильного Outlook. Это внешнее имя узла. Если имеется несколько экземпляров мобильного Outlook, рекомендуется выбрать либо экземпляр, находящийся ближе всего к конечной точке миграции, либо экземпляр, находящийся ближе всего к репликам общедоступных папок в организации Exchange 2010. С помощью следующей команды можно найти все экземпляры мобильного Outlook.
        
            Get-OutlookAnywhere | Format-Table Identity, ExternalHostName

2.  В Exchange Online PowerShell используйте информацию с шага 1 для выполнения приведенных ниже команд. Для переменных в этих командах используются значения с шага 1.
    
    1.  Передайте учетные данные пользователя с правами администратора в среде Exchange 2010 в переменную `$Source_Credential`. Когда вы отправите запрос на миграцию в Exchange Online, эти учетные данные потребуются, чтобы получить доступ к серверам Exchange 2010 через мобильный Outlook для копирования содержимого.
        
            $Source_Credential = Get-Credential
            <source_domain>\<PublicFolder_Administrator_Account>
    
    2.  Используйте значение ExchangeLegacyDN пользователя миграции на сервере Exchange прежней версии, найденное ранее на шаге 1a, и передайте его в переменную `$Source_RemoteMailboxLegacyDN`.
        
            $Source_RemoteMailboxLegacyDN = "<LegacyExchangeDN from step 1a>"
    
    3.  Используйте значение ExchangeLegacyDN сервера общедоступных папок, найденное ранее на шаге 1b выше, и передайте его в переменную `$Source_RemotePublicFolderServerLegacyDN`.
        
            $Source_RemotePublicFolderServerLegacyDN = "<LegacyExchangeDN from step 1b>"
    
    4.  Используйте внешнее имя узла мобильного Outlook, возвращенное ранее на шаге 1c, и передайте его в переменную `$Source_OutlookAnywhereExternalHostName`.
        
            $Source_OutlookAnywhereExternalHostName = "<ExternalHostName from step 1c>"

3.  В Exchange Online PowerShell выполните следующую команду, чтобы создать конечную точку миграции:
    
        $PfEndpoint = New-MigrationEndpoint -PublicFolderToUnifiedGroup -Name PFToGroupEndpoint -RPCProxyServer $Source_OutlookAnywhereExternalHostName -Credentials $Source_Credential -SourceMailboxLegacyDN $Source_RemoteMailboxLegacyDN -PublicFolderDatabaseServerLegacyDN $Source_RemotePublicFolderServerLegacyDN -Authentication Basic

4.  Выполните указанную ниже команду, чтобы создать пакет миграции из общедоступной папки в группу Office 365. В этой команде:
    
      - **CSVData** — CSV-файл, созданный выше на шаге 3 *Создайте CSV-файл*. Обязательно укажите полный путь к этому файлу. Если файл был по какой-либо причине перемещен, обязательно укажите новое расположение.
    
      - **NotificationEmails** — необязательный параметр, с помощью которого можно указать адреса электронной почты, на которые будут отправляться уведомления о состоянии и ходе миграции.
    
      - **AutoStart** — необязательный параметр, который запускает пакет миграции сразу же после его создания.
    
      - **PublicFolderToUnifiedGroup** — параметр, указывающий, что это пакет миграции из общедоступной папки в группу Office 365.
    
    <!-- end list -->
    
        New-MigrationBatch -Name PublicFolderToGroupMigration -CSVData (Get-Content <path to .csv file> -Encoding Byte) -PublicFolderToUnifiedGroup -SourceEndpoint $PfEndpoint.Identity [-NotificationEmails <email addresses for migration notifications>] [-AutoStart]

5.  Запустите миграцию, выполнив приведенную ниже команду в Exchange Online PowerShell. Обратите внимание, что это необходимо, только если параметр `-AutoStart` не использовался при создании пакета на шаге 4.
    
        Start-MigrationBatch PublicFolderToGroupMigration

Пакетные миграции необходимо создавать с помощью командлета `New-MigrationBatch` в Exchange Online PowerShell, но просматривать ход миграции и управлять им можно в Центре администрирования Exchange. Ход миграции также можете просматривать с помощью командлетов [Get-MigrationBatch](https://technet.microsoft.com/ru-ru/library/jj219164\(v=exchg.150\)) и [Get-MigrationUser](https://technet.microsoft.com/ru-ru/library/jj218702\(v=exchg.150\)). Командлет `New-MigrationBatch` инициирует пользователя миграции для каждого почтового ящика группы Office 365, и вы можете просматривать состояние этих запросов на странице миграции почтовых ящиков.

Чтобы просмотреть страницу миграции почтовых ящиков:

1.  В Exchange Online откройте Центр администрирования Exchange.

2.  Выберите **Получатели** \> **Миграция**.

3.  Выберите новый запрос на миграцию и нажмите **Просмотр сведений** в области **Сведения**.

Если статус пакета — **Завершено**, можете переходить к *шагу 5*.

## Шаг 5. Добавьте участников в группы Office 365 из общедоступных папок

Добавить участников в целевые группы в Office 365 можно вручную. Но если вы хотите добавить участников в группу в соответствии с разрешениями в общедоступных папках, запустите скрипт `AddMembersToGroups.ps1` на сервере Exchange 2010, как показано в приведенной ниже команде. Чтобы почтовые ящики пользователей можно было добавить в качестве участников группы Office 365, они должны быть синхронизированы с Exchange Online. Чтобы узнать, какие разрешения общедоступной папки можно добавить в качестве участников группы Office 365, ознакомьтесь с разделом Скрипты миграции далее в этой статье.

В следующей команде:

  - **MappingCsv** — CSV-файл, созданный на *шаге 3*. Обязательно укажите полный путь к этому файлу. Если по какой-либо причине файл был перемещен, обязательно проверьте и укажите новое расположение.

  - **BackupDir** — каталог, в которой будут храниться файлы журнала миграции.

  - **ArePublicFoldersOnPremises** — параметр, указывающий, где расположены общедоступные папки (в локальной среде или в Exchange Online).

  - **Credential** — имя пользователя и пароль для Exchange Online.

<!-- end list -->

    .\AddMembersToGroups.ps1 -MappingCsv <path to .csv file> -BackupDir <path to backup directory> -ArePublicFoldersOnPremises $true -Credential (Get-Credential)

После добавления в группу Office 365 пользователи могут начинать использовать ее.

## Шаг 6. Заблокируйте общедоступные папки (требуется перерыв в обслуживании)

Когда большая часть данных из общедоступных папок будет перенесена в группы Office 365, вы можете запустить скрипт `LockAndSavePublicFolderProperties.ps1` на сервере Exchange 2010, чтобы сделать их доступными только для чтения. Это гарантирует, что до завершения миграции в общедоступные папки не будут добавляться новые данные.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Если среди переносимых папок есть общедоступные папки, поддерживающие почту (MEPF), то некоторые их свойства, например SMTP-адреса, будут скопированы в соответствующую группу в Office 365, а затем будет отключена поддержка почты. Так как после выполнения этого скрипта для переносимых MEPF будет отключена поддержка почты, письма, отправляемые в MEPF, будут поступать в соответствующие группы. Дополнительные сведения см. в разделе Скрипты миграции далее в этой статье.</td>
</tr>
</tbody>
</table>


В следующей команде:

  - **MappingCsv** — CSV-файл, созданный на *шаге 3*. Обязательно укажите полный путь к этому файлу. Если по какой-либо причине файл был перемещен, обязательно проверьте и укажите новое расположение.

  - **BackupDir** — каталог, в котором будут храниться файлы резервных копий записей разрешений, свойств MEPF и файлов журнала миграции. Эта резервная копия пригодится в случае возврата к общедоступным папкам.

  - **ArePublicFoldersOnPremises** — параметр, указывающий, где расположены общедоступные папки (в локальной среде или в Exchange Online).

  - **Credential** — имя пользователя и пароль для Exchange Online.

<!-- end list -->

    .\LockAndSavePublicFolderProperties.ps1 -MappingCsv <path to .csv file> -BackupDir <path to backup directory> -ArePublicFoldersOnPremises $true -Credential (Get-Credential)

## Шаг 7. Завершите миграцию из общедоступных папок в группы Office 365

После того как вы сделаете общедоступные папки доступными только для чтения, вам нужно будет снова выполнить миграцию. Это необходимо для окончательного добавочного копирования данных. Перед повторным запуском миграции вам нужно будет удалить существующий пакет. Это можно сделать с помощью следующей команды:

    Remove-MigrationBatch <name of migration batch>

После этого создайте новый пакет с помощью того же CSV-файла, выполнив приведенную ниже команду. В этой команде:

  - **CsvData** — CSV-файл, созданный на *шаге 3*. Обязательно укажите полный путь к этому файлу. Если по какой-либо причине файл был перемещен, обязательно проверьте и укажите новое местоположение.

  - **NotificationEmails** — необязательный параметр, с помощью которого можно указать адреса электронной почты, на которые будут отправляться уведомления о состоянии и ходе миграции.

  - **AutoStart** — необязательный параметр, который запускает пакет миграции сразу же после его создания.

<!-- end list -->

    New-MigrationBatch -Name PublicFolderToGroupMigration -CSVData (Get-Content <path to .csv file> -Encoding Byte) -PublicFolderToUnifiedGroup -SourceEndpoint $PfEndpoint.Identity [-NotificationEmails <email addresses for migration notifications>] [-AutoStart]

После создания нового пакета запустите миграцию, выполнив приведенную ниже команду в Exchange Online PowerShell. Обратите внимание, что это необходимо, только если параметр `-AutoStart` не использовался в предыдущей команде.

    Start-MigrationBatch PublicFolderToGroupMigration

После того как пакет получит статус **Завершено**, убедитесь, что все данные были скопированы в группы Office 365. Если вас устраивают группы, вы можете приступить к удалению перенесенных общедоступных папок из среды Exchange 2010.

<table>
<thead>
<tr class="header">
<th><img src="images/Dd876857.important(EXCHG.150).gif" title="Важно" alt="Важно" />Важно!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Существуют способы отката миграции и возврата к общедоступным папкам, но после удаления исходных общедоступных папок это будет невозможно. Дополнительные сведения см. в разделе Как вернуться к общедоступным папкам из групп Office 365?.</td>
</tr>
</tbody>
</table>


## Известные проблемы

Во время типичной миграции из общедоступных папок в группы Office 365 могут возникать описанные ниже проблемы.

  - Скрипт, который передает SMTP-адрес из поддерживающих почту общедоступных папок в группу Office 365, добавляет адреса только как дополнительные адреса электронной почты в Exchange Online. Поэтому, если в среде настроены Exchange Online Protection (EOP) или централизованный поток обработки почты, после миграции будут возникать проблемы с отправкой электронной почты в группы (на дополнительные адреса электронной почты).

  - Если в CSV-файле сопоставления есть запись с недействительным путем к общедоступной папке, статус миграции изменится на **Завершено** без ошибки. При этом копирование данных будет прекращено.

## Скрипты миграции

Этот раздел содержит подробное описание трех сценариев миграции и задач, которые они выполняют в среде Exchange. Все скрипты и вспомогательные файлы можно [скачать здесь](https://www.microsoft.com/en-us/download/details.aspx?id=55985).

## AddMembersToGroups.ps1

Этот скрипт считывает разрешения для переносимых общедоступных папок, а затем добавляет участников и владельцев в группы Office 365, как описано ниже:

  - Пользователи с указанными ниже ролями будут добавлены в группу Office 365 в качестве участников. **Роли:**  Owner, PublishingEditor, Editor, PublishingAuthor, Author

  - Кроме того, пользователи с указанными ниже минимальными правами доступа также будут добавлены в группу Office 365 в качестве участников. **Права доступа:**  ReadItems, CreateItems, FolderVisible, EditOwnedItems, DeleteOwnedItems

  - Пользователи с правом доступа Owner будут добавлены в группу в качестве владельцев, а пользователи с другими правами доступа — в качестве участников.

  - Группы безопасности нельзя добавлять в группы Office 365 в качестве участников. Следовательно, они будут расширены, а затем отдельные пользователи будут добавлены в эти группы в качестве участников или владельцев в соответствии с правами доступа для группы безопасности.

  - Если пользователям в группах безопасности с правами доступа к общедоступной папке также назначены и явные разрешения для той же общедоступной папки, приоритет будут иметь явные разрешения. Допустим, в группе безопасности SG1 есть члены User1 и User2. Для общедоступной папки PF1 заданы следующие разрешения:
    
    SG1: Author в PF1
    
    User1: Owner в PF1
    
    В этом случае User1 будет добавлен в группу Office 365 в качестве владельца.

  - Если для переносимой общедоступной папки по умолчанию задано разрешение "Author" или выше, то скрипт предложит задать для соответствующей группы параметр конфиденциальности "Общедоступная".

Этот скрипт можно запустить даже после блокировки общедоступных папок, задав для параметра `ArePublicFoldersLocked` значение ` $true`. В этом случае скрипт считает разрешения из файла резервной копии, созданного во время блокировки.

## LockAndSavePublicFolderProperties.ps1

Этот скрипт делает переносимые общедоступные папки доступными только для чтения. При переносе общедоступных папок, поддерживающих почту, в первую очередь будет отключена поддержка почты, а их SMTP-адреса будут добавлены в соответствующие группы Office 365. Затем будут изменены записи разрешений, чтобы сделать их доступными только для чтения. Резервная копия почтовых свойств общедоступных папок, поддерживающих почту, а также записи разрешений для всех общедоступных папок будут скопированы перед изменением.

При наличии несколько пакетов миграции с каждым CSV-файлом сопоставления следует использовать отдельный каталог резервного копирования.

Вместе с общедоступными папками, поддерживающими почту, и группами Office 365 будут сохранены следующие почтовые свойства:

  - PrimarySMTPAddress

  - EmailAddresses

  - ExternalEmailAddress

  - EmailAddressPolicyEnabled

  - GrantSendOnBehalfTo

  - Список доверия SendAs

Указанные выше почтовые свойства будут сохранены в CSV-файле, который можно использовать в процессе отката (дополнительные сведения см. в разделе Как вернуться к общедоступным папкам из групп Office 365?). Моментальный снимок свойств общедоступных папок, поддерживающих почту, также будет сохранен в файле PfMailProperties.csv. Этот файл не нужен для отката, но его можно использовать для справки.

Следующие почтовые свойства будут перенесены в целевую группу в процессе блокировки:

  - PrimarySMTPAddress

  - EmailAddresses

  - Список доверия SendAs

  - GrantSendOnBehalfTo

Скрипт гарантирует, что параметры PrimarySMTPAddress и EmailAddresses переносимых общедоступных папок, поддерживающих почту, будут добавлены в качестве дополнительных SMTP-адресов соответствующих групп в Office 365. Кроме того, разрешения пользователей SendAs и SendOnBehalfTo для общедоступных папок, поддерживающих почту, получат эквивалентное разрешение в соответствующих целевых группах.

**Разрешенные права доступа**

Чтобы сделать общедоступные папки доступными только для чтения, пользователям будут предоставлены только указанные ниже права доступа.

  - ReadItems

  - CreateSubfolders

  - FolderContact

  - FolderVisible

Ниже показано, как будут изменены разрешения:

1.  ###  
    
    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>До блокировки</th>
    <th>После блокировки</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><p>Нет</p></td>
    <td><p>Нет</p></td>
    </tr>
    <tr class="even">
    <td><p>AvailabilityOnly</p></td>
    <td><p>AvailabilityOnly</p></td>
    </tr>
    <tr class="odd">
    <td><p>LimitedDetails</p></td>
    <td><p>LimitedDetails</p></td>
    </tr>
    <tr class="even">
    <td><p>Contributor</p></td>
    <td><p>FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>Reviewer</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="even">
    <td><p>NonEditingAuthor</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>Author</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="even">
    <td><p>Editor</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>PublishingAuthor</p></td>
    <td><p>ReadItems, CreateSubfolders, FolderVisible</p></td>
    </tr>
    <tr class="even">
    <td><p>PublishingEditor</p></td>
    <td><p>ReadItems, CreateSubfolders, FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>Owner</p></td>
    <td><p>ReadItems, CreateSubfolders, FolderContact, FolderVisible</p></td>
    </tr>
    </tbody>
    </table>


2.  Права доступа для пользователей без прав на чтение останутся без изменений, у них по-прежнему не будет прав на чтение.

3.  Все права доступа для пользователей с настраиваемыми ролями, кроме ReadItems, CreateSubfolders, FolderContact и FolderVisible, будут удалены. Если после фильтрации у пользователей нет прав доступа из разрешенного списка, то для прав доступа этих пользователей будет задано значение None.

В период между отключением поддержки почты для папок и добавлением их SMTP-адресов в группы Office 365 возможны перебои в отправке писем в общедоступные папки, поддерживающие почту.

## UnlockAndRestorePublicFolderProperties.ps1

Этот скрипт повторно назначит разрешения для общедоступных папок на основе файла резервной копии, созданного во время блокировки. Этот скрипт также включит поддержку почты для общедоступных папок после удаления SMTP-адресов папок из соответствующих групп в Office 365. В ходе этого процесса возможен небольшой перерыв в обслуживании.

## Как вернуться к общедоступным папкам из групп Office 365?

Указанная ниже команда восстановит среду до состояния, в котором она была перед миграцией. Откат можно выполнить, если существуют файлы резервной копии и вы не удалили общедоступные папки после миграции.

Выполните указанную ниже команду на сервере Exchange 2010. В этой команде:

  - **BackupDir** — каталог, в котором будут храниться файлы резервных копий записей разрешений, свойств MEPF и файлов журнала миграции. Используйте то же расположение, что и на *шаге 6*.

  - **ArePublicFoldersOnPremises** — параметр, указывающий, где расположены общедоступные папки (в локальной среде или в Exchange Online).

  - **Credential** — имя пользователя и пароль для Exchange Online.

<!-- end list -->

    .\UnlockAndRestorePublicFolderProperties.ps1 -BackupDir <path to backup directory> -ArePublicFoldersOnPremises $true -Credential (Get-Credential)

Учтите, что все элементы, добавленные в группу Office 365, и все операции редактирования, выполненные в группах, не копируются обратно в общедоступные папки. Следовательно, если во время использования групп были добавлены новые данные, они будут потеряны.

Обратите внимание, что невозможно восстановить только некоторые из общедоступных папок — должны быть восстановлены все перенесенные папки.

Соответствующие группы Office 365 не будут удалены в ходе отката. Очищать или удалять их придется вручную.

