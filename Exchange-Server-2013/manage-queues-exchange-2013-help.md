---
title: 'Управление очередями: Exchange 2013 Help'
TOCTitle: Управление очередями
ms:assetid: 37f11378-a884-4aff-ab55-689f40a46321
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Aa997263(v=EXCHG.150)
ms:contentKeyID: 51408022
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Управление очередями

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2014-01-31_

В Microsoft Exchange Server 2013 для управления очередями можно использовать средство просмотра очереди на панели элементов Exchange или командную консоль Exchange. Дополнительные сведения об использовании командлетов управления очередями в командной консоли Exchange см. в разделе [Использование командной консоли Exchange для управления очередями](use-the-exchange-management-shell-to-manage-queues-exchange-2013-help.md).

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения каждой процедуры: 15 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Запись "Очереди" в разделе [Разрешения потока обработки почты](mail-flow-permissions-exchange-2013-help.md).

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

<table>
<thead>
<tr class="header">
<th><img src="images/Bb124558.tip(EXCHG.150).gif" title="Совет" alt="Совет" />Совет.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.</td>
</tr>
</tbody>
</table>


## Что необходимо сделать?

## Просмотр очередей

## Просмотр очередей с помощью средства просмотра очереди на панели элементов Exchange

1.  Нажмите кнопку **Пуск** и последовательно выберите пункты **Все программы** \> **Microsoft Exchange 2013** \> **Панель элементов Exchange**.

2.  В разделе **Средства для потока почты** дважды щелкните **Средство просмотра очереди**, чтобы открыть средство в новом окне.

3.  В средстве просмотра очереди перейдите на вкладку **Очереди**. Отобразится список всех очередей на сервере, к которому установлено подключение.

4.  Для экспорта списка очередей можно использовать ссылку **Экспортировать список** в области действий. Дополнительные сведения см. в разделе [Экспорт списков из средства просмотра очереди](export-lists-from-queue-viewer-exchange-2013-help.md).

## Использование командной консоли для просмотра очередей

Для просмотра очередей введите команду в следующем формате.

    Get-Queue [-Filter <Filter> -Server <ServerIdentity> -Include <Internal | External | Empty | DeliveryType> -Exclude <Internal | External | Empty | DeliveryType>]

В этом примере показано, как отобразить основные сведения о непустых очередях в сервере почтовых ящиков Exchange 2013 с именем Mailbox01.

    Get-Queue -Server Mailbox01 -Exclude Empty

В этом примере показано, как отобразить подробные сведения обо всех очередях, содержащих более 100 сообщений, для сервера почтовых ящиков, на котором выполняется команда.

    Get-Queue -Filter {MessageCount -gt 100} | Format-List

## Просмотр сводных сведений об очередях на нескольких серверах Exchange с помощью командной консоли

Командлет **Get-QueueDigest** обеспечивает высокоуровневое сводное представление состояния очередей на всех серверах в определенной области, например в группе обеспечения доступности баз данных, на сайте Active Directory, в списке серверов или во всем лесу Active Directory. Обратите внимание, что очереди на подписанном пограничном транспортном сервере в сети периметра не включаются в результаты. Кроме того, командлет **Get-QueueDigest** доступен на пограничном транспортном сервере, но результаты ограничены очередями на данном сервере.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>По умолчанию командлет <strong>Get-QueueDigest</strong> отображает очереди доставки, включающие не менее десяти сообщений. Давность результатов составляет от одной до двух минут. Инструкции по смене этих значений по умолчанию приведены в статье <a href="configure-get-queuedigest-exchange-2013-help.md">Настройка Get-QueueDigest</a>.</td>
</tr>
</tbody>
</table>


Чтобы просмотреть сводные сведения об очередях на нескольких серверах Exchange, выполните следующую команду.

    Get-QueueDigest <-Server <ServerIdentity1,ServerIdentity2,..> | -Dag <DagIdentity1,DagIdentity2...> | -Site <ADSiteIdentity1,ADSiteIdentity2...> | -Forest> [-Filter <Filter>]

В этом примере показано, как отобразить сводные сведения об очередях, для которых количество сообщений превышает 100, на всех серверах почтовых ящиков Exchange 2013 на сайте Active Directory с именем FirstSite.

    Get-QueueDigest -Site FirstSite -Filter {MessageCount -gt 100}

В этом примере показано, как отобразить сводные сведения об очередях на всех серверах почтовых ящиков Exchange 2013 в группе обеспечения доступности баз данных (DAG) с именем DAG01, для которых состояние очереди имеет значение **Повтор**.

    Get-QueueDigest -Dag DAG01 -Filter {Status -eq "Retry"}

## Возобновление очередей

Путем возобновления очереди перезапускаются исходящие действия в очереди, имеющей состояние Suspended (Приостановлено). Чтобы это действие было выполнено, очередь должна иметь состояние "Приостановлено". При возобновлении очереди состояние сообщений в очереди не изменяется. Сообщения, имеющие состояние Suspended (Приостановлено), остаются таковыми и не покидают очередь.

## Возобновление очередей с помощью средства просмотра очереди на панели элементов Exchange

1.  Нажмите кнопку **Пуск** и последовательно выберите пункты **Все программы** \> **Microsoft Exchange 2013** \> **Панель элементов Exchange**.

2.  В разделе **Средства для потока почты** дважды щелкните **Средство просмотра очереди**, чтобы открыть средство в новом окне.

3.  В средстве просмотра очереди перейдите на вкладку **Очереди**. Отобразится список всех очередей на сервере, к которому установлено подключение.

4.  Щелкните **Создать фильтр** и введите выражение фильтра следующим образом:
    
    1.  Выберите пункт **Состояние** из раскрывающегося списка свойств очереди.
    
    2.  Выберите пункт **Равно** из раскрывающегося списка операторов сравнения.
    
    3.  Выберите **Приостановлено** в раскрывающемся списке значений.

5.  Нажмите кнопку **Применить фильтр**. Отобразятся все очереди на сервере, которые приостановлены в текущий момент.

6.  Выделите одну или несколько очередей в списке, щелкните правой кнопкой мыши и выберите команду **Возобновить**.

## Использование командной консоли для возобновления очередей

Для возобновления очереди введите команду в следующем формате.

    Resume-Queue <-Identity QueueIdentity | -Filter {QueueFilter} [-Server ServerIdentity]>

В этом примере показано, как возобновить все очереди на локальном сервере, находящиеся в состоянии "Приостановлено".

    Resume-Queue -Filter {Status -eq "Suspended"}

В этом примере показано, как возобновить приостановленную очередь доставки с именем contoso.com на сервере с именем Mailbox01.

    Resume-Queue -Identity Mailbox01\contoso.com

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно возобновили очередь, выполните следующие действия.

1.  Чтобы найти очередь, которую вы пытались возобновить, используйте средство просмотра очереди или командлет **Get-Queue**.

2.  Проверьте, что свойство **Состояние** для очереди не имеет значение `Suspended`.

## Повтор очередей

Когда транспортный сервер не может подключиться к следующему прыжку, очередь переходит в состояние Retry (Повтор). При повторе очереди доставки с помощью средства просмотра очереди или командной консоли инициируется немедленная попытка подключения и переопределяется следующее запланированное время повторной попытки. Если попытка подключения не удалась, таймер интервала повторения сбрасывается. Чтобы это действие было выполнено, очередь доставки должна находиться в состоянии повтора.

## Повтор очереди с помощью средства просмотра очереди на панели элементов Exchange

1.  Нажмите кнопку **Пуск** и последовательно выберите пункты **Все программы** \> **Microsoft Exchange 2013** \> **Панель элементов Exchange**.

2.  В разделе **Средства для потока почты** дважды щелкните **Средство просмотра очереди**, чтобы открыть средство в новом окне.

3.  В средстве просмотра очереди перейдите на вкладку **Очереди**. Отобразится список всех очередей на сервере, к которому установлено подключение.

4.  Щелкните **Создать фильтр** и введите выражение фильтра следующим образом:
    
    1.  Выберите пункт **Состояние** из раскрывающегося списка свойств очереди.
    
    2.  Выберите пункт **Равно** из раскрывающегося списка операторов сравнения.
    
    3.  Выберите пункт **Повторить** из раскрывающегося списка значений.

5.  Нажмите кнопку **Применить фильтр**. Будут показаны все очереди, которые в данный момент находятся в состоянии **Повтор**.

6.  Выберите в списке одну или несколько очередей. Щелкните выделение правой кнопкой мыши и в контекстном меню выберите пункт **Повторить очередь**. Если попытка подключения будет успешной, состояние очереди изменится на **Активно**. Если установить подключение не удастся, очередь останется в состоянии **Повтор**, причем время следующего повторения обновится.

## Использование командной консоли для повторной обработки очереди

Чтобы повторить очереди, введите команду в следующем формате.

    Retry-Queue <-Identity QueueIdentity | -Filter QueueFilter [-Server ServerIdentity]>

В этом примере показано, как на локальном сервере выполнить повтор всех очередей, находящихся в состоянии "Повтор".

    Retry-Queue -Filter {status -eq "retry"}

В этом примере показано, как повторить очередь с именем contoso.com, находящуюся в состоянии `Retry`, на сервере с именем Mailbox01.

    Retry-Queue -Identity Mailbox01\contoso.com

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно повторили очередь, выполните следующие действия.

1.  Чтобы найти очередь, которую вы пытались повторить, используйте средство просмотра очереди или командлет **Get-Queue**.

2.  Проверьте, что свойство очереди **LastRetryTime** содержит время, когда вы пытались повторить очередь.

## Повторная отправка сообщений, находящихся в очередях

Повторная отправка очереди похожа на повтор очереди за исключением того, что сообщения отправляются обратно в очередь передачи для повторной обработки классификатором. Сообщения, находящиеся в следующем состоянии, можно отправить повторно.

  - Очереди доставки в состоянии повтора. Сообщения в очередях не должны находиться в состоянии "Приостановлено".

  - Сообщения в очереди недоставленных сообщений, которые не находится в состоянии приостановки.

  - Сообщения из очереди опасных сообщений.

## Повторная отправка сообщений с помощью командной консоли

Для повторной отправки сообщений используйте введите команду в следующем формате.

    Retry-Queue <-Identity QueueIdentity | -Filter {Status -eq "Retry"} -Server ServerIdentity> -Resubmit $true

В этом примере показано, как повторно отправить все сообщения, находящиеся в любых очередях доставки с состоянием "Повтор", на сервере Mailbox01.

    Retry-Queue -Filter {Status -eq "Retry"} -Server Mailbox01 -Resubmit $true

В этом примере показано, как повторно отправить все сообщения, находящиеся в очереди "Сообщения с недостижимым местом назначения", на сервере Mailbox01.

    Retry-Queue -Identity Mailbox01\Unreachable -Resubmit $true

## Повторная отправка сообщений, находящихся в очереди подозрительных сообщений

Чтобы повторно отправить сообщения, находящиеся в очереди подозрительных сообщений, возобновите отправку сообщений. Чтобы повторно отправить сообщения, находящиеся в очереди подозрительных сообщений, можно использовать средство просмотра очереди или командную консоль. Обратите внимание, что очередь подозрительных сообщений отображается в средстве просмотра очереди только если в ней есть сообщения.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Очередь подозрительных сообщений содержит сообщения, которые считаются потенциально вредными для системы Exchange после сбоя сервера. Такие сообщения могут действительно иметь вредоносное содержимое или формат. И наоборот, они могут быть &quot;жертвами&quot; плохо написанного агента, приведшего к аварии сервера Exchange во время обработки предположительно опасных сообщений. При наличии сомнений в безопасности сообщений из очереди подозрительных сообщений экспортируйте сообщения в файлы, чтобы их можно было проверить. Подробнее см. в разделе <a href="export-messages-from-queues-exchange-2013-help.md">Экспорт сообщений из очередей</a>.</td>
</tr>
</tbody>
</table>


## Повторная отправка сообщений, находящихся в очереди подозрительных сообщений, с помощью средства просмотра очереди на панели элементов Exchange

1.  Нажмите кнопку **Пуск** и последовательно выберите пункты **Все программы** \> **Microsoft Exchange 2013** \> **Панель элементов Exchange**.

2.  В разделе **Средства для потока почты** дважды щелкните **Средство просмотра очереди**, чтобы открыть средство в новом окне.

3.  В средстве просмотра очереди перейдите на вкладку **Очереди**. Отобразится список всех очередей на сервере, к которому установлено подключение.

4.  Выберите очередь опасных сообщений. В области действий выберите **Просмотр сообщений**.

5.  Выделите одно или несколько сообщений в списке, щелкните правой кнопкой мыши и выберите команду **Возобновить**.

## Использование командной консоли для повторной отправки сообщений, находящихся в очереди подозрительных сообщений

Чтобы повторно отправить сообщения, находящиеся в очереди подозрительных сообщений, выполните следующие действия.

1.  Найдите идентификатор сообщения, выполнив следующую команду.
    
        Get-Message -Queue Poison | Format-Table Identity

2.  Используйте идентификатор сообщения, найденный на предыдущем шаге, в следующей команде.
    
        Resume-Message <PoisonMessageIdentity>
    
    В этом примере возобновляется сообщение из очереди опасных сообщений со значением идентификатора 222.
    
        Resume-Message 222

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно выполнили повторную отправку сообщения, находящегося в очереди подозрительных сообщений, сделайте следующее.

1.  Чтобы просмотреть очередь подозрительных сообщений, сообщение из которой вы пытались повторно отправить, используйте средство просмотра очереди или командлет **Get-Queue**.

2.  Проверьте, что этого сообщения больше нет в очереди подозрительных сообщений. Обратите внимание, что пустая очередь подозрительных сообщений не отображается в средстве просмотра очереди или в командлете **Get-Queue**. Поэтому если сообщение, которое вы повторно отправили, было единственным сообщением в очереди подозрительных сообщений, и очередь подозрительных сообщений больше не отображается, это свидетельствует, что повторная отправка сообщения была выполнена успешно.

## Приостановка очередей

Приостановка очереди означает, что сообщения не будут покидать эту очередь, однако состояние этих сообщений в очереди не меняется. Сообщения, которые доставляются через SMTP-отправку, завершат операции. Можно приостановить очередь, чтобы остановить поток почты, а затем приостановить одно или несколько сообщений в этой очереди. При возобновлении очереди приостановленные сообщения не покинут ее.

Можно приостановить очередь, которая имеет состояние Active или Retry. Можно также приостановить недоступную очередь и очередь передачи.

При приостановке недоступной очереди ее элементы не будут повторно предоставляться в классификатор при получении сервером транспорта обновлений конфигурации до возобновления очереди. При приостановке очереди передачи сообщения не будут забираться классификатором до возобновления этой очереди.

## Приостановка очереди с помощью средства просмотра очереди на панели элементов Exchange

1.  Нажмите кнопку **Пуск** и последовательно выберите пункты **Все программы** \> **Microsoft Exchange 2013** \> **Панель элементов Exchange**.

2.  В разделе **Средства для потока почты** дважды щелкните **Средство просмотра очереди**, чтобы открыть средство в новом окне.

3.  В средстве просмотра очереди перейдите на вкладку **Очереди**. Отобразится список всех очередей на сервере, к которому установлено подключение. Для просмотра очередей, соответствующих определенному критерию, необходимо создать фильтр.

4.  Выберите одну или несколько очередей, щелкните правой кнопкой мыши и выберите команду **Приостановить**.

## Приостановка очереди с помощью командной консоли Exchange

Чтобы приостановить очередь, введите команду в следующем формате.

    Suspend-Queue <-Identity QueueIdentity | -Filter {QueueFilter} [-Server ServerIdentity]>

В этом примере показано, как приостановить все очереди на локальном сервере, которые находятся в состоянии "Повтор" и в которых не менее 1000 сообщений.

    Suspend-Queue -Filter {MessageCount -ge 1000 -and Status -eq "Retry"}

В этом примере показано, как приостановить очередь с именем contoso.com на сервере с именем Mailbox01.

    Suspend-Queue -Identity Mailbox01\contoso.com

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно приостановили очередь, выполните следующие действия.

1.  Чтобы найти очередь, которую вы пытались приостановить, используйте средство просмотра очереди или командлет **Get-Queue**.

2.  Проверьте, что свойство **Состояние** для очереди имеет значение `Suspended`.

