---
title: 'Активация отстающей копии базы данных почтовых ящиков: Exchange 2013 Help'
TOCTitle: Активация отстающей копии базы данных почтовых ящиков
ms:assetid: 493d9c40-644d-49d6-9291-949acbcfdcb6
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dd979786(v=EXCHG.150)
ms:contentKeyID: 50487978
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Активация отстающей копии базы данных почтовых ящиков

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2014-01-28_

Изолированная копия базы данных почтовых ящиков — это копия базы данных почтовых ящиков со значением времени задержки преобразования, превышающим 0. Активация и восстановление изолированной копии базы данных почтовых ящиков — это простой процесс, если необходимо преобразовать все файлы журнала и сделать копию базы данных текущей. Преобразование файлов журнала к определенному моменту времени является более сложной операцией, так как необходимо вручную управлять файлами журнала и запускать Eseutil.

Необходимы другие сведения об изолированных копиях базы данных почтовых ящиков? См. раздел [Управление копиями баз данных почтовых ящиков](managing-mailbox-database-copies-exchange-2013-help.md).

> [!NOTE]  
> Количество времени, необходимое для непосредственной активации изолированной копии базы данных почтовых ящиков, зависит от количества файлов журнала, которые необходимо преобразовать, и скорости их преобразования оборудованием. Минимальная скорость преобразования журнала составляет два журнала базы данных в секунду. 


## Что нужно знать перед началом работы

  - Предполагаемое время выполнения задачи: 1 минута плюс время, необходимое для дублирования изолированной копии, преобразования необходимых файлов журнала и извлечения данных или подключения базы данных для активности клиентов.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Запись "Копии базы данных почтовых ящиков" в разделе [Разрешения высокого уровня доступности и устойчивости сайта](high-availability-and-site-resilience-permissions-exchange-2013-help.md).

  - Активируемая копия базы данных почтовых ящиков должна иметь значение времени задержки преобразования, превышающее 0.

  - Активируемая копия базы данных почтовых ящиков должна иметь все файлы журнала на момент времени, к которому необходимо ее восстановить. Необходимо учесть, что транзакции базы данных могут охватывать несколько файлов журнала при определении момента времени,к которому необходимо выполнить восстановление.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.. 


## Что необходимо сделать?

## Использование командной консоли для активации изолированной копии базы данных почтовых ящиков к определенному моменту времени

> [!NOTE]  
> Для активации изолированной копии базы данных почтовых ящиков к определенному моменту времени нельзя использовать Центр администрирования Exchange. Вместо этого выполните ряд действий в командной консоли и командной строке. 


1.  В этом примере с помощью командлета [Suspend-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd351074\(v=exchg.150\)) приостанавливается репликация для активируемой изолированной копии.
    ```powershell
        Suspend-MailboxDatabaseCopy DB1\EX3 -SuspendComment "Activate lagged copy of DB1 on Server EX3" -Confirm:$false
    ```
2.  При необходимости (для сохранения изолированной копии) сделайте копию копии базы данных и файлов ее журнала.
    
    > [!NOTE]  
	> Если на этом этапе продолжить выполнение процедуры в существующем томе, это приведет к снижению производительности операции копирования при записи. Если это нежелательно, можно скопировать базу данных и файлы журнала на другой том для выполнения восстановления.


3.  Определите, какие файлы журнала необходимо преобразовать в базу данных для выполнения восстановления на определенный момент времени (на основе даты и времени файла журнала, как показано в Проводнике Windows). Все журналы, созданные после этого момента, необходимо переместить в другой каталог до тех пор, пока процесс восстановления не закончится, а журналы больше не понадобятся.

4.  Удалите файл контрольной точки (.chk) для базы данных.

5.  В этом примере для выполнения операции восстановления используется программа Eseutil.
    
    ```powershell
    Eseutil.exe /r eXX /a
    ```
    
    > [!NOTE]  
	> В предыдущем примере e<em>XX</em> — это префикс создания журнала для базы данных (например, E00, E01, E02 и т. д.).
    
    > [!IMPORTANT]  
	> Этот шаг может занять значительное время в зависимости от нескольких факторов, например от продолжительности времени задержки преобразования, количества файлов журнала, созданных в течение этого периода, и скорости, с которой оборудование может преобразовать эти журналы в восстановленную базу данных.


6.  После завершения преобразования журнала база данных находится в состоянии чистого отключения и может быть скопирована и использована в целях восстановления.

7.  В этом примере после завершения восстановления возобновляется репликация для базы данных, которая использовалась в процессе восстановления.
    
    ```powershell
    Resume-MailboxDatabaseCopy DB1\EX3
    ```

Дополнительные сведения о синтаксисе и параметрах см. в разделах [Suspend-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd351074\(v=exchg.150\)) или [Resume-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd335220\(v=exchg.150\)).

## Использование командной консоли для активации изолированной копии базы данных почтовых ящиков путем преобразования всех нефиксируемых файлов журнала

1.  При необходимости (для сохранения изолированной копии) сделайте копию копии базы данных и файлов ее журнала.
    
    1.  В этом примере с помощью командлета [Suspend-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd351074\(v=exchg.150\)) приостанавливается репликация для активируемой изолированной копии.
        ```powershell
            Suspend-MailboxDatabaseCopy DB1\EX3 -SuspendComment "Activate lagged copy of DB1 on Server EX3" -Confirm:$false
        ```
    2.  При необходимости (для сохранения изолированной копии) сделайте копию копии базы данных и файлов ее журнала.
        
        > [!NOTE]  
		> Если на этом этапе продолжить выполнение процедуры в существующем томе, это приведет к снижению производительности операции копирования при записи. Если это нежелательно, можно скопировать базу данных и файлы журнала на другой том для выполнения восстановления.


2.  В этом примере с помощью командлета [Move-ActiveMailboxDatabase](https://technet.microsoft.com/ru-ru/library/dd298068\(v=exchg.150\)) с параметром *SkipLagChecks* активируется изолированная копия базы данных почтовых ящиков.
    
    ```powershell
    Move-ActiveMailboxDatabase DB1 -ActivateOnServer EX3 -SkipLagChecks
    ```

## Использование командной консоли для активации изолированной копии базы данных почтовых ящиков с помощью восстановления SafetyNet

1.  При необходимости (для сохранения отстающей копии) сделайте с помощью службы теневого копирования томов (VSS) файловый (без учета Exchange) снимок томов, содержащий копию базы данных и файлы ее журналов.
    
    1.  В этом примере с помощью командлета [Suspend-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd351074\(v=exchg.150\)) приостанавливается репликация для активируемой изолированной копии.
        ```powershell
            Suspend-MailboxDatabaseCopy DB1\EX3 -SuspendComment "Activate lagged copy of DB1 on Server EX3" -Confirm:$false
        ```
    2.  При необходимости (для сохранения изолированной копии) сделайте копию копии базы данных и файлов ее журнала.
        
        > [!NOTE]  
		> Если на этом этапе продолжить выполнение процедуры в существующем томе, это приведет к снижению производительности операции копирования при записи. Если это нежелательно, можно скопировать базу данных и файлы журнала на другой том для выполнения восстановления.


2.  Определите необходимые журналы для изолированной копии базы данных, выполнив поиск значения "Log Required:" в выходных данных заголовка базы данных ESEUTIL
    
    ```powershell
    Eseutil /mh <DBPath> | findstr /c:"Log Required"
    ```
    
    Запишите шестнадцатеричные числа в скобках. Первое число — это самый низкий необходимый номер версии (называемый LowGeneration), а второе число — самый высокий необходимый номер (называемый HighGeneration). Переместите все версии файлов журнала, порядковые номера которых превышают значение HighGeneration, в отдельную папку, чтобы не преобразовывать их в базу данных.

3.  На сервере размещения активной копии базы данных удалите файлы журнала для изолированной копии, которая активируется с активной копии, или остановите работу службы репликации Microsoft Exchange.

4.  Выполните переключение базы данных и активируйте изолированную копию. В этом примере описана процедура активации базы данных с помощью командлета [Move-ActiveMailboxDatabase](https://technet.microsoft.com/ru-ru/library/dd298068\(v=exchg.150\)) с несколькими параметрами.
    ```powershell
        Move-ActiveMailboxDatabase DB1 -ActivateOnServer EX3 -MountDialOverride BestEffort -SkipActiveCopyChecks -SkipClientExperienceChecks -SkipHealthChecks -SkipLagChecks
    ```
5.  На данный момент база данных подключится автоматически и запросит повторную доставку отсутствующих сообщений из SafetyNet.

## Как проверить, что все получилось?

Чтобы убедиться, что изолированная копия базы данных почтовых ящиков успешно активирована, выполните одно из следующих действий.

  - В Центре администрирования Exchange откройте раздел **Серверы** \> **Базы данных**. Выберите подходящую базу данных, и в области "Сведения" нажмите кнопку **Просмотр сведений**, чтобы открыть свойства копии базы данных.

  - Для отображения сведений о состоянии копии базы данных запустите в консоли следующую команду:
    
    ```powershell
    Get-MailboxDatabaseCopyStatus <DatabaseCopyName> | Format-List
    ```

