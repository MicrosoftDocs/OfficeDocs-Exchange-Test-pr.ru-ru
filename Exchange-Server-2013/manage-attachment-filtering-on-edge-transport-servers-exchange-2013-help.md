---
title: 'Exchange 2013: фильтрация вложений для пограничных транспортных серверов'
TOCTitle: Управление фильтрацией вложений на пограничных транспортных серверах
ms:assetid: 2ec91cc6-6ade-48ee-88bb-66153874393d
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Aa997139(v=EXCHG.150)
ms:contentKeyID: 60829961
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Управление фильтрацией вложений на пограничных транспортных серверах

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-04-08_

Фильтрацию вложений выполняет агент фильтра вложений, доступный только на пограничных транспортных серверах. Фильтрация вложений предотвращает попадание в организацию файлов, вложенных в сообщения электронной почты. Можно настроить одну или несколько записей фильтрации вложений так, чтобы фильтровать вложения по типу содержимого или по имени файла.

## Что нужно знать перед началом работы?

  - Предполагаемое время для завершения каждой процедуры: 10 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Запись "Функции защиты от нежелательной почты" в разделе [Разрешения для защиты от нежелательной почты и вредоносных программ](anti-spam-and-anti-malware-permissions-exchange-2013-help.md) и запись "Агенты транспорта" в разделе [Разрешения потока обработки почты](mail-flow-permissions-exchange-2013-help.md).

  - Изменения параметров настройки фильтрации вложений на пограничном транспортном сервере действуют только на локальном компьютере. Если в сети периметра имеется несколько пограничных транспортных серверов, фильтрацию вложений необходимо настроить отдельно на каждом из этих серверов.

  - Для выполнения этой процедуры можно использовать только командную консоль.

  - Все функции фильтрации вложений перестают работать при отключении фильтрации вложений и перезапуске службы транспорта Microsoft Exchange.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.


## Что необходимо сделать?

## Использование командной консоли для включения или отключения фильтрации вложений

При включении или отключении агента фильтрации вложений изменение вступает в силу после перезапуска службы транспорта Microsoft Exchange. При перезапуске службы транспорта Microsoft Exchange на пограничном транспортном сервере поток обработки почты на сервере временно прерывается.

Чтобы отключить фильтрацию вложений, выполните приведенную ниже команду.

```powershell
Disable-TransportAgent "Attachment Filtering Agent"
```

Чтобы включить фильтрацию вложений, выполните приведенную ниже команду.

```powershell
Enable-TransportAgent "Attachment Filtering Agent"
```

После включения или отключения фильтрации вложений перезапустите службу транспорта Microsoft Exchange, выполнив указанную ниже команду.

```powershell
Restart-Service MSExchangeTransport
```

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно включили или отключили фильтрацию вложений, выполните перечисленные ниже действия.

1.  Выполните приведенную ниже команду.
    
    ```powershell
Get-TransportAgent "Attachment Filtering Agent"
```

2.  Если для параметра **Enabled** установлено значение `True`, фильтрация вложений включена. Если для этого параметра задано значение `False`, фильтрация вложений отключена.

## Использование командной консоли для просмотра записей фильтрации вложений

Записи фильтрации вложений определяют вложения в сообщения, которые не должны попадать в организацию. Чтобы просмотреть записи фильтрации вложений, используемые агентом фильтрации вложений, выполните приведенную ниже команду.

```powershell
Get-AttachmentFilterEntry | Format-Table
```

Чтобы просмотреть конкретную запись типа контента MIME, используйте приведенный ниже синтаксис.

```powershell
Get-AttachmentFilteringEntry ContentType:<MIMEContentType>
```

Например, чтобы просмотреть запись типа контента для изображений в формате JPEG, выполните приведенную ниже команду.

```powershell
Get-AttachmentFilteringEntry ContentType:image/jpeg
```

Чтобы просмотреть определенную запись имени или расширения файла, используйте приведенный ниже синтаксис.

```powershell
Get-AttachmentFilteringEntry FileName:<FileName or FileNameExtension>
```

Например, чтобы просмотреть запись расширения имени файла для вложений в формате JPEG, выполните приведенную ниже команду.

    Get-AttachmentFilteringEntry FileName:*.jpg

## Использование командной консоли для добавления записей фильтрации вложений

Чтобы добавить запись фильтрации вложений, которая фильтрует вложения по типу контента MIME, используйте приведенный ниже синтаксис.

```powershell
Add-AttachmentFilterEntry -Name <MIMEContentType> -Type ContentType
```

В примере ниже добавляется запись типа контента MIME, которая фильтрует изображения в формате JPEG.

```powershell
Add-AttachmentFilterEntry -Name image/jpeg -Type ContentType
```

Чтобы добавить запись фильтрации вложений, которая фильтрует вложения по имени или расширению файла, используйте приведенный ниже синтаксис.

```powershell
Add-AttachmentFilterEntry -Name <FileName or FileNameExtension> -Type FileName
```

В примере ниже выполняется фильтрация вложений с расширением имени JPG-файла.

    Add-AttachmentFilterEntry -Name *.jpg -Type FileName

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно добавили запись фильтрации вложений, выполните перечисленные ниже действия.

1.  Выполните приведенную ниже команду, чтобы убедиться в наличии записи фильтрации.
    
    ```powershell
Get-AttachmentFilterEntry | Format-Table
```

2.  Отправьте тестовое сообщения с вложением запрещенного типа из внешнего почтового ящика внутреннему получателю и убедитесь, что сообщение отклонено, очищено от вложения или удалено.

## Использование командной консоли для удаления записей фильтрации вложений

Чтобы удалить запись фильтрации вложений, которая фильтрует вложения по типу контента MIME, используйте приведенный ниже синтаксис.

```powershell
Remove-AttachmentFilterEntry ContentType:<ContentType>
```

В примере ниже удаляется запись типа контента MIME для изображений в формате JPEG.

```powershell
Remove-AttachmentFilterEntry ContentType:image/jpeg
```

Чтобы удалить запись фильтрации вложений, которая фильтрует вложения по имени или расширению файла, используйте приведенный ниже синтаксис.

```powershell
Remove-AttachmentFilterEntry FileName:<FileName or FileNameExtension>
```

В примере ниже удаляется запись имени файла для расширения имени JPG-файла.

    Remove-AttachmentFilterEntry FileName:*.jpg

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно удалили запись фильтрации вложений, выполните перечисленные ниже действия.

1.  Убедитесь, что запись фильтрации удалена, выполнив приведенную ниже команду.
    
    ```powershell
Get-AttachmentFilterEntry | Format-Table
```

2.  Отправьте тестовое сообщения с вложением разрешенного типа из внешнего почтового ящика внутреннему получателю и убедитесь, что сообщение с вложением успешно доставлено.

## Использование командной консоли для просмотра действия фильтрации вложений

Чтобы просмотреть действие фильтрации вложений, выполняемое в случае обнаружения в сообщении запрещенного вложения, выполните приведенную ниже команду.

```powershell
Get-AttachmentFilterListConfig
```

## Использование командной консоли для настройки действия фильтрации вложений

Чтобы настроить действие фильтрации вложений, выполняемое в случае обнаружения в сообщении запрещенного вложения, используйте приведенный ниже синтаксис.

    Set-AttachmentFilterListConfig [-Action <Reject | Strip | SilentDelete>] [-RejectResponse "<Message text>"] [-AdminMessage "<Replacement file text>"] [-ExceptionConnectors <ConnectorGUID>]

В этом примере в конфигурацию фильтрации вложений вносятся приведенные ниже изменения.

  - Сообщения с запрещенными вложениями отклоняются (блокируются).

  - Для отклоненных сообщений используется настраиваемый ответ.

<!-- end list -->

    Set-AttachmentFilterListConfig -Action Reject -RejectResponse "This message contains a prohibited attachment. Your message can't be delivered. Please resend the message without the attachment."

Дополнительные сведения см. в статье [Set-AttachmentFilterListConfig](https://technet.microsoft.com/ru-ru/library/bb123483\(v=exchg.150\)).

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно настроили действие фильтрации вложений, отправьте тестовое сообщения с вложением запрещенного типа из внешнего почтового ящика внутреннему получателю и убедитесь, что сообщение и вложение обрабатываются должным образом.

