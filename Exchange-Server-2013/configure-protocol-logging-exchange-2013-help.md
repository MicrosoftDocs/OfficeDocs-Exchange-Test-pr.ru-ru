---
title: 'Настройка ведения журнала протокола: Exchange 2013 Help'
TOCTitle: Настройка ведения журнала протокола
ms:assetid: c81cac9c-b990-492a-b899-5be8d08a6068
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb124531(v=EXCHG.150)
ms:contentKeyID: 50489177
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Настройка ведения журнала протокола

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2013-03-15_

Ведение журнала протокола предназначено для записывания SMTP-диалогов, происходящих на соединителях отправки и соединителях получения при доставке сообщений.

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения: 15 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Записи "Транспортная служба", "Служба транспорта переднего плана", "Транспортная служба почтовых ящиков", "Соединители получения" и "Соединители отправки" в разделе [Разрешения потока обработки почты](mail-flow-permissions-exchange-2013-help.md).

  - Можно использовать Центр администрирования Exchange, чтобы включить или выключить ведение журнала протокола для соединителей отправки и получения в транспортной службе серверов почтовых ящиков, а также для соединителей получения в транспортной службе переднего плана на серверах клиентского доступа. Можно также использовать Центр администрирования Exchange для настройки путей к журналу протокола только для транспортной службы. Для всех других параметров журнала протокола требуется использование командной консоли.

  - Ведение протокола включается или отключается отдельно на каждом из соединителей. Все соединители получения на сервере Exchange используют одни и те же файлы и параметры ведения журнала протокола. Эти параметры журнала протокола хранятся отдельно от файлов и параметров журнала протокола соединителей отправки, расположенных на том же сервере.

  - 
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Dd876857.Caution(EXCHG.150).gif" title="Внимание!" alt="Внимание!" />Внимание!</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Не выполняйте эту процедуру на пограничном транспортном сервере, который подписан на организацию Exchange с помощью EdgeSync. Вместо этого внесите изменения в транспортной службе на сервере почтовых ящиков. Эти изменения будут реплицированы на пограничный транспортный сервер при следующей синхронизации EdgeSync.</td>
    </tr>
    </tbody>
    </table>


  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

<table>
<thead>
<tr class="header">
<th><img src="images/Bb124558.tip(EXCHG.150).gif" title="Совет" alt="Совет" />Совет.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.</td>
</tr>
</tbody>
</table>


## Что необходимо сделать?

## Настройка ведения журнала протокола с помощью Центра администрирования Exchange

Чтобы использовать Центр администрирования Exchange для включения или выключения ведения журнала протокола на соединителях отправки или получения в транспортной службе сервера почтовых ящиков или на соединителе получения в транспортной службе переднего плана сервера клиентского доступа, выполните следующие действия.

1.  В Центре администрирования Exchange выберите пункты **Поток обработки почты** \> **Соединители отправки** или **Поток обработки почты** \> **Соединители получения**.

2.  Выберите необходимый соединитель и нажмите кнопку **Правка**![Значок редактирования](images/Bb124582.6f53ccb2-1f13-4c02-bea0-30690e6ea71d(EXCHG.150).gif "Значок редактирования").

3.  На вкладке **Общие** в разделе **Уровень ведения журнала протокола** выберите один из следующих параметров.
    
      - **Нет**   Ведение журнала протокола на соединителе отключено.
    
      - **Подробно**   Ведение журнала протокола на соединителе включено.
    
    Завершив настройку, нажмите кнопку **Сохранить**.

Чтобы использовать Центр администрирования Exchange для настройки путей к журналу протокола для соединителей отправки и получения в транспортной службе на сервере почтовых ящиков, выполните следующие действия.

1.  В Центре администрирования Exchange перейдите к разделу **Серверы** \> **Серверы**.

2.  Выберите необходимый сервер почтовых ящиков и нажмите кнопку **Изменить**![Значок редактирования](images/Bb124582.6f53ccb2-1f13-4c02-bea0-30690e6ea71d(EXCHG.150).gif "Значок редактирования").

3.  На странице свойств сервера нажмите кнопку **Журналы транспорта**.

4.  В разделе **Журнал протокола** измените один из следующих параметров.
    
      - **Путь журнала протокола отправки**   Указанное значение должно быть на локальном сервере Exchange. Если папка не существует, она будет создана после нажатия кнопки **Сохранить**.
    
      - **Путь журнала протокола получения**   Указанное значение должно быть на локальном сервере Exchange. Если папка не существует, она будет создана после нажатия кнопки **Сохранить**.
    
    Завершив настройку, нажмите кнопку **Сохранить**.

## Как проверить, что все получилось?

Чтобы убедиться, что параметры журнала протокола настроены правильно с помощью Центра администрирования Exchange, выполните следующие действия.

1.  Откройте местоположение, указанное для журналов протокола соединителей отправки или получения.

2.  Если ведение журнала протокола включено, убедитесь, что файл журнала создан. Если ведение журнала отключено, убедитесь, что последний файл журнала больше не обновляется.

## Включение или выключение ведения журнала протокола для соединителей отправки и получения с помощью командной консоли

Чтобы включить или выключить ведение журнала протокола для соединителей отправки и получения, выполните следующую команду.

    <Set-SendConnector |Set-ReceiveConnector> <ConnectorIdentity> -ProtocolLoggingLevel <Verbose | None>

В этом примере показано, как включить ведение журнала протокола для соединителя получения с именем "Connection from Contoso.com".

    Set-ReceiveConnector "Connection from Contoso.com" -ProtocolLoggingLevel Verbose

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно включили или выключили ведение журнала протокола, выполните следующие действия.

1.  В командной консоли выполните следующую команду:
    
        <Get-SendConnector |Get-ReceiveConnector> | Format-List Name,ProtocolLoggingLevel

2.  Убедитесь, что отображаются значения, которые вы настроили.

## Включение или выключение ведения журнала протокола для внутриорганизационного соединителя отправки с помощью командной консоли

Чтобы включить или выключить ведение журнала протокола для неявного и невидимого внутриорганизационного соединителя отправки, расположенного в транспортной службе сервера почтовых ящиков и в транспортной службе переднего плана на сервере клиентского доступа, выполните следующую команду.

    <Set-TransportService | Set-FrontEndTransportService> -IntraOrgConnectorProtocolLoggingLevel <Verbose | None>

В этом примере показано, как включить ведение журнала протокола для внутриорганизационного соединителя отправки в транспортной службе на сервере почтовых ящиков с именем Mailbox01.

    Set-TransportService Mailbox01 -IntraOrgConnectorProtocolLoggingLevel Verbose

## Как проверить, что все получилось?

Чтобы убедиться, что вы успешно включили или выключили ведение журнала протокола для внутриорганизационного соединителя отправки, выполните следующие действия.

1.  В командной консоли выполните следующую команду:
    
        <Get-TransportService | Get-FrontEndTransportService> <ServerIdentity> | Format-List IntraOrgConnectorProtocolLoggingLevel

2.  Убедитесь, что отображается значение, которое вы настроили.

## Включение или выключение ведения журнала протокола для соединителя отправки доставки в почтовые ящики с помощью командной консоли

Чтобы включить или выключить ведение журнала протокола для неявного и невидимого соединителя отправки электронной почты, расположенного в транспортной службе почтовых ящиков на сервере почтовых ящиков, выполните следующую команду.

    Set-MailboxTransportService -MailboxDeliveryConnectorProtocolLoggingLevel <Verbose | None>

В этом примере показано, как включить ведение журнала протокола для соединителя получения доставки в почтовые ящики в транспортной службе почтовых ящиков на сервере почтовых ящиков с именем Mailbox01.

    Set-MailboxTransportService Mailbox01 -MailboxDeliveryConnectorProtocolLoggingLevel Verbose

## Как проверить, что все получилось?

Чтобы убедиться, что ведение журнала протокола для соединителя доставки в почтовые ящики включено или выключено успешно, выполните следующие действия.

1.  В командной консоли выполните следующую команду:
    
        Get-MailboxTransportService <ServerIdentity> | Format-List MailboxDeliveryConnectorProtocolLoggingLevel

2.  Убедитесь, что отображается значение, которое вы настроили.

## Настройка параметров ведения журнала протокола с помощью командной консоли

Чтобы настроить параметры ведения журнала протокола, выполните следующую команду.

    <Set-TransportService | Set-MailboxTransportService | Set-FrontEndTransportService> <ServerIdentity> -ReceiveProtocolLogPath <LocalFilePath> -SendProtocolLogPath <LocalFilePath> -ReceiveProtocolLogMaxFileSize <Size> -SendProtocolLogMaxFileSize <Size> -ReceiveProtocolLogMaxDirectorySize <Size> -SendProtocolLogMaxDirectorySize <Size> -ReceiveProtocolLogMaxAge <dd.hh:mm:ss> -SendProtocolLogMaxAge <dd.hh:mm:ss>

В этом примере показано, как установить следующие параметры журнала протокола в транспортной службе на сервере почтовых ящиков с именем Mailbox01.

  -  Местоположение всех журналов протокола соединителя получения установлено на значение D:\\Hub Receive SMTP Log, а местоположение журналов протокола соединителя отправки — на значение D:\\Hub Send SMTP Log. Обратите внимание, что если папка не существует, она будет создана.

  -  Максимальный размер файлов журнала протокола соединителей получения и отправки установлен на 20 МБ.

  -  Максимальный размер папки журнала протокола соединителей получения и отправки установлен на 400 МБ.

  -  Максимальный срок хранения файла журнала протокола соединителей получения и отправки установлен на 45 дней.

<!-- end list -->

    Set-TransportService Mailbox01 -ReceiveProtocolLogPath "D:\Hub Receive SMTP Log" -SendProtocolLogPath "D:\Hub Send SMTP Log" -ReceiveProtocolLogMaxFileSize 20MB -SendProtocolLogMaxFileSize 20MB -ReceiveProtocolLogMaxDirectorySize 400MB -SendProtocolLogMaxDirectorySize 400MB -ReceiveProtocolLogMaxAge 45.00:00:00 -SendProtocolLogMaxAge 45.00:00:00

<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><ul>
<li><p>Чтобы настроить параметры журнала протокола в транспортной службе почтовых ящиков на сервере почтовых ящиков, используйте командлет <strong>Set-MailboxTransportService</strong>. Чтобы настроить параметры журнала протокола в транспортной службе переднего плана на сервере клиентского доступа, используйте командлет <strong>Set-FrontEndTransportService</strong>.</p></li>
<li><p>Если для параметра <em>SendProtocolLogPath</em> или <em>ReceiveProtocolLogPath</em> задано значение <code>$null</code>, то ведение журнала протокола будет отключено для всех соединителей отправки и получения на сервере. Однако установка значения <code>$null</code> для любого из этих параметров при включенном ведении журнала протокола для любых соединителей сервера, в том числе внутриорганизационного соединителя отправки или соединителя отправки доставки в почтовые ящики, приводит к выдаче ошибок журнала событий.</p></li>
<li><p>Установка для параметров <em>ReceiveProtocolLogMaxAge</em> или <em>SendProtocolLogMaxAge</em> значения <code>00:00:00</code> предотвращает автоматическое удаление файлов журналов протокола по истечении срока хранения.</p></li>
</ul></td>
</tr>
</tbody>
</table>


## Как проверить, что все получилось?

Чтобы убедиться, что параметры журнала протокола настроены правильно, выполните следующие действия.

1.  В командной консоли выполните следующую команду:
    
        <Get-TransportService | Get-MailboxTransportService | Get-FrontEndTransportService> <ServerIdentity> | Format-List SendConnectorProtocolLog*,ReceiveConnectorProtocolLog*

2.  Убедитесь, что отображаются значения, которые вы настроили.

