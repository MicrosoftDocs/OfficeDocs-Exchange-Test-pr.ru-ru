---
title: 'Использование пакетной миграции для переноса общедоступных папок Exchange 2013 в группы Office 365: Exchange 2013 Help'
TOCTitle: Использование пакетной миграции для переноса общедоступных папок Exchange 2013 в группы Office 365
ms:assetid: 1d800576-957d-4916-ae2a-55c08ca75be1
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Mt843873(v=EXCHG.150)
ms:contentKeyID: 74468733
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Использование пакетной миграции для переноса общедоступных папок Exchange 2013 в группы Office 365

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2018-03-26_

**Сводка.** Узнайте, как переместить общедоступные папки Exchange 2013 в группы Office 365.

С помощью так называемой *пакетной миграции* вы можете перенести некоторые или все общедоступные папки Exchange 2013 в группы Office 365. "Группы Office 365" — это новый инструмент для совместной работы от Майкрософт, обладающий определенными преимуществами по сравнению с общедоступными папками. Обзор различий между общедоступными папками и группами Office 365, а также описание преимуществ перехода на "Группы Office 365" см. в статье [Перенос общедоступных папок в группы Office 365](migrate-your-public-folders-to-office-365-groups-exchange-2013-help.md).

В этой статье представлены пошаговые инструкции по выполнению пакетной миграции для общедоступных папок Exchange 2013.

## Что нужно знать перед началом работы?

Перед началом подготовки к миграции убедитесь, что выполнены все указанные ниже условия.

  - Сервер Exchange 2013 должен работать под управлением **Exchange 2013 с накопительным пакетом обновления 15 (CU15)** или более поздней версии.

  - В Exchange Online вам необходимо быть членом группы ролей Organization Management. Эта группа ролей отличается от разрешений, которые назначаются при подписке на Office 365 или Exchange Online. Сведения о том, как включить группу ролей Organization Management, см. в статье [Управление группами ролей](manage-role-groups-exchange-2013-help.md).

  - В случае Exchange 2013 вам необходимо быть членом группы ролей RBAC "Управление организацией" или "Управление сервером". Дополнительные сведения см. в статье [Добавление членов в группу ролей](https://go.microsoft.com/fwlink/?linkid=299212).

  - Прежде чем переносить общедоступные папки в группы Office 365, рекомендуем переместить в Office 365 почтовые ящики пользователей, которым нужен доступ к группам Office 365 после миграции. Дополнительные сведения см. в статье [Способы переноса нескольких записей электронной почты в Office 365](https://support.office.com/article/ways-to-migrate-multiple-email-accounts-to-office-365-0a4913fe-60fb-498f-9155-a86516418842).

  - Прокси-сервер MRS должен быть включен по крайней мере на одном сервере Exchange Server, на котором также размещаются почтовые ящики общедоступных папок. Дополнительные сведения см. в статье [Включение конечной точки прокси-сервера MRS для удаленных перемещений](enable-the-mrs-proxy-endpoint-for-remote-moves-exchange-2013-help.md).

  - Эту процедуру невозможно выполнить с помощью Центра администрирования Exchange (EAC) или консоли управления Exchange (EMC). На серверах Exchange 2013 необходимо использовать командную консоль Exchange. В Exchange Online необходимо использовать Exchange Online PowerShell. Дополнительные сведения см. в статье [Подключение к Exchange Online PowerShell](https://technet.microsoft.com/library/jj984289\(v=exchg.150\).aspx).

  - В настоящее время в "Группы Office 365" можно перенести только общедоступные папки календаря и почты. Перенос папок других типов не поддерживается. Кроме того, целевые группы в Office 365 должны быть созданы до миграции.

  - При пакетной миграции в "Группы Office 365" из общедоступных папок копируются только сообщения и элементы календаря. Так как другие объекты общедоступных папок, например правила и разрешения, не поддерживаются в группах Office 365, они не копируются.

  - Служба "Группы Office 365" предоставляется с почтовым ящиком объемом 50 ГБ. Убедитесь, что суммарный размер данных в переносимых общедоступных папках не превышает 50 ГБ. Кроме того, оставьте место для дополнительного содержимого, которое пользователи будут добавлять после миграции. Рекомендуем переносить общедоступные папки общим размером не более 25 ГБ.

  - Не обязательно переносить все сразу. Вы можете выбрать определенные общедоступные папки, которые будут перенесены. Если переносимая общедоступная папка содержит вложенные папки, они не будут автоматически включены в миграцию. Если их нужно перенести, включите их явным образом.

  - Эта миграция никак не повлияет на общедоступные папки. Однако когда вы с помощью скрипта блокировки сделаете перенесенные общедоступные папки доступными только для чтения, вашим пользователям придется использовать группы Office 365 вместо общедоступных папок. 

  - Прежде чем приступать к работе, рекомендуем полностью прочитать эту статью, так как на некоторых этапах требуется простой в работе.

## Этап 1. Скачивание скриптов

Для пакетной миграции в "Группы Office 365" необходимо запустить несколько скриптов на разных этапах миграции, как описано ниже в этой статье. Скачайте скрипты и их вспомогательные файлы [здесь](https://www.microsoft.com/en-us/download/details.aspx?id=55985). После скачивания всех скриптов и файлов сохраните их в одном расположении, например `c:\PFtoGroups\Scripts`.

Прежде чем продолжать, убедитесь, что вы скачали и сохранили все перечисленные ниже скрипты и файлы.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Обязательно сохраните все скрипты и файлы в одном расположении.</td>
</tr>
</tbody>
</table>


  - **AddMembersToGroups.ps1**. Этот скрипт добавляет владельцев и членов групп Office 365 в соответствии с разрешениями в исходных общедоступных папках.

  - **AddMembersToGroups.strings.psd1**. Этот вспомогательный файл используется скриптом `AddMembersToGroups.ps1`.

  - **LockAndSavePublicFolderProperties.ps1**. Этот скрипт делает общедоступные папки доступными только для чтения, чтобы предотвратить какие-либо изменения, и переносит связанные с почтой свойства общедоступных папок (при условии, что они поддерживают почту) в целевые группы, чтобы письма из общедоступных папок перенаправлялись в целевые группы. Этот скрипт также создает резервные копии записей разрешений и свойств почты перед их изменением.

  - **LockAndSavePublicFolderProperties.strings.psd1**. Этот вспомогательный файл используется скриптом `LockAndSavePublicFolderProperties.ps1`.

  - **UnlockAndRestorePublicFolderProperties.ps1**. Этот скрипт восстанавливает права доступа и свойства почты общедоступных папок, используя файлы резервных копий, созданные скриптом `LockandSavePublicFolderProperties.ps1`.

  - **UnlockAndRestorePublicFolderProperties.strings.psd1**. Этот вспомогательный файл используется скриптом `UnlockAndRestorePublicFolderProperties.ps1`.

  - **WriteLog.ps1**. Этот скрипт позволяет трем предыдущим скриптам вести журналы.

  - **RetryScriptBlock.ps1**. Этот скрипт позволяет скриптам `AddMembersToGroups`, `LockAndSavePublicFolderProperties` и `UnlockAndRestorePublicFolderProperties` повторять определенные действия в случае временных ошибок.

Дополнительные сведения о `AddMembersToGroups.ps1`, `LockAndSavePublicFolderProperties.ps1` и `UnlockAndRestorePublicFolderProperties.ps1`, а также выполняемых ими задачах см. в разделе Скрипты миграции далее в этой статье.

## Этап 2. Подготовка к миграции

Чтобы подготовить организацию к миграции, необходимо выполнить указанные ниже действия.

1.  Составьте список общедоступных папок (для почты и календарей), которые требуется перенести в "Группы Office 365".

2.  Составьте список соответствующих целевых групп для каждой переносимой общедоступной папки. Вы можете создать новую группу в Office 365 или использовать существующую. Если вы создаете новую группу, сведения о необходимых параметрах вы найдете в статье [Узнайте о группах в Office 365](https://go.microsoft.com/fwlink/p/?linkid=858521). Если для переносимой общедоступной папки по умолчанию задано разрешение **Author** или выше, необходимо создать в Office 365 соответствующую группу с параметром конфиденциальности **Public**. Но чтобы увидеть общедоступную группу в узле **Группы** в Outlook, пользователям все равно придется присоединиться к группе.

3.  Переименуйте все общедоступные папки, в именах которых есть обратная косая черта (**\\**). В противном случае эти общедоступные папки могут перенестись неправильно.

4.  Для клиента Office 365 должна быть включена функция миграции **PAW**. Чтобы проверить, включена ли она, выполните следующую команду в Exchange Online PowerShell:
    
        Get-MigrationConfig
    
    Если в разделе **Features** указана функция **PAW**, то она включена и можно переходить к этапу 3 — *Создание CSV-файла*.
    
    Если функция PAW еще не включена для вашего клиента, это может быть связано с тем, что у вас уже есть пакеты миграции (для общедоступных папок или пользователей). Эти пакеты могут быть в любом состоянии, в том числе "Завершено". В таком случае завершите обработку и удалите существующие пакеты миграции, чтобы при выполнении команды `Get-MigrationBatch` не возвращалось ни одной записи. После этого функция PAW должна включиться автоматически. Обратите внимание, что `Get-MigrationConfig` может показать изменение не сразу, но это нормально. По завершении этого этапа вы сможете продолжить создавать пакеты миграции пользователей.

## Этап 3. Создание CSV-файла

Создайте CSV-файл с входными данными для одного из скриптов миграции.

CSV-файл должен содержать следующие столбцы:

  - **FolderPath**. Путь к переносимой общедоступной папке.

  - **TargetGroupMailbox**. SMTP-адрес целевой группы в Office 365. Вы можете выполнить приведенную ниже команду, чтобы просмотреть основной SMTP-адрес.
    
        Get-UnifiedGroup <alias of the group> | Format-Table PrimarySmtpAddress

Пример CSV-файла:

    "FolderPath","TargetGroupMailbox"
    "\Sales","sales@contoso.onmicrosoft.com"
    "\Sales\EMEA","emeasales@contoso.onmicrosoft.com"

Обратите внимание, что папку почты и папку календаря можно объединить в одну группу в Office 365. Однако другие сценарии объединения нескольких общедоступных папок в одну группу не поддерживаются в одном пакете миграции. Чтобы сопоставить несколько общедоступных папок с одной группой Office 365, последовательно, один за другим, запустите разные пакеты миграции. Каждый пакет миграции может содержать до 500 записей.

Одна общедоступная папка должна переноситься только в одну группу при обработке одного пакета миграции.

## Этап 4. Отправка запроса на миграцию

На этом этапе вы собираете сведения из среды Exchange, а затем используете их в Exchange Online PowerShell для создания пакета миграции. После этого запускаете миграцию.

1.  На сервере Exchange 2013 найдите и запишите адрес сервера конечной точки прокси-сервера MRS. Он потребуется позже, при отправке запроса на миграцию.

2.  В Exchange Online PowerShell используйте сведения, полученные на этапе 1, для выполнения приведенных ниже команд. Для переменных в этих командах используются значения, полученные на этапе 1.
    
    1.  Передайте учетные данные пользователя с правами администратора в среде Exchange 2013 в переменную `$Source_Credential`. При отправке запроса на миграцию в Exchange Online вы будете использовать эти учетные данные для доступа к серверам Exchange 2013, чтобы скопировать содержимое в Exchange Online.
        
            $Source_Credential = Get-Credential
            <source_domain>\<PublicFolder_Administrator_Account>
    
    2.  Используя сведения о прокси-сервере MRS из среды Exchange 2013, записанные на этапе 1, передайте это значение в переменную `$Source_RemoteServer`.
        
            $Source_RemoteServer = "<MRS proxy endpoint>"

3.  В Exchange Online PowerShell выполните следующую команду, чтобы создать конечную точку миграции:
    
        $PfEndpoint = New-MigrationEndpoint -PublicFolderToUnifiedGroup -Name PFToGroupEndpoint -RemoteServer $Source_RemoteServer -Credentials $Source_Credential

4.  Выполните приведенную ниже команду, чтобы создать пакет миграции из общедоступной папки в группу Office 365. В этой команде:
    
      - **CSVData** — это CSV-файл, созданный на этапе 3, *Создание CSV-файла*. Обязательно укажите полный путь к этому файлу. Если по той или иной причине файл был перемещен, обязательно проверьте и используйте новое расположение.
    
      - **NotificationEmails** — необязательный параметр, с помощью которого можно указать электронные адреса, на которые будут отправляться уведомления о состоянии и ходе выполнения миграции.
    
      - **AutoStart** — необязательный параметр, при использовании которого пакет миграции запускается сразу же после его создания.
    
      - **PublicFolderToUnifiedGroup** — параметр, указывающий, что это пакет миграции из общедоступных папок в группы Office 365.
    
    <!-- end list -->
    
        New-MigrationBatch -Name PublicFolderToGroupMigration -CSVData (Get-Content <path to .csv file> -Encoding Byte) -PublicFolderToUnifiedGroup -SourceEndpoint $PfEndpoint.Identity [-NotificationEmails <email addresses for migration notifications>] [-AutoStart]

5.  Запустите миграцию, выполнив приведенную ниже команду в Exchange Online PowerShell. Обратите внимание, что это необходимо, только если параметр `-AutoStart` не использовался при создании пакета на этапе 4.
    
        Start-MigrationBatch PublicFolderToGroupMigration

Пакетные миграции необходимо создавать с помощью командлета `New-MigrationBatch` в Exchange Online PowerShell, но просматривать ход выполнения миграции и управлять им можно в Центре администрирования Exchange. Вы также можете просматривать ход выполнения миграции с помощью командлетов [Get-MigrationBatch](https://technet.microsoft.com/ru-ru/library/jj219164\(v=exchg.150\)) и [Get-MigrationUser](https://technet.microsoft.com/ru-ru/library/jj218702\(v=exchg.150\)). Командлет `New-MigrationBatch` инициирует пользователя миграции для каждого почтового ящика группы Office 365, и вы можете просматривать состояние этих запросов на странице миграции почтовых ящиков.

Чтобы просмотреть страницу миграции почтовых ящиков, выполните указанные ниже действия.

1.  Откройте Центр администрирования Exchange в Exchange Online.

2.  Перейдите к разделу **Получатели** и выберите пункт **Миграция**.

3.  Выберите новый запрос на миграцию и щелкните **Просмотр сведений** в области **Сведения**.

Если статус пакета — **Завершено**, можете переходить к этапу 5, *Добавление членов групп Office 365 из общедоступных папок*.

## Этап 5. Добавление членов групп Office 365 из общедоступных папок

Вы можете вручную добавлять членов в целевые группы в Office 365. Но если вы хотите добавить членов в группу в соответствии с разрешениями в общедоступных папках, запустите скрипт `AddMembersToGroups.ps1` на сервере Exchange 2013, как показано в приведенной ниже команде. Чтобы почтовые ящики пользователей можно было добавить в качестве членов группы Office 365, они должны быть синхронизированы с Exchange Online. Чтобы узнать, какие разрешения общедоступной папки можно добавить в качестве членов группы Office 365, ознакомьтесь с разделом Скрипты миграции далее в этой статье.

В следующей команде:

  - **MappingCsv** — это CSV-файл, созданный на этапе 3, *Создание CSV-файла*. Обязательно укажите полный путь к этому файлу. Если по той или иной причине файл был перемещен, обязательно проверьте и используйте новое расположение.

  - **BackupDir** — это каталог, в котором будут храниться файлы журнала миграции.

  - **ArePublicFoldersOnPremises** — параметр, указывающий, где расположены общедоступные папки (в локальной среде или в Exchange Online).

  - **Credential** — имя пользователя и пароль для Exchange Online.

<!-- end list -->

    .\AddMembersToGroups.ps1 -MappingCsv <path to .csv file> -BackupDir <path to backup directory> -ArePublicFoldersOnPremises $true -Credential (Get-Credential)

После добавления в группу Office 365 пользователи могут начинать использовать ее.

## Этап 6. Блокировка общедоступных папок (требуется их простой)

Когда большая часть данных из общедоступных папок будет перенесена в "Группы Office 365", вы можете запустить скрипт `LockAndSavePublicFolderProperties.ps1` на сервере Exchange 2013, чтобы сделать их доступными только для чтения. Благодаря этому до завершения миграции в общедоступные папки не будут добавляться новые данные.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Если среди переносимых папок есть общедоступные папки, поддерживающие почту (MEPF), то некоторые их свойства, например SMTP-адреса, будут скопированы в соответствующую группу в Office 365, а затем будет отключена поддержка почты. Так как после выполнения этого скрипта для переносимых MEPF будет отключена поддержка почты, письма, отправляемые в MEPF, будут поступать в соответствующие группы. Дополнительные сведения см. в разделе Скрипты миграции далее в этой статье.</td>
</tr>
</tbody>
</table>


В следующей команде:

  - **MappingCsv** — это CSV-файл, созданный на этапе 3, *Создание CSV-файла*. Обязательно укажите полный путь к этому файлу. Если по той или иной причине файл был перемещен, обязательно проверьте и используйте новое расположение.

  - **BackupDir** — каталог, в котором будут храниться резервные копии записей разрешений, свойств MEPF и файлов журнала миграции. Эта резервная копия пригодится в случае возврата к общедоступным папкам.

  - **ArePublicFoldersOnPremises** — параметр, указывающий, где расположены общедоступные папки (в локальной среде или в Exchange Online).

  - **Credential** — имя пользователя и пароль для Exchange Online.

<!-- end list -->

    .\LockAndSavePublicFolderProperties.ps1 -MappingCsv <path to .csv file> -BackupDir <path to backup directory> -ArePublicFoldersOnPremises $true -Credential (Get-Credential)

## Этап 7. Завершение миграции из общедоступных папок в "Группы Office 365"

После того как вы сделаете общедоступные папки доступными только для чтения, вам нужно будет снова выполнить миграцию. Это необходимо для окончательного добавочного копирования данных. Перед повторным запуском миграции вам нужно будет удалить существующий пакет. Это можно сделать с помощью следующей команды:

    Remove-MigrationBatch <name of migration batch>

После этого создайте новый пакет с помощью того же CSV-файла, выполнив приведенную ниже команду. В этой команде:

  - **CsvData** — это CSV-файл, созданный на этапе 3, *Создание CSV-файла*. Обязательно укажите полный путь к этому файлу. Если по той или иной причине файл был перемещен, обязательно проверьте и используйте новое расположение.

  - **NotificationEmails** — необязательный параметр, с помощью которого можно указать электронные адреса, на которые будут отправляться уведомления о состоянии и ходе выполнения миграции.

  - **AutoStart** — необязательный параметр, при использовании которого пакет миграции запускается сразу же после его создания.

<!-- end list -->

    New-MigrationBatch -Name PublicFolderToGroupMigration -CSVData (Get-Content <path to .csv file> -Encoding Byte) -PublicFolderToUnifiedGroup -SourceEndpoint $PfEndpoint.Identity [-NotificationEmails <email addresses for migration notifications>] [-AutoStart]

После создания нового пакета запустите миграцию, выполнив приведенную ниже команду в Exchange Online PowerShell. Обратите внимание, что это необходимо, только если параметр `-AutoStart` не использовался в предыдущей команде.

    Start-MigrationBatch PublicFolderToGroupMigration

По завершении этого этапа (когда для пакета будет отображаться состояние **Завершено**) убедитесь, что все данные были скопированы в "Группы Office 365". Если вас устраивают группы Office 365, вы можете приступить к удалению перенесенных общедоступных папок из среды Exchange 2013.

<table>
<thead>
<tr class="header">
<th><img src="images/Dd876857.important(EXCHG.150).gif" title="Важно" alt="Важно" />Важно!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Существуют способы отката миграции и возврата к общедоступным папкам, но после удаления исходных общедоступных папок это будет невозможно. Дополнительные сведения см. в разделе Как вернуться к общедоступным папкам, попробовав &quot;Группы Office 365&quot;?.</td>
</tr>
</tbody>
</table>


## Известные проблемы

Во время типичной миграции из общедоступных папок в группы Office 365 могут возникать описанные ниже известные проблемы.

  - Скрипт, который передает SMTP-адрес из поддерживающих почту общедоступных папок в группу Office 365, добавляет адреса только как дополнительные электронные адреса в Exchange Online. Поэтому если в среде вы настроили Exchange Online Protection (EOP) или централизованный поток обработки почты, то после миграции будут возникать проблемы с отправкой электронной почты в группы (на дополнительные электронные адреса).

  - Если в CSV-файле сопоставления есть запись с недействительным путем к общедоступной папке, статус миграции изменится на **Завершено** без ошибки. При этом копирование данных будет прекращено.

## Скрипты миграции

В этом разделе представлено подробное описание трех скриптов миграции и задач, которые они выполняют в среде Exchange. Все сценарии и вспомогательные файлы можно [скачать здесь](https://www.microsoft.com/en-us/download/details.aspx?id=55985).

## AddMembersToGroups.ps1

Этот скрипт считывает разрешения для переносимых общедоступных папок, а затем добавляет владельцев и членов групп Office 365, как описано ниже.

  - Пользователи с указанными ниже ролями будут добавлены в группу Office 365 в качестве ее членов. **Роли:** Owner, PublishingEditor, Editor, PublishingAuthor, Author.

  - Кроме того, пользователи с указанными ниже минимальными правами доступа также будут добавлены в группу Office 365 в качестве ее членов. **Права доступа:** ReadItems, CreateItems, FolderVisible, EditOwnedItems, DeleteOwnedItems.

  - Пользователи с правом доступа Owner будут добавлены в группу в качестве владельцев, а пользователи с другими правами доступа — в качестве ее членов.

  - Группы безопасности нельзя добавлять как членов групп в Office 365. Следовательно, отдельные пользователи этих групп будут добавлены в группы Office 365 в качестве членов или владельцев в соответствии с правами доступа для групп безопасности.

  - Если пользователям в группах безопасности с правами доступа к общедоступной папке назначены явные разрешения для той же общедоступной папки, приоритет будут иметь явные разрешения. Допустим, в группе безопасности SG1 есть члены User1 и User2. Для общедоступной папки PF1 заданы приведенные ниже разрешения.
    
    SG1: Author в PF1.
    
    User1: Owner в PF1.
    
    В этом случае User1 будет добавлен в группу Office 365 в качестве владельца.

  - Если для переносимой общедоступной папки по умолчанию задано разрешение Author или выше, то скрипт предложит задать для соответствующей группы параметр конфиденциальности Public.

Этот скрипт можно запустить даже после блокировки общедоступных папок, задав для параметра `ArePublicFoldersLocked` значение ` $true`. В этом случае скрипт считает разрешения из файла резервной копии, созданного при блокировке.

## LockAndSavePublicFolderProperties.ps1

Этот скрипт делает переносимые общедоступные папки доступными только для чтения. При переносе общедоступных папок, поддерживающих почту, в первую очередь будет отключена поддержка почты, а их SMTP-адреса будут добавлены в соответствующие группы Office 365. Затем будут изменены записи разрешений, чтобы папки стали доступными только для чтения. Резервная копия свойств почты для общедоступных папок, поддерживающих почту, а также записи разрешений для всех общедоступных папок будут скопированы перед их изменением.

Если имеется несколько пакетов миграции, то с каждым CSV-файлом сопоставления следует использовать отдельный каталог резервного копирования.

Вместе с общедоступными папками, поддерживающими почту, и группами Office 365 будут сохранены следующие свойства почты:

  - PrimarySMTPAddress;

  - EmailAddresses;

  - ExternalEmailAddress;

  - EmailAddressPolicyEnabled;

  - GrantSendOnBehalfTo;

  - список Trustee SendAs.

Указанные выше свойства почты будут сохранены в CSV-файле, который можно использовать при откате (дополнительные сведения см. в разделе Как вернуться к общедоступным папкам, попробовав "Группы Office 365"?). Моментальный снимок свойств общедоступных папок, поддерживающих почту, также будет сохранен в файле PfMailProperties.csv. Этот файл не нужен для отката, но его можно использовать для справки.

Следующие свойства почты будут перенесены в целевую группу при блокировке:

  - PrimarySMTPAddress;

  - EmailAddresses;

  - список Trustee SendAs;

  - GrantSendOnBehalfTo.

Этот скрипт позволяет добавить параметры PrimarySMTPAddress и EmailAddresses переносимых общедоступных папок, поддерживающих почту, в качестве дополнительных SMTP-адресов соответствующих групп в Office 365. Кроме того, пользовательские разрешения SendAs и SendOnBehalfTo для общедоступных папок, поддерживающих почту, будут заменены эквивалентными разрешениями в соответствующих целевых группах.

**Разрешенные права доступа**

Чтобы сделать общедоступные папки доступными только для чтения, пользователям будут предоставлены только указанные ниже права доступа. Они хранятся в списке **ListOfAccessRightsAllowed**.

  - ReadItems

  - CreateSubfolders

  - FolderContact

  - FolderVisible

Ниже показано, как будут изменены разрешения.

1.  ###  
    
    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>До блокировки</th>
    <th>После блокировки</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><p>None</p></td>
    <td><p>None</p></td>
    </tr>
    <tr class="even">
    <td><p>AvailabilityOnly</p></td>
    <td><p>AvailabilityOnly</p></td>
    </tr>
    <tr class="odd">
    <td><p>LimitedDetails</p></td>
    <td><p>LimitedDetails</p></td>
    </tr>
    <tr class="even">
    <td><p>Contributor</p></td>
    <td><p>FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>Reviewer</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="even">
    <td><p>NonEditingAuthor</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>Author</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="even">
    <td><p>Editor</p></td>
    <td><p>ReadItems, FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>PublishingAuthor</p></td>
    <td><p>ReadItems, CreateSubfolders, FolderVisible</p></td>
    </tr>
    <tr class="even">
    <td><p>PublishingEditor</p></td>
    <td><p>ReadItems, CreateSubfolders, FolderVisible</p></td>
    </tr>
    <tr class="odd">
    <td><p>Owner</p></td>
    <td><p>ReadItems, CreateSubfolders, FolderContact, FolderVisible</p></td>
    </tr>
    </tbody>
    </table>


2.  Права доступа для пользователей без разрешений на чтение останутся без изменений, у них по-прежнему не будет прав на чтение.

3.  Для пользователей с настраиваемыми ролями удаляются все права доступа, не указанные в списке **ListOfAccessRightsAllowed**. Если после фильтрации у пользователей нет прав доступа из разрешенного списка, то для прав доступа этих пользователей будет задано значение None.

В период между отключением поддержки почты для папок и добавлением их SMTP-адресов в "Группы Office 365" возможны перебои в отправке писем в общедоступные папки, поддерживающие почту.

## UnlockAndRestorePublicFolderProperties.ps1

Этот скрипт повторно назначит разрешения для общедоступных папок, используя файл резервной копии, созданный при блокировке. Этот скрипт также включит поддержку почты для общедоступных папок после удаления SMTP-адресов папок из соответствующих групп в Office 365. В ходе этого процесса возможен небольшой простой.

## Как вернуться к общедоступным папкам, попробовав "Группы Office 365"?

Если вы решите вернуться к использованию общедоступных папок, попробовав группы Office 365, приведенная ниже команда восстановит среду до того состояния, в котором она была перед миграцией. Откат можно выполнить, если существуют файлы резервной копии и вы не удалили общедоступные папки после миграции.

Выполните приведенную ниже команду на сервере Exchange 2013. В этой команде:

  - **BackupDir** — каталог, в котором будут храниться резервные копии записей разрешений, свойств MEPF и файлов журнала миграции. Убедитесь, что используется то же расположение, что и на этапе 6, *Блокировка общедоступных папок (требуется их простой)*.

  - **ArePublicFoldersOnPremises** — параметр, указывающий, где расположены общедоступные папки (в локальной среде или в Exchange Online).

  - **Credential** — имя пользователя и пароль для Exchange Online.

<!-- end list -->

    .\UnlockAndRestorePublicFolderProperties.ps1 -BackupDir <path to backup directory> -ArePublicFoldersOnPremises $true -Credential (Get-Credential)

Учтите, что все элементы, добавленные в группу Office 365, и результаты всех операций редактирования, выполненных в группах, не копируются обратно в общедоступные папки. Следовательно, если во время использования групп были добавлены новые данные, они будут потеряны.

Обратите внимание на то, что невозможно восстановить только некоторые из общедоступных папок. Должны быть восстановлены все перенесенные общедоступные папки.

Соответствующие группы Office 365 не будут удалены в ходе отката. Очищать или удалять их придется вручную.

