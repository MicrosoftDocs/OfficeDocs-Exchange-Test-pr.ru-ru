---
title: 'Обновление копии базы данных почтовых ящиков: Exchange 2013 Help'
TOCTitle: Обновление копии базы данных почтовых ящиков
ms:assetid: bead3cc5-7d50-446f-95b7-e432bcb7968e
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dd351100(v=EXCHG.150)
ms:contentKeyID: 50489016
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Обновление копии базы данных почтовых ящиков

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2012-11-02_

Обновление, также называемое *заполнением*, представляет собой процесс, в котором копия базы данных почтовых ящиков добавляется на другой сервер почтовых ящиков в группе обеспечения доступности баз данных (DAG). Только что добавленная копия становится базовой базой данных для пассивной копии, в которую воспроизводятся файлы журнала, скопированные из активной копии. Заполнение необходимо при следующих условиях:

  - при создании новой пассивной копии базы данных. Для новой копии базы данных почтовых ящиков заполнение может быть отложено, но в итоге каждая пассивная копия базы данных должна быть заполнена, чтобы служить резервной копией базы данных;

  - после перехода на другой ресурс при сбое, в ходе которого произошла потеря данных из-за возникшего расхождения и невозможности восстановления пассивной копии базы данных;

  - если система обнаружила поврежденный файл журнала, который нельзя воспроизвести в пассивную копию базы данных;

  - после автономной дефрагментации любой из копий базы данных;

  - после сброса версии журнала для базы данных обратно на 1.

Заполнение можно выполнить, используя следующие методы.

  - **Автоматическое заполнение**   автоматическое заполнение создает пассивную копию активной базы данных на конечном сервере почтовых ящиков. Автоматическое заполнение выполняется при создании новой базы данных.

  - **Заполнение с помощью командлета Update-MailboxDatabaseCopy**. Для заполнения копии базы данных в произвольный момент времени можно использовать командлет [Update-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd335201\(v=exchg.150\)) в командной консоли.

  - **Заполнение с помощью мастера обновления копии базы данных**   Для заполнения копии базы данных в произвольный момент времени можно использовать мастер обновления копии базы данных в EAC.

  - **Копирование автономной базы данных вручную**   можно отключить активную копию базы данных и скопировать файл базы данных в такое же расположение на другом сервере почтовых ящиков в той же группе доступности баз данных. При использовании этого метода работа службы прерывается, так как этот процесс требует отключения базы данных.

Обновление копии базы данных может занять длительное время, особенно если копируемая база данных имеет большой объем, а также в случае высокой задержки сети или использования низкоскоростной сети. После запуска процесса заполнения не закрывайте Центр администрирования Exchange (EAC) или командную консоль, пока процесс не будет завершен. В противном случае заполнение будет прервано.

Копия базы данных может быть заполнена, используя в качестве источника заполнения активную копию или актуальную пассивную копию. При заполнении из пассивной копии нужно учитывать, что операция заполнения будет прервана с ошибкой сетевого подключения при следующих обстоятельствах:

  - если состояние копии источника заполнения меняется на Failed (сбой) или FailedAndSuspended (сбой и приостановлено);

  - если база данных переходит на другую копию.

Несколько копий базы данных могут быть заполнены одновременно. Но при одновременном заполнении нескольких копий необходимо заполнять только файл базы данных, пропуская каталог индекса содержимого. Для этого можно воспользоваться параметром *DatabaseOnly* командлета [Update-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd335201\(v=exchg.150\)).

> [!NOTE]  
> Если при заполнении нескольких копий из одного источника параметр <em>DatabaseOnly</em> не используется, задача завершится неудачно с ошибкой SeedInProgressException FE1C6491.


Сведения о других задачах управления, относящихся к копиям базы данных почтовых ящиков, см. в разделе [Управление копиями баз данных почтовых ящиков](managing-mailbox-database-copies-exchange-2013-help.md).

## Что нужно знать перед началом работы?

  - Предполагаемое время выполнения задачи: 2 минуты, а также время на заполнение копии базы данных, которое зависит от ряда факторов, например размера базы данных, скорости, доступной полосы пропускания и задержки сети, а также скорости работы хранилища.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Запись «Копии базы данных почтовых ящиков» в разделе [Разрешения высокого уровня доступности и устойчивости сайта](high-availability-and-site-resilience-permissions-exchange-2013-help.md).

  - Копия базы данных почтовых ящиков должна быть приостановлена. Подробные сведения см. в разделе [Приостановка или возобновление работы копии базы данных почтовых ящиков](suspend-or-resume-a-mailbox-database-copy-exchange-2013-help.md).

  - Службу удаленного реестра необходимо запустить на сервере, на котором размещена обновляемая пассивная копия базы данных.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>..


## Что необходимо сделать?

## Использование EAC для обновления копии базы данных почтовых ящиков

1.  В Центре администрирования Exchange последовательно выберите пункты **Серверы** \> **Базы данных**.

2.  Выберите базу данных почтовых ящиков, пассивную копию которой необходимо обновить.

3.  В области сведений в разделе **Kопии базы данных** щелкните элемент **Приостановить** под пассивной копией базы данных, которую необходимо заполнить. Введите любые дополнительные комментарии и нажмите кнопку **сохранить**.

4.  В области сведений в разделе **Kопии базы данных** щелкните элемент **Обновить** под пассивной копией базы данных, которую необходимо заполнить.

5.  
    
    По умолчанию в качестве источника заполнения базы данных используется активная копия базы данных. Если необходимо использовать для заполнения пассивную копию базы данных, щелкните элемент **обзор…**, чтобы выбрать сервер с пассивной копией базы данных, которая будет использоваться в качестве источника.

6.  Нажмите кнопку **сохранить**, чтобы обновить пассивную копию базы данных.

## Использование командной консоли для обновления копии базы данных почтовых ящиков

В данном примере показано, как заполнить копию базы данных с именем DB1 на сервере MBX1.

    Update-MailboxDatabaseCopy -Identity DB1\MBX1

В данном примере показано, как заполнить копию базы данных с именем DB1 на сервере MBX1 с использованием сервера MBX2 в качестве исходного сервера почтовых ящиков для заполнения.

    Update-MailboxDatabaseCopy -Identity DB1\MBX1 -SourceServer MBX2

В данном примере показано, как заполнить копию базы данных с именем DB1 на сервере MBX1 без заполнения каталога индекса содержимого.

    Update-MailboxDatabaseCopy -Identity DB1\MBX1 -DatabaseOnly

В данном примере показано, как заполнить каталог индекса содержимого для копии базы данных с именем DB1 на сервере MBX1 без заполнения файла базы данных.

    Update-MailboxDatabaseCopy -Identity DB1\MBX1 -CatalogOnly

## Копирование автономной базы данных вручную

1.  Если для базы данных включено циклическое ведение журнала, его необходимо отключить перед продолжением работы. Циклическое ведение журнала можно отключить для базы данных почтовых ящиков с помощью командлета [Set-MailboxDatabase](https://technet.microsoft.com/ru-ru/library/bb123971\(v=exchg.150\)), как показано в этом примере.
    
        Set-MailboxDatabase DB1 -CircularLoggingEnabled $false

2.  Отключите базу данных. Можно использовать командлет [Dismount-Database](https://technet.microsoft.com/ru-ru/library/bb124936\(v=exchg.150\)), как показано в следующем примере.
    
        Dismount-Database DB1 -Confirm $false

3.  Вручную скопируйте файлы базы данных (файл самой базы и все файлы журнала) в другое расположение, например на внешний диск или в сетевую папку.

4.  Подключите базу данных. Можно использовать командлет [Mount-Database](https://technet.microsoft.com/ru-ru/library/aa998871\(v=exchg.150\)), как показано в следующем примере.
    
        Mount-Database DB1

5.  На сервере, где будет размещаться копия, скопируйте файлы базы данных с внешнего диска или из сетевой папки в тот же путь, что используется для активной копии базы данных. Например, если путь активной копии базы данных — D:\\DB1\\DB1.edb, а путь к файлам журнала — D:\\DB1, то файлы базы данных на сервере, где будет размещаться копия, следует скопировать в каталог D:\\DB1.

6.  Добавьте копию базы данных почтовых ящиков, используя командлет [Add-MailboxDatabaseCopy](https://technet.microsoft.com/ru-ru/library/dd298105\(v=exchg.150\)) с параметром *SeedingPostponed*, как показано в следующем примере.
    
        Add-MailboxDatabaseCopy -Identity DB1 -MailboxServer MBX3 -SeedingPostponed

7.  Если для базы данных включено циклическое ведение журнала, включите его повторно с помощью командлета [Set-MailboxDatabase](https://technet.microsoft.com/ru-ru/library/bb123971\(v=exchg.150\)), как показано в следующем примере.
    
        Set-MailboxDatabase DB1 -CircularLoggingEnabled $true

## Как проверить, что все получилось?

Чтобы убедиться, успешно ли заполнена копия базы данных почтовых ящиков, выполните одно из следующих действий:

  - В центре администрирования Exchange откройте раздел **Серверы** \> **Базы данных**. Выберите базу данных, которая была заполнена. В области "Сведения" отображается состояние копии базы данных и индекса ее содержимого, а также текущая длина очереди копирования.

  - Чтобы убедиться, что копия базы данных почтовых ящиков успешно заполнена и работоспособна, выполните следующую команду в командной консоли:
    
        Get-MailboxDatabaseCopyStatus <DatabaseCopyName>
    
    Состояние самой копии и индекса содержимого должно быть указано как работоспособное.

