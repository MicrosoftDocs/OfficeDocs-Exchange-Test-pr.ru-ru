---
title: 'Очереди: Exchange 2013 Help'
TOCTitle: Очереди
ms:assetid: e7ad0ba5-3789-4a2b-9825-6bb1b321609c
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb125022(v=EXCHG.150)
ms:contentKeyID: 51408089
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Очереди

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

*Очередь* — это временное хранилище сообщений, ожидающих следующей стадии обработки или доставки адресату. Каждая очередь представляет собой логический набор сообщений, которые обрабатываются сервером Exchange в определенном порядке. В Microsoft Exchange Server 2013 сообщения удерживаются в очередях до, во время и после доставки. Очереди существуют на серверах почтовых ящиков и пограничных транспортных серверах. В этом разделе серверы почтовых ящиков и пограничные транспортные серверы называются *транспортными серверами*.

Как и в предыдущих версиях Exchange, в Exchange 2013 для хранения очередей используется отдельная база данных расширенного обработчика хранилищ (ESE).

Вы можете управлять очередями и содержащимися в них сообщениями с помощью командной консоли Exchange и средства просмотра очереди на панели элементов Exchange. Можно использовать эти интерфейсы для просмотра состояния и содержимого очередей и особых свойств сообщений. Эти интерфейсы можно также использовать для изменения очередей или сообщений в очередях.

**Содержание**

  - Типы очередей

  - Файлы базы данных очередей

  - Свойства очереди
    
      - NextHopSolutionKey
    
      - IncomingRate, OutgoingRate и Velocity
    
      - Состояние очереди
    
      - Другие свойства очереди

  - Свойства сообщения
    
      - Состояние сообщения
    
      - Другие свойства сообщений

  - Управление очередями и находящимися в них сообщениями

## Типы очередей

В Exchange 2013 используются следующие типы очередей:

  - **Сохраняемые очереди**. *Сохраняемые очереди* — это очереди, которые имеются на каждом транспортном сервере в каждой организации Exchange. Как и в предыдущих версиях Exchange, в Exchange 2013 имеются сохраняемые очереди трех следующих типов.
    
      - **Очередь передачи**. Очередь передачи используется классификатором для сбора всех сообщений, которые будут разрешены, маршрутизированы и обработаны транспортными агентами на транспортном сервере. Обработка всех сообщений, полученных сервером транспорта, начинаются с очереди отправки. На серверах почтовых ящиков сообщения передаются посредством соединителя приема, каталогов раскладки и преобразования или службы отправки транспорта почтовых ящиков. На пограничных транспортных серверах сообщения обычно передаются с помощью соединителя приема, но каталоги раскладки и преобразования также доступны.
        
        Классификатор получает сообщение из этой очереди и, помимо всего прочего, определяет местоположение получателя и маршрут до него. После классификации сообщение перемещается в очередь доставки или в очередь "Недоступные". На каждом транспортном сервере имеется только одна очередь передачи. Сообщения в очереди отправки не могут одновременно находиться в других очередях. Дополнительные сведения о классификаторе и транспортном конвейере см. в разделе [Поток обработки почты](mail-flow-exchange-2013-help.md).
    
      - **Очередь недоставленных сообщений**. Очередь недоставленных сообщений содержит сообщения, которые невозможно маршрутизировать по назначению. Обычно недоступное назначение вызвано изменениями в настройке, которые изменили путь доставки. Вне зависимости от назначения все сообщения, имеющие недоступных адресатов, находятся в этой очереди. На каждом транспортном сервере имеется только одна очередь недоставленных сообщений.
        
        Сообщения в очереди недоставленных сообщений автоматически отправляются повторно при обнаружении изменения в маршрутизации. Поэтому после устранения ошибки в условии или конфигурации, из-за которой сообщения попадали в очередь недоставленных сообщений, не нужно выполнять дополнительные действия по их перемещению из этой очереди для доставки.
        
        Очередь недоставленных сообщений обычно пуста. Если очередь недоставленных сообщений не содержит сообщений, она не отображается в средстве просмотра очереди или результатах командлета **Get-Queue**.
    
      - **Очередь подозрительных сообщений**. Очередь подозрительных сообщений — это специальная очередь, используемая для изоляции сообщений, которые могут нанести вред системе Exchange 2013 после сбоя транспортного сервера или службы. Эти сообщения могут быть действительно опасными по своему содержанию и формату. Они также могут быть результатом того, что какой-либо некорректно написанный агент приводил к сбоям сервера Exchange, когда тот обрабатывал предположительно неправильные сообщения.
        
        Как правило, очередь подозрительных сообщений пустая. Если очередь подозрительных сообщений не содержит сообщений, она не отображается в средстве просмотра очереди или результатах командлета **Get-Queue**. Сообщения в этой очереди никогда не возобновляются и не удаляются автоматически. Сообщения остаются в очереди подозрительных сообщений, пока администратор не возобновит или не удалит их вручную.

  - **Очереди доставки**. В очередях доставки хранятся сообщения, которые доставляются в любые локальные или удаленные назначения по протоколу SMTP. Все сообщения передаются между серверами Exchange по протоколу SMTP. В назначениях, не использующих протокол SMTP, также используются очереди доставки, если назначение обслуживается соединителем агента доставки. . Каждая очередь доставки содержит сообщения, которые направляются в одно назначение. Практически всегда на транспортном сервере имеется несколько очередей доставки. Очереди доставки динамически создаются при необходимости и автоматически удаляются, когда очередь пуста и оканчивается срок ее действия. Окончание срока действия очереди определяется параметром *QueueMaxIdleTime* командлета **Set-TransportService**. Значение по умолчанию — три минуты.

  - **Теневые очереди**. В теневых очередях хранятся избыточные копии сообщений во время их передачи. Подробнее см. в разделе [Теневая избыточность](shadow-redundancy-exchange-2013-help.md).

  - **Сеть безопасности**. В "страховочной сети" хранятся копии сообщений, успешно доставленных транспортным сервером. Хотя к сети безопасности нельзя получить доступ с помощью средств управления очередями, она является еще одной очередью в базе данных очередей. Подробнее см. в разделе [Система безопасности](safety-net-exchange-2013-help.md).

В начало

## Файлы базы данных очередей

Все очереди хранятся в одной базе данных ESE. По умолчанию эта база данных очередей расположена на транспортном сервере по адресу `%ExchangeInstallPath%TransportRoles\data\Queue`.

Как и любая другая база данных ESE, база данных очередей использует файлы журнала для принятия, отслеживания и поддержания данных. Для повышения производительности все транзакции с сообщениями записываются сначала в файлы журнала и в память, а только затем — в базу данных. Файл контрольных точек позволяет отслеживать записи в журнале транзакций, зафиксированные в базе данных. В процессе обычного завершения работы службы транспорта Microsoft Exchange, незафиксированные изменения базы данных, обнаруженные в журналах транзакций, всегда фиксируются в базе данных.

Для базы данных очередей используется циклическое ведение журнала. Это означает, что журнал зафиксированных транзакций, имеющихся в журналах транзакций, не ведется. Все журналы транзакций старше текущей контрольной точки немедленно удаляются автоматически. Таким образом, журналы транзакций невозможно воспроизвести для восстановления базы данных очередей из резервной копии.

В Exchange 2013 используются *таблицы создания* для хранения и очистки сообщений в базе данных очередей. Вместо обработки и удаления отдельных записей сообщений из одной большой таблицы, база данных очередей сохраняет сообщения в таблицах на основе времени и удаляет всю таблицу после успешной обработки всех содержащихся в ней сообщений. Например, все сообщения, сохраненные в очередях с 13:00 до 14:00, хранятся в таблице `1p-2p_msgs` вне зависимости от очереди или их назначения. В 14:00 новые сообщения сохраняются в таблице `2p-3p_msgs`. В 16:00 создается новая таблица с именем `4p-5p_msgs`; вся таблица `1p-2p_msgs` удаляется, но только после успешной обработки всех содержащихся в ней сообщений. Этот способ удаления всех таблиц сообщений вместо отдельных сообщений позволяет улучшить производительность операций ввода-вывода диска, на котором хранится база данных очередей.

В следующей таблице приведен список файлов, входящих в базу данных очередей.

### Файлы, входящие в базу данных очередей

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Файл</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Mail.que</p></td>
<td><p>Файл базы данных очередей, в котором хранятся все сообщения, помещенные в очередь.</p></td>
</tr>
<tr class="even">
<td><p>Tmp.edb</p></td>
<td><p>Временный файл базы данных очередей, который используется для проверки схемы базы данных очередей при запуске.</p></td>
</tr>
<tr class="odd">
<td><p>Trn*.log</p></td>
<td><p>Журнал транзакций, в котором регистрируются все изменения базы данных очередей. Изменения базы данных сначала записываются в журнал транзакций, и только после этого вносятся в саму базу данных. Trn.log — текущий активный файл журнала транзакций. Trntmp.log — следующий выделенный файл журнала транзакций, который создается заблаговременно. Если существующий файл журнала транзакций Trn.log достигает максимального размера, Trn.log переименовывается в Trn<em>nnnn</em>.log, где <em>nnnn</em> — порядковый номер. Затем Trntmp.log переименовывается в Trn.log и становится текущим активным файлом журнала транзакций.</p></td>
</tr>
<tr class="even">
<td><p>Trn.chk</p></td>
<td><p>Файл контрольных точек, позволяющий отслеживать записи в журнале транзакций, добавленные в базу данных. Этот файл всегда находится в том же каталоге, что и файл mail.que.</p></td>
</tr>
<tr class="odd">
<td><p>Trnres00001.jrs</p>
<p>Trnres00002.jrs</p></td>
<td><p>Резервные файлы журналов транзакций, выполняющие роль заполнителей. Они используются лишь для обеспечения правильной остановки работы базы данных очередей в ситуации, когда заканчивается место на жестком диске, на котором хранится журнал транзакций.</p></td>
</tr>
</tbody>
</table>


В начало

## Параметры настройки базы данных очередей

Базу данных очередей можно настроить путем добавления или изменения ключей в файле конфигурации XML-приложения `%ExchangeInstallPath%Bin\EdgeTransport.exe.config`. Этот файл связан с транспортной службой Microsoft Exchange. Изменения, которые вносятся в файл EdgeTransport.exe.config, вступают в силу после перезапуска транспортной службы Microsoft Exchange.

В разделе `<appSettings>` файла EdgeTransport.exe.config можно добавлять новые и изменять существующие ключи. Если определенный ключ не существует, вы можете добавить его вручную и изменить его значение.

Ключи для базы данных очередей, имеющиеся в файле EdgeTransport.exe.config, описаны в следующей таблице.

### Ключи базы данных очередей сообщений, имеющиеся в файле EdgeTransport.exe.config

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Клавиша</th>
<th>Значение по умолчанию</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>QueueDatabaseBatchSize</em></p></td>
<td><p>40</p></td>
<td><p>Этот ключ указывает число операций ввода-вывода для базы данных, которые можно сгруппировать перед выполнением. По умолчанию данного ключа нет в файле EdgeTransport.exe.config.</p></td>
</tr>
<tr class="even">
<td><p><em>QueueDatabaseBatchTimeout</em></p></td>
<td><p>100</p></td>
<td><p>Этот ключ указывает максимальное время (в миллисекундах), в течение которого база данных будет ожидать группировки нескольких операций ввода-вывода перед тем, как их выполнить. Операции ввода-вывода базы данных выполняются немедленно, если истинны следующие условия:</p>
<ul>
<li><p>Число операций ввода-вывода для базы данных, указанное в ключе <em>QueueDatabaseBatchSize</em>, не достигнуто.</p></li>
<li><p>Время, указанное в ключе <em>QueueDatabaseBatchTimeout</em>, истекло.</p></li>
</ul>
<p>По умолчанию данного ключа нет в файле EdgeTransport.exe.config.</p></td>
</tr>
<tr class="odd">
<td><p><em>QueueDatabaseMaxConnections</em></p></td>
<td><p>4</p></td>
<td><p>Этот ключ указывает максимальное допустимое число открытых подключений к базе данных ESE.</p></td>
</tr>
<tr class="even">
<td><p><em>QueueDatabaseLoggingBufferSize</em></p></td>
<td><p>5 МБ</p></td>
<td><p>Этот ключ указывает объем памяти, используемой для кэширования записей транзакций перед занесением в файл журнала транзакций.</p></td>
</tr>
<tr class="odd">
<td><p><em>QueueDatabaseLoggingFileSize</em></p></td>
<td><p>5 МБ</p></td>
<td><p>Этот ключ указывает максимальный размер файла журнала транзакций. Когда достигается максимальный размер, создается новый файл журнала.</p></td>
</tr>
<tr class="even">
<td><p><em>QueueDatabaseLoggingPath</em></p></td>
<td><p><code>%ExchangeInstallPath%TransportRoles\data\Queue</code></p></td>
<td><p>В этом ключе указывается каталог файлов журнала базы данных очередей, используемый по умолчанию. Инструкции по изменению расположения базы данных очередей см. в разделе <a href="change-the-location-of-the-queue-database-exchange-2013-help.md">Изменение расположения базы данных очереди</a>.</p></td>
</tr>
<tr class="odd">
<td><p><em>QueueDatabaseMaxBackgroundCleanupTasks</em></p></td>
<td><p>32</p></td>
<td><p>Этот ключ определяет максимальное число элементов фонового процесса очистки, которые могут в любой момент времени быть помещены в очередь в пул потоков ядра СУБД.</p></td>
</tr>
<tr class="even">
<td><p><em>QueueDatabaseOnlineDefragEnabled</em></p></td>
<td><p>Истина</p></td>
<td><p>Этот ключ позволяет включить или отключить расписание оперативной дефрагментации базы данных очередей сообщений. По умолчанию данного ключа нет в файле EdgeTransport.exe.config.</p></td>
</tr>
<tr class="odd">
<td><p><em>QueueDatabaseOnlineDefragSchedule</em></p></td>
<td><p><code>1:00:00</code> или 13:00</p></td>
<td><p>Этот ключ указывает время запуска оперативной дефрагментации базы данных очередей сообщений в 24-часовом формате. Указываемое значение должно вводиться как интервал времени: <em>чч:мм:сс</em>, где <em>ч</em> — часы, <em>м</em> — минуты, а <em>с</em> — секунды.</p></td>
</tr>
<tr class="even">
<td><p><em>QueueDatabaseOnlineDefragTimeToRun</em></p></td>
<td><p><code>3:00:00</code> или 3 часа</p></td>
<td><p>Этот ключ указывает период времени, в течение которого может работать задача оперативной дефрагментации. Даже если дефрагментация не была завершена за указанное время, база данных сохраняется в согласованном состоянии. Указываемое значение должно вводиться как интервал времени: <em>чч:мм:сс</em>, где <em>ч</em> — часы, <em>м</em> — минуты, а <em>с</em> — секунды.</p></td>
</tr>
<tr class="odd">
<td><p><em>QueueDatabasePath</em></p></td>
<td><p><code>%ExchangeInstallPath%TransportRoles\data\Queue</code></p></td>
<td><p>Этот ключ указывает каталог файлов базы данных очередей, используемый по умолчанию. Инструкции по изменению расположения базы данных очередей см. в разделе <a href="change-the-location-of-the-queue-database-exchange-2013-help.md">Изменение расположения базы данных очереди</a>.</p></td>
</tr>
</tbody>
</table>


<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Все специальные настройки, выполненные для каждого сервера в XML-файлах конфигурации приложения Exchange, например в файлах web.config на серверах клиентского доступа или файлах EdgeTransport.exe.config на серверах почтовых ящиков, будут перезаписаны после установки накопительного пакета обновления Exchange. Обязательно сохраните нужные данные, чтобы упростить перенастройку сервера после установки. Эти параметры необходимо перенастроить после установки накопительного пакета обновления Exchange.</td>
</tr>
</tbody>
</table>


В начало

## Свойства очереди

Очередь имеет ряд свойств, описывающих ее цель и состояние. Некоторые свойства очереди применяются к ней при создании и не изменяются впоследствии. Другие свойства содержат сведения о состояния, размере, времени или другие индикаторы, которые часто обновляются.

В начало

## NextHopSolutionKey

Компонент маршрутизации классификатора в транспортной службе Microsoft Exchange выбирает назначение для сообщения, и это назначение используется для создания очереди доставки. Назначение отмечается на каждом получателе в качестве атрибута **NextHopSolutionKey**. Каждое уникальное значение **NextHopSolutionKey** соответствует отдельной очереди доставки.

Атрибут **NextHopSolutionKey** содержит следующие поля:

  - **DeliveryType**. Значение данного поля представляет собой результаты классификации сообщения, а также способ передачи сообщения транспортной службой до следующего прыжка, который может являться конечным назначением сообщения или промежуточным прыжком во время его передачи. В транспортной службе используется предопределенный список значений для **DeliveryType** на основе целевого назначения маршрутизации или группы доставки.

  - **NextHopDomain**. В этом поле используются определенные значения на основе значения поля **DeliveryType**. Что касается очередей доставки, значение данного поля указывает на имя очереди. Значение свойства **NextHopDomain** — не всегда имя домена. Например, это значение может быть именем целевого сайта Active Directory или группы обеспечения доступности баз данных. Рассматривайте это поле как имя следующего прыжка, причем значение поля является именем назначения маршрутизации целевой группы доставки.

  - **NextHopConnector**. В этом поле используются определенные значения на основе значения поля **DeliveryType**. Его значение всегда выражается как GUID. Если это поле не используется, его значение — GUID из одних нолей. Значение свойства **NextHopConnector** — не всегда GUID соединителя. Например, это значение может быть GUID целевого сайта Active Directory или группы обеспечения доступности баз данных. Рассматривайте это поле как GUID следующего прыжка, причем значение поля является GUID назначения маршрутизации целевой группы доставки.

В Exchange 2013 к очереди также добавляется свойство **NextHopCategory** на основе значения поля **DeliveryType**. Значение свойства **NextHopCategory** — `External` или `Internal`. Значение `External` указывает на то, что следующий прыжок очереди выходит за пределы организации Exchange. Значение `Internal` указывает на то, что следующий прыжок очереди остается в пределах организации Exchange. Обратите внимание, что для доставки сообщения для внешнего получателя во внешнюю систему может потребоваться один или несколько внутренних прыжков.

Значения свойств **DeliveryType**, **NextHopCategory**, **NextHopDomain** и **NextHopConnector** описаны в следующей таблице.


<table style="width:100%;">
<colgroup>
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 16%" />
</colgroup>
<thead>
<tr class="header">
<th>Свойство Delivery Type в средстве просмотра очереди</th>
<th>Свойство DeliveryType в командной консоли</th>
<th>Описание</th>
<th>NextHopCategory</th>
<th>NextHopDomain</th>
<th>NextHopConnector</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>Агент доставки</strong></p></td>
<td><p><strong>DeliveryAgent</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки получателям в адресном пространстве, не использующим протокол SMTP. Сообщения доставляются с помощью соединителя агента доставки, настроенного на локальном сервере.</p></td>
<td><p>External</p></td>
<td><p>Это значение — целевое адресное пространство, настроенное на соединителе агента доставки.</p></td>
<td><p>Это значение является GUID соединителя агента доставки. Например, <code>4520e633-d83d-411a-bbe4-6a84648674ee</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>DnsConnectorDelivery</strong></p></td>
<td><p><strong>DnsConnectorDelivery</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки получателям в адресном пространстве, использующим протокол SMTP. Сообщения доставляются с помощью соединителя отправки, настроенного на локальном сервере. Соединитель отправки настроен на использование маршрутизации DNS.</p></td>
<td><p>External</p></td>
<td><p>Это значение — целевое адресное пространство, настроенное на соединителе отправки. Например, <code>contoso.com</code>.</p></td>
<td><p>Это значение является GUID соединителя отправки. Например, <code>4520e633-d83d-411a-bbe4-6a84648674ee</code>.</p></td>
</tr>
<tr class="odd">
<td><p><strong>NonSmtpGatewayDelivery</strong></p></td>
<td><p><strong>NonSmtpGatewayDelivery</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки получателям в адресном пространстве, не использующим протокол SMTP. Сообщения доставляются с помощью внешнего соединителя, настроенного на локальном сервере.</p></td>
<td><p>External</p></td>
<td><p>Это значение — целевое адресное пространство, настроенное на внешнем соединителе.</p></td>
<td><p>Это значение является GUID внешнего соединителя. Например, <code>4520e633-d83d-411a-bbe4-6a84648674ee</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>SmartHostConnectorDelivery</strong></p></td>
<td><p><strong>SmartHostConnectorDelivery</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки получателям в адресном пространстве, использующим протокол SMTP. Сообщения доставляются с помощью соединителя отправки, настроенного на локальном сервере. Соединитель отправки настроен на использование маршрутизации на промежуточные узлы.</p></td>
<td><p>External</p></td>
<td><p>Это значение является списком промежуточных узлов, настроенных на соединителе отправки. Промежуточные узлы можно настроить в качестве полных доменных имен и/или IP-адресов. Значения могут являться одним из следующих элементов.</p>
<ul>
<li><p><strong>Полное доменное имя</strong>. Используемый синтаксис — <code>&lt;FQDN1,FQDN2,...&gt;</code>, например <code>smarthost01.contoso.com</code> или <code>smarthost01.contoso.com,smarthost02.fabrikam.com</code>.</p></li>
<li><p><strong>IP-адрес</strong>. Используемый синтаксис — <code>&lt;[IPAddress1],[IPAddress2],...&gt;</code>, например <code>[10.10.10.100]</code> или <code>[10.10.10.100],[10.10.10.101]</code>.</p></li>
<li><p><strong>Полное доменное имя и IP-адрес</strong>. Используется синтаксис <code>&lt;[IPAddress1],FQDN1,...&gt;</code>, который зависит от способа перечисления промежуточных узлов на соединителе отправки, например <code>[172.17.17.7],relay.tailspintoys.com</code> или <code>mail.contoso.com,[192.168.1.50]</code>.</p></li>
</ul></td>
<td><p>Это значение является GUID соединителя отправки. Например, <code>4520e633-d83d-411a-bbe4-6a84648674ee</code>.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Доставка в почтовый ящик по протоколу SMTP</strong></p></td>
<td><p><strong>SmtpDeliveryToMailbox</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки в почтовые ящики Exchange 2013 получателей. Целевая база данных почтовых ящиков находится в одном из следующих расположений:</p>
<ul>
<li><p>локальный сервер почтовых ящиков Exchange 2013;</p></li>
<li><p>сервер почтовых ящиков Exchange 2013 в той же группе обеспечения доступности баз данных;</p></li>
<li><p>сервер почтовых ящиков Exchange 2013 на том же сайте Active Directory в среде, отличной от группы обеспечения доступности баз данных.</p></li>
</ul></td>
<td><p>Internal</p></td>
<td><p>Это значение является именем целевой базы данных почтовых ящиков. Например, <code>Mailbox Database 0471695037</code>.</p></td>
<td><p>Это значение является GUID целевой базы данных почтовых ящиков. Например, <code>6dcb5a1e-0a88-4fc9-b8f9-634c34b1a123</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>Ретрансляция SMTP на исходные серверы соединителя отправки</strong></p></td>
<td><p><strong>SmtpRelayToConnectorSourceServers</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки получателям, как использующим, так и не использующим протокол SMTP. Сообщения доставляются с использованием соединителя отправки, соединителя агента доставки или внешнего соединителя, настроенного на удаленном транспортном сервере. Удаленным транспортным сервером может быть сервер почтовых ящиков Exchange 2013 или Exchange 2007 либо транспортный сервер-концентратор Exchange 2010 из предыдущей версии Exchange. Удаленный сервер может располагаться на локальном или удаленном сайте Active Directory.</p></td>
<td><p>Internal</p></td>
<td><p>Это значение является именем целевого соединителя отправки, соединителя агента доставки или внешнего соединителя. Например, <code>Contoso.com Send Connector</code>.</p></td>
<td><p>Это значение является GUID целевого соединителя отправки, соединителя агента доставки или внешнего соединителя. Например, <code>4520e633-d83d-411a-bbe4-6a84648674ee</code>.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Ретрансляция SMTP на группу обеспечения доступности баз данных</strong></p></td>
<td><p><strong>SmtpRelayToDag</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки в почтовые ящики Exchange 2013 получателей, причем целевая база данных почтовых ящиков расположена в удаленной группе обеспечения доступности баз данных. Удаленная группа обеспечения доступности баз данных может располагаться на локальном или удаленном сайте Active Directory.</p></td>
<td><p>Internal</p></td>
<td><p>Это значение является именем целевой группы обеспечения доступности баз данных. Например, <code>DAG1</code>.</p></td>
<td><p>Это значение является GUID целевой группы обеспечения доступности баз данных. Например, <code>6dcb5a1e-0a88-4fc9-b8f9-634c34b1a123</code></p></td>
</tr>
<tr class="even">
<td><p><strong>Ретрансляция SMTP на группу доставки в почтовый ящик</strong></p></td>
<td><p><strong>SmtpRelayToMailboxDeliveryGroup</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки в почтовые ящики прежних версий получателей, причем целевой почтовый ящик находится на сервере почтовых ящиков Exchange 2007 или Exchange 2010. Сообщение связывается с транспортным сервером-концентратором, работающим под управлением той же версии Exchange, что и целевой почтовый ящик. Целевой транспортный сервер-концентратор может располагаться на локальном или удаленном сайте Active Directory.</p></td>
<td><p>Internal</p></td>
<td><p>В имени очереди используется следующий синтаксис: <code>Site:&lt;ADSiteName&gt;;Version:&lt;ExchangeVersion&gt;</code>, где <em>&lt;AdSiteName&gt;</em> — это имя целевого сайта Active Directory, а <em>&lt;ExchangeVersion&gt;</em> — версия Exchange на сервере почтовых ящиков.</p></td>
<td><p>Это значение пустое.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Ретрансляция SMTP на удаленный сайт Active Directory</strong></p></td>
<td><p><strong>SmtpRelayToRemoteActiveDirectorySite</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки на удаленное назначение, а топология маршрутизации требует, чтобы сообщение направлялось через определенный сайт Active Directory. Сайт является промежуточным прыжком на пути в конечное назначение. Эта ситуация происходит в следующих случаях:</p>
<ul>
<li><p>сообщение необходимо направить через сайт концентратора;</p></li>
<li><p>сообщение необходимо доставить через соединитель отправки, настроенный на пограничном транспортном сервере, который подписан на удаленный сайт Active Directory.</p></li>
</ul></td>
<td><p>Internal</p></td>
<td><p>Это значение является целевым именем сайта Active Directory. Например, <code>NorthAmericanSite</code>.</p></td>
<td><p>Это значение является GUID целевого сайта Active Directory. Например, <code>bfd6c3df-5b65-8bfb-53f1f2c0d55c</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>Ретрансляция SMTP на указанные серверы Exchange Server</strong></p></td>
<td><p><strong>SmtpRelayToServers</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки в группу рассылки, настроенную для определенного сервера развертывания. Сервер развертывания может быть сервером почтовых ящиков Exchange 2013 или транспортным сервером-концентратором Exchange 2007 либо Exchange 2010. Сервер может располагаться на локальном или удаленном сайте Active Directory.</p></td>
<td><p>Internal</p></td>
<td><p>Это значение является полным доменным именем целевого сервера развертывания. Например, <code>mailbox01.contoso.com</code>.</p></td>
<td><p>Это значение — <code>00000000-0000-0000-0000-000000000000</code>.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Ретрансляция SMTP из сайта Active Directory на пограничный транспортный сервер</strong></p></td>
<td><p><strong>SmtpRelayWithinAdSiteToEdge</strong></p></td>
<td><p>В очереди хранятся сообщения для доставки в адресное пространство, использующее протокол SMTP. Сообщения доставляются с использованием соединителя отправки, настроенного на пограничном транспортном сервере, который подписан на локальный сайт Active Directory.</p></td>
<td><p>Internal</p></td>
<td><p>Это значение является именем соединителя отправки, который отвечает за отправку исходящей почты Интернета из организации в Интернет. Этот соединитель отправки автоматически создается пограничной подпиской и имеет имя <code>EdgeSync - &lt;ADSiteName&gt; to Internet</code>. <em>&lt;ADSiteName&gt;</em> — это имя локального сайта Active Directory, на который подписан транспортный сервер-концентратор.</p></td>
<td><p>Это значение является GUID соединителя отправки. Например, <code>4520e633-d83d-411a-bbe4-6a84648674ee</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>Пульс</strong></p></td>
<td><p><strong>Пульс</strong></p></td>
<td><p>Это значение зарезервировано для внутреннего использования корпорацией Майкрософт. Дополнительные сведения о пульсе см. в разделе <a href="shadow-redundancy-exchange-2013-help.md">Теневая избыточность</a>.</p></td>
<td><p>не применимо</p></td>
<td><p>Неприменимо</p></td>
<td><p>Неприменимо</p></td>
</tr>
<tr class="odd">
<td><p><strong>Теневая избыточность</strong></p></td>
<td><p><strong>ShadowRedundancy</strong></p></td>
<td><p>Сообщения хранятся в теневой очереди. В теневой очереди хранятся избыточные копии передаваемых сообщений на случай неуспешной доставки основных сообщений. Подробнее см. в разделе <a href="shadow-redundancy-exchange-2013-help.md">Теневая избыточность</a>.</p></td>
<td><p>Internal</p></td>
<td><p>Это значение является полным доменным именем сервера-источника, для которого в теневой очереди хранятся избыточные копии основных сообщений. Например, <code>mailbox01.contoso.com</code>.</p></td>
<td><p>Это значение — <code>00000000-0000-0000-0000-000000000000</code>.</p></td>
</tr>
<tr class="even">
<td><p><strong>Не определено</strong></p></td>
<td><p><strong>Не определено</strong></p></td>
<td><p>Это значение используется только для очередей передачи и подозрительных сообщений.</p></td>
<td><p>Internal</p></td>
<td><p>Для очереди передачи используется значение <code>Submisssion</code>. Для очереди подозрительных сообщений используется значение <code>Poison Message</code>.</p></td>
<td><p>Это значение — <code>00000000-0000-0000-0000-000000000000</code>.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Не доставлено</strong></p></td>
<td><p><strong>Недостижимость</strong></p></td>
<td><p>Это значение используется только для очереди недоставленных сообщений.</p></td>
<td><p>Internal</p></td>
<td><p>Это значение — <code>Unreachable Domain</code>.</p></td>
<td><p>Это значение — <code>00000000-0000-0000-0000-000000000000</code>.</p></td>
</tr>
</tbody>
</table>


Обратите внимание, что Exchange 2013 поддерживает устаревшие значения свойства **DeliveryType** для обратной совместимости с предыдущими версиями Exchange. Эти значения доступны в средстве просмотра очереди и командной консоли, но не используются службой Exchange 2013. Эти устаревшие значения **DeliveryType** приведены ниже.

  - **MapiDelivery**. В очереди хранятся сообщения для доставки транспортным сервером-концентратором Exchange 2007 или Exchange 2010 в почтовый ящик на сервере почтовых ящиков Exchange 2007 или Exchange 2010 на локальном сайте Active Directory.

  - **SmtpRelayWithinAdSite**. В очереди хранятся сообщения для доставки транспортным сервером-концентратором Exchange 2007 или Exchange 2010 на другой транспортный сервер-концентратор на том же сайте Active Directory. Целевой транспортный сервер-концентратор может быть исходным сервером для соединителя или сервером развертывания группы рассылки.

  - **SmtpRelaytoTiRg**. В очереди хранятся сообщения для доставки транспортным сервером-концентратором Exchange 2007 или Exchange 2010 в группу маршрутизации Exchange Server 2003. Целевой сервер может быть исходным сервером для соединителя, сервером развертывания группы рассылки или сервером-плацдармом Exchange 2003.

В начало

## IncomingRate, OutgoingRate и Velocity

Exchange 2013 измеряет скорость поступления сообщений в очередь и выхода из нее, а также сохраняет эти значения в свойствах очереди. Эти значения скорости можно использовать в качестве индикатора состояния очереди и транспортного сервера. Используются следующие свойства.

  - **IncomingRate**. Это свойство обозначает скорость поступления сообщений в очередь.
    
    Это значение подсчитывается на основе количества сообщений, которые поступают в очередь каждые 5 секунд с усреднением за последние 60 секунд. Формула может выражаться как `(i1+i2+i3+i4+i5+i6)/6`, где i*n* — количество входящих сообщений за 5 секунд.

  - **OutgoingRate**. Это свойство обозначает скорость выхода сообщений из очереди.
    
    Это значение подсчитывается на основе количества сообщений, которые покидают очередь каждые 5 секунд с усреднением за последние 60 секунд. Формула может выражаться как `(o1+o2+o3+o4+o5+o6)/6`, где o*n* — количество исходящих сообщений за 5 секунд.

  - **Velocity**. Это свойство обозначает скорость очистки очереди и подсчитывается путем вычитания значения **IncomingRate** из значения **OutgoingRate**.
    
    Если значение свойства **Velocity** больше 0, сообщения покидают очередь быстрее, чем поступают в нее.
    
    Если значение свойства **Velocity** равно 0, сообщения покидают очередь с такой же скоростью, что и поступают в нее. Это значение также отображается, если очередь неактивна.
    
    Если значение свойства **Velocity** меньше 0, сообщения поступают в очередь быстрее, чем покидают ее.

На базовом уровне положительное значение свойства **Velocity** указывает на работоспособную очередь, которая быстро опустошается, а отрицательное значение свойства **Velocity** указывает на то, что очередь опустошается недостаточно эффективно. Однако также необходимо учитывать значения свойств **IncomingRate**, **OutgoingRate** и **MessageCount**, а также величину значения **Velocity** для очереди. Например, высокое отрицательное значение свойства **Velocity**, высокое значение свойства **MessageCount**, низкое значение свойства **OutgoingRate** и высокое значение свойства **IncominRate** — точные индикаторы того, что очередь не опустошается надлежащим образом. Однако отрицательное значение свойства **Velocity**, очень близкое к нулю, в сочетании с очень низкими значениями свойств **IncomingRate**, **OutgoingRate** и **MessageCount** указывает на отсутствие проблем с очередью.

В начало

## Состояние очереди

Текущее состояние очереди хранится в ее свойстве **Status**. Очередь может находиться в одном из следующих состояний.

  - **Активно**.   Очередь активно передает сообщения.

  - **Установка связи**.   Очередь находится в процессе подключения к следующему прыжку.

  - **Готово**.   Очередь недавно передала сообщения, но в настоящее время пуста.

  - **Повторить**.   Последняя попытка автоматического или ручного подключения закончилась неудачей, и очередь ожидает повторного подключения.

  - **Приостановлено**. Администратор вручную приостановил очередь, чтобы запретить доставку сообщений. Новые сообщения могут поступать в очередь, а сообщения, которые как раз передаются к следующему прыжку, будут успешно доставлены и покинут очередь. В противном случае сообщения не покинут очередь, пока администратор не возобновит ее вручную. Обратите внимание, что приостановка очереди не приводит к изменению состояния отдельных сообщений, находящихся в ней.
    
    Можно приостановить очередь, которая имеет состояние "Active" или "Retry". Можно также приостановить недоступную очередь и очередь передачи.
    
    Если вы приостановите очередь недоставленных сообщений, сообщения не будут автоматически повторно отправляться на классификатор при обнаружении обновлений конфигурации. Чтобы повторно автоматически отправить эти сообщения, необходимо вручную возобновить очередь недоставленных сообщений. При приостановке очереди передачи сообщения не будут забираться классификатором до возобновления этой очереди.

В начало

## Другие свойства очереди

Существуют другие свойства очереди, значения которых очевидны. Большинство этих свойств очереди используются в качестве параметров фильтрации. Указав условия фильтрации, можно быстро находить очереди и выполнять над ними различные действия. Полное описание свойств очереди, связанных с фильтрацией, см. в разделе [Фильтры очередей](queue-filters-exchange-2013-help.md).

Важное свойство очереди, которое следует упомянуть в этом разделе, — **MessageCount**, отвечающее за отображение количества сообщений в очереди. Это свойство является важным индикатором состояния очереди. Например, очередь доставки, содержащая большое количество сообщений, которое продолжает расти и совсем не уменьшается, может указывать на проблему с маршрутизацией или транспортным конвейером, на которую следует обратить внимание.

В начало

## Свойства сообщения

Сообщение в очереди имеет ряд свойств. Многие свойства отображают сведения, которые использовались для создания сообщения. На некоторые свойства состояния сообщений и сведений о них в значительной мере влияют соответствующие свойства очереди. Однако отдельное сообщение может иметь значение, которое отличается от соответствующего свойства очереди. Другие свойства содержат сведения о состояния, времени или другие индикаторы, которые часто обновляются.

В начало

## Состояние сообщения

Текущее состояние сообщения хранится в его свойстве **Status**. Сообщение может иметь одно из следующих состояний:

  - **Активно**. Если сообщение находится в очереди доставки, выполняется доставка сообщения в его место назначения. Если сообщение находится в очереди отправки, сообщение обрабатывается классификатором.

  - **Locked**. Это значение зарезервировано для внутреннего использования корпорацией Майкрософт и не используется в локальных организациях Exchange.

  - **PendingRemove**. Сообщение удалено администратором, но как раз передавалось к следующему прыжку. Сообщение будет удалено, если доставка завершится ошибкой, вызывающей повторную постановку сообщения в очередь. В противном случае доставка будет продолжена.

  - **PendingSuspend**. Сообщение приостановлено администратором, но как раз передавалось к следующему прыжку. Сообщение будет приостановлено, если доставка завершится ошибкой, вызывающей повторную постановку сообщения в очередь. В противном случае доставка будет продолжена.

  - **Ready (готово)**. Сообщение находится в очереди и готово к обработке.

  - **Retry**. Последняя попытка автоматического или ручного подключения для очереди, в которой находится это сообщение, закончилась неудачей. Сообщение ожидает следующей попытки автоматического подключения для очереди.

  - **Suspended**. Администратор вручную приостановил сообщение. Все сообщения в очереди подозрительных сообщений находятся в окончательно приостановленном состоянии.

В начало

## Другие свойства сообщений

Существуют другие свойства сообщений, значения которых очевидны. Большинство этих свойств сообщений можно использовать в качестве параметров фильтрации. Указывая условия отбора, можно быстро находить сообщения и выполнять действия над ними. Полное описание свойств сообщений, связанных с фильтрацией, см. в разделе [Фильтры сообщений](message-filters-exchange-2013-help.md).

В начало

## Управление очередями и находящимися в них сообщениями

Средство просмотра очереди и практически все командлеты, используемые для управления очередями и сообщениями, ограничены одним сервером Exchange. Можно просматривать или обрабатывать отдельные очереди или сообщения либо несколько очередей или сообщений, но только на определенном сервере.

В Exchange 2013 представлен командлет **Get-QueueDigest**, который обеспечивает высокоуровневое сводное представление состояния очередей на всех серверах в определенной области, например в группе обеспечения доступности баз данных, на сайте Active Directory, в списке серверов или во всем лесу Active Directory. Обратите внимание, что очереди на подписанном пограничном транспортном сервере в сети периметра не включаются в результаты. Кроме того, командлет **Get-QueueDigest** доступен на пограничном транспортном сервере, но результаты ограничены очередями на данном сервере.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>По умолчанию командлет <strong>Get-QueueDigest</strong> отображает очереди доставки, включающие не менее десяти сообщений. Давность результатов составляет от одной до двух минут. Инструкции по смене этих значений по умолчанию приведены в статье <a href="configure-get-queuedigest-exchange-2013-help.md">Настройка Get-QueueDigest</a>.</td>
</tr>
</tbody>
</table>


В следующей таблице описаны задачи управления, которые можно выполнять для очередей или сообщений, находящихся в них.


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Задача</th>
<th>Описание</th>
<th>Используемое средство</th>
<th>Инструкции</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Просмотр и фильтрация очередей на сервере</p></td>
<td><p>Это действие отображает одну или несколько очередей на транспортном сервере. Его результаты можно использовать для применения действий по отношению к очередям.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Get-Queue</strong>.</p></td>
<td><p><a href="manage-queues-exchange-2013-help.md">Управление очередями</a></p></td>
</tr>
<tr class="even">
<td><p>Просмотр и фильтрация очередей на указанных серверах в конкретных группах обеспечения доступности баз данных, на определенных сайтах Active Directory или в целом лесу Active Directory.</p></td>
<td><p>Это действие отображает сводное представление очередей в определенной области (серверы, группы обеспечения доступности баз данных, сайты Active Directory или весь лес Active Directory).</p></td>
<td><p>Только командлет <strong>Get-QueueDigest</strong></p></td>
<td><p><a href="manage-queues-exchange-2013-help.md">Управление очередями</a></p></td>
</tr>
<tr class="odd">
<td><p>Приостановка очередей</p></td>
<td><p>Это действие временно запрещает доставку сообщений, находящихся в очереди. Новые сообщения продолжают поступать в очередь, но ни одно сообщение не может ее покинуть.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Suspend-Queue</strong>.</p></td>
<td><p><a href="manage-queues-exchange-2013-help.md">Управление очередями</a></p></td>
</tr>
<tr class="even">
<td><p>Возобновление очередей</p></td>
<td><p>Это действие отменяет приостановку очереди и разрешает доставку сообщений, находящихся в ней.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Resume-Queue</strong>.</p></td>
<td><p><a href="manage-queues-exchange-2013-help.md">Управление очередями</a></p></td>
</tr>
<tr class="odd">
<td><p>Повтор очередей</p></td>
<td><p>Этой действие позволяет немедленно выполнить попытку подключения к следующему прыжку. Без ручного вмешательства, если не удается выполнить подключение к следующему прыжку, попытка подключения выполняется указанное количество раз через определенные интервалы времени между каждой попыткой.</p>
<p>Вне зависимости от того, как выполняется подключение (вручную или автоматически), любая попытка подключения приводит к сбросу времени следующей попытки. Подробнее см. в разделе <a href="message-retry-resubmit-and-expiration-intervals-exchange-2013-help.md">Интервалы повторной отправки, повторной передачи и истечения срока действия сообщений</a>.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Retry-Queue</strong>.</p></td>
<td><p><a href="manage-queues-exchange-2013-help.md">Управление очередями</a></p></td>
</tr>
<tr class="even">
<td><p>Повторная отправка сообщений, находящихся в очередях</p></td>
<td><p>Это действие позволяет заново отправить сообщения в очереди в очередь отправки и вернуться к процессу классификации.</p></td>
<td><p>Командлет <strong>Retry-Queue</strong> с параметром <em>Resubmit</em></p>
<p>Обратите внимание, что для повторной отправки сообщений можно использовать средство просмотра очереди, но только для очереди подозрительных сообщений. Чтобы повторно отправить сообщение из очереди подозрительных сообщений, его необходимо возобновить в средстве просмотра очереди или с помощью командлета <strong>Resume-Message</strong>.</p></td>
<td><p><a href="manage-queues-exchange-2013-help.md">Управление очередями</a></p></td>
</tr>
<tr class="odd">
<td><p>Приостановка сообщений, находящихся в очередях</p></td>
<td><p>Это действие временно приостанавливает доставку сообщения. Действие приостановки сообщения можно использовать для предотвращения доставки сообщения всем адресатам отдельной очереди или всем адресатам во всех очередях.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Suspend-Message</strong>.</p></td>
<td><p><a href="manage-messages-in-queues-exchange-2013-help.md">Управление сообщениями в очередях</a></p></td>
</tr>
<tr class="even">
<td><p>Возобновление доставки сообщений, находящихся в очередях</p></td>
<td><p>Это действие отменяет приостановку доставки сообщений и возобновляет доставку сообщений, находящихся в очереди. Действие возобновления сообщения можно использовать для возобновления доставки сообщения всем адресатам отдельной очереди или всем адресатам во всех очередях.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Resume-Message</strong>.</p></td>
<td><p><a href="manage-messages-in-queues-exchange-2013-help.md">Управление сообщениями в очередях</a></p></td>
</tr>
<tr class="odd">
<td><p>Удаление сообщений из очередей</p></td>
<td><p>Это действие делает доставку сообщения невозможной. Действие удаления сообщения можно использовать для предотвращения доставки сообщения всем адресатам отдельной очереди или всем адресатам во всех очередях. Также в этом действии имеется возможность послать отчет о недоставке отправителю сообщения при его удалении.</p></td>
<td><p>Средство просмотра очереди или командлет <strong>Remove-Message</strong>.</p></td>
<td><p><a href="manage-messages-in-queues-exchange-2013-help.md">Управление сообщениями в очередях</a></p></td>
</tr>
<tr class="even">
<td><p>Экспорт сообщений из очередей</p></td>
<td><p>Это действие копирует сообщение по указанному пути к файлу. Сообщения не удаляются из очереди, но их копии сохраняются в указанном месте. Впоследствии это позволяет администраторам или должностным лицам предприятия подробно изучить корреспонденцию. Перед экспортом сообщения необходимо приостановить сообщение в очереди, чтобы обычная доставка не продолжалась во время экспорта.</p></td>
<td><p>Только командлет <strong>Export-Message</strong>.</p></td>
<td><p><a href="export-messages-from-queues-exchange-2013-help.md">Экспорт сообщений из очередей</a></p></td>
</tr>
</tbody>
</table>


В начало

