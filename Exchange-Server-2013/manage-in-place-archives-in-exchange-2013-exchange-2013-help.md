---
title: 'Управление архивами на месте в Exchange 2013: Exchange 2013 Help'
TOCTitle: Управление архивами на месте в Exchange 2013
ms:assetid: 49ef4a3e-d209-4fb2-80a3-6132b0f69bd0
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ651146(v=EXCHG.150)
ms:contentKeyID: 50487987
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Управление архивами на месте в Exchange 2013

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2016-02-01_

Архивация на месте помогает обеспечить контроль над данными системы обмена сообщениями в организации путем исключения необходимости в личных хранилищах сертификатов (PST) и позволяет удовлетворить требования организации к хранению сообщений и обнаружению электронных данных. При включении функции архивации пользователи могут хранить сообщения в архивном почтовом ящике, доступном с помощью МайкрософтOutlook и Outlook Web App.

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения каждой процедуры: 5 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье запись "Личный архив" в разделе [Политика обмена сообщениями и разрешения для соответствия требованиям](messaging-policy-and-compliance-permissions-exchange-2013-help.md).

  - Основной почтовый ящик пользователя не может располагаться в Exchange, версия которого ниже версии архива пользователя. Если основной почтовый ящик пользователя по-прежнему расположен в Exchange 2010, необходимо переместить его в Exchange 2013 одновременно с перемещением архива в Exchange 2013.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.


## Что необходимо сделать?

## Создание почтового ящика и включение локального архива

## Использование Центра администрирования Exchange

1.  Последовательно выберите пункты **Получатели** \> **Почтовые ящики**.

2.  Нажмите кнопку **Создать** \> **Почтовый ящик пользователя**.

3.  На странице **Создание почтового ящика пользователя** в поле **Псевдоним** введите псевдоним пользователя.
    
    > [!NOTE]  
    > Если оставить это поле пустым, то в качестве псевдонима пользователя будет использовано значение поля <strong>Имя пользователя для входа</strong>.


4.  Для этого выберите один из приведенных ниже вариантов.
    
      - **Существующий пользователь**   Нажмите эту кнопку, а затем — кнопку **Обзор**, чтобы открыть диалоговое окно **Выбор пользователя — весь лес**. В данном диалоговом окне отображается список учетных записей тех пользователей Active Directory в данном лесу, для которых не была включена поддержка почты или которые не имеют почтовых ящиков Exchange. Выберите учетную запись пользователя, для которой необходимо включить поддержку почты, а затем нажмите кнопку **ОК**. При выборе этой опции не требуется указывать данные учетной записи пользователя, потому что они уже присутствуют в Active Directory.
    
      - **Создать пользователя**   Нажмите эту кнопку, чтобы создать новую учетную запись пользователя в Active Directory, а также создать почтовый ящик для этого пользователя. В случае выбора этой опции необходимо указать необходимые данные учетной записи пользователя.
    
    > [!NOTE]  
    > Учетная запись Active Directory, связанная с почтовыми ящиками пользователя, должна находиться в том же лесу, что и сервер Exchange. Чтобы создать почтовый ящик для учетной записи пользователя, хранящейся в доверенном лесу, необходимо создать связанный почтовый ящик. Дополнительные сведения см. в статье <a href="manage-linked-mailboxes-exchange-2013-help.md">Управление связанными почтовыми ящиками</a>.


5.  Чтобы настроить следующие параметры, нажмите кнопку **Дополнительные параметры**.
    
      - **База данных почтовых ящиков**   Нажмите кнопку **Обзор**, чтобы выбрать базу данных почтовых ящиков, в которой необходимо сохранить почтовый ящик. Если не выбрать базу данных, Exchange автоматически ее назначит.
    
      - **Архив**   Установите этот флажок, чтобы создать архивный почтовый ящик для почтового ящика. При создании архивного почтового ящика элементы автоматически перемещаются из основного почтового ящика в архивный на основе параметров политики хранения по умолчанию или на основе параметров, указанных пользователем.
        
        Нажмите кнопку **Обзор**, чтобы выбрать базу данных, расположенную в локальном лесу, для хранения архивного почтового ящика.
        
        Дополнительные сведения см. в статье [Архивация на месте в Exchange 2013](in-place-archiving-in-exchange-2013-exchange-2013-help.md).
    
      - **Политика адресных книг**   В этом списке можно выбрать политику адресных книг для почтового ящика. Политики адресных книг содержат глобальный список адресов, автономную адресную книгу, список помещений и набор списков адресов. Политика адресных книг предоставляет пользователям почтовых ящиков, которым она назначается, доступ к настраиваемому глобальному списку адресов в Outlook и Outlook Web App. Дополнительные сведения см. в статье [Политики адресных книг](https://docs.microsoft.com/ru-ru/exchange/address-books/address-book-policies/address-book-policies).

6.  По завершении нажмите кнопку **Сохранить**, чтобы создать почтовый ящик.

## Использование командной консоли

В этом примере показано, как в Active Directory создать пользователя с именем Григорий Верный, а также создать почтовый ящик в базе данных почтовых ящиков DB01 и включить архив. При следующем входе необходимо сбросить пароль. Чтобы задать значение исходного пароля в этом примере создается переменная ($password), появляется запрос на ввод пароля, а затем этот пароль назначается переменной как объект SecureString.

    $password = Read-Host "Enter password" -AsSecureString
    New-Mailbox -UserPrincipalName chris@contoso.com -Alias chris -Archive -Database "DB01" -Name ChrisAshton -OrganizationalUnit Users -Password $password -FirstName Chris -LastName Ashton -DisplayName "Chris Ashton" 

Подробные сведения о синтаксисе и параметрах см. в статье [New-Mailbox](https://technet.microsoft.com/ru-ru/library/aa997663\(v=exchg.150\)).

## Как проверить, что все получилось?

Чтобы проверить, успешно ли создан почтовый ящик пользователя с локальным архивом, выполните одно из следующих действий.

  - В Центре администрирования Exchange откройте раздел **Получатели** \> **Почтовые ящики** и выберите в списке новый почтовый ящик пользователя. В области сведений в разделе **Встроенный архив** убедитесь, что установлено значение **Включено**. Нажмите **Просмотреть сведения**, чтобы просмотреть свойства архива, включая состояние архива и базу данных почтовых ящиков, в которой он создан.

  - Чтобы просмотреть сведения о новом почтовом ящике пользователя и архиве, выполните в командной консоли следующую команду.
    
        Get-Mailbox <Name> | FL Name,RecipientTypeDetails,PrimarySmtpAddress,*Archive*

  - В командной консоли с помощью командлета **Test-ArchiveConnectivity** проверьте подключение к архиву. Пример проверки подключения к архиву приведен в статье "Примеры" раздела [Test-ArchiveConnectivity](https://technet.microsoft.com/ru-ru/library/hh529914\(v=exchg.150\)).

## Включение локального архива для существующего почтового ящика

Вы также можете создавать архивы для существующих пользователей, у которых есть почтовые ящики, но для которых не включена архивация. Этот процесс известен как *включение архива* для существующего почтового ящика.

## Использование Центра администрирования Exchange

1.  Последовательно выберите пункты **Получатели** \> **Почтовые ящики**.

2.  Выберите почтовый ящик.

3.  В области сведений в разделе **Личный архив** нажмите кнопку **Включить**.
    
    > [!TIP]  
    > Вы также можете массово включить архивы, выбрав несколько почтовых ящиков (используйте клавиши Shift или Ctrl). Выбрав несколько почтовых ящиков, в области сведений выберите пункт <strong>Дополнительные опции</strong>. Потом в разделе <strong>Архив</strong> нажмите кнопку <strong>Включить</strong>.


4.  На странице **Создание личного архива** нажмите кнопку **ОК**, чтобы приложение Exchange автоматически выбрало базу данных почтовых ящиков для архива, или кнопку **Обзор**, чтобы указать необходимую базу данных.

## Использование командной консоли

В этом примере включается архив для почтового ящика пользователя Tony Smith.

    Enable-Mailbox "Tony Smith" -Archive

В этом примере показано, как извлечь из базы данных DB01 почтовые ящики, для которых не включен локальный или облачный архив и имя которых не начинается со строки DiscoverySearchMailbox. Результат передается в командлет **Enable-Mailbox**, который включает архив для всех почтовых ящиков в базе данных почтовых ящиков DB01.

    Get-Mailbox -Database DB01 -Filter {ArchiveGuid -Eq $null -AND ArchiveDomain -eq $null -AND Name -NotLike "DiscoverySearchMailbox*"} | Enable-Mailbox -Archive

Дополнительные сведения о синтаксисе и параметрах см. в разделах [Enable-Mailbox](https://technet.microsoft.com/ru-ru/library/aa998251\(v=exchg.150\)) и [Get-Mailbox](https://technet.microsoft.com/ru-ru/library/bb123685\(v=exchg.150\)).

## Как проверить, что все получилось?

Чтобы проверить, успешно ли включен локальный архив для существующего почтового ящика, выполните одно из следующих действий.

  - В Центре администрирования Exchange перейдите к разделу **Получатели** \> **Почтовые ящики** и выберите почтовый ящик из списка. В области сведений в разделе **Встроенный архив** убедитесь, что установлено значение **Включено**. Нажмите **Просмотреть сведения**, чтобы просмотреть свойства архива, включая состояние архива и базу данных почтовых ящиков, в которой он создан.

  - Чтобы просмотреть сведения о новом архиве, выполните в командной консоли следующую команду.
    
        Get-Mailbox <Name> | FL Name,*Archive*

  - В командной консоли с помощью командлета **Test-ArchiveConnectivity** проверьте подключение к архиву. Пример проверки подключения к архиву приведен в подразделе "Примеры" раздела [Test-ArchiveConnectivity](https://technet.microsoft.com/ru-ru/library/hh529914\(v=exchg.150\)).

## Отключение локального архива

Вам может потребоваться отключить архив пользователя в целях устранения неполадок или при переносе почтового ящика в версию Exchange, которая не поддерживает локальную архивацию. При отключении локального архива все его данные сохраняются в базе данных почтовых ящиков до тех пор, пока не истечет срок хранения почтового ящика, после чего архив будет безвозвратно удален. (По умолчанию отключенные почтовые ящики, включая архивные, хранятся в Exchange тридцать дней)

> [!IMPORTANT]  
> При отключении архива он удаляется из почтового ящика и помечается в базе данных почтовых ящиков как подлежащий удалению.


Чтобы снова подключить локальный архив к почтовому ящику, используйте командлет [Connect-Mailbox](https://technet.microsoft.com/ru-ru/library/aa997878\(v=exchg.150\)) с параметром *Archive*.

## Использование Центра администрирования Exchange

1.  Последовательно выберите пункты **Получатели** \> **Почтовые ящики**.

2.  Выберите почтовый ящик.

3.  В области сведений в разделе **Встроенный архив** нажмите кнопку **Отключить**.
    
    > [!TIP]  
    > Вы также можете массово отключить архивы, выбрав несколько почтовых ящиков (используйте клавиши Shift или Ctrl). Выбрав несколько почтовых ящиков, в области сведений выберите пункт <strong>Дополнительные опции</strong>. Затем в разделе <strong>Архив</strong> нажмите кнопку <strong>Отключить</strong>.


## Использование командной консоли

В этом примере показано отключение архива для почтового ящика Григория Верного. Почтовый ящик не отключается.

    Disable-Mailbox -Identity "Chris Ashton" -Archive

Подробные сведения о синтаксисе и параметрах см. в статье [Disable-Mailbox](https://technet.microsoft.com/ru-ru/library/aa997210\(v=exchg.150\)).

## Как проверить, что все получилось?

Чтобы проверить, успешно ли вы отключили архив, выполните следующие действия.

  - Выберите почтовый ящик в Центре администрирования Exchange. Затем в области сведений проверьте его архивное состояние в разделе **Встроенный архив**.

  - Чтобы проверить свойства архива для пользователя почтового ящика, введите в командной консоли следующую команду.
    
        Get-Mailbox -Identity "Chris Ashton" | Format-List *Archive*
    
    Если архив отключен, для его свойств возвращаются следующие значения.
    
    
    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>Свойство</th>
    <th>Значение</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><p>ArchiveDatabase (для локальных архивов)</p></td>
    <td><p>&lt;blank&gt;</p></td>
    </tr>
    <tr class="even">
    <td><p>ArchiveState</p></td>
    <td><p><code>None</code></p></td>
    </tr>
    <tr class="odd">
    <td><p>DisabledArchiveDatabase (для локальных архивов)</p></td>
    <td><p>&lt;имя базы данных почтовых ящиков&gt;</p></td>
    </tr>
    <tr class="even">
    <td><p>DisabledArchiveGuid</p></td>
    <td><p>&lt;GUID отключенного архива&gt;</p></td>
    </tr>
    </tbody>
    </table>


## Подключение локального архива

Выше описано, как отключить архивный почтовый ящик. Отключенный архивный почтовый ящик остается в базе данных почтовых ящиков в течение определенного периода времени. По умолчанию отключенные архивы хранятся в Exchange 30 дней. В течение этого времени вы можете восстановить архив, связав его с существующим почтовым ящиком. Вы можете изменить срок хранения удаленных почтовых ящиков, чтобы удаленный почтовый ящик или архив хранился в течение более или менее длительного срока.

> [!CAUTION]  
> Если вы отключите архив для пользователя, а потом включите его для этого же пользователя, то пользователь получит новый архив. В новом архиве не будет данных, которые содержались в отключенном архиве пользователя. Чтобы снова подключить пользователя к отключенному архиву, выполните следующую процедуру.


> [!NOTE]  
> Подключить отключенный архив к почтовому ящику пользователя с помощью Центра администрирования Exchange нельзя.


## Использование командной консоли

1.  Если вы не знаете имя архива, вы можете просмотреть его, выполнив в командной консоли следующую команду. В этом примере показано, как извлечь базу данных почтовых ящиков DB01, передать ее в командлет **Get-MailboxStatistics**, чтобы получить статистику для почтовых ящиков в базе данных, а затем с помощью командлета **Where-Object** отфильтровать результаты и получить список отключенных архивов. Команда выводит дополнительные сведения о каждом архиве, такие как GUID и число элементов.
    
        Get-MailboxDatabase "DB01" | Get-MailboxStatistics | Where {($_.DisconnectDate -ne $null) -and ($_.IsArchiveMailbox -eq $true)} | Format-List

2.  Подключите архив к основному почтовому ящику. В этом примере архив пользователя Артема Кузнецова подключается к его основному почтовому ящику, причем в качестве идентификатора архива используется GUID.
    
        Enable-Mailbox -ArchiveGuid "8734c04e-981e-4ccf-a547-1c1ac7ebf3e2" -ArchiveDatabase "DB01" -Identity "Chris Ashton"

Подробные сведения о синтаксисе и параметрах см. в таких разделах:

  - [Get-MailboxDatabase](https://technet.microsoft.com/ru-ru/library/bb124924\(v=exchg.150\))

  - [Get-MailboxStatistics](https://technet.microsoft.com/ru-ru/library/bb124612\(v=exchg.150\))

  - [Enable-Mailbox](https://technet.microsoft.com/ru-ru/library/aa998251\(v=exchg.150\))

## Как проверить, что все получилось?

Чтобы проверить, успешно ли вы подключили отключенный архив к почтовому ящику пользователя, выполните в командной консоли следующую команду, которая возвращает значения свойств архива для почтового ящика, и проверьте значения свойств *ArchiveGuid* и *ArchiveDatabase*.

    Get-Mailbox -Identity "Chris Ashton" | Format-List *Archive*

