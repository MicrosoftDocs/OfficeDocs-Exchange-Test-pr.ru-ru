---
title: 'Рекомендации по настройке правил обработки почтового потока: Exchange Online Protection Help'
TOCTitle: Рекомендации по настройке правил обработки почтового потока
ms:assetid: abd863c3-c0ce-42f3-9470-a573adc3cbba
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dn960147(v=EXCHG.150)
ms:contentKeyID: 65236545
ms.date: 05/23/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Рекомендации по настройке правил обработки почтового потока

 

_**Применимо к:**Exchange Online, Exchange Online Protection, Exchange Server 2013_

_**Последнее изменение раздела:**2016-12-09_

Следуйте этим рекомендациям по использованию правил транспорта Exchange, чтобы избежать появления распространенных ошибок конфигурации. Во всех рекомендациях приведены ссылки на соответствующие статьи с примерами, а также пошаговые инструкции.

## Проверка правил

Тщательно проверьте все правила, чтобы избежать появления у пользователей непредвиденных проблем с их электронной почтой, а также обеспечить соответствие юридическим, нормативным и бизнес-требованиям. Следует учитывать множество параметров и взаимодействие правил, поэтому важно при тестировании правила использовать как сообщения, которые должны ему соответствовать, так и сообщения, которые не должны. Так вы удостоверитесь, что правило не получилось слишком общим. Дополнительные сведения о всех вариантах тестирования правил см. в статье [Тестирование правила обработки почтового потока](test-a-mail-flow-rule-exchange-2013-help.md).

## Область действия правила

Убедитесь, что правило применяется только к нужным сообщениям. Например, вот что можно сделать:

  - **Ограничьте область действия правила входящими или исходящими сообщениями вашей организации.**
    
    По умолчанию новое правило применяется к сообщениям, отправляемым или получаемым сотрудниками вашей организации. Поэтому, если требуется применять правило только одним способом, укажите его в условиях. Примеры см. в статье [Распространенные сценарии блокирования вложений](common-attachment-blocking-scenarios-for-mail-flow-rules-exchange-2013-help.md).

  - **Ограничение области действия правила на основе домена отправителя или получателя**
    
    По умолчанию новое правило применяется к сообщениям, отправляемым и получаемым через любой домен. Иногда требуется применить правило ко всем доменам за одним исключением или же только к одному домену. Примеры см. в статье [Создание списка надежных отправителей или списка заблокированных отправителей на основе домена или пользователя с помощью правил транспорта](https://technet.microsoft.com/ru-ru/library/dn198251\(v=exchg.150\)).

Полный список условий и исключений, доступных для правил транспорта, см. в статьях:

  - [Почтовые поток правила условий и исключений (предикаты) в Exchange Online](https://technet.microsoft.com/ru-ru/library/jj919235\(v=exchg.150\))

  - [Условия правил транспорта (предикаты)](mail-flow-rule-conditions-and-exceptions-predicates-in-exchange-2013-exchange-2013-help.md)

  - [Почтовые поток правила условий и исключений (предикаты) в Exchange Online Protection](https://technet.microsoft.com/ru-ru/library/jj919234\(v=exchg.150\))

## Как узнать о необходимости двух правил

Иногда для выполнения ваших задач требуется два правила. Правила транспорта обрабатываются в определенном порядке, поэтому к одному сообщению можно применить несколько правил. Например, если кроме блокировки сообщения нужно отправить его копию руководителю отправителя или изменить тему уведомления, потребуется создать два правила. Первое правило позволит скопировать сообщение для руководителя отправителя и изменить тему, а второе — заблокировать сообщение.

При использовании двух подобных правил убедитесь, что их условия совпадают. См. примеры 3 в статьях [Распространенные сценарии утверждения сообщений](common-message-approval-scenarios-exchange-2013-help.md) и [Распространенные сценарии блокирования вложений](common-attachment-blocking-scenarios-for-mail-flow-rules-exchange-2013-help.md), а также статью [Заявления об отказе, подписи, верхние или нижние колонтитулы на уровне организации](organization-wide-disclaimers-signatures-footers-or-headers-exchange-online-help.md).

## Не повторяйте одно действие для всех сообщений в беседе

Цепочка сообщений в беседе состоит из нескольких отдельных сообщений, и выполнение одного и того же действия для каждого из них может быть досадным. Например, задано действие для добавления заявления об отказе, которое вы хотите применить только к первому сообщению беседы. В этом случае добавьте исключение для сообщений, уже содержащих текст такого заявления. Примеры см. в статье [Заявления об отказе, подписи, верхние или нижние колонтитулы на уровне организации](organization-wide-disclaimers-signatures-footers-or-headers-exchange-online-help.md).

## Как узнать, когда остановить обработку правила

Иногда разумно остановить обработку правила, когда выполнены условия для его срабатывания. Например, если одно правило создано для блокирования сообщений с вложениями, а второе — для добавления заявления об отказе к сообщениям, соответствующим шаблону, обработку правил можно прекратить, как только сообщение будет заблокировано. Дальнейшие действия лишены смысла.

Чтобы после срабатывания правила прекратить обработку других правил, установите флажок **Остановить обработку других правил**.

## Если используется много ключевых слов и шаблонов для поиска соответствий, загрузите их из файла

Например, необходимо предотвратить отправку сообщений, содержащих ряд недопустимых или нецензурных слов. Можно создать текстовый файл, в котором будут перечислены соответствующие слова и выражения, а затем с помощью Оболочка Windows PowerShell задать правило транспорта, блокирующее сообщения с этими словами.

Текстовый файл может содержать регулярные выражения для шаблонов, в которых не учитывается регистр. К наиболее распространенным регулярным выражениям относятся


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p><strong>Выражение</strong></p></td>
<td><p><strong>Совпадения</strong></p></td>
</tr>
<tr class="even">
<td><p><strong>.</strong></p></td>
<td><p>Любой символ</p></td>
</tr>
<tr class="odd">
<td><p><strong>*</strong></p></td>
<td><p>Все дополнительные символы</p></td>
</tr>
<tr class="even">
<td><p><strong>\d</strong></p></td>
<td><p>Любое десятичное число</p></td>
</tr>
<tr class="odd">
<td><p>[<em>группа_символов</em>]</p></td>
<td><p>Любой символ из <em>группы_символов</em>.</p></td>
</tr>
</tbody>
</table>


Пример использования текстового файла с регулярными выражениями и команд Оболочка Windows PowerShell модуля Exchange см. в статье [Использование правил обработки почтового потока для маршрутизации электронной почты с учетом списка слов, фраз или шаблонов](use-mail-flow-rules-to-route-email-based-on-a-list-of-words-phrases-or-patterns-exchange-2013-help.md).

Сведения о том, как указывать шаблоны с использованием регулярных выражений, см. в статье [Справочник по регулярным выражениям](https://go.microsoft.com/fwlink/p/?linkid=532394).

