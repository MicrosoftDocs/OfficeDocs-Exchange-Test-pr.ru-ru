---
title: 'Очистка папки "Элементы с возможностью восстановления": Exchange 2013 Help'
TOCTitle: Очистка папки "Элементы с возможностью восстановления"
ms:assetid: 82c310f8-de2f-46f2-8e1a-edb6055d6e69
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Ff678798(v=EXCHG.150)
ms:contentKeyID: 50556399
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
f1_keywords:
- классифицированный разрыв
- Поиск и уничтожение
- разрыв классифицированных сообщений
- разрыв сообщения
- уборка классифицированного разрыва
- уборка разрыва классифицированных сообщений
- уборка разрыва сообщений
ms.translationtype: HT
---

# Очистка папки \"Элементы с возможностью восстановления\"

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-09-30_

Папка "Элементы с возможностью восстановления" (известная в ранних версиях Exchange как *корзина*) предназначена для защиты от случайного или намеренного удаления элементов, а также упрощения их обнаружения до или во время судебных процессов и расследований. Дополнительные сведения о папке элементов для восстановления см. в разделе [Папка "Элементы для восстановления"](recoverable-items-folder-exchange-2013-help.md).

Способ очистки папки почтового ящика "Элементы с возможностью восстановления" зависит от того, применялось ли к почтовому ящику хранение для судебного разбирательства, хранение на месте или восстановление отдельных элементов.

  - Если к почтовому ящику не применено хранение для судебного разбирательства, хранение на месте или восстановление отдельных элементов, можно просто удалять элементы из папки "Элементы с возможностью восстановления". После удаления элементов использование процедуры восстановления одного элемента невозможно.

  - Если к почтовому ящику применено хранение для судебного разбирательства, хранение на месте либо восстановление отдельных элементов, важно сохранять данные почтового ящика до отключения этих функций. Поэтому для очистки папки элементов для восстановления необходимо выполнить более детальные действия.

Чтобы узнать больше о хранении на месте и хранении для судебного разбирательства, см. статью [Хранение на месте и хранение для судебного разбирательства](https://docs.microsoft.com/ru-ru/exchange/security-and-compliance/in-place-and-litigation-holds). Дополнительные сведения о восстановлении отдельного элемента см. в подразделе "Восстановление отдельного элемента" в разделе [Папка "Элементы для восстановления"](recoverable-items-folder-exchange-2013-help.md).

Дополнительные сведения о папке элементов для восстановления см. в разделе [Папка "Элементы для восстановления"](recoverable-items-folder-exchange-2013-help.md).

## Что нужно знать перед началом работы?

  - Предполагаемое время выполнения процедуры: 30 минут. Это время может меняться в зависимости от размеров папки элементов для восстановления.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Запись «Удаление содержимого почтового ящика» в разделе [Политика обмена сообщениями и разрешения для соответствия требованиям](messaging-policy-and-compliance-permissions-exchange-2013-help.md).

  - Так как некорректная очистка папки элементов для восстановления может привести к потере данных, важно ознакомиться с принципом работы этой папки и последствиями удаления ее содержимого. Прежде чем выполнять эту процедуру, ознакомьтесь с разделом [Папка "Элементы для восстановления"](recoverable-items-folder-exchange-2013-help.md).

  - Центр администрирования Exchange (EAC) невозможно использовать для выполнения этих действий. Необходимо использовать командную консоль.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: [Exchange Server](https://go.microsoft.com/fwlink/p/?linkid=60612), [Exchange Online](https://go.microsoft.com/fwlink/p/?linkid=267542) или [Exchange Online Protection](https://go.microsoft.com/fwlink/p/?linkid=285351).

## Использование командной консоли для удаления элементов из папки "Элементы с возможностью восстановления" в почтовых ящиках, для которых не включалось хранение или восстановление отдельных элементов

В этом примере выполняется окончательное удаление элементов из папки "Элементы с возможностью восстановления" почтового ящика пользователя Gurinder Singh, а также копирование элементов в папку GurinderSingh-RecoverableItems в почтовом ящике поиска на обнаружение (почтовый ящик обнаружения, созданный программой установки Exchange).

    Search-Mailbox -Identity "Gurinder Singh" -SearchDumpsterOnly -TargetMailbox "Discovery Search Mailbox" -TargetFolder "GurinderSingh-RecoverableItems" -DeleteContent

> [!NOTE]  
> Чтобы удалить элементы из почтового ящика без их копирования в другой почтовый ящик, используйте предыдущую команду без параметров <em>TargetMailbox</em> и <em>TargetFolder</em>.


Дополнительные сведения о синтаксисе и параметрах см. в разделе [Search-Mailbox](https://technet.microsoft.com/ru-ru/library/dd298173\(v=exchg.150\)).

## Использование командной консоли для очистки папки "Элементы с возможностью восстановления" в почтовых ящиках, для которых включалось хранение или восстановление отдельных элементов

Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье запись "Удаление содержимого почтового ящика" в разделе [Политика обмена сообщениями и разрешения для соответствия требованиям](messaging-policy-and-compliance-permissions-exchange-2013-help.md).

Если почтовый ящик достигает квоты папки элементов для восстановления, рекомендуется поднять квоту и не удалять элементы из папки. Кроме того, можно отслеживать события в журнале приложений, связанные с квотой предупреждения для папки "Элементы с возможностью восстановления", и предпринимать необходимые действия. Например, увеличивать квоту или анализировать рост папки "Элементы с возможностью восстановления" в почтовых ящиках, размер которых достигает квоты предупреждения.

Если ограничения хранилища или подобные проблемы препятствуют повышению квоты для папки "Элементы с возможностью восстановления", а также если вам нужно удалить сообщения из указанной папки почтового ящика, для которого включено хранение или восстановление отдельных элементов, рекомендуем сначала скопировать данные из папки "Элементы с возможностью восстановления" в другой почтовый ящик. Если удаление элементов выполняется в связи с ограничениями хранилища в одном томе, можно скопировать элементы в почтовый ящик, расположенный в томе с достаточным объемом памяти.

В этой процедуре выполняется копирование элементов из папки «Элементы для восстановления» пользователя Gurinder Singh в папку GurinderSingh-RecoverableItems почтового ящика поиска на обнаружение. Прежде чем копировать и удалять элементы из папки элементов для восстановления, необходимо в первую очередь выполнить некоторые действия, которые обеспечат невозможность удаления элементов из указанной папки. После копирования элементов в почтовый ящик обнаружения или резервного копирования и очистки папки можно вернуть прежние значения параметров почтового ящика.

1.  Получите значения следующих параметров квоты. Обязательно запишите значения, чтобы можно было вернуть их после очистки папки элементов для восстановления:
    
      - *RecoverableItemsQuota*
    
      - *RecoverableItemsWarningQuota*
    
      - *ProhibitSendQuota*
    
      - *ProhibitSendReceiveQuota*
    
      - *UseDatabaseQuotaDefaults*
    
      - *RetainDeletedItemsFor*
    
      - *UseDatabaseRetentionDefaults*
    
    > [!NOTE]  
    > Если для параметра <em>UseDatabaseQuotaDefaults</em> установлено значение <code>$true</code>, то предыдущие параметры квоты не применяются. Соответствующие параметры квоты, настроенные в базе данных почтовых ящиков, применяются даже в том случае, если заполнены параметры отдельных почтовых ящиков.
    
        Get-Mailbox "Gurinder Singh" | Format-List RecoverableItemsQuota, RecoverableItemsWarningQuota, ProhibitSendQuota, ProhibitSendReceiveQuota, UseDatabaseQuotaDefaults, RetainDeletedItemsFor, UseDatabaseRetentionDefaults

2.  Получите параметры доступа к почтовому ящику. Обязательно запишите их значения для последующей настройки.
    
        Get-CASMailbox "Gurinder Singh" | Format-List EwsEnabled, ActiveSyncEnabled, MAPIEnabled, OWAEnabled, ImapEnabled, PopEnabled

3.  Получите текущий размер папки элементов для восстановления. Запишите размер, чтобы можно было поднять квоты на шаге 6.
    
        Get-MailboxFolderStatistics "Gurinder Singh" -FolderScope RecoverableItems | Format-List Name,FolderAndSubfolderSize

4.  Получите текущую конфигурацию рабочего цикла помощника для управляемых папок. Обязательно запишите эти значения для последующей настройки.
    
        Get-MailboxServer "My Mailbox Server" | Format-List Name,ManagedFolderWorkCycle

5.  Отключите клиентский доступ к почтовому ящику, чтобы обеспечить невозможность внесения изменений в данные почтового ящика на время данной процедуры.
    
        Set-CASMailbox "Gurinder Singh" -EwsEnabled $false -ActiveSyncEnabled $false -MAPIEnabled $false -OWAEnabled $false -ImapEnabled $false -PopEnabled $false

6.  Чтобы запретить удаление элементов из папки «Элементы для восстановления», увеличьте для этой папки стандартную квоту и квоту предупреждения, а для периода хранения удаленных элементов установите значение, которое превышает текущий размер пользовательской папки элементов для восстановления. Это особенно важно для сохранения сообщений из почтовых ящиков, к которым применено хранение для судебного разбирательства или хранение на месте. Рекомендуется увеличить значения этих параметров вдвое.
    
        Set-Mailbox "Gurinder Singh" -RecoverableItemsQuota 50Gb -RecoverableItemsWarningQuota 50Gb -RetainDeletedItemsFor 3650 -ProhibitSendQuota 50Gb -ProhibitSendRecieveQuota 50Gb -UseDatabaseQuotaDefaults $false -UseDatabaseRetentionDefaults $false

7.  Отключите помощник для управляемых папок на сервере почтовых ящиков.
    
        Set-MailboxServer MyMailboxServer -ManagedFolderWorkCycle $null
    
    > [!IMPORTANT]  
    > Если почтовый ящик находится в базе данных почтовых ящиков в группе обеспечения доступности баз данных (DAG), то необходимо отключить помощник для управляемых папок для каждого члена группы DAG, в котором размещается копия этой базы данных. Если база данных переходит на другой сервер при сбое, то это предотвращает удаление данных почтовых ящиков помощником для управляемых папок на этом сервере.


8.  Отключите функцию восстановления отдельных элементов и снимите почтовый ящик с хранения для судебного разбирательства.
    
        Set-Mailbox "Gurinder Singh" -SingleItemRecoveryEnabled $false -LitigationHoldEnabled $false
    
    > [!IMPORTANT]  
    > Когда команда запущена, включение восстановления отдельных элементов или хранения для судебного разбирательства может занять до одного часа. Переходить к следующему шагу рекомендуется только после завершения этого этапа.


9.  Скопируйте элементы из папки элементов для восстановления в папку почтового ящика поиска на обнаружение и удалите содержимое исходного почтового ящика.
    
        Search-Mailbox -Identity "Gurinder Singh" -SearchDumpsterOnly -TargetMailbox "Discovery Search Mailbox" -TargetFolder "GurinderSingh-RecoverableItems" -DeleteContent
    
    Если требуется удалить только сообщения, соответствующие определенным условиям, то для их задания используется параметр *SearchQuery*. В этом примере выполняется удаление строки «Your bank statement» в поле **Тема**.
    
        Search-Mailbox -Identity "Gurinder Singh" -SearchQuery "Subject:'Your bank statement'" -SearchDumpsterOnly -TargetMailbox "Discovery Search Mailbox" -TargetFolder "GurinderSingh-RecoverableItems" -DeleteContent
    
    > [!NOTE]  
    > Копировать элементы в почтовый ящик поиска на обнаружение не требуется. Сообщения можно копировать в любой почтовый ящик. Тем не менее, чтобы запретить доступ к потенциально конфиденциальным данным почтовых ящиков, рекомендуется копировать сообщения в тот почтовый ящик, доступ к которому имеют только авторизованные диспетчеры записей. По умолчанию круг пользователей, имеющих доступ к почтовому ящику поиска на обнаружение по умолчанию, ограничен членами группы ролей управления обнаружением. Дополнительные сведения см. в разделе <a href="https://docs.microsoft.com/ru-ru/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery">Обнаружение электронных данных на месте</a>.


10. Если к этому почтовому ящику ранее применялось хранение для судебного разбирательства или восстановление отдельных элементов, снова включите эти функции.
    
        Set-Mailbox "Gurinder Singh" -SingleItemRecoveryEnabled $true -LitigationHoldEnabled $true
    
    > [!IMPORTANT]  
    > Когда команда запущена, включение восстановления отдельных элементов или хранения для судебного разбирательства может занять до одного часа. Включать помощник для управляемых папок и разрешать клиентский доступ (шаги 11 и 12) рекомендуется только после завершения этого этапа.


11. Верните прежние значения квот, записанные на шаге 1:
    
      - *RecoverableItemsQuota*
    
      - *RecoverableItemsWarningQuota*
    
      - *ProhibitSendQuota*
    
      - *ProhibitSendReceiveQuota*
    
      - *UseDatabaseQuotaDefaults*
    
      - *RetainDeletedItemsFor*
    
      - *UseDatabaseRetentionDefaults*
    
    В этом примере выполняется снятие почтового ящика с судебного удержания, для периода хранения удаленных элементов устанавливается значение 14 дней, а для квоты "Элементы с возможностью восстановления" настраивается использование того же значения, что и для базы данных почтовых ящиков. Если на шаге 1 были записаны другие значения, необходимо использовать предыдущие параметры для задания каждого значения, а для параметра *UseDatabaseQuotaDefaults* установить значение `$false`. Если для параметров *RetainDeletedItemsForand UseDatabaseRetentionDefaults* ранее были заданы другие значения, то им также необходимо вернуть значения, записанные на шаге 1.
    
        Set-Mailbox "Gurinder Singh" -RetentionHoldEnabled $false -RetainDeletedItemsFor 14 -RecoverableItemsQuota unlimited -UseDatabaseQuotaDefaults $true

12. Включите помощник для управляемых папок путем установки для рабочего цикла значения из шага 4. В этом примере рабочему циклу присваивается значение, равное одному дню.
    
        Set-MailboxServer MyMailboxServer -ManagedFolderWorkCycle 1

13. Включите клиентский доступ.
    
        Set-CASMailbox -ActiveSyncEnabled $true -EwsEnabled $true -MAPIEnabled $true -OWAEnabled $true -ImapEnabled $true -PopEnabled $true

Подробные сведения о синтаксисе и параметрах см. в следующих разделах:

  - [Get-Mailbox](https://technet.microsoft.com/ru-ru/library/bb123685\(v=exchg.150\))

  - [Get-CASMailbox](https://technet.microsoft.com/ru-ru/library/bb124754\(v=exchg.150\))

  - [Get-MailboxFolderStatistics](https://technet.microsoft.com/ru-ru/library/aa996762\(v=exchg.150\))

  - [Get-MailboxServer](https://technet.microsoft.com/ru-ru/library/bb123539\(v=exchg.150\))

  - [Set-CASMailbox](https://technet.microsoft.com/ru-ru/library/bb125264\(v=exchg.150\))

  - [Set-Mailbox](https://technet.microsoft.com/ru-ru/library/bb123981\(v=exchg.150\))

  - [Set-MailboxServer](https://technet.microsoft.com/ru-ru/library/aa998651\(v=exchg.150\))

  - [Search-Mailbox](https://technet.microsoft.com/ru-ru/library/dd298173\(v=exchg.150\))

## Как проверить, что все получилось?

Чтобы убедиться в том, что папка элементов для восстановления почтового ящика успешно очищена, используйте командлет [Get-MailboxFolderStatistics](https://technet.microsoft.com/ru-ru/library/aa996762\(v=exchg.150\)), чтобы проверить размер этой папки.

В этом примере возвращается значение, указывающее размер этой папки и ее вложенных папок, а также число элементов в папке и каждой вложенной папке.

    Get-MailboxFolderStatistics -Identity "Gurinder Singh" -FolderScope RecoverableItems | Format-Table Name,FolderAndSubfolderSize,ItemsInFolderAndSubfolders -Auto

