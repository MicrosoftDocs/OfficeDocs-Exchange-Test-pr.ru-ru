---
title: 'Тестирование правила обработки почтового потока: Exchange 2013 Help'
TOCTitle: Тестирование правила обработки почтового потока
ms:assetid: 3d949e2a-8ba4-4261-8cfb-736fd2446ea1
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dn831862(v=EXCHG.150)
ms:contentKeyID: 63144169
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Тестирование правила обработки почтового потока

 

_**Применимо к:**Exchange Online, Exchange Online Protection, Exchange Server 2013_

_**Последнее изменение раздела:**2016-12-09_

Каждое созданное правило для потока обработки почты в Exchange, также называемое правилом транспорта, следует проверить перед его включением. Тогда, если вы случайно создадите условие, которое будет давать непредвиденные результаты или конфликтовать с другими правилами, вам удастся избежать нежелательных последствий.

<table>
<thead>
<tr class="header">
<th><img src="images/Dd876857.important(EXCHG.150).gif" title="Важно" alt="Важно" />Важно!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Подождите 30 минут после создания правила перед его проверкой. Если проверить его сразу же после создания, результаты могут быть неверными. Если вы используете Exchange Server и несколько серверов Exchange, может потребоваться еще больше времени, чтобы все серверы получили правило.</td>
</tr>
</tbody>
</table>


## Шаг 1. Создание правила в тестовом режиме

Выбрав режим проверки, можно оценить условия правила, не теряя действия, которые влияют на поток почты. Вы можете настроить правило так, чтобы получать уведомление по электронной почте при каждом срабатывании правила, или просматривать в Анализ трассировки сообщения сообщения, которые могут соответствовать правилу. Существует два режима проверки.

  - **Тестирование без подсказок политики**. Используйте этот режим вместе с действием "Отчет об инциденте", и вы будете получать сообщение электронной почты каждый раз, когда сообщение совпадает с правилом.

  - **Тестирование с подсказками политики**. Этот режим доступен, только если вы используете службу [Защита от потери данных](technical-overview-of-dlp-data-loss-prevention-in-exchange.md) (DLP), входящую в некоторых планы подписки Exchange Online и Exchange Online Protection (EOP). В этом режиме сообщение передается отправителю, если сообщения от них соответствуют политике, но никакие действия потока обработки почты не выполняются.

Вот что вы увидите, когда срабатывает правило, если вы добавили действие "Отчет об инциденте":

![Сообщение, отправленное при обнаружении правила](images/Dn831862.c1a2db60-3fb9-4ddc-86d5-1757e2250f59(EXCHG.150).png "Сообщение, отправленное при обнаружении правила")

**Использование режима проверки с действием "Отчет об инциденте"**

1.  Откройте Центр администрирования Exchange (EAC) и выберите элементы **Поток обработки почты** \> **Правила**.

2.  Создайте правило или выберите существующее правило, а затем нажмите кнопку **Изменить**.

3.  Прокрутите вниз до раздела **Выбрать режим для этого правила** и выберите элемент **Тестирование без подсказок политики** или **Тестирование с подсказками политики**.

4.  Добавьте действие "Отчет об инциденте":
    
    1.  Выберите элемент **Добавить действие**, или, если он не отображается, нажмите кнопку **Дополнительные параметры** и щелкните **Добавить действие**.
    
    2.  Выберите параметр **Создать отчет об инциденте и отправить его**.
    
    3.  Щелкните **Выбрать...** и выберите себя или другого пользователя.
    
    4.  Выберите параметр **Включить свойства сообщения**, а затем выберите свойства сообщения, которые будут включены в отправляемое сообщение электронной почты. Если ничего не выбрать, вы все равно будете получать сообщение при совпадении с правилом.

5.  Нажмите кнопку **Сохранить**.

## Шаг 2. Проверка работы правила

Для проверки правила можно отправить достаточно тестовых сообщений, чтобы убедиться, что происходит то, что предполагается, или можно просмотреть трассировку сообщений, отправленных пользователями вашей организации. Обязательно проверьте следующие типы сообщений:

  - сообщения, которые по вашему мнению должны соответствовать правилу;

  - сообщения, которые по вашему мнению не должны соответствовать правилу;

  - сообщения, отправляемые и получаемые пользователями вашей организации;

  - сообщения, отправляемые и получаемые пользователями вне вашей организации;

  - ответы на сообщения, которые соответствуют правилу;

  - сообщения, которые могут вызвать взаимодействие нескольких правил.

## Советы для отправки тестовых сообщений

Один из способов проверки состоит в том, чтобы войти в систему одновременно как отправитель и получатель тестового сообщения.

  - Если у вас нет доступа к нескольким учетным записям в вашей организации, можно использовать [пробную учетную запись Office 365](https://go.microsoft.com/fwlink/p/?linkid=402791) или создать в организации несколько временных фиктивных пользователей.

  - Поскольку браузер обычно не позволяют использовать несколько одновременно открытых сеансов на одном компьютере под разными учетными записями, можно использовать [режим просмотра InPrivate Internet Explorer](https://go.microsoft.com/fwlink/p/?linkid=402784) или другой компьютер, устройство или браузер для каждого пользователя.

## Анализ трассировки сообщения

Трассировка сообщения содержит запись для каждого правила, которое сработало для сообщения, и запись для каждого действия правила. Это полезно для отслеживания того, что происходит с тестовыми сообщениями, а также того, что происходит с реальными сообщениями, проходящими через вашу организацию.

![Трассировка сообщений с отображением действий правил транспорта](images/Dn831862.64179f28-5c8c-421b-b630-cc1f7de9a34f(EXCHG.150).png "Трассировка сообщений с отображением действий правил транспорта")

1.  В Центре администрирования Exchange последовательно выберите пункты **Поток обработки почты** и **Трассировка сообщений**.

2.  Найдите нужные сообщения по отправителю и дате отправки. Сведения об указании условий поиска см. в разделе [Запуск трассировки сообщений и просмотр результатов](https://technet.microsoft.com/ru-ru/library/jj200712\(v=exchg.150\)).

3.  Найдя сообщение, для которого требуется выполнить трассировку, дважды щелкните его, чтобы просмотреть сведения о нем.

4.  В столбце **Событие** найдите **Правило транспорта**. В столбце **Действие** отображается выполненное действие.

## Шаг 3. Активация правила после тестирования

1.  В Центре администрирования Exchange перейдите в раздел **Поток обработки почты** \> **Правила**.

2.  Выберите правило, а затем нажмите кнопку **Изменить**.

3.  Выберите пункт **Принудительно**.

4.  Если вы использовали действие для создания отчета об инциденте, выберите действие, а затем нажмите кнопку **Удалить**.

5.  Нажмите кнопку **Сохранить**.

<table>
<thead>
<tr class="header">
<th><img src="images/Bb124558.tip(EXCHG.150).gif" title="Совет" alt="Совет" />Совет.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Чтобы избежать непредвиденных ситуаций, сообщите пользователям о новых правилах.</td>
</tr>
</tbody>
</table>


## Рекомендации по устранению неполадок

Вот несколько распространенных проблем и способы их устранения.

  - **Все выглядит хорошо, но правило не работает.**
    
    Иногда требуется более 15 минут для активации нового правила потока обработки почты. Подождите несколько часов и повторите попытку. Проверьте также, не возник ли конфликт правил. Попробуйте изменить приоритет правила на 0, поместив его в верхней части списка.

  - **Заявление об отказе добавляется в исходное сообщение и все ответы, а не только исходное сообщение.**
    
    Чтобы избежать этого, добавьте исключение в правило заявления об отказе, чтобы искать уникальные фразу в заявлении об отказе.

  - **Правило использует два условия, а действие должно выполняться, если выполнено одно из них, но правило срабатывает только при выполнении обоих условий.**
    
    Вам нужно создать два правила, по одному для каждого условия. Можно легко скопировать правило, нажав кнопку **Копировать** и удалив одно условие из исходного правила и другое условие из копии.

  - **Я работаю с группами рассылки и** **Отправитель является** (**SentTo**) **не работает.**
    
    **SentTo** сопоставляет сообщения, один из получателей которых — это почтовый ящик, пользователь с включенной поддержкой почты или контакт. Группу рассылки в этом условии указать невозможно. Вместо этого используйте условие **Поле "Кому" содержит члена этой группы** (**SentToMemberOf**).

## Другие параметры тестирования

Если вы используете Exchange Online или Exchange Online Protection, можно просмотреть число обнаруженных соответствий для каждого правила с помощью отчета о правилах. Чтобы включить правило в отчеты, установите для него флажок **Проверять выполнение этого правила со степенью серьезности**. Эти отчеты помогают определять тенденции использования правил и выявлять правила, которые не срабатывают.

Для просмотра отчета о правилах в Центре администрирования Office 365 выберите элемент **Отчеты**.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Хотя большинство данных в отчете доступны в течение 24 часов, для появления некоторых данных может потребоваться до 5 дней.</td>
</tr>
</tbody>
</table>


![Отчет, отображающий использование правил](images/Dn831862.df5bf202-741d-432a-b71d-b37143f0ec0a(EXCHG.150).png "Отчет, отображающий использование правил")

Дополнительные сведения см. в статье [Просмотр отчетов о защите почты](https://go.microsoft.com/fwlink/p/?linkid=402958).

## Нужна помощь?

[Управление правилами потока обработки почты](manage-mail-flow-rules-exchange-2013-help.md)

[Правила потока обработки почты (правила транспорта) в Exchange Online](https://technet.microsoft.com/ru-ru/library/jj919238\(v=exchg.150\)) (Exchange Online)

[Правила потока обработки почты (правила транспорта) в Exchange Online Protection](https://technet.microsoft.com/ru-ru/library/dn271424\(v=exchg.150\)) (Exchange Online Protection)

[Правила обработки почтового потока и транспорта](mail-flow-rules-transport-rules-in-exchange-2013-exchange-2013-help.md) (Exchange Server)

