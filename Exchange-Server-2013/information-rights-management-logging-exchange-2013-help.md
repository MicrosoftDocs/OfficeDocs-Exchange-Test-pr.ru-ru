---
title: 'Ведение журнала управления правами на доступ к данным: Exchange 2013 Help'
TOCTitle: Ведение журнала управления правами на доступ к данным
ms:assetid: e06f57f9-a9e2-43a2-b88c-288b324d71f0
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Ff461940(v=EXCHG.150)
ms:contentKeyID: 50489358
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# Ведение журнала управления правами на доступ к данным

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

В службе управления правами на доступ к данным (IRM) Microsoft Exchange Server 2013 операции заносятся в журнал IRM. Журналы IRM помогают отслеживать и устранять неполадки взаимодействий между клиентом службы управления правами (RMS) на сервере Exchange 2013 и кластером служб управления правами Active Directory (AD RMS) в организации.

Дополнительные сведения об управлении правами на доступ к данным (IRM) см. в разделе [Управление правами на доступ к данным](information-rights-management-exchange-2013-help.md).

**Содержание**

Structure of IRM logs

Logging process

Information written to IRM logs

Managing IRM logs

Необходимы сведения о задачах управления, связанных с управлением правами на доступ к данным (IRM)? См. раздел [Сведения о процедуры управления правами](information-rights-management-procedures-exchange-2013-help.md).

## Структура журналов IRM

По умолчанию журналы IRM расположены в каталоге C:\\Program Files\\Microsoft\\Exchange Server\\V14\\Logging\\IRMLogs.

Контекст именования для файлов журналов IRM имеет следующий вид: \<*Процесс*\>\_\<*Идентификатор\_процесса* или *Идентификатор\_пула\_приложений\_IIS*\>\_IRMLOG*ггггммдд*-*нннн*.log, где:

  - \<*Процесс*\>— процесс, создающий файл журнала. Например, на транспортной службе им будет являться EdgeTransport.

  - \<*Идентификатор\_процесса* или *Идентификатор\_пула\_приложений\_IIS\>* —числовой идентификатор процесса.

  - *ггггммдд* — дата создания файла журнала в формате UTC.

  - *нннн* — номер экземпляра, который каждый новый день начинается с 1.

Примером имени файла журнала IRM является EdgeTransport\_1056\_IRMLOG20101201-1.log.

В приведенной ниже таблице перечислены журналы, созданные для различных ролей сервера.

### Журналы для ролей сервера

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Роль сервера</th>
<th>Имя файла журнала IRM</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>служба передачи</p></td>
<td><p>EdgeTransport_&lt;<em>Идентификатор_процесса</em>&gt;_IRMLOG<em>ггггммдд</em>-<em>нннн</em>.log</p></td>
<td><p>Этот журнал используется для записи всех транзакций службы управления правами, выполненных транспортным конвейером транспортной службы (например, в отношении правил защиты транспорта и расшифровки отчетов журнала). Идентификатор процесса edgetransport.exe используется для создания имени файла журнала.</p></td>
</tr>
<tr class="even">
<td><p>Сервер почтовых ящиков</p></td>
<td><p>msftefd_&lt;<em>Идентификатор_процесса</em>&gt;_IRMLOG<em>ггггммдд</em>-<em>нннн</em>.log</p></td>
<td><p>Этот журнал используется для записи всех транзакций службы управления правами, выполняемых во время запросов на поиск и индексацию. Серверы почтовых ящиков Exchange 2013 используют процесс msftefd.exe для индексации содержимого. Идентификатор процесса msftefd.exe используется для создания имени файла журнала.</p></td>
</tr>
<tr class="odd">
<td><p>Сервер клиентского доступа</p></td>
<td><p>w3wp_MSExchangeOWAAppOol_IRMLOG<em>ггггммдд</em>-<em>нннн</em>.log</p></td>
<td><p>Этот журнал используется для записи всех транзакций службы управления правами на доступ к данным (IRM) в приложении Microsoft OfficeOutlook Web App.</p></td>
</tr>
<tr class="even">
<td><p>Все роли сервера Exchange 2013</p></td>
<td><p>w3wp_MSExchangePowerShellAppPool_IRMLOG<em>ггггммдд</em>-<em>нннн</em>.log</p></td>
<td><p>Этот журнал используется для записи всех транзакций службы управления правами IRM, источником которых является среда Windows PowerShell, например при выполнении командлета <strong>Test-IRMConfiguration</strong>.</p></td>
</tr>
</tbody>
</table>


В начало

## Процесс ведения журнала

Данные заносятся в файл журнала до тех пор, пока его размер не достигнет максимального установленного значения. При достижении максимального размера создается файл журнала с последующим номером экземпляра. Эта процедура выполняется круглосуточно. При циклическом ведении журнала, когда каталог журналов IRM достигает максимально допустимого размера или когда файл журнала достигает максимально допустимого срока хранения, указанного в конфигурации ведения журналов IRM на каждом сервере, удаляются самые старые файлы журнала.

В начало

## Сведения, записываемые в журналы IRM

Файлы журналов IRM представляют собой текстовые файлы в формате CSV. Каждый журнал IRM имеет заголовок, содержащий следующие сведения.

  - **\#Software**   Название программы, создавшей файл журнала IRM. Обычно значением является `Microsoft Exchange Server`.

  - **\#Version**   Номер версии программы, создавшей файл журнала IRM.

  - **\#Log-Type**   Тип журнала, соответствующий значению `Rms Client Manager Log`.

  - **\#Date**   Дата и время создания файла журнала в формате UTC. Дата и время UTC представлены в формате ISO 8601: *гггг*-*мм*-*дд*T*чч*:*мм*:*сс.ддд*Z, где:
    
      - гггг — год;
    
      - *мм* — месяц;
    
      - *дд* — день;
    
      - T — обозначение времени, используемое, чтобы показать начало компонента времени;
    
      - *чч* — час;
    
      - *мм* — минута;
    
      - *сс* — секунда;
    
      - *ддд* — доли секунды;
    
      - Z — другой способ обозначения времени в формате UTC

  - **\#Fields**   Разделенные запятыми имена полей, используемые в файлах журнала IRM.
    
    В журнале IRM каждое событие транзакции службы управления правами хранится в отдельной строке в полях, разделенных запятыми. В следующей таблице перечислены поля журналов IRM для всех ролей сервера с включенными функциями управления правами на доступ к данным (IRM).
    
    ### Поля, используемые в журналах IRM
    
    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th>Поле</th>
    <th>Описание</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><p><strong>Date-time</strong></p></td>
    <td><p>Указывает отметку времени в формате UTC.</p></td>
    </tr>
    <tr class="even">
    <td><p><strong>Feature</strong></p></td>
    <td><p>Указывает используемую функцию клиента службы управления правами. Допустимыми являются следующие значения:</p>
    <ul>
    <li><p><code>RacClc</code></p></li>
    <li><p><code>Template</code></p></li>
    <li><p><code>Prelicense</code></p></li>
    <li><p><code>UseLicense</code></p></li>
    <li><p>Проверка подписи</p></li>
    <li><p><code>ServerInfo</code></p></li>
    </ul></td>
    </tr>
    <tr class="odd">
    <td><p><strong>Event-Type</strong></p></td>
    <td><p>Указывает тип события. Допустимыми являются следующие значения:</p>
    <ul>
    <li><p><code>Acquire</code>   Запрашивается лицензия или шаблон службы управления правами.</p></li>
    <li><p><code>Success</code>   Лицензия или шаблон службы управления правами успешно получены.</p></li>
    <li><p><code>Exception</code>   Произошла ошибка.</p></li>
    <li><p><code>Queued</code>   Запрос находится в режиме ожидания.</p></li>
    </ul></td>
    </tr>
    <tr class="even">
    <td><p><strong>Tenant-Id</strong></p></td>
    <td><p>Зарезервировано для внутреннего использования корпорацией Майкрософт.</p></td>
    </tr>
    <tr class="odd">
    <td><p><strong>Server-url</strong></p></td>
    <td><p>Указывает URL-адрес сервера службы управления правами, доступ к которому выполняется во время операции.</p></td>
    </tr>
    <tr class="even">
    <td><p><strong>Context</strong></p></td>
    <td><p>Используется вызывающим процессом, чтобы объединить несколько транзакций службы управления правами. Допустимыми являются следующие значения:</p>
    <ul>
    <li><p><code>MessageID: &lt;Actual message ID&gt;</code></p></li>
    <li><p><code>MailboxGuid: &lt;Mailbox GUID&gt;</code></p></li>
    <li><p><code>AttachmentFileName: &lt;File name&gt;</code></p></li>
    </ul></td>
    </tr>
    <tr class="odd">
    <td><p><strong>Transaction-id</strong></p></td>
    <td><p>Определяет уникальную транзакцию. Всем событиям, происходящим во время одной транзакции, присваивается один и тот же идентификатор.</p></td>
    </tr>
    </tbody>
    </table>


В начало

## Управление журналами IRM

Для каждой роли сервера с включенными функциями управления правами на доступ к данным (IRM) ведение журналов IRM активируется по умолчанию. Для каждой роли сервера можно изменить указанную ниже конфигурацию журналов IRM с помощью соответствующего командлета **Set**. Например, чтобы настроить ведение журналов управления правами на доступ к данным (IRM) для сервера почтовых ящиков, используйте командлет **Set-MailboxServer**.

### Параметры конфигурации журналов IRM

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><em>IrmLogEnabled</em></p></td>
<td><p>Включает ведение журналов транзакций IRM. По умолчанию ведение журналов управления правами на доступ к данным включено. Чтобы отключить ведение журналов управления правами на доступ к данным (IRM) для роли сервера, установите для этого параметра значение <code>$false</code>.</p></td>
</tr>
<tr class="even">
<td><p><em>IrmLogMaxAge</em></p></td>
<td><p>Указывает максимальный срок хранения файла журнала управления правами на доступ к данным. Файлы старше этого значения удаляются. Значение по умолчанию равно <code>30.00:00:00</code> (30 дням).</p></td>
</tr>
<tr class="odd">
<td><p><em>IrmLogMaxDirectorySize</em></p></td>
<td><p>Указывает максимальный размер всех журналов IRM в каталоге журналов подключений. Когда размер каталога достигает максимального значения, сервер в первую очередь удаляет самые старые файлы. По умолчанию значение равно <code>250 MB</code>.</p></td>
</tr>
<tr class="even">
<td><p><em>IrmLogMaxFileSize</em></p></td>
<td><p>Указывает максимальный размер одного файла журнала. При достижении файлом журнала указанного размера создается новый файл журнала с последующим номером экземпляра. По умолчанию значение равно <code>10 MB</code>.</p></td>
</tr>
<tr class="odd">
<td><p><em>IrmLogPath</em></p></td>
<td><p>Указывает расположение журнала управления правами на доступ к данным. Путь по умолчанию: %ExchangeInstallPath%Logging\IRMLogs.</p></td>
</tr>
</tbody>
</table>


Дополнительные сведения о синтаксисе и параметрах см. в следующих разделах:

  - [Set-MailboxServer](https://technet.microsoft.com/ru-ru/library/aa998651\(v=exchg.150\))

  - [Set-ClientAccessServer](https://technet.microsoft.com/ru-ru/library/bb125157\(v=exchg.150\))

  - [Set-TransportService](https://technet.microsoft.com/ru-ru/library/jj215682\(v=exchg.150\))

В начало

