---
title: 'Настройка интервалов повторной отправки, повторной передачи и истечения срока действия сообщений: Exchange 2013 Help'
TOCTitle: Настройка интервалов повторной отправки, повторной передачи и истечения срока действия сообщений
ms:assetid: 5420124f-aa4c-4702-b493-40a9a7edb786
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Aa998043(v=EXCHG.150)
ms:contentKeyID: 51408038
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Настройка интервалов повторной отправки, повторной передачи и истечения срока действия сообщений

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2014-12-16_

В Microsoft Exchange Server 2013 можно настраивать интервалы повторной отправки, повторной передачи и срока действия сообщений в транспортной службе на серверах почтовых ящиков и пограничных транспортных серверах. Описание этих настроек см. в разделе [Интервалы повторной отправки, повторной передачи и истечения срока действия сообщений](message-retry-resubmit-and-expiration-intervals-exchange-2013-help.md).

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения каждой процедуры: 10 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье Записи "Транспортная служба" и "Пограничный транспортный сервер" в разделе [Разрешения потока обработки почты](mail-flow-permissions-exchange-2013-help.md).

  - Все специальные настройки, выполненные для каждого сервера в XML-файлах конфигурации приложения Exchange, например в файлах web.config на серверах клиентского доступа или файлах EdgeTransport.exe.config на серверах почтовых ящиков, будут перезаписаны после установки накопительного пакета обновления Exchange. Обязательно сохраните нужные данные, чтобы упростить перенастройку сервера после установки. Эти параметры необходимо перенастроить после установки накопительного пакета обновления Exchange.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.


## Что необходимо сделать?

## Использовать файл EdgeTransport.exe.config для настройки количества и интервалов повторных попыток очереди при сбое, интервала между повторными попытками для очереди доставки в почтовые ящики и максимального времени простоя перед интервалами повторной передачи.

Для настройки количества и интервалов повторных попыток очереди при сбое, интервала между повторными попытками для очереди доставки в почтовые ящики и максимального времени простоя перед интервалами повторной передачи необходимо изменить ключи в XML-файле конфигурации приложения %ExchangeInstallPath%Bin\\EdgeTransport.exe.config на сервере почтовых ящиков или пограничном транспортном сервере. Изменения в этом файле применяются после перезапуска службы транспорта Microsoft Exchange. При перезапуске этой службы поток почты на сервере временно прерывается.

1.  В командной строке на сервере почтовых ящиков или пограничном транспортном сервере откройте файл EdgeTransport.exe.config в Блокноте, выполнив следующую команду:
    
        Notepad %ExchangeInstallPath%Bin\EdgeTransport.exe.config

2.  В разделе `<appSettings>` найдите следующие ключи.
    
        <add key="QueueGlitchRetryCount" value="<Integer>" />
        <add key="QueueGlitchRetryInterval" value="<hh:mm:ss>" />
        <add key="MailboxDeliveryQueueRetryInterval" value="<hh:mm:ss>" />
        <add key="MaxIdleTimeBeforeResubmit" value="<hh:mm:ss>" />
    
    В этом примере изменяется значение количества повторных попыток очереди при сбое на 6, интервал повторных попыток очереди при сбое на 30 секунд, интервал между повторными попытками для очереди доставки в почтовые ящики на 3 минуты, а максимальное время простоя перед интервалами повторной передачи — на 6 часов.
    
        <add key="QueueGlitchRetryCount" value="6" />
        <add key="QueueGlitchRetryInterval" value="00:00:30" />
        <add key="MailboxDeliveryQueueRetryInterval" value="00:03:00" />
        <add key="MaxIdleTimeBeforeResubmit" value="6:00:00" />

3.  Закончив, сохраните и закройте файл EdgeTransport.exe.config.

4.  Перезапустите службу транспорта Microsoft Exchange, выполнив следующую команду:
    
        net stop MSExchangeTransport && net start MSExchangeTransport

## Настроить количество повторных попыток при временной ошибке, интервал повторной попытки при временной ошибке и интервал повторной попытки при ошибке исходящего подключения

Количество повторных попыток при временной ошибке определяет количество попыток подключения, которые выполняются после того, как оказались неудачными попытки подключения, контролируемые ключами `QueueGlitchRetryCount` и `QueueGlitchRetryInterval`. По умолчанию количество повторных попыток при временной ошибке равно 6. Допустимый диапазон для этого параметра — от 0 до 15. Если установить для количества повторных попыток при временной ошибке значение 0, следующая попытка подключения будет контролироваться *интервалом между повторными попытками при ошибке исходящего подключения*.

Интервал между повторными попытками при временной ошибке определяет интервал между последовательными попытками подключения, указываемыми количеством повторных попыток при временной ошибке. В транспортной службе сервера почтовых ящиков интервал между повторными попытками при временной ошибке по умолчанию составляет 5 минут. На пограничном транспортном сервере интервал между повторными попытками при временной ошибке по умолчанию составляет 10 минут.

Интервал между повторными попытками подключения при сбое исходящего подключения определяет интервал между повторными попытками подключения при случившейся ранее ошибке исходящего подключения. Количество закончившихся ошибкой попыток управляется количеством повторных попыток при временной ошибке и интервалом между повторными подключениями при временной ошибке. По умолчанию интервал между повторными попытками при ошибке в транспортной службе на сервере почтовых ящиков составляет 10 минут. Значением по умолчанию для сервера пограничного транспорта является 30 минут.

## Использовать Центр администрирования Exchange для настройки количества повторных попыток при временной ошибке, интервала повторной попытки при временной ошибке или интервала повторной попытки при ошибке исходящего подключения

1.  В Центре администрирования Exchange перейдите в раздел **Серверы** \> **Серверы**, выберите сервер, нажмите кнопку **Изменить**![Значок редактирования](images/Bb124582.6f53ccb2-1f13-4c02-bea0-30690e6ea71d(EXCHG.150).gif "Значок редактирования"), а затем щелкните **Ограничения транспорта**.

2.  В разделе **Повторные попытки** введите значение параметров **Интервал повторной попытки при ошибке исходящего подключения (секунд)**, **Интервал повторной попытки при временной ошибке (минут)** или **Количество повторных попыток при временной ошибке**.

3.  Завершив настройку, нажмите кнопку **Сохранить**.

## Использовать командную консоль для настройки количества повторных попыток при временной ошибке, интервала повторной попытки при временной ошибке или интервала повторной попытки при ошибке исходящего подключения

Для настройки количества повторных попыток при временной ошибке, интервала повторной попытки при временной ошибке и интервала повторной попытки при ошибке исходящего подключения в транспортной службе на сервере почтовых ящиков или пограничном транспортном сервере введите команду в следующем формате.

    Set-TransportService <ServerIdentity> -TransientFailureRetryCount <Integer> -TransientFailureRetryInterval <hh:mm:ss> -OutboundConnectionFailureRetryInterval <dd.hh:mm:ss>

В этом примере изменяются следующие значения на сервере почтовых ящиков с именем Mailbox01: на пограничном транспортном сервере Exchange01.

  - Количество повторных попыток при временной ошибке равно 8.

  - Интервал повторной попытки при временной ошибке равен 1 минуте.

  - Интервал повторной попытки при ошибке исходящего подключения равен 45 минутам.

<!-- end list -->

    Set-TransportService Mailbox01 -TransientFailureRetryCount 8 -TransientFailureRetryInterval 00:01:00 -OutboundConnectionFailureRetryInterval 00:45:00

> [!NOTE]  
> Параметры <em>TransientFailureRetryCount</em> и <em>TransientFailureRetryInterval</em> также доступны в командлете <strong>Set-FrontEndTransportService</strong> для внешней службы транспорта на серверах клиентского доступа.


## Настроить количество повторных попыток при временной ошибке, интервал повторной попытки при временной ошибке и интервал повторной попытки при ошибке исходящего подключения

## Использовать Центр администрирования Exchange для настройки количества повторных попыток при временной ошибке, интервала повторной попытки при временной ошибке и интервала повторной попытки при ошибке исходящего подключения

1.  В Центре администрирования Exchange выберите раздел **Серверы** \> **Серверы**, выберите сервер, нажмите кнопку **Изменить**![Значок редактирования](images/Bb124582.6f53ccb2-1f13-4c02-bea0-30690e6ea71d(EXCHG.150).gif "Значок редактирования"), а затем щелкните **Ограничения транспорта**.

2.  В разделе **Повторные попытки** введите значение параметров **Интервал повторной попытки при ошибке исходящего подключения (секунд)**, **Интервал повторной попытки при временной ошибке (минут)** или **Количество повторных попыток при временной ошибке**.

3.  Завершив настройку, нажмите кнопку **Сохранить**.

## Использовать командную консоль для настройки количества повторных попыток при временной ошибке, интервала повторной попытки при временной ошибке или интервала повторной попытки при ошибке исходящего подключения

Для настройки количества повторных попыток при временной ошибке, интервала повторной попытки при временной ошибке и интервала повторной попытки при ошибке исходящего подключения в транспортной службе на сервере почтовых ящиков или пограничном транспортном сервере введите команду в следующем формате.

    Set-TransportService <ServerIdentity> -TransientFailureRetryCount <Integer> -TransientFailureRetryInterval <hh:mm:ss> -OutboundConnectionFailureRetryInterval <dd.hh:mm:ss>

В этом примере изменяются следующие значения на сервере почтовых ящиков с именем Mailbox01: на пограничном транспортном сервере Exchange01.

  - Количество повторных попыток при временной ошибке равно 8.

  - Интервал повторной попытки при временной ошибке равен 1 минуте.

  - Интервал повторной попытки при ошибке исходящего подключения равен 45 минутам.

<!-- end list -->

    Set-TransportService Mailbox01 -TransientFailureRetryCount 8 -TransientFailureRetryInterval 00:01:00 -OutboundConnectionFailureRetryInterval 00:45:00

> [!NOTE]  
> Параметры <em>TransientFailureRetryCount</em> и <em>TransientFailureRetryInterval</em> также доступны в командлете <strong>Set-FrontEndTransportService</strong> для внешней службы транспорта на серверах клиентского доступа.


## Использовать командную консоль для настройки интервала повторной отправки сообщения

По умолчанию интервал для повторной отправки сообщения равен `00:15:00` или 15 минутам. Рекомендуется изменять значение по умолчанию только после получения соответствующих указаний от службы технической поддержки Майкрософт.

Для настройки интервала повторной отправки сообщения введите команду в следующем формате.

    Set-TransportService <ServerIdentity> -MessageRetryInterval <dd.hh:mm:ss>

В этом примере интервал повторной отправки сообщения на сервере почтовых ящиков с именем Mailbox01 меняется на значение 20 минут.

    Set-TransportService Mailbox01 -MessageRetryInterval 00:20:00

## Настроить время ожидания для уведомления о состоянии задержанной доставки

Для настройки времени ожидания для уведомления о состоянии задержанной доставки можно использовать Центр администрирования Exchange или командную консоль. Эта настройка применима только к локальному транспортному серверу. Для включения и отключения отправки уведомлений о состоянии задержанной доставки для внутренних или внешних отправителей можно использовать только командную консоль. Эти настройки применяются ко всем транспортным серверам в организации.

> [!NOTE]  
> На транспортных серверах-концентраторах Exchange 2007 все параметры <em>ExternalDSN*</em> и <em>InternalDSN*</em> доступны в командлете <strong>Set-TransportServer</strong>, а не в командлете <strong>Set-TransportConfig</strong>. Если в вашей организации есть транспортные серверы-концентраторы Exchange 2007, необходимо изменить эти значения с помощью командлета <strong>Set-TransportServer</strong> на каждом транспортном сервере-концентраторе Exchange 2007.


## Настроить интервал ожидания уведомления о состоянии задержанной доставки с помощью Центра администрирования Exchange

1.  В Центре администрирования Exchange выберите раздел **Серверы** \> **Серверы**, выберите сервер, нажмите кнопку **Изменить**![Значок редактирования](images/Bb124582.6f53ccb2-1f13-4c02-bea0-30690e6ea71d(EXCHG.150).gif "Значок редактирования"), а затем щелкните **Ограничения транспорта**.

2.  В разделе **Уведомления** введите значение для параметра **Уведомить отправителя при задержке сообщения более (часов)**.

3.  Завершив настройку, нажмите кнопку **Сохранить**.

## Настроить интервал ожидания уведомления о состоянии задержанной доставки с помощью командной консоли

Для настройки интервала повторной отправки сообщения введите команду в следующем формате.

    Set-TransportService <ServerIdentity> -DelayNotificationTimeout <dd.hh:mm:ss>

В этом примере интервал ожидания уведомления о состоянии задержанной доставки на сервере почтовых ящиков с именем Mailbox01 меняется на значение 6 минут.

    Set-TransportService Mailbox01 -DelayNotificationTimeout 06:00:00

## Использовать командную консоль для включения или отключения отправки уведомлений о состоянии задержанной доставки для внешних или внутренних отправителей сообщений

Для настройки уведомлений о состоянии задержанной доставки введите команду в следующем формате.

    Set-TransportConfig -ExternalDelayDSNEnabled <$true | $false> -InternalDelayDSNEnabled <$true |$false>

В этом примере запрещается отправка уведомлений о состоянии задержанной доставки внешним отправителям.

    Set-TransportConfig -ExternalDelayDSNEnabled $false

В этом примере запрещается отправка уведомлений о состоянии задержанной доставки внутренним отправителям.

    Set-TransportConfig -InternalDelayDSNEnabled $false

## Настроить интервал срока действия сообщений

## Использовать Центр администрирования Exchange для настройки интервала срока действия сообщений

1.  В Центре администрирования Exchange выберите раздел **Серверы** \> **Серверы**, выберите сервер, нажмите кнопку **Изменить**![Значок редактирования](images/Bb124582.6f53ccb2-1f13-4c02-bea0-30690e6ea71d(EXCHG.150).gif "Значок редактирования"), а затем щелкните **Ограничения транспорта**.

2.  В разделе **Срок действия сообщений** введите значение для параметра **Максимальное время с момента отправки (дней)**.

3.  Завершив настройку, нажмите кнопку **Сохранить**.

## Использовать командную консоль для настройки интервала срока действия сообщений

Чтобы настроить интервал срока действия сообщения введите команду в следующем формате.

    Set-TransportService <ServerIdentity> -MessageExpirationTimeout <dd.hh:mm:ss>

В этом примере на сервере Exchange с именем Mailbox01 интервал срока действия сообщения меняется на 4 дня.

    Set-TransportService Mailbox01 -MessageExpirationTimeout 4.00:00:00

