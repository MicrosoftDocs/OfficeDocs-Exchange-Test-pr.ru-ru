---
title: 'Ведение журнала протокола: Exchange 2013 Help'
TOCTitle: Ведение журнала протокола
ms:assetid: 40da446b-bcc3-4a97-ace7-a54f6ddebd79
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Aa997624(v=EXCHG.150)
ms:contentKeyID: 50487951
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Ведение журнала протокола

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2015-03-09_

Ведение журнала протокола предназначено для записи SMTP-диалогов, происходящих между серверами обмена сообщениями при доставке сообщений. Эти SMTP-диалоги ведутся в соединителях отправки и получения, настроенных в службе транспорта переднего плана на серверах клиентского доступа, службе транспорта на серверах почтовых ящиков и службе транспорта почтовых ящиков на серверах почтовых ящиков. Можно использовать ведение журнала протокола для диагностики неполадок при обработке потока почтовых сообщений.

По умолчанию ведение журнала протокола отключено на всех соединителях отправления и соединителях приема. Ведение протокола включается или отключается отдельно на каждом из соединителей. Прочие параметры ведения журнала протокола задаются для всех соединителей получения или всех соединителей отправки, настроенных в каждой отдельной службе транспорта на сервере. Все соединители получения в службе транспорта совместно используют одни и те же файлы и параметры журнала протокола. Эти файлы и параметры хранятся отдельно от файлов и параметров журнала протокола соединителей отправки, настроенных в службе транспорта на том же сервере.

Следующие параметры доступны для журналов протокола всех соединителей отправки и получения в службе транспорта на сервере Exchange.

  - Параметр, указывающий местоположение файлов журнала протокола соединителя отправления или приема.

  - Параметр, указывающий максимальный размер файлов журнала протокола соединителя отправления или приема. Значение по умолчанию: 10 мегабайт (МБ).

  - Параметр, указывающий максимальный размер каталога, содержащего файлы журнала протокола соединителя отправления или приема. Размер по умолчанию — 250 МБ.

  - Параметр, указывающий максимальное время хранения файлов журнала протокола соединителя отправления или приема. Время хранения по умолчанию равно 30 дням.

По умолчанию Exchange использует циклическое ведение журналов для ограничения размеров журналов протоколов на основе размера и возраста файла. Это позволяет контролировать использование пространства жесткого диска файлами журнала.

В службе транспорта на каждом сервере почтовых ящиков, а также в службе транспорта переднего плана на каждом сервере клиентского доступа существует специальный соединитель отправки, называемый внутриорганизационным. Этот соединитель создается неявно, является невидимым и не требует управления. Внутриорганизационный соединитель отправки используется следующими службами транспорта.

  - **Транспортная служба на серверах почтовых ящиков**
    
      - Ретранслирует сообщения в службу транспорта и службу транспорта почтовых ящиков на других серверах почтовых ящиков Exchange 2013 в организации.
    
      - Ретранслирует сообщения на другие транспортные серверы-концентраторы Exchange 2007 или Exchange 2010 в организации.
    
      - Ретранслирует сообщения на пограничные транспортные серверы в сети периметра.

  - **Служба транспорта переднего плана на серверах клиентского доступа.**   Ретранслирует сообщения в службу транспорта на серверах почтовых ящиков Exchange 2013 в организации.

В службе транспорта на каждом сервере почтовых ящиков существует эквивалентный соединитель отправки, называемый соединителем отправки для доставки в почтовые ящики. Этот соединитель также создается неявно, является невидимым и не требует управления. Соединитель отправки для доставки в почтовые ящики используется для ретрансляции сообщений в службу транспорта и службу транспорта почтовых ящиков на других серверах почтовых ящиков в организации.

По умолчанию ведение журнала протокола для этого соединителя отправки также отключено. Можно включить или отключить ведение журнала протокола для него с помощью параметра *MailboxDeliveryConnectorProtocolLoggingLevel* командлета **Set-MailboxTransportService**. При включении ведения журнала протокола для соединителя отправки для доставки в почтовые ящики записи ведутся в журналах протокола соединителя отправки, настроенных в службе транспорта почтовых ящиков на сервере почтовых ящиков.

**Содержание**

Структура файлов журнала протокола

Сведения, записываемые в журнал протокола

## Структура файлов журнала протокола

По умолчанию файлы протокола размещаются в следующих папках:

  - **Файлы журнала протокола для соединителя получения в службе транспорта на серверах почтовых ящиков:**    %ExchangeInstallPath%TransportRoles\\Logs\\Hub\\ProtocolLog\\SmtpReceive

  - **Файлы журнала протокола для соединителя получения в службе транспорта почтовых ящиков на серверах почтовых ящиков:**    %ExchangeInstallPath%TransportRoles\\Logs\\Mailbox\\ProtocolLog\\SmtpReceive

  - **Файлы журнала протокола для соединителя получения в службе транспорта переднего плана на серверах клиентского доступа:**    %ExchangeInstallPath%TransportRoles\\Logs\\FrontEnd\\ProtocolLog\\SmtpReceive

  - **Файлы журнала протокола для соединителя отправки в службе транспорта на серверах почтовых ящиков:**    %ExchangeInstallPath%TransportRoles\\Logs\\Hub\\ProtocolLog\\SmtpSend

  - **Файлы журнала протокола для соединителя отправки в службе транспорта почтовых ящиков на серверах почтовых ящиков:**    %ExchangeInstallPath%TransportRoles\\Logs\\Mailbox\\ProtocolLog\\SmtpSend

  - **Файлы журнала протокола для соединителя отправки в службе транспорта переднего плана на серверах клиентского доступа:**    %ExchangeInstallPath%TransportRoles\\Logs\\FrontEnd\\ProtocolLog\\SmtpSend

Имена файлов журнала в каждом каталоге журнала протокола должны иметь следующий вид: *prefixyyyymmdd-nnnn*.log. Заполнители обозначают следующее:

  - Заполнитель *prefix* имеет значение SEND для соединителей отправления и значение RECV для соединителей приема.

  - Заполнитель *ггггммдд* — это дата в формате UTC (Coordinated Universal Time) создания файла журнала. При этом заполнитель *yyyy* обозначает год, *mm* — месяц, а *dd* — день.

  - Заменитель *nnnn* представляет собой порядковый номер, который каждый день начинается со значения 1.

Сведения записываются в файл журнала до тех пор, пока размер файла не достигнет заданного наибольшего значения, и не откроется новый файл журнала, имеющий следующий порядковый номер. Это процесс повторяется на протяжении всего дня. При циклическом ведении журнала, когда каталог журнала протокола достигает заданного наибольшего размера или когда файл журнала достигает заданного наибольшего срока хранения, удаляются самые старые файлы журнала.

Файлы журнала протокола представляют собой текстовые файлы в формате данных с разделителями-запятыми (CSV). Каждый файл журнала протокола снабжен заголовком, содержащим следующие сведения:

  - **\#Software**   Название программного обеспечения, создавшего файл журнала протокола. Как правило, значением является: Microsoft Exchange Server.

  - **\#Version**   Номер версии программного обеспечения, создавшего файл журнала протокола. Текущее значение — 15.0.0.0.

  - **\#Log-Type**   Значение типа журнала в данном поле равно "SMTP Receive Protocol Log" или "SMTP Send Protocol Log".

  - **\#Date**   Дата и время создания файла журнала в формате UTC. Дата и время в формате UTC переводятся в формат по стандарту ISO 8601: *yyyy-mm-dd*T*hh:mm:ss.fff*Z, где *yyyy* — год, *mm* — месяц, *dd* — день, *hh* — час, *mm* — минута, *ss* — секунда, *fff* — доли секунды. "T" указывает на начало кода времени. "Z" значит "время зулу" (еще одно обозначение формата UTC).

  - **\#Fields**   Разделенные запятыми имена полей, используемые в файлах журнала протокола.

В начало

## Сведения, записываемые в журнал протокола

В журнале протокола каждое событие хранится в отдельной строке. Сведения, хранящиеся в каждой строке, сгруппированы по полям. Поля разделяются запятыми. В следующей таблице описаны поля, используемые для классификации каждого протокола.

### Поля, используемые для классификации каждого события протокола

<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Имя поля</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>date-time</strong></p></td>
<td><p>Дата и время события протокола в формате UTC. Дата и время в формате UTC переводятся в формат по стандарту ISO 8601: <em>yyyy-mm-dd</em>T<em>hh:mm:ss.fff</em>Z, где <em>yyyy</em> — год, <em>mm</em> — месяц, <em>dd</em> — день, <em>hh</em> — час, <em>mm</em> — минута, <em>ss</em> — секунда, <em>fff</em> — доли секунды. &quot;T&quot; указывает на начало кода времени. &quot;Z&quot; значит &quot;время зулу&quot; (еще одно обозначение формата UTC).</p></td>
</tr>
<tr class="even">
<td><p><strong>connector-id</strong></p></td>
<td><p>Различающееся имя (DN) соединителя, связанного с SMTP-событием.</p></td>
</tr>
<tr class="odd">
<td><p><strong>session-id</strong></p></td>
<td><p>Идентификатор GUID, уникальный для каждого сеанса SMTP, но идентичный для каждого события, связанного с сеансом SMTP.</p></td>
</tr>
<tr class="even">
<td><p><strong>sequence-number</strong></p></td>
<td><p>Значение счетчика, которое начинается с 0 и увеличивается на единицу для каждого события в рамках одного SMTP-сеанса.</p></td>
</tr>
<tr class="odd">
<td><p><strong>local-endpoint</strong></p></td>
<td><p>Локальная конечная точка SMTP-сеанса. Она включает в себя IP-адрес и номер порта TCP в формате <em>&lt;IP-адрес&gt;</em>:<em>&lt;порт&gt;</em>.</p></td>
</tr>
<tr class="even">
<td><p><strong>remote-endpoint</strong></p></td>
<td><p>Удаленная конечная точка SMTP-сеанса. Она включает в себя IP-адрес и номер порта TCP в формате <em>&lt;IP-адрес&gt;</em>:<em>&lt;порт&gt;</em>.</p></td>
</tr>
<tr class="odd">
<td><p><strong>event</strong></p></td>
<td><p>Одиночный символ, представляющий событие протокола. Для события возможны следующие значения.</p>
<ul>
<li><p><strong>+</strong>   Подключение</p></li>
<li><p><strong>-</strong>   Отключение</p></li>
<li><p><strong>&gt;</strong>   Отправка</p></li>
<li><p><strong>&lt;</strong>   Прием</p></li>
<li><p><strong>*</strong>   Сведения</p></li>
</ul></td>
</tr>
<tr class="even">
<td><p><strong>data</strong></p></td>
<td><p>Текстовые данные, связанные с SMTP-событием.</p></td>
</tr>
<tr class="odd">
<td><p><strong>context</strong></p></td>
<td><p>Дополнительные содержательные сведения, которые могут быть связаны с SMTP-событием.</p></td>
</tr>
</tbody>
</table>


Одиночный SMTP-диалог, отражающий отправку или получение одиночного сообщения электронной почты, формирует несколько SMTP-событий. Указанные SMTP-события приводят к созданию нескольких строк, подлежащих записи в журнал протокола. Несколько SMTP-диалогов, отражающих отправку или прием нескольких сообщений электронной почты, могут произойти одновременно. При этом попеременно создаются записи журнала протокола из различных SMTP-диалогов. Можно использовать поля идентификатора сеанса и порядкового номера для сортировки записей журнала протокола по SMTP-диалогам.

В начало

