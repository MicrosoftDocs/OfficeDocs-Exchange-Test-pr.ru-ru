---
title: 'Сценарий. Развертывание политик адресных книг: Exchange 2013 Help'
TOCTitle: Сценарий. Развертывание политик адресных книг
ms:assetid: 6ac3c87d-161f-447b-afb2-149ae7e3f1dc
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ657455(v=EXCHG.150)
ms:contentKeyID: 50488364
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Сценарий. Развертывание политик адресных книг

 

_**Применимо к:**Exchange Online, Exchange Server 2013_

_**Последнее изменение раздела:**2016-12-09_

## Сценарии развертывания

В приведенных ниже трех сценариях описаны возможные решения развертывания для трех различных типов организаций. Хотя есть много сценариев, здесь описаны самые популярные. Списки адресов и глобальные списки адресов (GAL) в этих сценариях создаются с помощью фильтров, например настраиваемых атрибутов, которые обеспечивают логическую группировку объектов.

## Сценарий 1. Две отдельные компании — одна организация Exchange

Такой сценарий применим для правительственных учреждений, подразделений или отделов, которые имеют общую инфраструктуру, но не имеют общей подчиненности и общих сотрудников. Кроме того, эти подразделения, не имеют каких-то особых требований к безопасности или конфиденциальности. В этом сценарии создаются две политики адресных книг (ABP), в которых работники могут видеть только членов из той же организации при просмотре глобального списка адресов или членства в других группах рассылки. Кроме того, никто из пользователей не будет участником групп рассылки, охватывающих всю организацию.

![Политики адресных книг с двумя отдельными компаниями](images/JJ657455.b4fc82da-a659-4ade-ba33-d55d90dcf204(EXCHG.150).gif "Политики адресных книг с двумя отдельными компаниями")

Политики адресных книг Contoso и Humungous были созданы с помощью следующих списков адресов, глобальных списков адресов, списков помещений, а также автономных адресных книг, которые были созданы с использованием фильтра получателей, группировавшего объекты с помощью такого фильтра, как, например, фильтр настраиваемых атрибутов. Так как две компании отделены друг от друга и взаимодействие между ними отсутствует, у них нет общих списков адресов.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p></p></td>
<td><p>Contoso</p></td>
<td><p>Humungous Insurance</p></td>
</tr>
<tr class="even">
<td><p>Списки адресов</p></td>
<td><p>AL_CON_Groups</p>
<p>AL_CON_Users</p>
<p>AL_CON_Contacts</p></td>
<td><p>AL_HI_Groups</p>
<p>AL_HI_Users</p>
<p>AL_HI_Contacts</p></td>
</tr>
<tr class="odd">
<td><p>Глобальный список адресов</p></td>
<td><p>GAL_CON</p></td>
<td><p>GAL_HI</p></td>
</tr>
<tr class="even">
<td><p>Список адресов помещений</p></td>
<td><p>AL_CON_Rooms</p></td>
<td><p>AL_HI_Rooms</p></td>
</tr>
<tr class="odd">
<td><p>Автономная адресная книга</p></td>
<td><p>OAB_CON</p></td>
<td><p>OAB_HI</p></td>
</tr>
</tbody>
</table>


## Сценарий 2. Две компании, общий исполнительный директор

В этом сценарии Fabrikam и Tailspin Toys используют одну организацию Exchange, и у них один и тот же исполнительный директор. Он является единственным сотрудником обеих компаний сразу. В этом сценарии требуется использовать три политики адресной книги, обладающие приведенными ниже характеристиками.

  - Пользователи Tailspin Toys могут просматривать только пользователей Tailspin Toys при просмотре глобального списка адресов.

  - Пользователей Fabrikam могут видеть только пользователей Fabrikam при просмотре глобального списка адресов.

  - В каждой компании существует группа рассылки SeniorLeaders, включающая высокопоставленных руководителей этой компании и исполнительного директора.

  - Пользователи, просматривающие членство директора в группах, будут видеть только группы, относящиеся к своей компании. Группы из другой компании им не видны.

  - Создаются три политики адресных книг: **Fab**, **Tail** и **CEO**.

![Две компании, один исполнительный директор](images/Hh529948.c87a5654-d456-4688-acb2-0be15ba1cda6(EXCHG.150).gif "Две компании, один исполнительный директор")


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p></p></td>
<td><p>Fabrikam</p></td>
<td><p>Tailspin Toys</p></td>
<td><p>Исполнительный директор</p></td>
</tr>
<tr class="even">
<td><p>Списки адресов</p></td>
<td><p>AL_FAB_Users_DGs</p>
<p>AL_FAB_Contacts</p></td>
<td><p>AL_TAIL_Users_DGs</p>
<p>AL_TAIL_Contacts</p></td>
<td><p>AL_FAB_Users_DGs</p>
<p>AL_FAB_Contacts</p>
<p>AL_TAIL_Users_DGs</p>
<p>AL_TAIL_Contacts</p></td>
</tr>
<tr class="odd">
<td><p>Глобальный список адресов</p></td>
<td><p>GAL_FAB</p></td>
<td><p>GAL_TAIL</p></td>
<td><p>Default GAL (список по умолчанию)</p></td>
</tr>
<tr class="even">
<td><p>Список адресов помещений</p></td>
<td><p>AL_FAB_Rooms</p></td>
<td><p>AL_TAIL_Rooms</p></td>
<td><p>Default All Rooms (Все помещения, список по умолчанию)</p></td>
</tr>
<tr class="odd">
<td><p>Автономная адресная книга</p></td>
<td><p>OAB_FAB</p></td>
<td><p>OAB_TAIL</p></td>
<td><p>Автономная адресная книга по умолчанию</p></td>
</tr>
</tbody>
</table>


Когда исполнительный директор добавляется в группы рассылки в каждой организации и попадает в область политики адресной книги каждой компании, то он становится виден для каждой компании. Исполнительный директор может создавать группы рассылки, охватывающие обе компании, которые будут видны в каждой компании, но их участникам будут доступны только члены группы из своей организации.

## Сценарий 3. Образование

Этот сценарий применяется в учебных заведениях, где требуется разделить классы для гарантии конфиденциальности учащихся. Сценарий образования обладает приведенными ниже характеристиками.

  - Учащиеся в каждом классе могут работать только с другими учащимися в своем классе, своим преподавателем и директором.

  - Учителя могут видеть только учащихся в своих классах.

  - Учителя могут видеть всех остальных учителей и директора.

  - Группы рассылки создаются для сотрудников и родителей в каждом классе.

![Сценарий изучения политик адресных книг](images/JJ657455.435f3b1a-9752-4c61-ab8a-80115c643d12(EXCHG.150).gif "Сценарий изучения политик адресных книг")


<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="odd">
<td><p></p></td>
<td><p>Students_ClassA</p></td>
<td><p>Teachers_ClassA</p></td>
<td><p>Директор</p></td>
</tr>
<tr class="even">
<td><p>Списки адресов</p></td>
<td><p>AL_ClassAAL_Principal</p></td>
<td><p>AL_ClassAAL_AllTeachersAL_AllGroupsAL_Principal</p></td>
<td><p>AL_ClassA</p>
<p>AL_ClassB</p>
<p>AL_AllTeachers</p>
<p>AL_AllStudents</p>
<p>AL_AllGroups</p></td>
</tr>
<tr class="odd">
<td><p>Глобальный список адресов</p></td>
<td><p>GAL_StudentsClassA</p></td>
<td><p>GAL_TeachersClassA</p></td>
<td><p>GAL_Everyone</p></td>
</tr>
<tr class="even">
<td><p>Список адресов помещений</p></td>
<td><p>AL_BlankRoom</p></td>
<td><p>AL_BlankRoom</p></td>
<td><p>Default All Rooms (Все помещения, список по умолчанию)</p></td>
</tr>
<tr class="odd">
<td><p>Автономная адресная книга</p></td>
<td><p>OAB_StudentsClassA</p></td>
<td><p>OAB_TeachersClassA</p></td>
<td><p>Автономная адресная книга по умолчанию</p></td>
</tr>
</tbody>
</table>


## Рекомендации

При использовании политик адресных книг в организации следует учитывать приведенные ниже факторы.

  - Чтобы политики адресных книг работали надлежащим образом, почтовый ящик пользователя, к которому применяется политика адресной книги, должен располагаться на сервере Exchange 2010 с пакетом обновления 3 (SP3) или сервере Exchange 2013.

  - Не используйте роль сервера клиентского доступа Exchange 2010 на сервере глобального каталога. Это приведет к использованию Active Directory в качестве интерфейса NSPI, а не службы адресных книг Microsoft Exchange. Политики адресных книга могут правильно работать при использовании роли сервера Exchange 2013 на сервере глобального каталога, однако мы не рекомендуем устанавливать Exchange на контроллере домена.

  - Невозможно одновременно использовать иерархические адресные книги и политики адресных книг. Дополнительные сведения см. в разделе [Иерархические адресные книги](hierarchical-address-books-exchange-2013-help.md).

  - Любой пользователь, к которому применяется политика адресной книги, должен содержаться в доступном ему глобальном списке адресов.

  - Если разрешить клиентским приложениям доступ напрямую к Active Directory через LDAP, логика, встроенная в политики адресных книг, работать не будет. Так как Outlook для Mac 2011 и Entourage 2008 используют прямые LDAP-запросы к Active Directory, эти клиентские приложения не будут работать надлежащим образом с политиками адресных книг, если служба автообнаружения предоставляет им контроллер домена или сервер глобального каталога. Outlook для Mac 2011 может использовать службы EWS или локальную автономную адресную книгу для доступа к данным каталога. Однако если Outlook для Mac 2011 может получить прямой доступ к службе LDAP, клиент начнет получать данные о контактах через нее.

  - Глобальный список адресов, используемый в политике адресной книги, должен, по меньшей мере, содержать все списки адресов, определенные и настроенные в политике адресной книги, включая список адресов помещений. Не создавайте глобальный список адресов, содержащий меньше объектов, чем любой из списков адресов, указанных в этой же политике адресной книги.

  - Рекомендуется создать группы рассылки, которые не выходят за пределы виртуальной организации. Создание групп рассылки, содержащих членов различных виртуальных организаций, приведет к возникновению следующих возможных проблем.
    
      - Если члены группы запрашивают отчет о доставке или прочтении при отправке сообщения группе рассылки, они смогут увидеть адреса электронной почты членов группы из других виртуальных организаций
    
      - Если зашифрованное сообщение было отправлено в группу рассылки и некоторые члены группы не имеют действующих цифровых удостоверений, отправитель получит предупреждение, в котором будет указано общее число участников, не имеющих действующие удостоверения, а также список их адресов электронной почты. Однако если некоторые члены с допустимыми цифровыми удостоверениями находятся в другой организации (с точки зрения отправителя), в предупреждение будет включено верное число участников, но будут отсутствовать адреса электронной почты членов из другой организации. В результате общее число не будет совпадать с адресами из списка членов.
        
        Предположим, группа рассылки состоит из пяти членов из двух организаций: агентства А и агентства Б. Три члена — из агентства А, и у одного из них недопустимое цифровое удостоверение. Два других члена — из агентства Б, и у обоих допустимые удостоверения. Если человек из агентства А отправляет зашифрованное сообщение в группу рассылки, он получит предупреждение, в котором говорится, что у трех получателей недопустимые цифровые удостоверения. Однако в этом предупреждении будет указан только один адрес электронной почты получателя из агентства А.
    
      - Политики адресных книг не применяются к командлетам **Get-Group**. Поэтому любой пользователь или процесс, имеющий право на выполнение **Get-Group**, сможет увидеть всех членов любой группы, к которой у него имеется доступ.
        
        Рекомендуется изменить параметры управления группами в параметрах управления OWA, чтобы пользователи не могли использовать Outlook Web App для управления группами. Чтобы запретить пользователям управлять группами с помощью параметров OWA, исключите этих пользователей из роли RBAC MyDistributionGroupMembership. Дополнительные сведения см. в разделе [Роль MyDistributionGroupMembership](mydistributiongroupmembership-role-exchange-2013-help.md).
    
      - Если пользователям разрешено использовать Outlook или Outlook Web App для управления группами, владельцы групп должны иметь доступ к списку членов группы.

  - Все политики адресных книг должны содержать список адресов помещений. Однако если в организации не используются списки адресов помещений, можно создать пустой список адресов помещений по умолчанию.

  - Развертывание политик адресных книг не препятствует пользователям в одной виртуальной организации отправлять электронную почту пользователям в другой виртуальной организации. Если необходимо запретить пользователям отправлять сообщения электронной почты между организациями, рекомендуется создать правило транспорта. Например, чтобы создать правило транспорта, препятствующее получению пользователями домена Contoso сообщений от пользователей домена Fabrikam, но разрешающее руководству домена Fabrikam отправлять сообщения пользователям Contoso, выполните следующую команду в командной консоли:
    
        New-TransportRule -Name "StopFabrikamtoContosoMail" -FromMemberOf "AllFabrikamEmployees" -SentToMemberOf "AllContosoEmployees" -DeleteMessage -ExceptIfFrom seniorleadership@fabrikam.com

  - Если необходимо использовать функцию, подобную политике адресной книги, в клиенте Lync, следует задать атрибут `msRTCSIP-GroupingID` для нужных объектов пользователей. Подробные сведения см. в разделе [Замена PartitionByOU на msRTCSIP-GroupingID](https://go.microsoft.com/fwlink/p/?linkid=232306).

## Общие действия по развертыванию

## Переход с разделения адресных списков к политикам адресной книги

Если в вашей организации настроено разделение списков адресов Exchange 2007 в соответствии с указаниями, изложенными в документе [Настройка виртуальных организаций и разделение список адресов в Exchange 2007](https://go.microsoft.com/fwlink/p/?linkid=109601), сначала необходимо перейти на Exchange Server 2010 с помощью действий, описанных в документе [Переход на политики адресных книг Exchange Server 2010 от разделения списков адресов в Exchange Server 2007](https://go.microsoft.com/fwlink/p/?linkid=235967). Эта процедура потребует простоя, поэтому ее нужно заранее спланировать.

## Развертывание политики адресной книги с нуля

Если в вашей организации осуществляется развертывание ABP Exchange 2013 и не использовалось решение с разделением списков адресов в Exchange 2007, эти инструкции можно использовать для развертывания ABP в организации.

В этом разделе приводятся пошаговые действия по выполнению сценария 2: Сценарий 2. Две компании, общий исполнительный директор. В этом сценарии у двух отдельных компаний (Fabrikam и Tailspin Toys) общий исполнительный директор и все высшее руководство.

## Действие 1. Установка и настройка агента маршрутизации политики адресной книги

Если используются политики адресных книг, и необходимо, чтобы пользователи в отдельных виртуальных организациях не могли просматривать потенциально конфиденциальные сведения друг друга, можно включить агент маршрутизации политики адресных книг. Агент маршрутизации политики адресной книги — это агент транспорта, который выполняется на сервере почтовых ящиков, управляющем разрешением получателей в организации. Когда установлен и настроен агент маршрутизации политики адресной книги, пользователи, которым назначаются различные глобальные списки адресов (GAL), отображаются в качестве внешних получателей, поскольку они не могут просматривать карточки контактов других внешних получателей.

Подробные инструкции см. в разделе [Установка и настройка агента маршрутизации политики адресной книги](install-and-configure-the-address-book-policy-routing-agent-exchange-2013-help.md).

## Действие 2. Разделение виртуальных организаций

При этом потребуется разработать способ разделения организаций. Для разделения виртуальных организаций рекомендуется использовать свойство CustomAttribute1-15 для почтовых ящиков, контактов и группы вместо предварительно подготовленных условных атрибутов, таких как Company, Department или StateOrProvince по следующим причинам:

  - Не все типы объектов получателей имеют заранее подготовленные условные атрибуты в Active Directory. Например, группы рассылки и динамические группы рассылки не поддерживают атрибуты компании, отдела или региона.

  - Не все предустановленные условные атрибуты представлены в командлетах, относящихся ко всем получателям. Например, параметры *Company*, *department* и *StateOrProvince* недоступны в командлетах для пользователей почты, контактов, групп рассылки и общедоступных папок с поддержкой почты.

  - Требуется несколько командлетов для разделения получателей при использовании предварительно подготовленных условных атрибутов. Например, необходимо выполнить командлет Set-User для задания *Company*, *Department*, *StateOrProvince* для UserMailbox после выполнения командлетов **New-Mailbox** или **Set-Mailbox**.

  - Параметры *CustomAttributeX* доступны в командлетах Set-\* для каждого типа получателей, что позволяет завершить разделение в одном командлете Set-

  - Атрибуты CustomAttributeX явным образом зарезервированы для настройки организации и полностью находятся под контролем администраторов организации.

Еще одна рекомендация по разделению организаций — использовать идентификаторы компаний для имен обычных и динамических групп рассылки. В Exchange есть политики именования групп, которые автоматически добавляют суффикс или префикс к имени группы рассылки на основе многих атрибутов пользователя, создающего группу рассылки, включая Company, StateorProvince, Title и CustomAttribute1—CustomAttribute15. Политика именования групп особенно важна, если пользователям разрешено создавать собственные группы рассылки. Подробнее см. в разделе [Создание политики именования групп рассылки](create-a-distribution-group-naming-policy-exchange-2013-help.md).

Политики именования групп не применяются для динамических групп рассылки, поэтому необходимо вручную разделить их и вручную применить политику именования.

## Действие 3. Создание списков адресов, глобальных списков адресов и автономных адресных книг

При создании списков адресов и глобальных списков адресов не используйте параметры "IncludedRecipient" и "ConditionalX", например ConditionalCompany или ConditionalCustomAttribute5. Вместо этого используйте фильтр получателей. Для создания фильтров получателей необходимо использовать командную консоль. Дополнительные сведения о фильтрах получателей см. в разделе [Фильтрация получателей на пограничных транспортных серверах](recipient-filtering-on-edge-transport-servers-exchange-2013-help.md).

При создании ABP вы создаете несколько списков адресов, основываясь на том, как пользователи должны видеть списки адресов в Outlook или Outlook Web App. Эта организация располагает четырьмя списками адресов:

  - AL\_FAB\_Users\_DGs

  - AL\_FAB\_Contacts

  - AL\_TAIL\_Users\_DGs

  - AL\_TAIL\_Contacts

В этом примере создается список адресов AL\_TAIL\_Users\_DGs. Список адресов будет содержать всех пользователей и группы рассылки, где CustomAttribute15 равняется TAIL.

    New-AddressList -Name "AL_TAIL_Users_DGs" -RecipientFilter {((RecipientType -eq 'UserMailbox') -or (RecipientType -eq "MailUniversalDistributionGroup") -or (RecipientType -eq "DynamicDistributionGroup")) -and (CustomAttribute15 -eq "TAIL")}

Дополнительные сведения о создании списков адресов с помощью фильтров получателей см. в разделе [Создание списка адресов с помощью фильтров получателей](create-an-address-list-by-using-recipient-filters-exchange-2013-help.md).

Для создания ABP необходимо предоставить список адресов помещений. Если в организации нет почтовых ящиков ресурсов для оборудования и помещений, стоит создать пустой список адресов помещений. В следующем примере создается пустой список адресов помещений, так как в организации отсутствуют почтовые ящики помещений.

    New-AddressList -Name AL_BlankRoom -RecipientFilter {(Alias -ne $null) -and ((RecipientDisplayType -eq 'ConferenceRoomMailbox') -or (RecipientDisplayType -eq 'SyncedConferenceRoomMailbox'))}

В этом случае компании Fabrikam и Contoso имеют почтовые ящики помещений. В этом примере создается список помещений для Fabrikam с помощью фильтра получателей, где CustomAttribute15 равняется FAB.

    New-AddressList -Name AL_FAB_Room -RecipientFilter {(Alias -ne $null) -and (CustomAttribute15 -eq "FAB")-and (RecipientDisplayType -eq 'ConferenceRoomMailbox') -or (RecipientDisplayType -eq 'SyncedConferenceRoomMailbox')}

Глобальный список адресов, который используется в ABP, должен быть надмножеством списков адресов. Не создавайте глобальный список адресов, в котором число объектов меньше, чем в списках адресов в политике адресной книги. В этом примере для Tailspin Toys создается глобальный список адресов, включающий всех получателей, которые есть в списках адресов и списке адресов помещений.

    New-GlobalAddressList -Name "GAL_TAIL" -RecipientFilter {(CustomAttribute15 -eq "TAIL")}

Подробнее см. в разделе [Создание глобального списка адресов](create-a-global-address-list-exchange-2013-help.md).

При создании автономной адресной книги необходимо включить соответствующий глобальный список адресов при указании параметра *AddressLists* в командлете New- или Set-OfflineAddressBook, чтобы не пропустить записи. В целом можно настроить набор записей, которые пользователь будет видеть, или уменьшить размер автономной адресной книги, указав список AddressLists в AddressLists для New/Set-OfflineAddressBook Если же пользователь должен видеть полный набор записей глобального списка адресов в автономной адресной книге, включите глобальный список адресов в AddressLists.

В этом примере для Fabrikam создается автономная адресная книга с именем OAB\_FAB.

    New-OfflineAddressBook -Name "OAB_FAB" -AddressLists "GAL_FAB"

Подробнее см. в разделе [Создание автономной адресной книги](create-an-offline-address-book-exchange-2013-help.md).

## Действие 4. Создание политик адресных книг

После создания всех требуемых объектов можно создать АВР. В этом примере создается ABP с именем ABP\_TAIL.

    New-AddressBookPolicy -Name "ABP_TAIL" -AddressLists "AL_TAIL_Users_DGs"," AL_TAIL_Contacts" -OfflineAddressBook "\OAB_TAIL" -GlobalAddressList "\GAL_TAIL" -RoomList "\AL_TAIL_Rooms"

Подробнее см. в разделе [Создание политики адресных книг](create-an-address-book-policy-exchange-2013-help.md).

## Действие 5. Назначение политик адресной книги почтовым ящикам

Последний этап процесса — назначение политики адресной книги пользователю. Политики адресных книг вступают в силу, когда приложение пользователя подключается к службе адресных книг Microsoft Exchange на сервере клиентского доступа. Если пользователь уже подключен к Outlook или Outlook Web App, когда к его учетной записи применяется политика адресной книги, ему потребуется закрыть и перезапустить клиентское приложение, чтобы видеть новые списки адресов и глобальный список адресов.

В этом примере значение ABP\_FAB назначается для всех почтовых ящиков, где CustomAttribute15 равняется "FAB".

    Get-Mailbox -resultsize unlimited | where {$_.CustomAttribute15 -eq "TAIL"} | Set-Mailbox -AddressBookPolicy "ABP_TAIL"

Подробнее см. в разделе [Назначение политики адресной книги пользователям почты](assign-an-address-book-policy-to-mail-users-exchange-2013-help.md).

