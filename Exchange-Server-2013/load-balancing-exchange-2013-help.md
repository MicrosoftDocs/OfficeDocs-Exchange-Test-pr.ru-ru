---
title: 'Балансировка нагрузки: Exchange 2013 Help'
TOCTitle: Балансировка нагрузки
ms:assetid: f572c193-6f3a-400e-9085-a9d3e5e18c59
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ898588(v=EXCHG.150)
ms:contentKeyID: 51408105
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Балансировка нагрузки

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2016-12-09_

Балансировка нагрузки позволяет определять, какие серверы будут принимать трафик. Балансировка нагрузки помогает распределить входящие клиентские подключения на различных конечных точках, например серверах клиентского доступа, чтобы ни одна из них не получила непропорциональную долю нагрузки. Балансировка нагрузки также обеспечивает отказоустойчивость в случае сбоя одной или нескольких конечных точек. Используя балансировку нагрузки с Exchange Server 2013, вы будете уверены в том, что пользователи смогут применять функции Exchange в случае сбоя компьютера. Балансировка нагрузки также позволяет развертыванию обрабатывать больший объем трафика по сравнению с одним сервером при использовании одного имени узла для клиентов.

Балансировка нагрузки выполняет две основные задачи. Она сокращает влияние сбоя одного сервера клиентского доступа на одном из сайтов Active Directory. Кроме того, балансировка нагрузки обеспечивает равномерное распределение нагрузки на серверах клиентского доступа.

В Exchange 2013 также входят следующие решения для переключения и отказоустойчивости.

  - Для обеспечения **высокого уровня доступности**Exchange 2013 используются группы доступности базы данных (DAG), которые обеспечивают синхронизацию нескольких копий ваших почтовых ящиков на разных серверах. Таким образом при сбое базы данных почтовых ящиков на одном сервере пользователи могут подключиться к синхронизированной копии базы данных на другом сервере.

  - **Устойчивость сайта.** Вы можете развернуть два сайта Active Directory в различных географических расположениях, синхронизировать данные почтовых ящиков между ними и перенаправить всю нагрузку на один из сайтов при сбое другого.

  - **Оперативное перемещение почтовых ящиков.** Во время оперативного перемещения почтовых ящиков пользователи сохраняют доступ к своим учетным записям электронной почты. Учетные записи пользователей блокируются только на короткое время в конце процесса (когда выполняется окончательная синхронизация). Можно выполнять оперативное перемещение почтовых ящиков между лесами или в одном лесу.

  - **Теневая избыточность**   Теневая избыточность поддерживает доступность и возможность восстановления сообщений во время их передачи. Благодаря теневой избыточности удаление сообщения из баз данных транспорта откладывается до тех пор, пока транспортный сервер не установит, что на всех следующих прыжках для этого сообщения доставка завершена. В случае сбоя на одном из следующих прыжков до получения отчета об успешной доставке сообщение повторно отправляется для доставки на прыжок, на котором доставка не была завершена.

## Изменения архитектуры балансировки нагрузки для Exchange Server 2013

В Exchange Server 2010 подключением и обработкой клиентов занималась роль сервера клиентского доступа. Для этого требовалось выполнять балансировку нагрузки внешних и внутренних подключений Outlook, а также подключений мобильных устройств и сторонних клиентов, в массиве серверов клиентского доступа в развертывании, чтобы добиться отказоустойчивости и эффективного применения серверов. Для многих протоколов клиентского доступа Exchange 2010 требуется привязка между клиентом и определенным сервером клиентского доступа. В частности, для Outlook Web App, панели управления Exchange, веб-служб Exchange, мобильного Outlook, MAPI-подключений TCP/IP для Outlook, Exchange ActiveSync, службы адресной книги Exchange и Remote PowerShell требовалась привязка сервера клиентского доступа к клиенту. В Exchange 2010 были представлены следующие варианты балансировки нагрузки:

  - балансировка сетевой нагрузки Windows на основе соответствия исходному IP-адресу;

  - аппаратная балансировка нагрузки.

Из-за различия требований клиентских протоколов в Exchange 2010 мы рекомендуем использовать решение балансировки нагрузки на уровне 7. Его также называют балансировкой нагрузки на уровне приложений. Оно позволяет использовать сложные правила для определения способа балансировки каждого запроса, попадающего в систему, если все данные взаимодействия между клиентом и сервером будут доступны для логики балансировки нагрузки. Такие правила обеспечивали попадание всех запросов от определенного клиента на одну конечную точку сервера клиентского доступа. Если в Exchange 2010 все запросы от определенного клиента не попадали на одну конечную точку, для которой требовалась привязка, это негативно влияло на работу пользователей. Дополнительные сведения о вариантах балансировки нагрузки Exchange 2010 см. в разделе [Общие сведения о балансировке нагрузки в системе Exchange 2010](https://go.microsoft.com/fwlink/p/?linkid=196447).

В Exchange Server 2013 используется два основных типа сервера: сервер клиентского доступа и сервер почтовых ящиков. Серверы клиентского доступа в Exchange 2013 действуют как облегченные прокси-серверы без состояния, позволяя клиентам подключаться к серверам почтовых ящиков Exchange 2013. Серверы клиентского доступа Exchange 2013 обеспечивают унифицированное пространство имен и проверку подлинности. Кроме того, серверы клиентского доступа Exchange 2013:

  - поддерживают логику прокси-сервера и перенаправления для клиентских протоколов;

  - поддерживают использование балансировки нагрузки на уровне 4.

При использовании привязки сеанса и балансировки нагрузки на уровне 7 все запросы между клиентом и сервером отправляются одной конечной точке, как того требуют различные протоколы. Запросы распределяются на уровне приложений. При балансировке на уровне 4 запросы распределяются на транспортном уровне. Решение балансировки нагрузки распределяет запросы от клиента, который знает только один IP-адрес (который иногда называют виртуальным или VIP-адресом), среди набора серверов, выполняющих задачи. Для определения содержимого запроса необходимо установить подключение между клиентом и сервером, чтобы подсистема балансировки нагрузки выбрала сервер для получения запроса перед изучением его содержимого. Целевой сервер может выбираться различными способами, например циклически, когда каждое входящее подключение переходит на следующий целевой сервер в циклическом списке, или по методу "наименьших подключений", когда подсистема балансировки нагрузки отправляет новое подключение на сервер, у которого на текущий момент меньше всего установленных подключений. Так как привязка к сеансу не требуется, выбор нужной вам архитектуры балансировки нагрузки стал шире и проще. Балансировка нагрузки без привязки к сеансу позволяет увеличить емкость и степень использования подсистемы балансировки нагрузки, так как для поддержки дополнительных вариантов соответствия, например балансировки на основе файлов cookie или кода сеанса SSL, обработка не используется.

## Массивы серверов клиентского доступа и Exchange 2013

В Exchange 2010 мы представили концепцию массива клиентского доступа. После настройки массива клиентского доступа для сайта Active Directory все серверы клиентского доступа на сайте автоматически становятся участниками массива. В текущих сборках Exchange 2013 массив клиентского доступа не требуется, так как развертывание службы с балансировкой нагрузки и высоким уровнем доступности намного проще.

## Решения балансировки нагрузки

Использование аппаратных подсистем балансировки нагрузки для Exchange 2013 поддерживается и дальше. Сведения об устройствах балансировки нагрузки, успешно прошедших проверку с помощью Exchange 2010, которые, вероятно, попадут в окончательный список, утвержденный для Exchange 2013, см. в статье [Развертывание подсистемы балансировки нагрузки Exchange Server 2010](https://go.microsoft.com/fwlink/p/?linkid=261834). Помните, что на этой странице описана более сложная семиуровневая конфигурация устройств балансировки нагрузки, работающих под управлением Exchange 2010. Трафик балансировки нагрузки Exchange 2013 можно значительно упростить, учитывая архитектурные изменения, описанные ранее в этом разделе. Вместо настройки привязки сеанса для всех протоколов Exchange входящие подключения к серверам клиентского доступа Exchange 2013 могут направляться подсистемой балансировки нагрузки на доступный сервер без дополнительной обработки. Аппаратные подсистемы балансировки нагрузки все равно играют важную роль в обеспечении высокого уровня доступности службы Exchange, так как они могут обнаружить сбой сервера клиентского доступа и удалить его из набора серверов, которые будут обрабатывать входящие подключения.

## Балансировка сетевой нагрузки Windows

Балансировка сетевой нагрузки Windows (WNLB) — это наиболее распространенная подсистема балансировки нагрузки для серверов Exchange. Существуют некоторые ограничения, связанные с развертыванием подсистемы WNLB в системе Microsoft Exchange.

  - Подсистему WNLB невозможно использовать на серверах Exchange, на которых используются группы обеспечения доступности баз данных почтовых ящиков, так как балансировка сетевой нагрузки Windows несовместима с отказоустойчивым кластером Windows. При использовании группы обеспечения доступности баз данных Exchange 2013 и необходимости использовать подсистему WNLB требуется установить роль сервера клиентского доступа и роль сервера почтовых ящиков на отдельных серверах.

  - Подсистема WNLB не обнаруживает простои в работе служб. Она обнаруживает только простои в работе серверов по IP-адресу. Это значит, что если в работе определенной веб-службы, например Outlook Web App, происходит сбой, но сервер по-прежнему работает, то подсистема WNLB не обнаружит неполадку и будет маршрутизировать запросы на этот сервер клиентского доступа. Администратору необходимо вручную удалить простаивающий сервер клиентского доступа из пула балансировки нагрузки.

  - Использование WNLB может приводить к переполнению портов и перегрузке сетевой инфраструктуры.

  - Так как балансировка сетевой нагрузки Windows обеспечивает соответствие для клиента только с помощью исходного IP-адреса, решение будет неэффективным, если в нем используется пул исходных IP-адресов небольшого размера. Это может происходить при использовании пула исходных IP-адресов из удаленной подсети или в случае применения преобразования сетевых адресов (NAT) в организации.

