---
title: 'Планирование высокой доступности и устойчивости сайтов: Exchange 2013 Help'
TOCTitle: Планирование высокой доступности и устойчивости сайтов
ms:assetid: 29bb0358-fc8e-4437-8feb-d2959ed0f102
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dd638104(v=EXCHG.150)
ms:contentKeyID: 50487698
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Планирование высокой доступности и устойчивости сайтов

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2016-12-09_

На этапе планирования специалисты по архитектуре системы, администраторы и другие заинтересованные лица должны определять бизнес-требования и требования к архитектуре для развертывания, в частности требования высокой доступности и устойчивости сайтов.

Для развертывания этих функций необходимо соблюдение некоторых общих требований, а также специальных требований к оборудованию, программному обеспечению и сети.

**Содержание**

Общие требования

Требования к оборудованию

Требования к хранилищу

Требования к программному обеспечению

Требования к сети

Требования к следящему серверу

Планирование устойчивости сайтов

## Общие требования

Перед развертыванием группы обеспечения доступности баз данных и созданием копий базы данных почтовых ящиков убедитесь, что выполнены следующие требования к системе.

  - Служба доменных имен (DNS) запущена. В идеальном случае DNS-сервер должен принимать динамические обновления. Если DNS-сервер не принимает динамические обновления, необходимо создать запись DNS Host (A) для каждого сервера Exchange. Иначе Exchange будет работать неправильно.

  - Каждый сервер почтовых ящиков в группе доступности базы данных должен являться рядовым сервером в том же домене.

  - Добавление сервера почтовых ящиков Exchange 2013, который также является сервером каталогов, в группу обеспечения доступности баз данных не поддерживается.

  - Имя, присваиваемое группе обеспечения доступности баз данных, должно быть допустимым, доступным и уникальным именем компьютера, состоящим из 15 или менее символов.

Общие требования

## Требования к оборудованию

Как правило, для групп обеспечения доступности баз данных или копий баз данных почтовых ящиков не существует особых требований к оборудованию. Используемые серверы должны соответствовать всем требованиям, изложенным в разделах [Предварительные требования для Exchange 2013](exchange-2013-prerequisites-exchange-2013-help.md) и [Требования к системе для установки Exchange 2013](exchange-2013-system-requirements-exchange-2013-help.md).

Общие требования

## Требования к хранилищу

Как правило, к хранилищу не предъявляется никаких специальных требований для групп обеспечения доступности баз данных или копий базы данных почтовых ящиков. В группах DAG не используется управляемое кластером общее хранилище, этого не требуется. Управляемое кластером общее хранилище поддерживается для использования в группе DAG только в том случае, когда группа DAG настроена на использование решения, в котором используется сторонний интерфейс API репликации, встроенный в систему Exchange 2013.

Общие требования

## Требования к программному обеспечению

Группы обеспечения доступности баз данных (DAG) доступны в Exchange 2013 Standard и Exchange 2013 Enterprise. Кроме того, группа DAG может содержать сочетание серверов под управлением Exchange 2013 Standard и Exchange 2013 Enterprise.

Все участники группы доступности базы данных должны также работать под управлением одинаковой операционной системы. Exchange 2013 поддерживается в ОС Windows Server 2008 R2, Windows Server 2012 и Windows Server 2012 R2. Все участники заданной группы обеспечения доступности баз данных должны использовать одну операционную систему. Windows Server 2012 R2 поддерживается только для участников группы DAG под управлением Exchange 2013 с пакетом обновления 1 (SP1) или более поздней версии.

Кроме того, для установки Exchange 2013 необходимо, чтобы соблюдались не только предварительные условия, но и требования к операционной системе. Группы обеспечения доступности баз данных используют технологию отказоустойчивых кластеров Windows, поэтому им требуется ОС Windows Server 2008 R2 версии Enterprise или Datacenter либо Windows Server 2012 (Windows Server 2012 R2) версии Standard или Datacenter.

Общие требования

## Требования к сети

Для каждой группы доступности базы данных и каждого ее участника также должны выполняться требования к сети. У каждой группы обеспечения доступности баз данных должна быть одна *сеть MAPI*, используемая участниками группы обеспечения доступности баз данных для взаимодействия с другими серверами (например, другими серверами Exchange 2013 *или серверами каталогов), и, при необходимости,* сети репликации, выделенные для доставки и заполнения журналов.

В предыдущих версиях Exchange мы рекомендовали по крайней мере две сети (одну сеть MAPI и одну сеть репликации) для групп обеспечения доступности баз данных. В Exchange 2013 поддерживаются различные сети, но наши рекомендации зависят от фактической топологии физической сети. Если между участниками группы обеспечения доступности баз данных существует несколько сетей, которые полностью физически отделены друг от друга, то использование отдельной сети MAPI и сети репликации обеспечивает дополнительную избыточность. Если вы используете несколько физически разделенных сетей, но которые при этом объединены в одну физическую сеть (например, один канал глобальной сети), то рекомендуется использовать одну сеть (желательно Ethernet 10 Гбит/с) для трафика MAPI и репликации. Это позволит упростить работу с сетью.

При разработке инфраструктуры сети для группы доступности базы данных необходимо учитывать следующие факторы.

  - Для каждого участника группы обеспечения доступности баз данных необходимо настроить по крайней мере один сетевой адаптер, который может устанавливать соединение со всеми остальными участниками данной группы. При использовании одного сетевого пути рекомендуется использовать по крайней мере подключение Ethernet 1 Гбит/с, но желательно — Ethernet 10 Гбит/с. Кроме того, при использовании одного сетевого адаптера для каждого участника группы доступности базы данных рекомендуется создать общее решение с учетом использования одного сетевого адаптера и пути.

  - Использование двух сетевых адаптеров для каждого участника группы доступности базы данных предоставляет одну сеть MAPI и одну сеть для репликации, с избыточностью для сети репликации, а также следующие способы восстановления:
    
      - При возникновении сбоя в сети MAPI происходит переход сервера на другой ресурс (при наличии исправных копий базы данных почтовых ящиков, которые можно активировать).
    
      - При возникновении сбоя в сети для репликации, если сеть MAPI не повреждена сбоем, операции доставки и заполнения журналов будут выполняться в сети MAPI, даже если ее свойство *ReplicationEnabled* имеет значение False. После того как работоспособность сети для репликации будет восстановлена и она будет готова возобновить операции доставки и заполнения журналов, необходимо переключиться на эту сеть вручную. Чтобы переключить репликацию с сети MAPI на восстановленную сеть для репликации, можно либо приостановить и затем возобновить непрерывную репликацию с помощью командлетов **Suspend-MailboxDatabaseCopy** и **Resume-MailboxDatabaseCopy**, либо перезапустить службу репликации Microsoft Exchange. Рекомендуется использовать операции приостановки и возобновления, чтобы предотвратить краткие сбои, вызванные перезапуском службы репликации Microsoft Exchange.

  - Каждый участник группы доступности базы данных должен иметь одинаковое количество сетей. Например, если для одного участника группы обеспечения доступности баз данных используется один сетевой адаптер, необходимо использовать один сетевой адаптер для каждого участника данной группы.

  - Для каждой группы доступности базы данных должно быть настроено не более одной сети MAPI. Сеть MAPI должна обеспечивать подключение к другим серверам Exchange и службам, таким как Active Directory и DNS.

  - При необходимости можно добавить дополнительные сети для репликации. Чтобы какой-либо сетевой адаптер не стал единственной точкой отказа, можно использовать группирование сетевых адаптеров или аналогичную технологию. Однако даже при использовании группирования сеть остается единственной точкой отказа. Более того, группирование приводит к нежелательному повышению сложности группы обеспечения доступности базы данных.

  - Каждая сеть на каждом сервере участника группы доступности базы данных должна находиться в собственной подсети. Все серверы в группе доступности базы данных должны находиться в разных подсетях, но сеть MAPI и сеть для репликации должны быть маршрутизируемыми и обеспечивать подключение, при котором:
    
      - каждая сеть на каждом сервере участника группы доступности базы данных находится на своей подсети, отдельной от подсети, используемой другими сетями на сервере;
    
      - каждая сеть MAPI на сервере участника группы доступности базы данных может устанавливать связь с другими сетями MAPI участника группы доступности базы данных;
    
      - каждая сеть для репликации на сервере участника группы доступности базы данных может устанавливать связь с другими сетями для репликации участника группы доступности базы данных;
    
      - не существует прямой маршрутизации, выполняющей трафик пульса из сети для репликации на одном сервере участника DAG в сеть MAPI на другом сервере участника DAG и наоборот, или между несколькими сетями для репликации в группе доступности базы данных.

  - Независимо от географического местоположения участников группы обеспечения доступности баз данных, задержка приема-передачи в сети между участниками группы не должна превышать 500 миллисекунд. Поскольку задержка приема-передачи между двумя серверами почтовых ящиков, на которых размещаются копии базы данных, увеличивается, то возрастает вероятность того, что репликация не будет обновляться. Независимо от уровня задержки в данном решении, пользователи должны убедиться, что сети между всеми участниками группы обеспечения доступности баз данных удовлетворяют целям защиты данных и доступности развертывания. Для конфигураций с более высокими уровнями задержек для достижения поставленных целей может требоваться специальная настройка группы обеспечения доступности баз данных, параметров репликации и сети, например увеличение числа баз данных или уменьшение количества почтовых ящиков на базу данных.

  - Для конфигурации с несколькими центрами обработки данных требования к задержке приема-передачи могут и не быть определяющими требованиями к пропускной способности и задержке сети. Чтобы определить необходимые требования к сети для конкретной среды, следует оценить общую нагрузку сети, которая включает клиентский доступ, Active Directory, передачу данных, непрерывную репликацию и другой прикладной трафик.

  - Сети группы обеспечения доступности баз данных поддерживают протокол IP версии 4 (IPv4) и IPv6. Протокол IPv6 поддерживается только при использовании IPv4; использование в среде только IPv6 невозможно. IPv6-адреса и диапазоны IP-адресов поддерживаются, только если на компьютере включены протоколы IPv6 и IPv4, а сеть поддерживает IP-адреса обеих версий. Если сервер Exchange 2013 развернут в этой конфигурации, все роли сервера могут обмениваться данными с устройствами, серверами и клиентами, использующими IPv6-адреса.

  - Автоматическое назначение частных IP-адресов (APIPA) — это функция Microsoft Windows, которая автоматически назначает IP-адреса при отсутствии в сети доступных DHCP-серверов (Dynamic Host Configuration Protocol). Использование APIPA-адресов (включая адреса, назначенные вручную из диапазона APIPA-адресов) в группах доступности базы данных или Exchange 2013 не поддерживается.

## Требования к именам и IP-адресам группы обеспечения доступности баз данных

При создании каждая группа доступности базы данных получает уникальное имя, а также один или несколько статических IP-адресов или настраивается для использования протокола DHCP. Независимо от использования статических или динамически назначенных адресов любой IP-адрес, назначенный группе обеспечения доступности баз данных, должен находиться в сети MAPI.

Для каждой группы доступности баз данных под управлением Windows Server 2008 R2 или Windows Server 2012 необходим как минимум один IP-адрес в сети MAPI. При расширении сети MAPI на несколько подсетей группе доступности базы данных требуются дополнительные IP-адреса. Для групп обеспечения доступности баз данных под управлением Windows Server 2012 R2, созданных без административной точки доступа кластера, IP-адрес не требуется.

На следующем рисунке изображена группа доступности базы данных, для всех узлов которой сеть MAPI настроена в одной и той же подсети.

**Группа обеспечения доступности баз данных с сетью MAPI в одной подсети**

![Группа доступности базы данных (DAG) на одной подсети](images/Dd638104.bcb7ef68-6d18-4516-a736-b936991c82cb(EXCHG.150).gif "Группа доступности базы данных (DAG) на одной подсети")

В этом примере сеть MAPI для каждого участника группы доступности базы данных находится в подсети 172.19.18.*x*. Поэтому группе доступности базы данных требуется один IP-адрес в этой подсети.

На следующем рисунке изображена группа обеспечения доступности баз данных, сеть MAPI которой расширяется на две подсети: 172.19.18.*x* и 172.19.19.*x*.

**Группа обеспечения доступности баз данных с сетью MAPI в нескольких подсетях**

![Группа доступности базы данных (DAG), расширенная на несколько подсетей](images/Dd638104.ffb57c64-3cb1-435c-8148-1b7154d1575c(EXCHG.150).gif "Группа доступности базы данных (DAG), расширенная на несколько подсетей")

В этом примере сеть MAPI для каждого участника группы доступности базы данных находится в отдельной подсети. Поэтому группе доступности базы данных требуется два IP-адреса, по одному для каждой подсети в сети MAPI.

При каждом расширении сети MAPI группы доступности базы данных на дополнительную подсеть для группы DAG необходимо настраивать дополнительный IP-адрес для этой подсети. Каждый IP-адрес, настроенный для группы доступности базы данных, назначается и используется базовым отказоустойчивым кластером группы доступности базы данных. Имя группы доступности базы данных также используется в качестве имени для базового отказоустойчивого кластера.

В определенный момент времени кластером группы доступности базы данных используется только один из назначенных IP-адресов. Отказоустойчивый кластер Windows регистрирует этот IP-адрес в системе доменных имен при переводе IP-адреса кластера и ресурсов сетевых имен в оперативный режим работы. Кроме использования IP-адреса и сетевого имени в Active Directory также создается объект имени кластера (CNO). Имя, IP-адрес и сетевой объект кластера используются внутри системы, чтобы гарантировать безопасность группы обеспечения доступности баз данных и осуществления внутренней связи. Администраторам и конечным пользователям нет необходимости обращаться или подключаться к имени группы обеспечения доступности баз данных или IP-адресу.

<table>
<thead>
<tr class="header">
<th><img src="images/JJ126620.note(EXCHG.150).gif" title="Примечание" alt="Примечание" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Хотя IP-адрес кластера и сетевое имя используются внутри системы, доступность этих ресурсов не зависит от Exchange 2013. Даже если административная точка доступа базового кластера (например, ее IP-адрес и ресурсы сетевого имени) используется в автономном режиме, внутренняя связь в группе обеспечения доступности баз данных осуществляется посредством имен сервера участника такой группы. Тем не менее, рекомендуется периодически проверять доступность этих ресурсов, чтобы убедиться, что они не находятся в автономном режиме более 30 дней. Если базовый кластер находится в автономном режиме более 30 дней, учетная запись CNO кластера становится недействительной в процессе сборки мусора в Active Directory.</td>
</tr>
</tbody>
</table>


## Настройка сетевого адаптера для групп доступности базы данных

Каждый сетевой адаптер должен быть настроен должным образом в соответствии с его предполагаемым использованием. Настройка сетевого адаптера, используемого для сети MAPI, отличается от настройки сетевого адаптера для сети репликации. Необходимо правильно настроить не только каждый сетевой адаптер, но и такой порядок подключения к сети в Windows, чтобы сеть MAPI находилась в начале списка вариантов для подключения. Подробные сведения об изменении порядка подключения к сети см. в статье [Изменение очередности выбора поставщиков сети и привязок протокола](https://go.microsoft.com/fwlink/p/?linkid=179138).

## Настройка сетевого адаптера MAPI

Сетевой адаптер, предназначенный для использования сетью MAPI, необходимо настроить следующим образом.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Сетевые компоненты</th>
<th>Параметры</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Клиент для сетей Microsoft</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="even">
<td><p>Планировщик пакетов QoS</p></td>
<td><p>Дополнительно включена</p></td>
</tr>
<tr class="odd">
<td><p>Служба доступа к файлам и принтерам сетей Microsoft</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="even">
<td><p>Протокол IP версии 6 (TCP/IP v6)</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="odd">
<td><p>Протокол IP версии 4 (TCP/IP v4)</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="even">
<td><p>Драйвер в/в тополога канального уровня</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="odd">
<td><p>Ответчик обнаружения топологии канального уровня</p></td>
<td><p>Включено</p></td>
</tr>
</tbody>
</table>


Свойства TCP/IP v4 для сетевого адаптера MAPI настраиваются следующим образом.

  - IP-адрес для сети MAPI участника группы обеспечения доступности баз данных можно назначить вручную или настроить для использования DHCP. При использовании DHCP рекомендуется регулярно выполнять резервирование для IP-адресов сервера.

  - Сетью MAPI обычно используется шлюз по умолчанию, хотя он не является обязательным.

  - Необходимо настроить по крайней мере один адрес DNS-сервера. Для обеспечения избыточности рекомендуется использовать несколько DNS-серверов.

  - Флажок **Зарегистрировать адреса этого подключения в DNS** должен быть установлен.

## Конфигурация репликации сетевого адаптера

Сетевой адаптер, предназначенный для использования сетью для репликации, необходимо настроить следующим образом.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Сетевые компоненты</th>
<th>Параметры</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Клиент для сетей Microsoft</p></td>
<td><p>Отключено</p></td>
</tr>
<tr class="even">
<td><p>Планировщик пакетов QoS</p></td>
<td><p>Дополнительно включена</p></td>
</tr>
<tr class="odd">
<td><p>Служба доступа к файлам и принтерам сетей Microsoft</p></td>
<td><p>Отключено</p></td>
</tr>
<tr class="even">
<td><p>Протокол IP версии 6 (TCP/IP v6)</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="odd">
<td><p>Протокол IP версии 4 (TCP/IP v4)</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="even">
<td><p>Драйвер в/в тополога канального уровня</p></td>
<td><p>Включено</p></td>
</tr>
<tr class="odd">
<td><p>Ответчик обнаружения топологии канального уровня</p></td>
<td><p>Включено</p></td>
</tr>
</tbody>
</table>


Свойства TCP/IP v4 адаптера сети для репликации настраиваются следующим образом.

  - IP-адрес для сети репликации участника группы обеспечения доступности баз данных можно назначить вручную или настроить для использования DHCP. При использовании DHCP рекомендуется регулярно выполнять резервирование для IP-адресов сервера.

  - В сетях для репликации обычно отсутствует шлюз по умолчанию, но если в сети MAPI есть такой шлюз, другие сети не должны иметь шлюзов по умолчанию. Маршрутизация сетевого трафика в сети для репликации можно настроить с помощью постоянных, статичных маршрутов в соответствующую сеть других участников группы доступности базы данных посредством адресов шлюзов, обладающих возможностью направлять трафик между сетями для репликации. Весь остальной трафик, не соответствующий маршруту, будет обрабатываться шлюзом по умолчанию, который настроен на адаптере для сети MAPI.

  - Адреса DNS-серверов настраивать не следует.

  - Не следует устанавливать флажок **Зарегистрировать адреса этого подключения в DNS**.

Общие требования

## Требования к следящему серверу

*Следящий сервер* — это сервер, который находится за пределами группы обеспечения доступности баз данных, а также используется для достижения и сохранения кворума для группы обеспечения доступности баз данных с четным количеством участников. Группы обеспечения доступности баз данных с нечетным количеством участников не используют следящий сервер. Следящий сервер должен использоваться во всех группах обеспечения доступности баз данных с четным количеством участников. Следящим сервером может быть любой компьютер, работающий под управлением Windows Server. Версия операционной системы Windows Server следящего сервера не обязательно должна совпадать с версией операционной системы, используемой участниками группы обеспечения доступности баз данных.

Кворум сохраняется на уровне кластера под группой доступности базы данных. Кворум достигается, когда большинство участников группы доступности базы данных находятся в оперативном режиме и могут связываться с другими участниками группы доступности базы данных. Это определение кворума является одним из аспектов концепции кворума отказоустойчивого кластера Windows. Также важным аспектом кворума в отказоустойчивых кластерах является *ресурс кворума*. Ресурс кворума — это внутренний ресурс отказоустойчивого кластера, предоставляющий средства арбитража, ведущие к состоянию кластера и решениям участников. Ресурс кворума также предоставляет постоянное хранилище для хранения сведений о конфигурации. Сопутствующим элементом ресурса кворума является *журнал кворума*, который представляет собой конфигурацию базы данных для кластера. В журнале форума содержатся сведения о серверах-участниках кластера, ресурсах, установленных в кластере и состоянии этих ресурсов (например, интерактивный или автономный режим).

Критически важно, чтобы каждый участник группы обеспечения доступности баз данных имел представление о конфигурации базового кластера таких групп. Кворум выступает в качестве определяющего репозитория для сведений о конфигурации кластера. Кворум также используется в качестве разрушителя связей во избежание *разделения вычислительных мощностей*. Разделение вычислительных мощностей — это состояние, когда участники группы обеспечения доступности баз данных запущены и доступны, но не могут связаться друг с другом. Возникновение синдрома "разделенности" можно предотвратить, установив требования взаимодействия большинства участников группы доступности базы данных (и, в случае с группами базы данных, с четным количеством участников и следящим сервером) для поддержки доступности группы доступности базы данных.

Общие требования

## Планирование устойчивости сайтов

С каждым днем все больше и больше предпринимателей понимают, что доступ к надежным системам обмена сообщениями является основой делового успеха. Для многих организаций система обмена сообщениями является частью плана по обеспечению бесперебойной деятельности, а устойчивость сайтов должна обеспечиваться при развертывании службы обмена сообщениями. В своей основе многие решения по устойчивости сайтов подразумевают собой развертывание оборудования в дополнительных центрах обработки данных.

В конечном счете общая структура группы доступности базы данных, включая количество участников группы доступности базы данных и количество копий базы данных почтовых ящиков, зависит от соглашения об уровне обслуживания по восстановлению каждой организации, которое покрывает различные сценарии сбоев. На стадии планирования архитекторы и администраторы решений определяют требования для развертывания, в том числе и требования к устойчивости сайта. Они определяют используемые местоположения и необходимые цели для соглашения об уровне обслуживания по восстановлению. Соглашение об уровне обслуживания по восстановлению определяет отдельные элементы, которые будут являться основой для разработки решения, предоставляющего высокую доступность и устойчивость сайта: время восстановления и цель точки восстановления. Оба значения измеряются в минутах. Ожидаемое время восстановления — это время, затраченное на восстановление службы. Срок выполнения восстановления обозначает уровень актуальности данных после завершения операции восстановления. В соглашении об уровне обслуживания по восстановлению может быть также определено полное восстановление основного центра обработки данных после устранения в нем неполадок.

Кроме того, архитекторы и администраторы решения определяют группу пользователей, для которых требуется защита устойчивости сайта, а также конфигурацию "активный-пассивный" или "активный-активный" решения для нескольких сайтов. Как правило, в конфигурации "активный-пассивный" пользователи не размещаются в резервном центре обработки данных. В конфигурации "активный-активный" пользователи размещаются в обоих местоположениях, а некоторое количество от общего числа баз данных в решении в основном хранятся во втором центре обработки данных. Если происходит сбой обслуживания пользователей одного центра обработки данных, они автоматически активируются в другом.

Создавая соответствующие соглашения об уровне обслуживания по восстановлению часто требуется ответить на следующие вопросы.

  - Какой уровень обслуживания требуется после сбоя основного центра обработки данных?

  - Нужны ли пользователям их данные или достаточно только возможности обмена сообщениями?

  - Насколько быстро потребуются эти данные?

  - Какое количество пользователей необходимо поддерживать?

  - Каким образом пользователи получат доступ к своим данным?

  - Что такое соглашение об уровне обслуживания по активации резервного центра обработки данных?

  - Каким образом производится переключение обслуживания обратно на основной центр обработки данных?

  - Выделены ли ресурсы для обеспечения устойчивости сайтов?

Отвечая на эти вопросы, можно начать создание решения для обеспечения устойчивости сайтов системы обмена сообщениями. Краеугольным требованием к защите сайта от сбоя является создание решения для переноса данных системы обмена сообщениями в резервный центр обработки данных, где размещена резервная служба обмена сообщениями.

## Планирование сертификатов

При развертывании группы доступности базы данных в одном центре данных не существует определенных требований к сертификатам. Тем не менее, при расширении группы доступности базы данных на несколько центров данных в конфигурации устойчивости сайтов существует несколько определенных требований к сертификатам. В основном структура сертификата зависит от используемого клиента, также как и требования к сертификатам других приложений, использующих сертификаты. Однако существуют определенные рекомендации, которым необходимо следовать в зависимости от типа и количества сертификатов.

Рекомендуется минимизировать число сертификатов, используемых для серверов Exchange и обратных прокси-серверов. Рекомендуется использовать один сертификат для всех конечных точек службы в каждом центре данных. В этом случае уменьшается количество используемых сертификатов, что приводит к уменьшению сложности и затрат на решение.

Для клиентов мобильного Outlook рекомендуется использовать один сертификат альтернативного имени субъекта для каждого центра данных и включить в него несколько имен узлов. Чтобы обеспечить подключение мобильного Outlook после переключения базы данных, сервера или центра данных, необходимо использовать одно имя участника сертификата для каждого сертификата, а также настроить объект конфигурации поставщика Outlook в Active Directory с тем же именем участника в форме по стандарту Microsoft (MSSTD). Например, при использовании имени участника сертификата mail.contoso.com атрибут настраивается следующим образом.

    Set-OutlookProvider EXPR -CertPrincipalName "msstd:mail.contoso.com"

Некоторые приложения, взаимодействующие с Exchange, имеют определенные требования к сертификатам, для чего может потребоваться использование дополнительных сертификатов. Сервер Exchange 2013 может сосуществовать с Office Communications Server (OCS). Для OCS требуется использование сертификатов размером 1024 бита или больше с именем сервера OCS в качестве имени участника сертификата. Поскольку использование имени сервера OCS в качестве имени участника сертификата не позволяет Outlook Anywhere работать правильно, может потребоваться дополнительный отдельный сертификат для среды OCS.

## Планирование сети

Кроме определенных требований к сети, которые должны соответствовать каждой группе доступности базы данных, также как и каждому серверу, являющемуся участником группы доступности базы данных, существует несколько требований и рекомендаций для конфигурации устойчивости сайтов. Для всех групп обеспечения доступности баз данных, развертываются ли ее участники на одном или нескольких сайтах, задержка приема-передачи в сети между участниками группы не должна превышать 500 миллисекунд. Кроме того, существуют определенные параметры конфигурации, рекомендуемые для групп доступности базы данных, расширенных на несколько сайтов.

  - **Сети MAPI должны быть изолированы от сетей для репликации**   Для блокировки трафика между сетями MAPI и сетями для репликации необходимо использовать политики сети Windows, политики брандмауэра Windows или списки управления доступом маршрутизатора. Такая конфигурация необходима для предотвращения перекрестных помех сети при подтверждении соединения.

  - **Время действия клиентских записей DNS должно составлять 5 минут**   Время простоя клиентов зависит не только от скорости переключения, но также и от скорости выполнения репликации DNS и запросов клиентов на обновленные сведения о DNS. Для DNS-записей всех клиентских служб Exchange, в том числе Microsoft Office Outlook Web App, Microsoft Exchange ActiveSync, веб-служб Exchange, мобильного Outlook, SMTP, POP3 и IMAP4, на внутренних и внешних DNS-серверах следует задать значение TTL, равное 5 минутам.

  - **Использование статичных маршрутов для настройки соединения через сети для репликации** Чтобы обеспечить соединение между всеми адаптерами сети для репликации, используйте постоянные статичные маршруты. Это быстрая разовая настройка, выполняемая для каждого участника группы обеспечения доступности баз данных при использовании статичных IP-адресов. Если для получения IP-адресов для сетей репликации используется DHCP-сервер, его можно также использовать для назначения статичных маршрутов для репликации, что упрощает процесс настройки.

## Общее планирование устойчивости сайтов

Кроме требований для высокой доступности, перечисленных выше, существуют другие рекомендации по развертыванию Exchange 2013 в конфигурации устойчивости сайта (например, расширение группы обеспечения доступности баз данных на несколько центров данных). Действия, выполняемые на стадии планирования, прямо влияют на успешность решения по обеспечению устойчивости сайта. Например, неудачное планирование пространства имен может стать причиной возникновения трудностей с назначением сертификатов, а неправильная конфигурация сертификата может препятствовать доступу пользователей к службам.

Чтобы уменьшить время активации второго центра данных и позволить ему размещать конечные точки службы центров данных, в которых произошел сбой, необходимо правильно выполнить планирование. Примеры:

  - Необходимо изучить и задокументировать цели соглашения об уровне обслуживания для решения по обеспечению устойчивости сайта.

  - Серверы во втором центре обработки данных должны обладать достаточной вместительностью для размещения пользователей обоих центров данных.

  - Во втором центре данных необходимо включить все службы, представленные в основном центре данных (если служба не входит в состав соглашения об уровне обслуживания устойчивости сайта). Сюда входят: Active Directory, инфраструктура сети (например, DNS или TCP/IP), службы телефонии (при использовании единой системы обмена сообщениями) и инфраструктура сайта (питание, охлаждение и т. д.).

  - Чтобы пользователи центров данных со сбоем могли иметь доступ к некоторым службам, необходимо настроить для них соответствующие сертификаты сервера. В некоторых службах запрещено использовать экземпляры (например, POP3 и IMAP4), а разрешено использовать только один сертификат. В таких случаях сертификат должен являться сертификатом альтернативного имени субъекта с несколькими именами, либо несколько имен должны быть достаточно схожими для использования группового сертификата (при условии, что политики безопасности организации позволяют использование группового сертификата).

  - Необходимые службы должны быть определены во втором центре обработки данных. Например, если первый центр данных имеет три разных URL-адреса SMTP на разных транспортных серверах, во втором центре данных необходимо определить соответствующую конфигурацию, чтобы разрешить хотя бы одному (или всем трем) транспортному серверу размещать рабочую нагрузку.

  - Для поддержки переключения центра обработки данных должна быть установлена необходимая конфигурация сети. Это может означать, что необходимо проверить конфигурацию балансировки нагрузки, настройку глобальной DNS, а также наличие подключения к Интернету с соответствующей маршрутизацией.

  - Необходимо ознакомиться со стратегией включения изменений DNS, необходимых для переключения центра данных. Определенные изменения DNS, включая параметры срока жизни, необходимо определить и задокументировать для поддержки работы соглашения об уровне обслуживания.

  - Стратегия проверки решения должна быть установлена и учтена в соглашении об уровне обслуживания. Периодическая проверка развертывания — это единственный метод, гарантирующий качество и устойчивость развертывания в течение долгого времени. После проверки развертывания рекомендуется задокументировать явным образом часть конфигурации, которая прямо влияет на успешность решения. Кроме того, рекомендуется усилить процесс управления изменениями в тех сегментах развертывания.

Общие требования

