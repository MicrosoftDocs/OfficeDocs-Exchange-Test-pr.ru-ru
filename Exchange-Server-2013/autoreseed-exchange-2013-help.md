---
title: 'AutoReseed: Exchange 2013 Help'
TOCTitle: AutoReseed
ms:assetid: 61f9a8be-070e-4c62-b505-52644fcff0c5
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Dn789209(v=EXCHG.150)
ms:contentKeyID: 62523828
ms.date: 05/22/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# AutoReseed

 

_**Применимо к:** Exchange Server 2013 SP1_

_**Последнее изменение раздела:** 2015-03-09_

Автоматическое повторное заполнение, или AutoReseed — это функция, которая заменяет обычное действие администратора в ответ на отказ диска, повреждение базы данных или другую проблему, требующую повторного заполнения копии базы данных. Функция AutoReseed разработана для автоматического восстановления избыточности баз данных после отказа диска с помощью резервных дисков, которые имеются в системе.

## Общие сведения о функции Autoreseed

В конфигурации AutoReseed используется стандартизованная структура представления хранилища и администратор выбирает начальную точку. Функция AutoReseed позволяет после сбоя диска восстановить избыточность как можно скорее. Это предполагает предварительное сопоставление набора томов (в том числе резервных) и баз данных с помощью точек подключения. В случае отказа диска, когда он больше недоступен операционной системе или не поддерживает возможность записи, в системе выделяется резервный том, а поврежденные копии базы данных повторно заполняются данными автоматически.

1.  Служба репликации Microsoft Exchange периодически выполняет сканирование на наличие копий в состоянии FailedAndSuspended. Если все копии базы данных в томе, настроенном для AutoReseed, находятся в состоянии FailedandSuspended в течение 15 минут подряд, запускается рабочий процесс AutoReseed.

2.  Функция AutoReseed будет пытаться перезапустить неисправные и приостановленные схемы до трех раз с 5-минутными интервалами. Иногда после возобновления работы копии базы данных в состоянии FailedandSuspended она остается в состоянии Failed. Это может происходить по множеству причин, поэтому данный этап предназначен для решения таких проблем. Функция AutoReseed автоматически приостанавливает копии баз данных, которые находились в состоянии Failed в течение 10 минут подряд, чтобы поддерживать ход рабочего процесса. Если действия приостанавливания и перезапуска не приводят к полной работоспособности базы данных, рабочий процесс продолжается.

3.  При обнаружении копии с этим состоянием выполняются необходимые проверки. Например, будет проверено, достаточно ли на диске свободного пространства, находятся ли база данных и файлы журналов в одном томе и в допустимых расположениях, соответствующих соглашениям об именах.

4.  Если эти проверки проходят успешно, функция освобождения места на диске в службе репликации Microsoft Exchange выделяет, повторно сопоставляет и форматирует резервный диск в соответствии с графиками в приведенной ниже таблице. AutoReseed будет пытаться назначить резервный том до 5 раз с часовыми интервалами.

5.  Назначив резервный том, функция AutoReseed выполнит операцию InPlaceSeed с использованием параметра заполнения SafeDeleteExistingFiles. Все базы данных, которые находились на поврежденном диске, повторно заполняются с использованием активной копии базы данных в качестве источника заполнения.

6.  После завершения заполнения служба репликации Microsoft Exchange проверяет работоспособность только что заполненной копии.

По достижении максимального числа попыток рабочий процесс останавливается. Если спустя 3 дня копия базы данных по-прежнему находится в состоянии FailedandSuspended, состояние рабочего процесса сбрасывается, и он перезапускается с этапа 1. Такой принцип работы полезен (и применяется намеренно), так как замена неисправного диска, контроллера и других устройств может занять несколько дней.

На этом этапе, если произошел отказ диска, потребуется вмешательство оператора или администратора, чтобы удалить и заменить отказавший диск, а затем повторно настроить заменяющий диск в качестве резервного.

AutoReseed настраивается с помощью трех свойств группы обеспечения доступности баз данных. Два из них относятся к двум используемым точкам подключения. В Exchange 2013 учитывается тот факт, что Windows Server допускает использование нескольких точек подключения для одного тома. Свойство *AutoDagVolumesRootFolderPath* относится к точке подключения, содержащей все доступные тома. Она включает в себя тома, на которых размещаются базы данных, и резервные тома. Свойство *AutoDagDatabasesRootFolderPath* относится к точке подключения, содержащей базы данных. Третье свойство группы обеспечения доступности баз данных, *AutoDagDatabaseCopiesPerVolume*, используется для настройки количества копий базы данных для каждого тома.

Ниже приведен пример конфигурации AutoReseed.

**Пример конфигурации AutoReseed**

![Пример конфигурации автоматического повторного заполнения](images/Dn789209.e3af7306-f5b4-4ec4-9ccf-222ec452699b(EXCHG.150).gif "Пример конфигурации автоматического повторного заполнения")

В этом примере используются три тома, два из которых содержат базы данных (VOL1 и VOL2), а один пустой. Он отформатированный и резервный (VOL3).

Настройка AutoReseed

1.  Все три тома подключаются в единой точке подключения. В этом примере используется точка подключения C:\\ExchVols. Она представляет каталог, используемый для получения хранилища для баз данных Exchange.

2.  Корневой каталог базы данных почтовых ящиков подключается в качестве другой точки подключения. В этом примере используется точка подключения C:\\ExchDBs. Затем структура каталога создается таким образом, чтобы база данных содержала родительский каталог с двумя подкаталогами: для файла базы данных и файлов журнала соответственно.

3.  Создаются базы данных. В приведенном выше примере показана простая схема с использованием одной базы данных для каждого тома. Таким образом, том VOL1 содержит три каталога: родительский каталог и два подкаталога (для файла базы данных MDB1 и его журналов соответственно). Хотя это не показано на изображении в примере, том VOL2 также будет включать три каталога: родительский каталог с вложенными каталогами для файла базы данных MDB2 и его журналов соответственно.

Если в этой конфигурации в базе данных MDB1 или MDB2 произойдет сбой, копия отказавшей базы данных будет автоматически повторно заполнена на томе VOL3.

## Компонент освобождения места на диске

Компонент функции AutoReseed, который выделяет и форматирует резервные диски, называется *компонентом освобождения места на диске*. Компонент освобождения места на диске автоматически форматирует резервные диски в процессе подготовки к автоматическому повторному заполнению через различные промежутки времени в зависимости от состояния диска. Чтобы компонент освобождения места на диске отформатировал диск, должны быть выполнены определенные условия.

  - Компонент освобождения места на диске должен быть включен. Он включен по умолчанию, но его можно отключить с помощью команды [Set-DatabaseAvailabilityGroup](https://technet.microsoft.com/ru-ru/library/dd297934\(v=exchg.150\)).

  - Корневой путь томов должен включать точку подключения (по умолчанию это C:\\ExchangeVolumes).

  - Путь томов баз данных не должен включать никаких точек подключения тома (по умолчанию это C:\\ExchangeDatabases).

  - Если том содержит файлы, ни один из них не должен использоваться в течение суток.

Кроме выше упомянутых условий, компонент освобождения места на диске попытается отформатировать определенный том только один раз в день. В таблице ниже описано поведение форматирования компонента освобождения места на диске.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Состояние диска и копий базы данных</th>
<th>Интервал форматирования</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Диск не отформатирован или отформатирован, но пустой или содержит файлы, которые не использовались в течение суток, и на локальном сайте Active Directory есть работоспособные активные копии базы данных, которые можно использовать в качестве источника заполнения.</p></td>
<td><p>1 день</p></td>
</tr>
<tr class="even">
<td><p>Диск не отформатирован или отформатирован, но пустой или содержит файлы, которые не использовались в течение суток, но на локальном сайте Active Directory нет работоспособных активных копий базы данных, которые можно использовать в качестве источника заполнения.</p></td>
<td><p>2 дня</p></td>
</tr>
<tr class="odd">
<td><p>Диск не отформатирован или отформатирован, но пустой или содержит файлы, которые не использовались в течение суток, и на локальном сайте Active Directory есть работоспособные активные копии базы данных, которые можно использовать в качестве источника заполнения, но кроме файла базы данных (EDB-файла) и файлов журнала существуют неизвестные файлы.</p></td>
<td><p>2 недели</p></td>
</tr>
<tr class="even">
<td><p>Диск не отформатирован или отформатирован, но пустой или содержит файлы, которые не использовались в течение суток, и на локальном сайте Active Directory есть работоспособные активные копии базы данных, которые можно использовать в качестве источника заполнения, но в Active Directory отсутствуют один или несколько файлов базы данных (EDB-файлов) для баз данных.</p></td>
<td><p>2 недели</p></td>
</tr>
</tbody>
</table>

