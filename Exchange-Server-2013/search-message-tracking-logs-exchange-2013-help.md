---
title: 'Поиск в журналах отслеживания сообщений: Exchange 2013 Help'
TOCTitle: Поиск в журналах отслеживания сообщений
ms:assetid: e1678327-bcd5-42d4-a363-67f33067fe9a
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Bb124926(v=EXCHG.150)
ms:contentKeyID: 51408086
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Поиск в журналах отслеживания сообщений

 

_**Применимо к:** Exchange Server 2013_

_**Последнее изменение раздела:** 2013-02-25_

В Microsoft Exchange Server 2013 журнал отслеживания сообщений содержит подробные сведения о всей активности сообщений при их передаче на транспортную службу и с нее на серверы почтовых ящиков, в почтовые ящики на этих серверах и на пограничные транспортные серверы.

Командлет **Get-MessageTrackingLog** в командной консоли Exchange позволяет искать записи в журнале отслеживания сообщений, используя определенные условия поиска.

## Что нужно знать перед началом работы

  - Предполагаемое время для завершения: 30 минут.

  - Для выполнения этих процедур необходимы соответствующие разрешения. Сведения о необходимых разрешениях см. в статье запись "Отслеживание сообщений" в разделе [Разрешения потока обработки почты](mail-flow-permissions-exchange-2013-help.md).

  - Для поиска журналов отслеживания сообщений необходимо запустить службу поиска журналов транспорта Microsoft Exchange. Если вы отключите или остановите эту службу, то не сможете выполнять поиск журналов отслеживания сообщений или запускать отчеты о доставке. Однако остановка этой службы не затрагивает другие функции службы Exchange.

  - Имена полей, которые отображаются в результатах командлета **Get-MessageTrackingLog**, похожи на фактические имена полей, используемые в журналах отслеживания сообщений. Ниже приведены главные различия.
    
      - Дефисы удаляются из имен полей. Так, **internal-message-id** отображается как `InternalMessageId`.
    
      - Поле **date-time** отображается как `Timestamp`.
    
      - Поле **recipient-address** отображается как `Recipients`.
    
      - Поле **sender-address** отображается как `Sender`.

  - В поле **date-time** в журнале отслеживания сообщений сведения хранятся в формате UTC. Однако вводить дату и время в качестве условий поиска для параметров *Start* или *End* следует в региональном формате даты и времени, настроенном на компьютере, который используется для поиска.

  - Нельзя копировать файлы журнала отслеживания сообщений с другого сервера Exchange, а затем искать их с помощью командлета **Get-MessageTrackingLog**. Кроме того, если вручную сохранить имеющийся файл журнала отслеживания сообщения, изменение метки даты и времени в файле нарушит логику запросов, используемую в службе Exchange для поиска данных в журналах отслеживания сообщений.

  - Командлет Exchange 2013**Get-MessageTrackingLog** поддерживает поиск журналов отслеживания сообщений на серверах Exchange 2007 и Exchange 2010 на одном сайте Active Directory.

  - Сочетания клавиш для процедур, описанных в этой статье, приведены в статье [Сочетания клавиш в Центре администрирования Exchange](keyboard-shortcuts-in-the-exchange-admin-center-exchange-online-protection-help.md).

> [!TIP]  
> Возникли проблемы? Обратитесь за помощью к участникам форумов, посвященных Exchange. Посетите форумы по таким продуктам: <a href="https://go.microsoft.com/fwlink/p/?linkid=60612">Exchange Server</a>, <a href="https://go.microsoft.com/fwlink/p/?linkid=267542">Exchange Online</a> или <a href="https://go.microsoft.com/fwlink/p/?linkid=285351">Exchange Online Protection</a>.


## Что необходимо сделать?

## Использование командной консоли для поиска данных в журналах отслеживания сообщений

При поиске записей об определенных событиях в журналах отслеживания сообщений введите команду в следующем формате.

    Get-MessageTrackingLog [-Server <ServerIdentity.] [-ResultSize <Integer> | Unlimited] [-Start <DateTime>] [-End <DateTime>] [-EventId <EventId>] [-InternalMessageId <InternalMessageId>] [-MessageId <MessageId>] [-MessageSubject <Subject>] [-Recipients <RecipientAddress1,RecipientAddress2...>] [-Reference <Reference>] [-Sender <SenderAddress>]

Чтобы просмотреть 1000 последних записей в журнале отслеживания сообщений на сервере, выполните следующую команду.

    Get-MessageTrackingLog

В этом примере в журналах отслеживания сообщений на сервере выполняется поиск всех записей, зарегистрированных с 28.03.2013, 08:00, по 28.03.2013, 17:00, для всех событий с меткой **FAIL** для отправителя pat@contoso.com.

    Get-MessageTrackingLog -ResultSize Unlimited -Start "3/28/2013 8:00AM" -End "3/28/2013 5:00PM" -EventId "Fail" -Sender "pat@contoso.com"

## Использование командной консоли для управления форматом вывода результатов поиска в журналах отслеживания сообщений

Введите команду в следующем формате.

    Get-MessageTrackingLog <SearchFilters> | <Format-Table | Format-List> [<FieldNames>] [<OutputFileOptions>]

В этом примере в журналах отслеживания сообщений выполняется поиск со следующими условиями.

  - Возвращаются результаты для первых 1000 событий с меткой **Send**.

  - Результаты отображаются в формате списка.

  - Отображаются только имена полей, которые начинаются со слова `Send` или `Recipient`.

  - Выходные данные записываются в файл с именем `D:\Send Search.txt`

<!-- end list -->

    Get-MessageTrackingLog -EventId Send | Format-List Send*,Recipient* > "D:\Send Search.txt"

## Использование командной консоли для поиска записей сообщений в журналах отслеживания сообщений на нескольких серверах

Обычно значение в поле заголовка **MessageID:**  остается неизменным по мере продвижения сообщения в организации Exchange. В служебных программах для просмотра очереди это свойство называется **InternetMessageId**, а в служебных программах для просмотра журнала отслеживания сообщений — **MessageId**. Определив значение поля `MessageID:` для определенного сообщения, вы можете выполнить поиск сведений о нем в журналах отслеживания сообщений на каждом сервере почтовых ящиков в организации Exchange.

Для поиска всех записей определенного сообщения в журналах отслеживания сообщений на всех серверах почтовых ящиков введите команду в следующем формате.

    Get-ExchangeServer | where {$_.isHubTransportServer -eq $true -or $_.isMailboxServer -eq $true} | Get-MessageTrackingLog -MessageId <MessageID> | Select-Object <CommaSeparatedFieldNames> | Sort-Object -Property <FieldName>

В этом примере в журналах отслеживания сообщений на всех серверах почтовых ящиков Exchange 2013 выполняется поиск со следующими условиями.

  - Выполняется поиск всех записей, связанных с сообщением, для которого в поле **MessageID:**  задано значение `<ba18339e-8151-4ff3-aeea-87ccf5fc9796@mailbox01.contoso.com>`. Обратите внимание, что вы можете пропустить символы угловых скобок (`<``>`). Если не сделать этого, все значение поля **MessageID:**  необходимо заключить в кавычки.

  - Для каждой записи отображаются поля **date-time**, **server-hostname**, **client-hostname**, **source**, **event-id** и **recipient-address**.

  - Результаты сортируются по полю **date-time**.

<!-- end list -->

    Get-ExchangeServer | where {$_.isHubTransportServer -eq $true -or $_.isMailboxServer -eq $true} | Get-MessageTrackingLog -MessageId ba18339e-8151-4ff3-aeea-87ccf5fc9796@mailbox01.contoso.com | Select-Object Timestamp,ServerHostname,ClientHostname,Source,EventId,Recipients | Sort-Object -Property Timestamp

## Использование Центра администрирования Exchange для поиска данных в журналах отслеживания сообщений

Используя функцию отчетов о доставке для администраторов в Центре администрирования Exchange, в журналах отслеживания сообщений можно выполнять поиск сведений о сообщениях, которые отправляются из определенного почтового ящика в организации или приходят в него. Дополнительные сведения см. в разделе [Отслеживание сообщений при помощи отчетов о доставке](track-messages-with-delivery-reports-exchange-2013-help.md).

