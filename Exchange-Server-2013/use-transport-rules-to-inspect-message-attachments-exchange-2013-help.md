---
title: 'Использование правил транспорта для проверки вложений сообщений: Exchange 2013 Help'
TOCTitle: Использование правил транспорта для проверки вложений сообщений
ms:assetid: c0de687e-e33c-4e8a-b253-771494678795
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/JJ674307(v=EXCHG.150)
ms:contentKeyID: 50489030
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Использование правил транспорта для проверки вложений сообщений

 

_**Применимо к:**Exchange Server 2013_

_**Последнее изменение раздела:**2015-03-27_

Вы можете изучать вложения в сообщения электронной почты в своей организации, настроив правила транспорта. В Exchange доступны правила, которые позволяют изучать вложения в процессе обеспечения безопасности и соблюдения требований при обмене сообщениями. Во время просмотра вложений вы можете выполнять действия с сообщениями на основе содержимого или характеристик этих вложений. Далее представлено несколько задач, связанных с вложениями, которые можно выполнять с помощью правил транспорта:

  - Поиск файлов в сжатых вложениях, например ZIP- и RAR-файлах, и добавление заявления об отказе в конце сообщения, если файл содержит текст, соответствующий указанному шаблону.

  - Изучение содержимого вложений и перенаправление сообщения модератору на утверждение перед доставкой, если во вложении найдены указанные ключевые слова.

  - Проверка наличия сообщения с вложениями, которые невозможно изучить, и блокировка отправки всего сообщения.

  - Проверка вложений, размер которых превышает определенное значение, и уведомление отправителя о проблеме, если сообщение не будет доставлено.

  - Создание уведомлений для пользователей, отправивших сообщение, из-за которого сработало правило транспорта.

  - Блокирование всех сообщений с вложениями. Примеры см. в статье [Распространенные сценарии блокирования вложений](common-attachment-blocking-scenarios-for-mail-flow-rules-exchange-2013-help.md).

Администраторы Exchange могут создавать правила транспорта в **Центр администрирования Exchange** \> **Поток обработки почты** \> **Правила**. Для выполнения этой процедуры необходимы соответствующие разрешения. Приступив к созданию правила, вы можете увидеть полный список условий, связанных с вложениями, щелкнув **Дополнительные параметры** \> **Любое вложение** в списке **Применить это правило, если**. Параметры, связанные с вложениями, показаны на следующем рисунке.

![Диалоговое окно выбора правил, связанных с вложениями](images/JJ674307.2ae4a179-bfd2-4a0e-abe1-53ed4e9e3368(EXCHG.150).jpg "Диалоговое окно выбора правил, связанных с вложениями")

Дополнительные сведения о правилах транспорта, включая полный диапазон доступных условий и действий, см. в разделе [Правила обработки почтового потока и транспорта](mail-flow-rules-transport-rules-in-exchange-2013-exchange-2013-help.md). Пользователи Exchange Online Protection (EOP) и гибридных сред могут воспользоваться рекомендациями по применению правил транспорт из статьи [Рекомендации по настройке EOP](https://technet.microsoft.com/ru-ru/library/jj723164\(v=exchg.150\)). Если вы готовы начать создание правил, см. раздел [Управление правилами потока обработки почты](manage-mail-flow-rules-exchange-2013-help.md).

## Проверка содержимого вложений

Вы можете использовать условия правила транспорта в следующей таблице для проверки содержимого вложений сообщений. При этом анализируются только первые 150 КБ вложения. Чтобы использовать эти условия при проверке сообщений, их необходимо добавить в правило транспорта. Сведения о создании и изменении правил см. в разделе [Управление правилами потока обработки почты](manage-mail-flow-rules-exchange-2013-help.md).


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Имя условия в Центре администрирования Exchange</th>
<th>Имя условия в командной консоли</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>Содержимое вложения содержит любое из этих слов</strong></p></td>
<td><p><code>AttachmentContainsWords</code></p></td>
<td><p>Это условие сопоставляет сообщения с поддерживаемыми типами файлов вложений, содержащими заданную строку или группу символов.</p></td>
</tr>
<tr class="even">
<td><p><strong>Все содержимое вложения соответствует эти текстовые шаблоны</strong></p></td>
<td><p><code>AttachmentMatchesPatterns</code></p></td>
<td><p>Это условие сопоставляет сообщения с поддерживаемыми типами файлов вложений, которые содержат текстовый шаблон, соответствующий заданному регулярному выражению.</p></td>
</tr>
</tbody>
</table>


Имена условий Командная консоль Exchange, перечисленные здесь — это параметры для командлета `TransportRule`.

  -  
    Дополнительные сведения о командлете см. в статье [New-TransportRule](https://technet.microsoft.com/ru-ru/library/bb125138\(v=exchg.150\)).

  -  
    Дополнительные сведения о типах свойств этих условий см. в статье [Conditions and exceptions for mail flow rules on Mailbox servers](mail-flow-rule-conditions-and-exceptions-predicates-in-exchange-2013-exchange-2013-help.md).

Правила транспорта могут проверять только содержимое поддерживаемых типов файлов. Если агент правил транспорта обнаруживает вложение, тип которого отсутствует в списке поддерживаемых типов файлов, вызывается условие `AttachmentIsUnsupported`. Поддерживаемые типы файлов перечислены в следующем разделе. Каждый файл, отсутствующий в списке, вызывает условие `AttachmentIsUnsupported`.

## Сжатые архивные файлы

Если сообщение содержит сжатый архивный файл, такой как ZIP- или CAB-файл, агент правил транспорта проверяет файлы, содержащиеся в этом вложении. Такие сообщения обрабатываются способом, схожим с обработкой сообщений с несколькими вложениями. Свойства сжатых архивных файлов не проверяются. Например, если тип файла-контейнера поддерживает примечания, это поле не просматривается.

## Поддерживаемые типы файлов для проверки содержимого с помощью правил транспорта

В следующей таблице перечислены типы файлов, которые поддерживаются правилами транспорта. Система автоматически обнаруживает типы файлов, изучая их свойства, а не расширение. Так пользователи, рассылающие нежелательную почту, не смогут обойти фильтрацию правил транспорта, переименовав расширение файла. Список типов файлов с исполняемым кодом, которые могут проверяться с помощью правил транспорта, представлен далее в этом разделе.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Категория</th>
<th>Расширение файла</th>
<th>Примечания</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Office 2013, Office 2010 и Office 2007</p></td>
<td><p>.docm, .docx, .pptm, .pptx, .pub, .one, .xlsb, .xlsm, .xlsx</p></td>
<td><p>Файлы Microsoft OneNote и Microsoft Publisher не поддерживаются по умолчанию. Поддержку этих типов файлов можно включить с помощью интеграции IFilter. Дополнительные сведения см. в разделе <a href="register-filter-pack-ifilters-with-exchange-2013-exchange-2013-help.md">Регистрация фильтров IFilter из пакета фильтров с помощью Exchange 2013</a>.</p>
<p>Содержимое любых внедренных частей внутри этих типов файлов также проверяется. Однако любые объекты помимо встроенных, например связанные, не анализируются.</p></td>
</tr>
<tr class="even">
<td><p>Office 2003</p></td>
<td><p>.doc, .ppt, .xls</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="odd">
<td><p>Дополнительные файлы Office</p></td>
<td><p>.rtf, .vdw, .vsd, .vss, .vst</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="even">
<td><p>Adobe PDF</p></td>
<td><p>.pdf</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="odd">
<td><p>HTML</p></td>
<td><p>.html</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="even">
<td><p>XML</p></td>
<td><p>.xml, .odp, .ods, .odt</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="odd">
<td><p>Текст</p></td>
<td><p>TXT, ASM, BAT, C, CMD, CPP, CXX, DEF, DIC, H, HPP, HXX, IBQ, IDL, INC, INF, INI, INX, JS, LOG, M3U, PL, RC, REG, TXT, VBS, WTX</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="even">
<td><p>OpenDocument</p></td>
<td><p>.odp, .ods, .odt</p></td>
<td><p>Части ODF-файлов не обрабатываются. Например, если ODF-файл содержит внедренный документ, содержимое внедренного документа не просматривается.</p></td>
</tr>
<tr class="odd">
<td><p>Чертеж AutoCAD</p></td>
<td><p>.dxf</p></td>
<td><p>Файлы AutoCAD 2013 не поддерживаются.</p></td>
</tr>
<tr class="even">
<td><p>Изображение</p></td>
<td><p>.jpg, .tiff</p></td>
<td><p>Проверяется только текст метаданных, связанный с этими файлами изображений. Распознавание текста не применяется.</p></td>
</tr>
</tbody>
</table>


## Проверка свойств файла вложения

Приведенные ниже условия правила транспорта проверяют свойства файла, вложенного в сообщение. Чтобы использовать эти условия при проверке сообщений, их необходимо добавить в правило транспорта. Список поддерживаемых типов файлов с исполняемым кодом, которые могут проверяться с помощью правил транспорта, представлен далее. Дополнительные сведения о создании и изменении правил см. в разделе [Управление правилами потока обработки почты](manage-mail-flow-rules-exchange-2013-help.md).


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Имя условия в Центре администрирования Exchange</th>
<th>Имя условия в командной консоли</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>Имя любого файла вложения соответствует этим текстовым шаблонам</strong></p></td>
<td><p><code>AttachmentNameMatchesPatterns</code></p></td>
<td><p>Это условие сопоставляет сообщения с поддерживаемыми типами файлов вложений, если имя таких вложений содержит указанные символы.</p></td>
</tr>
<tr class="even">
<td><p><strong>Расширение любого файла вложения включает эти слова</strong></p></td>
<td><p><code>AttachmentExtensionMatchesWords</code></p></td>
<td><p>Это условие сопоставляет сообщения с поддерживаемыми типами файлов вложений, если расширение имени файла соответствует указанному.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Размер любого вложения равен или превышает</strong></p></td>
<td><p><code>AttachmentSizeOver</code></p></td>
<td><p>Это условие соответствует сообщениям с поддерживаемыми типами файлов вложений, если их размер больше указанного.</p></td>
</tr>
<tr class="even">
<td><p><strong>Любое вложение, проверка которого не завершена</strong></p></td>
<td><p><code>AttachmentProcessingLimitExceeded</code></p></td>
<td><p>Это условие соответствует сообщениям, если вложение не было проверено агентом правил транспорта.</p></td>
</tr>
<tr class="odd">
<td><p><strong>Любое вложение содержит исполняемое содержимое</strong></p></td>
<td><p><code>AttachmentHasExecutableContent</code></p></td>
<td><p>Это условие сопоставляет сообщения, которые содержат исполняемые файлы в виде вложений. В этом разделе перечислены поддерживаемые типы файлов.</p></td>
</tr>
<tr class="even">
<td><p><strong>Любое вложение защищено паролем</strong></p></td>
<td><p><code>AttachmentIsPasswordProtected</code></p></td>
<td><p>Это условие соответствует сообщениям с поддерживаемыми типами файлов вложений, если они защищены паролем.</p></td>
</tr>
</tbody>
</table>


Имена Командная консоль Exchange перечисленных здесь условий входят в число параметров, для которых требуется командлет `TransportRule`.

  -  
    Дополнительные сведения о командлете см. в статье [New-TransportRule](https://technet.microsoft.com/ru-ru/library/bb125138\(v=exchg.150\)).

  -  
    Дополнительные сведения о типах свойств этих условий см. в статье [Conditions and exceptions for mail flow rules on Mailbox servers](mail-flow-rule-conditions-and-exceptions-predicates-in-exchange-2013-exchange-2013-help.md).

## Поддерживаемые типы исполняемых файлов для проверки правил транспорта

Агент транспорта использует обнаружение подлинных типов, изучая свойства, а не только расширение файла. Это не позволяет злоумышленникам обойти данное правило, переименовав расширение. В таблице ниже перечислены типы исполняемых файлов, которые поддерживают эти условия. Если обнаружен файл, которого нет в этой таблице, инициируется условие `AttachmentIsUnsupported`.


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип файла</th>
<th>Собственное расширение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Самораспаковывающийся архив, созданный WinRAR.</p></td>
<td><p>.rar</p></td>
</tr>
<tr class="even">
<td><p>32-разрядный исполняемый файл Windows с расширением библиотеки динамической компоновки.</p></td>
<td><p>.dll</p></td>
</tr>
<tr class="odd">
<td><p>Самораспаковывающийся исполняемый файл.</p></td>
<td><p>.exe</p></td>
</tr>
<tr class="even">
<td><p>Архивный файл Java.</p></td>
<td><p>.jar</p></td>
</tr>
<tr class="odd">
<td><p>Исполняемый файл для удаления.</p></td>
<td><p>.exe</p></td>
</tr>
<tr class="even">
<td><p>Файл ярлыка программы.</p></td>
<td><p>.exe</p></td>
</tr>
<tr class="odd">
<td><p>Файл скомпилированного исходного кода, файла 3D-объекта или файл последовательности.</p></td>
<td><p>.obj</p></td>
</tr>
<tr class="even">
<td><p>32-разрядный исполняемый файл Windows.</p></td>
<td><p>.exe</p></td>
</tr>
<tr class="odd">
<td><p>Файл документа Microsoft Visio в формате XML.</p></td>
<td><p>.vxd</p></td>
</tr>
<tr class="even">
<td><p>Файл операционной системы OS/2.</p></td>
<td><p>.os2</p></td>
</tr>
<tr class="odd">
<td><p>16-разрядный исполняемый файл Windows.</p></td>
<td><p>.w16</p></td>
</tr>
<tr class="even">
<td><p>Файл дисковой операционной системы.</p></td>
<td><p>.dos</p></td>
</tr>
<tr class="odd">
<td><p>Стандартный файл антивирусной проверки Европейского Института исследования Антивирусных Программ.</p></td>
<td><p>.com</p></td>
</tr>
<tr class="even">
<td><p>Файл сведений о программе Windows.</p></td>
<td><p>.pif</p></td>
</tr>
<tr class="odd">
<td><p>Исполняемый файл Windows.</p></td>
<td><p>.exe</p></td>
</tr>
</tbody>
</table>


## Расширение количества поддерживаемых типов файлов

Поддерживаемые типы файлов, перечисленные в этом разделе, можно изменить в любое время с помощью интеграции IFilter. Подробнее см. в разделе [Регистрация фильтров IFilter из пакета фильтров с помощью Exchange 2013](register-filter-pack-ifilters-with-exchange-2013-exchange-2013-help.md).

Типы файлов, добавленные таким способом, становятся поддерживаемыми типами файлов и больше не вызывают условие `AttachmentIsUnsupported`.

## Политики защиты от потери данных (DLP) и правила транспорта вложений

Чтобы упростить управление важными бизнес-данными в электронной почте, вы можете добавить любые связанные с вложениями условия вместе с правилами политики защиты от потери данных (DLP). Например, можно разрешить отправку сообщений с номерами паспортов, только если эти данные находятся во вложении, защищенном паролем. Для этого выполните следующие действия.

  - Создайте политику DLP, которая проверяет сообщения на наличие конфиденциальных данных, связанных с паспортами. Дополнительные сведения см. в разделе [Процедуры защиты от потери данных](dlp-procedures-exchange-2013-help.md).

  - Добавьте исключение **Любое вложение защищено паролем** в области правила транспорта **Кроме случаев, когда…**.

  - Определите действие, которое будет выполняться для сообщений, содержащих номера паспортов не защищенном файле.

Политики DLP и условия, связанные с вложениями, позволяют выполнить бизнес-требования, определив их как условия, исключения и действия правила транспорта. Если добавить в политику DLP анализ конфиденциальных данных, все вложения сообщений будут проверяться только на наличие этой информации. Однако условия, связанные с вложениями, такие как размер или тип файла, не будут использоваться, пока не добавить условия, указанные в этом разделе. Компонент DLP доступен не во всех версиях Exchange. Дополнительные сведения см. в разделе [Защита от потери данных](technical-overview-of-dlp-data-loss-prevention-in-exchange.md).

## Дополнительные сведения

[Защита от потери данных](technical-overview-of-dlp-data-loss-prevention-in-exchange.md)

[Правила обработки почтового потока и транспорта](mail-flow-rules-transport-rules-in-exchange-2013-exchange-2013-help.md)

[Условия правил транспорта (предикаты)](mail-flow-rule-conditions-and-exceptions-predicates-in-exchange-2013-exchange-2013-help.md)

[Проверка вложений с помощью правил обработки почтового потока](https://technet.microsoft.com/ru-ru/library/jj919236\(v=exchg.150\)) в Exchange Online

