---
title: 'Поиск и удаление сообщений (справка администратора): Exchange 2013 Help'
TOCTitle: Поиск и удаление сообщений (справка администратора)
ms:assetid: 8c36bb03-e716-4fdd-9958-4aa7a2a1db42
ms:mtpsurl: https://technet.microsoft.com/ru-ru/library/Ff459253(v=EXCHG.150)
ms:contentKeyID: 52059210
ms.date: 04/30/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Поиск и удаление сообщений (справка администратора)

 

_**Применимо к:**Exchange Online, Exchange Server 2013_

_**Последнее изменение раздела:**2017-12-20_

Администраторы могут использовать командлет **Search-Mailbox** для поиска и удаления сообщений в почтовых ящиках пользователей.

Чтобы найти и одновременно удалить сообщения, выполните командлет **Search-Mailbox** с параметром *DeleteContent*. Однако при этом вы не сможете предварительно просмотреть результаты поиска или создать журнал сообщений, которые будут возвращены в результатах поиска. Таким образом, вы можете случайно удалить сообщения, которые не хотели удалять. Чтобы просмотреть журнал сообщений в результатах поиска перед их удалением, выполните командлет **Search-Mailbox** с параметром *LogOnly*.

В целях дополнительной защиты данных можно предварительно скопировать сообщения в другой почтовый ящик с помощью параметров *TargetMailbox* и *TargetFolder*. Благодаря этому сохранится копия удаленных сообщений на случай необходимости доступа к ним в будущем.

## Что нужно знать для начала?

  - Предполагаемое время выполнения: 10 минут. Фактическое время зависит от размера почтового ящика и запроса поиска.

  - Для выполнения этих процедур нельзя использовать Центр администрирования Exchange. Необходимо использовать командную консоль.

  - Для поиска и удаления сообщений в почтовых ящиках пользователей необходимы обе указанные ниже роли управления.
    
      - **Поиск в почтовых ящиках.**   Эта роль позволяет искать сообщения в нескольких почтовых ящиках в пределах организации. Администраторы не имеют этой роли по умолчанию. Чтобы назначить себя этой роли для поиска в почтовых ящиках, добавьте себя в группу ролей "Управление обнаружением". См. раздел [Назначение разрешений обнаружения электронных данных в Exchange](assign-ediscovery-permissions-in-exchange-exchange-2013-help.md).
    
      - **Импорт и экспорт почтовых ящиков.**   Эта роль позволяет удалять сообщения из почтового ящика пользователя. По умолчанию эта роль группе ролей не назначена. Для удаления сообщений из почтовых ящиков пользователей следует добавить роль "Импорт и экспорт почтовых ящиков" в группу ролей "Управление организацией". Дополнительные сведения см. в разделе "Добавление роли в группу ролей" статьи [Управление группами ролей](manage-role-groups-exchange-2013-help.md).

  - Если для почтового ящика, из которого необходимо удалить сообщения, включена функция восстановления одного элемента, сначала необходимо отключить ее. Дополнительные сведения см. в статье [Включение или отключение восстановления одного элемента в почтовом ящике](enable-or-disable-single-item-recovery-for-a-mailbox-exchange-2013-help.md).

  - Если почтовый ящик, из которого необходимо удалить сообщения, помещен на хранение, рекомендуем обратиться в отдел управления записями или юридический отдел, прежде чем отключать хранение и удалять содержимое почтового ящика. Получив утверждение, выполните действия, описанные в статье [Очистка папки "Элементы с возможностью восстановления"](clean-up-the-recoverable-items-folder-exchange-2013-help.md).

  - С помощью командлета **Search-Mailbox** можно выполнить поиск не более чем в 10 000 почтовых ящиков. Если в вашей организации Exchange Online более 10 000 почтовых ящиков, вы можете использовать функцию поиска соответствия (или связанный с ней командлет **New-ComplianceSearch**), чтобы выполнять поиск в неограниченном количестве почтовых ящиков. Затем вы можете удалить сообщения, возвращенные поиском соответствия, с помощью командлета **New-ComplianceSearchAction**. Дополнительные сведения см. в статье [Поиск и удаление сообщений электронной почты из организации Office 365](https://go.microsoft.com/fwlink/p/?linkid=786856).

  - Если вы включите поисковый запрос (используя параметр *SearchQuery*), командлет **Search-Mailbox** вернет максимум 10 000 элементов. Поэтому, чтобы удалить более 10 000 элементов, может потребоваться выполнить команду **Search-Mailbox** несколько раз.

  - При запуске командлета **Search-Mailbox** поиск также выполняется в архивном почтовом ящике пользователя. Аналогично, при использовании командлета **Search-Mailbox** с параметром *DeleteContent* удаляются элементы в основном архивном почтовом ящике. Чтобы этого не произошло, можно включить параметр *DoNotIncludeArchive*. Кроме того, мы не рекомендуем использовать параметр *DeleteContent* для удаления сообщений в почтовых ящиках Exchange Online, для которых включено автоматическое расширение архивов, так как это может привести к непредвиденной потере данных.

## Поиск сообщений и ведение журнала результатов

В этом примере в почтовом ящике пользователя April Stewart выполняется поиск сообщений, содержащих фразу "Your bank statement" в теме; результаты поиска записываются в журнал в папке SearchAndDeleteLog почтового ящика администратора. Сообщения не копируются в целевой почтовый ящик и не удаляются из него.

    Search-Mailbox -Identity "April Stewart" -SearchQuery 'Subject:"Your bank statement"' -TargetMailbox administrator -TargetFolder "SearchAndDeleteLog" -LogOnly -LogLevel Full

В этом примере во всех почтовых ящиках организации выполняется поиск сообщений с любыми типами вложенных файлов, содержащих слово Trojan в имени. При этом сообщение журнала отправляется в почтовый ящик администратора.

    Get-Mailbox -ResultSize unlimited | Search-Mailbox -SearchQuery attachment:trojan* -TargetMailbox administrator -TargetFolder "SearchAndDeleteLog" -LogOnly -LogLevel Full

Подробные сведения о синтаксисе и параметрах см. в разделе [Search-Mailbox](https://technet.microsoft.com/ru-ru/library/dd298173\(v=exchg.150\)).

К началу

## Поиск и удаление сообщений

В этом примере в почтовом ящике пользователя April Stewart выполняется поиск сообщений, содержащих фразу "Your bank statement" в теме; сообщения удаляются из исходного почтового ящика без копирования результатов поиска в другую папку. Как было указано ранее, вам должна быть назначена роль управления "Экспорт и импорт почтового ящика", чтобы удалять сообщения из почтового ящика пользователя.

<table>
<thead>
<tr class="header">
<th><img src="images/Dd876857.important(EXCHG.150).gif" title="Важно" alt="Важно" />Важно!</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>При использовании командлета <strong>Search-Mailbox</strong> с параметром <em>DeleteContent</em> сообщения окончательно удаляются из исходного почтового ящика. Перед окончательным удалением сообщений рекомендуется использовать параметр <em>LogOnly</em> для создания журнала сообщений, найденных в результатах поиска, или скопировать эти сообщения в другой почтовый ящик перед их удалением из исходного почтового ящика.</td>
</tr>
</tbody>
</table>


    Search-Mailbox -Identity "April Stewart" -SearchQuery 'Subject:"Your bank statement"' -DeleteContent

В этом примере в почтовом ящике пользователя April Stewart выполняется поиск сообщений, содержащих фразу "Your bank statement" в теме; результаты поиска копируются в папку AprilStewart-DeletedMessages почтового ящика BackupMailbox, а сообщения удаляются из почтового ящика April.

    Search-Mailbox -Identity "April Stewart" -SearchQuery 'Subject:"Your bank statement"' -TargetMailbox "BackupMailbox" -TargetFolder "AprilStewart-DeletedMessages" -LogLevel Full -DeleteContent

В этом примере во всех почтовых ящиках организации выполняется поиск сообщений, содержащих строчку "Download this file" в теме, после чего эти сообщения безвозвратно удаляются.

    Get-Mailbox -ResultSize unlimited | Search-Mailbox -SearchQuery 'Subject:"Download this file"' -DeleteContent

Подробные сведения о синтаксисе и параметрах см. в разделе [Search-Mailbox](https://technet.microsoft.com/ru-ru/library/dd298173\(v=exchg.150\)).

К началу

## Использование параметра -LogLevel Full

В некоторых предыдущих примерах параметр *LogLevel* со значением `Full` используется для записи подробной информации о результатах, возвращаемых командлетом **Search-Mailbox**. Если этот параметр включен, в почтовый ящик, указанный параметром *TargetMailbox*, отправляется сообщение с файлом журнала (Search Results.csv), который будет находиться в папке, указанной параметром *TargetFolder*. Файл журнала содержит по одной строке для каждого сообщения, включенного в результаты поиска при выполнении командлета **Search-Mailbox**.

